---
title: 什么是状态？
toc: true
clearReading: true
thumbnailImagePosition: right
metaAlignment: center
thumbnailImage:
categories: 其他
tags: 操作系统
keywords: [有状态,无状态]
excerpt: 经常听到什么有状态服务，无状态服务，这些概念究竟想要表达什么含义？
---

## 概述
**有状态服务**和**无状态服务**是两种不同的服务架构，两者的不同之处在于对于服务状态的处理。

:question:什么是服务的状态？
{% alert success no-icon%}
服务状态是请求所需的数据，它可以是一个变量或者一个数据结构
{%endalert%}

无状态服务不会记录服务状态，不同请求之间也是没有任何关系；而有状态服务则刚好相反，不同的请求之间是有关联关系的。判断一个服务的状态性的标识就是：两个来自相同发起者的请求在服务端是否具有上下文关系
### 无状态服务

无状态请求，服务器端所能够处理的数据全部来自于请求所携带的信息，无状态服务对于客户端的单次请求的处
理，不依赖于其他请求，处理一次请求的信息都包含在该请求里。最典型的就是通过cookie保存token的方式传输
请求数据。也可以理解为Cookie是通过客户端保持状态的解决方案
{% image fancybox fig-100  center  https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20211102194130571.png%}

### 有状态服务

有状态服务则相反，服务会存储请求上下文相关的数据信息，先后的请求是可以有关联的。例如，在Web 应用
中，经常会使用Session 来维系登录用户的上下文信息。虽然http 协议是无状态的，但是借助Session，可以使
http 服务转换为有状态服务

{% image fancybox fig-100  center  https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20211102194134064.png %}


## 云原生场景下的状态分析

### 有状态应用

### 无状态应用


## 附录


# 云原生应用

:question:什么是一个应用的状态？

- 它在特定时间的状况或品质，即它的存在状态。

如果同一时刻同一个请求产生的数据的状态大于一，则是有状态的，只有一个状态则为无状态

:question:如何判断一个应用是有状态还是无状态的

要判断一个应用为有状态或无状态，取决于交互状态的**记录时长**以及**该信息所需的存储方式**



## 无状态应用

无状态进程或应用可以理解为孤立的。关于它的既往事务，我们一无所知，没有任何参考。每项事务处理似乎都是从头开始。无状态应用只提供一项服务或功能，并使用内容交付网络（CDN）、Web 或打印服务器来处理这些短期请求。 

无状态事务的典型示例是执行在线搜索，寻找您想要的答案。您在搜索引擎中输入问题，然后按 Enter。如果您的事务被意外中断或关闭，则只需重新开始即可。我们不妨将无状态事务看作一台自动售货机：一个请求对应一个响应。 

## 有状态应用

有状态应用和流程则是可以周而复始、反复发生的应用和流程，例如网上银行或电子邮件。

这些操作是在先前的事务背景下执行的，当前事务可能会受到先前事务的影响。正因如此，有状态应用在每次处理用户的请求时**都会使用相同的服务器**

如果有状态事务被中断，其上下文和历史记录会被存储下来，这样就可以或多或少地从上次中断的地方继续。

有状态应用会跟踪诸如窗口位置、设置首选项和近期活动等内容。我们可以把有状态事务视为与同一个人进行的定期对话。

## 容器与状态

随着云计算和微服务的普及，无论是有状态还是无状态应用，其容器化程度都在不断提高。容器时一组打包在一起的应用代码以及他们的库和依赖项，这样一来，他们就可以轻松移动并能在任何环境中运行——无论是在台式机、传统IT基础架构上，还是在云端

最初，容器被构建为无状态，因为这比较符合其便携、灵活的特性。但随着容器的广泛使用，人们开始对现有的有状态应用进行容器化处理（重新设计和重新封装，以实现从容器运行）。这在为他们赋予容器的灵活性和速度的同时，也提供了有状态应用的存储和上下文。

正因为这个原因，有状态应用越来越像无状态应用，无状态应用向有状态应用靠近的趋势，如：存在一个无状态的应用，它不需要长期存储，但允许服务器使用 Cookie 来跟踪同一客户端的请求



## 无状态和有状态容器管理

有状态现在已成为容器存储的主体，而现在的问题从要不要使用有状态容器，变成了该如何使用

究竟是使用有状态还是无状态容器，要取决于构建哪种类型的应用以及用途。如果只是临时需要信息（快速而短暂），无状态便是解决之道。但如果应用需要更多的内存来存储从一个会话到下一个会话的操作，则应用采用有状态方式



# 有状态服务

有状态服务，即服务端需要记录每次会话的客户端信息，从而识别客户端身份，根据用户身份进行请求的处理，典型的设计如 tomcat 中的 session。

例如登录：用户登录后，我们把登录者的信息保存在服务端 session 中，并且给用户一个 cookie 值，记录对应的 session。然后下次请求，用户携带 cookie 值来，我们就能识别到对应 session，从而找到用户的信息。

:persevere:有状态的缺点

- 服务端保存大量数据，增加服务端压力
- 服务端保存用户状态，无法进行水平扩展
- 客户端请求依赖服务端，多次请求必须访问同一台服务器



# 无状态服务

客户端的每次请求必须具备自描述信息，通过这些信息识别客户端身份。服务端不保存任何客户端请求者信息。

:sparkles:无状态服务特点

- 客户端请求不依赖服务端的信息，任何多次请求不需要必须访问到同一台服务
- 服务端的集群和状态对客户端透明
- 服务端可以任意的迁移和伸缩
- 减小服务端存储压力





# 【高可用架构】理解有状态服务和无状态服务

http://liaojiacan.me/2019/05/27/%E3%80%90%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84%E3%80%91%E7%90%86%E8%A7%A3%E6%9C%89%E7%8A%B6%E6%80%81%E6%9C%8D%E5%8A%A1%E5%92%8C%E6%97%A0%E7%8A%B6%E6%80%81%E6%9C%8D%E5%8A%A1/index.html

# 分布式系统中的“无状态”和“有状态”详解

https://blog.csdn.net/universsky2015/article/details/105677992

# 无状态服务VS有状态服务

https://blog.csdn.net/u010472499/article/details/53888480

云原生应用

# 有状态与无状态



https://www.proud2becloud.com/stateful-vs-stateless-the-good-the-bad-and-the-ugly/

https://www.xenonstack.com/insights/stateful-and-stateless-applications

# 附录

[RedHat](https://www.redhat.com/zh/topics/cloud-native-apps/stateful-vs-stateless)
[Stateful and Stateless Applications Best Practices and Advantages](https://www.xenonstack.com/insights/stateful-and-stateless-applications)

