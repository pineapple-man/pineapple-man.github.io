---
title: 物理建模
toc: true
clearReading: true
metaAlignment: center
categories: 数据库
tags: 数据库
keywords: 
    - 物理建模
    - 三范式
excerpt: 本文主要讲解数据库设计应当遵从的规则，并推荐常用的物理建模工具
---

<font style="color:red;font-weight:bold">数据库最苦难的两步：创建和维护</font>

## 物理建模

:sparkles:物理建模就是主要包括两部分内容，确定最基本的数据结构，以及对约束建模

### 理论

主要记录数据库中存在的范数理论

#### 第一范式

- 第一范式：数据库表中的每一列都不可再分，满足<font style="color:red;font-weight:bold">原子性</font>

![](https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20210903130503266.png)

上面这个表中**部门岗位**应该拆分成两个字段：**部门名称**、**岗位**  

![](https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20210903130631420.png)

#### 第二范式

- 第二范式：在满足第一范式基础上要求<font style="color:red;font-weight:bold">每个字段都和主键完整相关</font>，而不是仅和主键部分相关（主要针对联合主键而言）

![](https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20210903130847241.png)

**订单详情表** 使用**订单编号** 和**产品编号**作为联合主键

此时**产品价格**、**产品数量**都和联合主键整体相关，但**订单金额** 和**下单时间**只和联合主键中的**订单编号** 相关， 和“**产品编号**” 无关。 所以只关联了主键中的部分字段， 不满足第二范式。  

把“**订单金额**” 和“**下单时间**” 移到订单表就符合第二范式了  

![](https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20210903130913085.png)

#### 第三范式

- 第三范式：表中的非主键字段和主键字段<font style="color:red;font-weight:bold">直接相关</font>，不允许间接相关

![](https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20210903131051787.png)

:bug:上面表中的“**部门名称**” 和“**员工编号**” 的关系是“**员工编号**” →“**部门编号**”→“**部门名称**”， 不是直接相关，此时会带来下列问题  ：

- 数据冗余：**部门名称**多次重复出现
- 插入异常：组件一个新部门时没有员工信息，也就无法单独插入部门信息。就算强行插入部门信息，员工表中没有员工信息的记录同样是非法记录
- 删除异常：删除员工信息会连带删除部门信息导致部门信息意外丢失
- 更新异常：哪怕只修改一个部门的名称也要更新多条员工记录

:bulb:正确的做法是：把上表拆分成两张表，以外键形式关联

![](https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20210903131603870.png)

“**部门编号**” 和“**员工编号**” 是直接相关的  

第三范式的另一种表述方式是： 两张表要通过外键关联， 不保存冗余字段。 例如： 不能在“**员工表**” 中存储“**部门名称**”  

反三范式：反三范式是基于第三范式所调整的，没有冗余的数据库未必是最好的数据库，有时为了提高运行效率，就必须降低 范式标准，适当保留冗余数据

### 实践

:sparkles:项目中如何进行数据库建模

- 规则的变通：三大范式是设计数据库表结构的规则约束，但是在实际开发中允许局部变通

> :bulb:比如为了快速查询到关联数据可能会允许冗余字段的存在。 例如在员工表中存储部门名称<font style="color:red;font-weight:bold">虽然违背第三范式， 但是免去了对部门表的关联查询</font>

- 根据业务功能设计数据库表
  - 看得见的字段（能够从需求文档或原型页面上直接看到的数据都需要设计对应的数据库表、字段来存储）
  - 看不见的字段（保存一些相关数据）
  - 冗余字段（为了避免建表时考虑不周有所遗漏，到后期再修改表结构非常麻烦，所以也有的团队会设置一些额外的冗余字段备用）
- 实际开发对接（实际开发中除了一些各个模块都需要使用的公共表再项目启动时创建好，其他<font style="color:blue;font-weight:bold">专属于各个模块的表由该模块的负责人创建</font>。但<font style="color:red;font-weight:bold">通常开发人员不能直接操作数据库服务器，所以需要把建表的SQL语句发送给运维工程师执行创建操作</font>）

## 建模工具

对于数据模型的建模，最有名的要数PowerDesigner，但是了解到国人开发的pdMan也挺好用的【研一暑假做项目时使用过，对于当时还是新手的我还是挺友好的】

PowerDesigner是一个很方便的建模工具，只需要拉个图形然后自动生成sql语句，他的优势在于：不用在使 用create table等语句创建表结构，数据库设计人员只关注如何进行数据建模即可，将来的数据库语句，可以自动生成

## 附录

[PowerDesigner介绍](https://www.cnblogs.com/huangting/p/12654057.htm)

[pdman介绍](https://blog.csdn.net/xinzhifu1/article/details/111693664)

