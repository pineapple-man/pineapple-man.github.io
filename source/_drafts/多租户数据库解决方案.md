---
title: 多租户数据库解决方案
toc: true
clearReading: true
metaAlignment: center
categories: 解决方案
tags: 数据库
keywords: 多租户的解决方案
excerpt: 在 SaaS 项目中不可避免会拥有多个用户，那么如何进行多租户管理是常见的问题，本文总结并比较常用的方法，给出三种解决方案
---
## 概述

:question:多租户是什么？

多租户技术（Multi-TenancyTechnology）又称多重租赁技术：是一种软件架构技术，是实现如何在多用户环境下共用相同的系统或程序组件，并且可确保各用户间数据的隔离性

简单理解：在一台服务器上运行单个应用实例，它为多个租户（客户）提供服务

从定义中我们可以理解：多租户是一种架 构，目的是为了让多用户环境下使用同一套程序，且保证用户间数据隔离

多租户的重点就是同一套程序下实现多用户数据的隔离

## 需求分析

传统软件模式，指将软件产品进行买卖，是一种单纯的买卖关系，客户通过买断的方式获取软件的使用权，软件的 源码属于客户所有，因此传统软件是部署到企业内部，不同的企业各自部署一套自己的软件系统

Saas模式，指服务提供商提供的一种软件服务，应用统一部署到服务提供商的服务器上，客户可以根据自己的实际 需求按需付费。用户购买基于WEB的软件，而不是将软件安装在自己的电脑上，用户也无需对软件进行定期的维护与管理

![](https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20211031145720464.png)

在SaaS平台里需要使用共用的数据中心以单一系统架构与服务提供多数客户端相同甚至可定制化的服务，并且仍可以保障客户的数据正常使用。由此带来了新的挑战，就是如何对应用数据进行设计，以支持多租户，而这种设计的 思路，是要在数据的共享、安全隔离和性能间取得平衡

## 设计方案

目前基于多租户的数据库设计方案通常有如下三种：

- 独立数据库
- 共享数据库、独立`Schema`
- 共享数据库、共享数据表

### 独立数据库

独立数据库：每个租户一个数据库

优点：为不同的租户提供独立的数据库，有助于简化数据模型的扩展设计，满足不同租户的独特需求；如果出现故障，恢复数据比较简单

缺点： 增多了数据库的安装数量，随之带来维护成本和购置成本的增加

这种方案与传统的一个客户、一套数据、一套部署类似，差别只在于软件统一部署在运营商那里。由此可见此方案 用户数据隔离级别最高，安全性最好，但是成本较高

###  共享数据库、独立 Schema

:question:什么是数据库Schema

oracle数据库：在oracle中一个数据库可以具有多个用户，那么一个用户一般对应一个Schema，表都是建立在Schema中的,（可以简单的理解：在oracle中一个用户一套数据库表）

![](https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20211031151118555.png)

mysql数据库：mysql数据中的schema比较特殊，并不是数据库的下一级，而是等同于数据库。比如执行create schema test 和执行create database test效果是一模一样的  


![](https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20211031151129278.png)

共享数据库、独立 Schema：即多个或所有的租户使用同一个数据库服务（如常见的ORACLE或MYSQL数据库）， 但是每个租户一个Schema

优点： 为安全性要求较高的租户提供了一定程度的逻辑数据隔离，并不是完全隔离；每个数据库可支持更多的租户数量

缺点： 如果出现故障，数据恢复比较困难，因为恢复数据库将牵涉到其他租户的数据； 如果需要跨租户统计数据，存在一定困难

这种方案是方案一的变种。只需要安装一份数据库服务，通过不同的Schema对不同租户的数据进行隔离。由于数 据库服务是共享的，所以成本相对低廉

### 共享数据库、共享数据表

共享数据库、共享数据表：即租户共享同一个Database，同一套数据库表（所有租户的数据都存放在一个数据库 的同一套表中）。在表中增加租户ID等租户标志字段，表明该记录是属于哪个租户的

优点：所有租户使用同一套数据库，所以成本低廉。

缺点：隔离级别最低，安全性最低，需要在设计开发时加大对安全的开发量，数据备份和恢复最困难。

这种方案和基于传统应用的数据库设计并没有任何区别，但是由于所有租户使用相同的数据库表，所以需要做好对 每个租户数据的隔离安全性处理，这就增加了系统设计和数据管理方面的复杂程度

![](https://gitee.com/mingchaohu/blog-image/raw/master/image/image-20211031151423558.png)

