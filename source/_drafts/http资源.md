---
title: http资源
toc: true
clearReading: true
metaAlignment: center
categories: Java Web
tags: HTTP
keywords: HTTP
excerpt: 本文主要讲解在HTTP协议中是如何管理资源的

---



## 概述

:question:什么是资源？

在互联网中，几乎计算机中的任何东西都可以认为是一种资源，互联网最初搭建的目的就是：能够让使用者之间相互共享资源

互联网发展至今，与日常生活距离最近的应用就是Web（浏览器），浏览器中Web 服务器是 Web 资源（Web resource）的宿主。Web 资源是 Web 内容的源头

最简单的 Web 资源就是 Web 服务器文件系统中的静态文件。这些文件可以包含 任意内容：文本文件、HTML 文件、微软的 Word 文件、Adobe 的 Acrobat 文件、 JPEG 图片文件、AVI 电影文件，或所有其他你能够想到的格式，但资源不一定非得是静态文件。资源还可以是根据需要生成内容的软件程序。

所有的东西都有一个标准化的名字，以帮助人们寻找城市中的各种资源。书籍有 ISBN 号，公交车有线路号，银行账户有账户编码，个人有社会保险号码

所有人都对这些名字的标准达成了一致，所以才能方便地共享这座城市的宝藏。你 告诉出租车司机把你载到 McAllister 大街 246 号，他就知道你是什么意思了（即使 他走的是一条很远的路）

## 资源类型

因特网上有数千种不同的数据类型，HTTP 仔细地给每种要通过 Web 传输的对 象都打上了名为 MIME 类型（MIME type）的数据格式标签。最初设计 MIME （Multipurpose Internet Mail Extension，多用途因特网邮件扩展）是为了解决在不同 的电子邮件系统之间搬移报文时存在的问题。MIME 在电子邮件系统中工作得非常 好，因此 HTTP 也采纳了它，用它来描述并标记多媒体内容。

Web 服务器会为所有 HTTP 对象数据附加一个 MIME 类型（参见图 1-3）。当 Web 浏览器从服务器中取回一个对象时，会去查看相关的 MIME 类型，看看它是否知道 应该如何处理这个对象。

## 定位资源

每个 Web 服务器资源都有一个名字，这样客户端就可以说明它们感兴趣的资源是 什么了。服务器资源名被称为统一资源标识符（Uniform Resource Identifier，URI）。 URI 就像因特网上的邮政地址一样，在世界范围内唯一标识并定位信息资源。

### URI

URI 是一类更通用的资源标识符，URL 实际上是它的一个子集。URI 是一个通用的 概念，由两个主要的子集 URL 和 URN 构成，URL 是通过描述资源的位置来标识资 源的，而 URN（本章稍后会介绍）则是通过名字来识别资源的，与它们当前所处位 置无关

URI 有两种形式，分别称为 URL 和 URN。

HTTP 规范将更通用的概念 URI 作为其资源标识符，但实际上，HTTP 应用程序处 理的只是 URI 的 URL 子集

### URL

URL 是浏览器寻找信息时所需的资源位置。通过 URL，人类和应用程序才能找到、 使用并共享因特网上大量的数据资源。URL 是人们对 HTTP 和其他协议的常用访问 点：一个人将浏览器指向一个 URL，浏览器就会在幕后发送适当的协议报文来获取 人们所期望的资源。

统一资源定位符（URL）是资源标识符最常见的形式。URL 描述了一台特定服务器 上某资源的特定位置。它们可以明确说明如何从一个精确、固定的位置获取资源。

![image-20211029093457141](C:/Users/14376/AppData/Roaming/Typora/typora-user-images/image-20211029093457141.png)

URL实例

| URL                                                        | 描述                                                         |
| ---------------------------------------------------------- | ------------------------------------------------------------ |
| `http://www.oreilly.com/index.html`                        | O’Reilly & Associates 公司的主 URL                           |
| `https://pineapple-man.github.io/assets/images/logo.jpg`   | 我的博客logo的URL                                            |
| `p://joe:tools4u@ftp.joes-hardware.com/locking-pliers.gif` | 用 密 码 保 护 的 FTP 作 为 访 问 协 议 的 locking-pliers.gif 图片文件的 URL |

大部分 URL 都遵循一种标准格式，这种格式包含三个部分

URL 的第一部分被称为方案（scheme），说明了访问资源所使用的协议类型。这 部分通常就是 HTTP 协议（http://）以告知 Web 客户端怎 样访问资源

第二部分给出了服务器的因特网地址（比如，www.joes-hardware.com）告知 Web 客户端资源位于何处

其余部分指定了 Web 服务器上的某个资源路径（比如，/specials/saw-blade.gif）路径说明了请求的是 服务器上哪个特定的本地资源

URL 可以通过 HTTP 之外的其他协议来访问资源。它们可以指向因特网上的任意资 源，或者个人的 E-mail 账户

`mailto:president@whitehouse.gov`

或者通过其他协议（比如 FTP 协议）访问的各种文件：

`ftp://ftp.lots-o-books.com/pub/complete-price-list.xls`

URL 提供了一种统一的资源命名方式。大多数 URL 都有同样的：“方案 :// 服务器 位置 / 路径”结构。因此，对网络上的每个资源以及获取这些资源的每种方式来说， 命名资源的方法都只有一种，这样不管是谁都可以用名字来找到这个资源了

### URN

URI 的第二种形式就是统一资源名（URN）。URN 是作为特定内容的唯一名称使用 的，与目前的资源所在地无关。使用这些与位置无关的 URN，就可以将资源四处搬 移。通过 URN，还可以用同一个名字通过多种网络访问协议来访问资源

:persevere:URN 仍然处于试验阶段，还未大范围使用。

## URL的语法

URL 提供了一种定位因特网上任意资源的手段，但这些资源是可以通过各种不同的 方案（比如 HTTP、FTP、SMTP）来访问的，因此 URL 语法会随方案的不同而有 所不同

这是不是意味着每种不同的 URL 方案都会有完全不同的语法呢？实际上，不是的。 大部分 URL 都遵循通用的 URL 语法，而且不同 URL 方案的风格和语法都有不少重叠

多数 URL 方案的 URL 语法都建立在这个由 9 部分构成的通用格式上：

```url
<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>
```

几乎没有哪个URL中包含了所有这些组件，URL最重要的三个部分是方案（Scheme）、主机（host）和路径（path）

| 组件 |                             描述                             |     默认值     |
| :--: | :----------------------------------------------------------: | :------------: |
| 方案 |             访问服务器以获取资源时要使用哪种协议             |       无       |
| 用户 |                某些方案访问资源时需要的用户名                |      匿名      |
| 密码 |       用户名后面可能要包含的密码，中间由冒号（:）分隔        | <E-mail 地址 > |
| 主机 |             资源宿主服务器的主机名或点分 IP 地址             |       无       |
| 端口 | 资源宿主服务器正在监听的端口号。很多方案都有默认端 口号（HTTP 的默认端口号为 80） |  每个方案特有  |
| 路径 | 服务器上资源的本地名，由一个斜杠（/）将其与前面的 URL 组件分隔开来。路径组件的语法是与服务器和方案有关的（本章稍后会讲到 URL 路径可以分为若干个段，每段都可以有其特有的组件。 |       无       |
| 参数 | 某些方案会用这个组件来指定输入参数。参数为名 / 值对。 URL 中可以包含多个参数字段，它们相互之间以及与路径 的其余部分之间用分号（;）分隔 |       无       |
| 查询 | 某些方案会用这个组件传递参数以激活应用程序（比如数 据库、公告板、搜索引擎以及其他因特网网关）。查询组件的内容没有通用格式。用字符`?`将其与 URL 的其余 部分分隔开来 |       无       |
| 片段 | 一小片或一部分资源的名字。引用对象时，不会将 frag 字 段传送给服务器；这个字段是在客户端内部使用的。通过 字符“#”将其与 URL 的其余部分分隔开来 |       无       |

### 方案——使用什么协议

方案组件必须以一个字母符号开始，由第一个“:”符号将其与 URL 的其余部分分 隔开来。方案名是大小写无关的，因此 URL“http://www.joes-hardware.com”和 “HTTP://www.joes-hardware.com”是等价的

## 主机与端口号

要想在因特网上找到资源，应用程序要知道是哪台机器装载了资源，以及在那台机 器的什么地方可以找到能对目标资源进行访问的服务器。URL 的主机和端口组件提 供了这两组信息

主机组件标识了因特网上能够访问资源的宿主机器。可以用上述主机名（www.joes-hardware.com），或者 IP 地址来表示主机名。

### 用户名和密码

很多服务器都要求输入用户名和密码才会允许用 户访问数据。FTP 服务器就是这样一个常见的实例。这里有几个例子： 

ftp://ftp.prep.ai.mit.edu/pub/gnu 

ftp://anonymous@ftp.prep.ai.mit.edu/pub/gnu ftp://anonymous:my_passwd@ftp.prep.ai.mit.edu/pub/gnu 

http://joe:joespasswd@www.joes-hardware.com/sales_info.txt

第一个例子没有用户或密码组件，只有标准的方案、主机和路径。如果某应用程 序使用的 URL 方案要求输入用户名和密码，比如 FTP，但用户没有提供，它通常 会插入一个默认的用户名和密码

如果向浏览器提供一个 FTP URL，但没 有指定用户名和密码，它就会插入 anonymous（匿名用户）作为你的用户名，并发 送一个默认的密码（Internet Explorer 会发送 IEUser，Netscape Navigator 则会发送 mozilla）

### 路径

URL 的路径组件说明了资源位于服务器的什么地方。路径通常很像一个分级的文件 系统路径。比如： http://www.joes-hardware.com:80/seasonal/index-fall.html

这个 URL 中的路径为 /seasonal/index-fall.html，很像 UNIX 文件系统中的文件系统 路径。路径是服务器定位资源时所需的信息。

这是一种简化的说法，路径并不总能为资源定位提供足够的信息，有时候服务器还需要其他的信息

可以用字符“/”将 HTTP URL 的路 径组件划分成一些路径段（path segment）每个路径段都有自己的参数（param）组件

### 参数

对很多方案来说，只有简单的主机名和到达对象的路径是不够的。除了服务器正在 监听的端口，以及是否能够通过用户名和密码访问资源外，很多协议都还需要更多 的信息才能工作

负责解析 URL 的应用程序需要这些协议参数来访问资源。否则，另一端的服务器可 能就不会为请求提供服务，或者更糟糕的是，提供错误的服务。比如，像 FTP 这样 的协议，有两种传输模式，二进制和文本形式。你肯定不希望以文本形式来传送二 进制图片，这样的话，二进制图片可能会变得一团糟。

为了向应用程序提供它们所需的输入参数，以便正确地与服务器进行交互，URL 中 有一个参数组件。这个组件就是 URL 中的名值对列表，由字符“;”将其与 URL 的 其余部分（以及各名值对）分隔开来。它们为应用程序提供了访问资源所需的所有 附加信息。比如：

ftp://prep.ai.mit.edu/pub/gnu;type=d

在这个例子中，有一个参数 type=d，参数名为 type，值为 d。

如前所述，HTTP URL 的路径组件可以分成若干路径段。每段都可以有自己的参 数。

```
http://www.joes-hardware.com/hammers;sale=false/index.html;graphics=true
```

这个例子就有两个路径段，hammers 和 index.html。hammers 路径段有参数 sale，其值 为 false。index.html 段有参数 graphics，其值为 true

### 查询字符串

很多资源，比如数据库服务，都是可以通过提问题或进行查询来缩小所请求资源类 型范围的

假设 Joe 的五金商店在数据库中维护着一个未售货物的清单，并可以对清单进行查 询，以判断产品是否有货，那就可以用下列 URL 来查询 Web 数据库网关，看看编 号为 12731 的条目是否有货

```
http://www.joes-hardware.com/inventory-check.cgi?item=12731
```

这个 URL 的大部分都与我们见过的其他 URL 类似。只有问号（?）右边的内容是 新出现的。这部分被称为查询（query）组件。URL 的查询组件和标识网关资源的 URL 路径组件一起被发送给网关资源。基本上可以将网关当作访问其他应用程序的 访问点

除了有些不合规则的字符需要特别处理之外，对查询组件的格 式没什么要求。按照常规，很多网关都希望查询字符串以一系列“名 / 值”对的形 式出现，名值对之间用字符“&”分隔：

```
http://www.joes-hardware.com/inventory-check.cgi?item=12731&color=blue
```

### 片段

有些资源类型，比如 HTML，除了资源级之外，还可以做进一步的划分。比如，对 一个带有章节的大型文本文档来说，资源的 URL 会指向整个文本文档，但理想的情 况是，能够指定资源中的那些章节。

为了引用部分资源或资源的一个片段，URL 支持使用片段（frag）组件来表示一个 资源内部的片段。比如，URL 可以指向 HTML 文档中一个特定的图片或小节

片段挂在 URL 的右手边，最前面有一个字符“#”。比如

```
http:://www.joes-hardware.com/tools.html#drills
```

在这个例子中，片段 drills 引用了 Joe 的五金商店 Web 服务器上页面 /tools.html 中的一 个部分。这部分的名字叫做 drills。

HTTP 服务器通常只处理整个对象，3 而不是对象的片段，客户端不能将片段传送给 服务器

浏览器从服务器获得了整个资源之后，会根据片段来显示你 感兴趣的那部分资源

## URL快捷方式

Web 客户端可以理解并使用几种 URL 快捷方式。相对 URL 是在某资源内部指定一 个资源的便捷缩略方式。很多浏览器还支持 URL 的“自动扩展”，也就是用户输入 URL 的一个关键（可记忆的）部分，然后由浏览器将其余部分填充起来。

### 相对URL

URL 有两种方式：绝对的和相对的。到目前为止，我们只见过绝对 URL。绝对 URL 中包含有访问资源所需的全部信息

另一方面，相对 URL 是不完整的。要从相对 URL 中获取访问资源所需的全部信息， 就必须相对于另一个，被称为其基础（base）的 URL 进行解析

相对 URL 是 URL 的一种便捷缩略记法。如果你手工写过 HTML 的话，可能就会发 现相对 URL 是多么便捷了。例 2-1 是一个嵌入了相对 URL 的 HTML 文档实例

```html
<HTML>
<HEAD><TITLE>Joe's Tools</TITLE></HEAD>
<BODY>
<H1> Tools Page </H1>
<H2> Hammers <H2>
<P> Joe's Hardware Online has the largest selection of <A HREF="./
hammers.html">hammers
</A> on earth.
</BODY>
</HTML>
```

在这个 HTML 文档中有一个包含了 URL ./hammers.html 的超链接。这个 URL 看起 来是不完整的，但实际上是个合法的相对 URL。可以相对于它所在文档的 URL 对 其进行解释；在这个例子中，就是相对于 Joe 的五金商店 Web 服务器的资源 /tools. html

### 基础URL

转换处理的第一步就是找到基础 URL。基础 URL 是作为相对 URL 的参考点使用 的。可以来自以下几个不同的地方

#### 在资源中显式提供

有些资源会显式地指定基础 URL。比如，HTML 文档中可能会包含一个定义了 基础 URL 的 HTML 标记 ，通过它来转换那个 HTML 文档中的所有相对 URL

#### 封装资源的基础 URL

如果在一个没有显式指定基础 URL 的资源中发现了一个相对 URL，可以将它所属资源的 URL 作为基础

#### 可以将它所属资源的 URL 作为基础

在某些情况下，没有基础 URL。这通常意味着你有一个绝对 URL；但有时可能 只是一个不完整或损坏了的 URL

### 解析相对引用

要将相对 URL 转换为一个绝对 URL，下 一步要做的就是将相对 URL 和基础 URL 划分成组件段

实际上，这样只是在解析 URL，但这种做法会将其划分成一个个组件，因此通常会 称作分解（decomposing）URL。只要将基础和相对 URL 划分成了组件，就可以应 用图 2-5 中的算法来完成转换了

### 自动扩展URL

有些浏览器会在用户提交 URL 之后，或者在用户输入的时候尝试着自动扩展 URL。 这就为用户提供了一条捷径：用户不需要输入完整的 URL，因为浏览器会自动 扩展

这些“自动扩展”特性有以下两种方式

 主机名扩展

在主机名扩展中，只要有些小提示，浏览器通常就可以在没有帮助的情况下，将 你输入的主机名扩展为完整的主机名。 比如，如果在地址栏中输入 yahoo，浏览器就会自动在主机名中插入 www. 和 .com，构建出 www.yahoo.com。如果找不到与 yahoo 匹配的站点，有些浏览 器会在放弃之前尝试几种扩展形式。浏览器通过这些简单的技巧来节省你的时 间，减少找不到的可能。 但是，这些主机名扩展技巧可能会为其他一些 HTTP 应用程序带来问题，比如代 理

 历史扩展

浏览器用来节省用户输入 URL 时间的另一种技巧是，将以前用户访问过的 URL 历史存储起来。当你输入 URL 时，它们就可以将你输入的 URL 与历史记录中 URL 的前缀进行匹配，并提供一些完整的选项供你选择。因此，如果你输入了 一个以前访问过的 URL 的开始部分，比如 http://www.joes-，浏览器就可能会建 议使用 http://www.joes-hardware.com。然后你就可以选择这个地址，不用输入完 整的 URL 了。

注意，与代理共同使用时，URL 自动扩展的行为可能会有所不同。6

### URL中的字符处理

URL 是可移植的（portable）。它要统一地命名因特网上所有的资源，这也就意味着 要通过各种不同的协议来传送这些资源。这些协议在传输数据时都会使用不同的机 制，所以，设计 URL，使其可以通过任意因特网协议安全地传输是很重要的

安全传输意味着 URL 的传输不能丢失信息。有些协议，比如传输电子邮件的简单邮 件传输协议（Simple Mail Transfer Protocol，SMTP），所使用的传输方法就会剥去 一些特定的字符。4 为了避开这些问题，URL 只能使用一些相对较小的、通用的安 全字母表中的字符。

4 这是由报文的 7 位二进制码编码造成的。如果源端是以 8 位或更多位编码的，就会有部分信息被剥离

除了希望 URL 可以被所有因特网协议进行传送之外，设计者们还希望 URL 也可供 人类阅读。因此，即使不可见、不可打印的字符能够穿过邮件程序，从而成为可移 植的，也不能在 URL 中使用

5 不可打印字符中包括空格符

URL 还得是完整的，这就使问题变得更加复杂了。URL 的设计者们认识到有时人们 可能会希望 URL 中包含除通用的安全字母表之外的二进制数据或字符。因此，需要 有一种转义机制，能够将不安全的字符编码为安全字符，再进行传输

### URL 字符集

默认的计算机系统字符集通常都倾向于以英语为中心。有些 URL 中还会包含任意的二进制数据。认识到对完整性的需求之后，URL 的设计者就将转义序列集成了进去。通过转义序列，就可以用 US-ASCII 字符集的 有限子集对任意字符值或数据进行编码了，这样就实现了可移植性和完整性。

### 编码机制

为了避开安全字符集表示法带来的限制，人们设计了一种编码机制，用来在 URL 中 表示各种不安全的字符。这种编码机制就是通过一种“转义”表示法来表示不安全字符的，这种转义表示法包含一个百分号（%），后面跟着两个表示字符 ASCII 码的 十六进制数

| 字符 |   ASCII码    |                          示例                          |
| :--: | :----------: | :----------------------------------------------------: |
|  ~   | 126(`0x7E`)  |         `http://www.joes-hardware.com/%7Ejoe`          |
| 空格 | 32（`0x20`） |    `http://www.joes-hardware.com/more%20tools.html`    |
|  %   | 37（`0x25`） | `http://www.joes-hardware.com/100%25satisfaction.html` |

### 字符限制

在 URL 中，有几个字符被保留起来，有着特殊的含义。有些字符不在定义的 USASCII 可打印字符集中。还有些字符会与某些因特网网关和协议产生混淆，因此不 赞成使用

|       字符        |                        保留/受限原因                         |
| :---------------: | :----------------------------------------------------------: |
|         %         |                  保留作为编码字符的转义标志                  |
|         /         |             保留作为路径组件中分隔路径段的定界符             |
|         .         |                     保留在路径组件中使用                     |
|        ..         |                     保留在路径组件中使用                     |
|         #         |                    保留作为分段定界符使用                    |
|         ?         |                 保留作为查询字符串定界符使用                 |
|         ;         |                    保留作为参数定界符使用                    |
|         :         |    保留作为方案、用户/口令，以及主机/端口组件的定界符使用    |
|        $,+        |                             保留                             |
|       @ & =       |            在某些方案的上下文中有特殊的含义，保留            |
| { }\| \ ^ ~ [ ] ` | 由于各种传输 Agent 代理，比如各种网关的不安全处理，使用受限  |
|       <> "        | 不安全；这些字符在 URL 范围之外通常是有意义的，比如在文档中对 URL 自身 进行定界（比如 http://www.joes-hardware.com），所以应该对其进行编码 |
|  0x00-0x1F,0x7F   | 受限，这些十六进制范围内的字符都在 US-ASCII 字符集的不可打印区间内 |
|       >0x7F       | 受限，十六进制值在此范围内的字符都不在 US-ASCII 字符集的 7 比特范围内 |

### 其他

应用程序要按照一定规范工作。客户端应用程序在向其他应用程序发送任意 URL 之 前，最好把所有不安全或受限字符都进行转换 6 。只要对所有不安全字符都进行了编 码，这个 URL 就是可在各应用程序之间共享的规范形式；也就无需操心其他应用程 序会被字符的任何特殊含义所迷惑了

最适合判断是否需要对字符进行编码的程序就是从用户处获取 URL 的源端应用程 序。URL 的每个组件都会有自己的安全 / 不安全字符，哪些字符是安全 / 不安全的 与方案有关，因此只有从用户那里接收 URL 的应用程序才能够判断需要对哪些字符 进行编码

另一种极端的做法就是应用程序对所有字符都进行编码。尽管并不建议这么 做，但也没有什么强硬且严格的规则规定不能对那些安全字符进行编码；但在实际 应用中，有些应用程序可能会假定不对安全字符进行编码，这么做的话可能会产生 一些奇怪的破坏性行为

有时，有些人会恶意地对额外的字符进行编码，以绕过那些对 URL 进行模式匹配的 应用程序——比如，Web 过滤程序。对安全的 URL 组件进行编码会使模式匹配程 序无法识别出它们所要搜寻的模式。总之，解释 URL 的应用程序必须在处理 URL 之前对其进行解码

## 总结

URL 是一种强有力的工具。它可以用来命名所有现存对象，而且可以很方便地包含 一些新格式。URL 还提供了一种可以在各种因特网协议间共享的统一命名机制

但 URL 并不完美。它们表示的是实际的地址，而不是准确的名字。这就意味着 URL 会告诉你资源此时处于什么位置。它会为你提供特定端口上特定服务器的名 字，告诉你在何处可以找到这个资源。这种方案的缺点在于如果资源被移走了， URL 也就不再有效了。那时，它就无法对对象进行定位了

目前看来，在可预见的未来，因特网资源仍然会以 URL 来命名。它们无处不在，而 且是 Web 的成功过程中一个非常重要的部分。其他命名方案想要取代 URL 还要一 段时间。但是，URL 确实有其局限型，可能会出现新的标准（可能就是 URN），对 这种标准进行部署会解决其中的某些问题
