---
title: 认证解决方案
toc: true
clearReading: true
thumbnailImagePosition: right
metaAlignment: center
categories: 解决方案
tags: 安全
keywords: 用户认证
excerpt: 用户认证
date: 2021-11-25 20:27:32
thumbnailImage:
---
<!-- toc -->

## 概述

:question:什么是认证
{% alert success no-icon%}
认证就是证明真身的过程
{%endalert%}
## 常见的认证机制
目前有五种常见的认证机制：HTTP Basic Auth、Cookie Auth、OAuth、Token Auth 和 JWT
### HTTP Basic Auth

HTTP Basic Auth 就是每次请求API时都提供用户的 username 和 password。Basic Auth是配合 RESTful API 使用的最简单的认证方式，只需提供用户名密码即可，但由于存在用户名密码暴露给第三方客户端的风险（仅使用 Base64 编码），在生产环境下被使用的越来越少。因此，在开发对外开放的 RESTful API 时，尽量避免采用 HTTP Basic Auth

### Cookie Auth

Cookie 认证机制是：每当服务器收到一个请求认证时，就创建一个 Session 对象，同时在客户端的浏览器端创建一个 Cookie 对象；通过客户端带上来 Cookie 对象来与服务器端的 Session 对象匹配来实现**状态管理**的。默认的，当关闭浏览器的时候，cookie 会被删除，可以通过修改 cookie 的expire time 使 cookie 永不失效

:question:cookie 删除后，服务端的 session 如何处理？
{% alert success no-icon%}

根据 Session 机制，如果长时间没有访问，服务器端的 Session 会自动删除（Session 钝化）
{%endalert%}
### OAuth

OAuth（开放授权）是一个开放的授权标准，允许用户让第三方应用访问该用户在某一 web 服务上存储的私密的资源（如照片，视频，联系人列表），而无需将用户名和密码提供给第三方应用。

OAuth 允许用户提供一个令牌，而不是用户名和密码来访问他们存放在特定服务提供者的数据。每一个令牌授权一个特定的第三方系统（例如，视频编辑网站)在特定的时段（例如，接下来的2小时内）内访问特定的资源（例如仅仅是某一相册中的视频）。这样，OAuth让用户可以授权第三方网站访问他们存储在另外服务提供者的某些特定信息，而非所有内容这种基于OAuth的认证机制适用于个人消费者类的互联网产品，如社交类APP等应用，但是不太适合拥有自有认证权限管理的企业应用

### Token Auth

{% alert success no-icon%}

使用基于 Token 的身份验证方法，在服务端不需要存储用户的登录记录
{%endalert%}

:sailboat:大概的流程是这样的：

1. 客户端使用用户名和密码请求登录
2. 服务端收到请求，验证用户名与密码
3. 验证成功后，服务端会签发一个 Token，再把此 Token 发送给客户端
4. 客户端收到 Token 以后可以把它存储起来，比如放在 Cookie 里
5. 客户端每次向服务端请求资源的时候需要带着服务端签发的 Token
6. 服务端收到请求，然后去验证客户端请求里面带着的 Token，如果验证成功，就向客户端返回请求的数据

:+1:Token Auth的优点
{% alert success no-icon%}
支持跨域访问：Cookie 是不允许垮域访问的，这一点对 Token 机制不存在。前提是传输的用户认证信息通过HTTP头传输

无状态(也称：服务端可扩展行)：Token 机制在服务端不需要存储 session 信息，因为 Token 自身包含了所有登录用户的信息，只需要在客户端的 cookie 或本地介质存储状态信息

更适用CDN: 可以通过内容分发网络请求服务端的所有资料（如：javascript，HTML,图片等），而服务端只要提供 API 即可

去耦: 不需要绑定到一个特定的身份验证方案，Token 可以在任何地方生成，只要在 API 被调用的时候，可以进行 Token 生成调用即可

更适用于移动应用: 当客户端是一个原生平台（iOS, Android，Windows 8等）时，Cookie 是不被支持的（需要通过 Cookie 容器进行处理），这时采用 Token 认证机制就会简单得多

CSRF：因为不再依赖于 Cookie，所以就不需要考虑对 CSRF（跨站请求伪造）的防范

性能: 一次网络往返时间（通过数据库查询 session 信息）总比做一次 HMACSHA256 计算的 Token 验证和解析要费时得多

不需要为登录页面做特殊处理: 如果使用 Protractor 做功能测试的时候，不再需要为登录页面做特殊处理

基于标准化:你的API可以采用标准化的 JSON Web Token (JWT). 这个标准已经存在多个后端库（.NET, Ruby,Java,Python, PHP）和多家公司的支持（如：Firebase,Google, Microsoft）

{%endalert%}

### JWT

JSON Web Token（JWT）是一个非常轻巧的规范，这个规范允许我们使用 JWT 在用户和服务器之间传递安全可靠的信息。在 Java 世界中通过 JJWT 实现 JWT 创建和验证