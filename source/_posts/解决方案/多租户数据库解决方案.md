---
title: 多租户数据库解决方案
toc: true
clearReading: true
thumbnailImagePosition: right
metaAlignment: center
categories: 解决方案
tags: 项目
keywords: 多租户的解决方案
excerpt: 在 SaaS 项目中不可避免会拥有多个用户，那么如何进行多租户管理是常见的问题，本文总结并比较常用的方法，给出三种解决方案
date: 2021-10-31 22:30:10
thumbnailImage:
---
<!-- toc -->

## 概述

:question:多租户是什么？

{% alert success no-icon%}

多租户技术（Multi-TenancyTechnology）又称**多重租赁技术**，是一种软件架构技术，能够保证在多用户环境下，不同用户共用相同的系统组件，且确保各用户间的数据隔离

{% endalert%}
:bulb:简单理解：在一台服务器上运行单个应用实例，它为多个租户（客户）提供服务

:notes:多租户的重点是**同一套程序实现多用户数据的隔离**

## 问题的缘由

随着云计算的兴起，软件行业的交付方式已然发生改变。曾经冗长复杂的软件交付模式已经转变为更加便捷的服务访问方式，这极大的减轻了软件使用者的负担，但是为软件提供商带来了许多困难。下图就是传统软件模式和云计算软件模式的区别
![problem](https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211031145720464.png)

### 传统软件模式

传统软件模式指：将软件产品进行买卖，是一种单纯的买卖关系，客户通过买断的方式获取软件的使用权，软件的源码属于客户所有，因此**传统软件是部署到企业内部，不同的企业各自部署一套自己的软件系统**

### SaaS 模式

Saas模式指：**服务提供商提供的一种软件服务**，应用统一部署到**服务提供商的服务器上**，客户可以根据自己的实际需求**按需付费**。用户通过购买基于WEB的软件，而不是将软件安装在自己的电脑上，就能得到传统软件模式享受的服务。因此，对于 SaaS 平台简化了客户使用软件的方式，但是对软件提供者提出了更多的难题。

:sparkles:其中使得 SaaS 平台支持多租户的数据管理就是常见的一种问题，此问题的窘境在于：要在**数据共享、安全隔离和性能间取得平衡**

## 解决方案

目前多租户的数据库设计方案通常有如下三种：

{% alert success no-icon%}

- 独立数据库
- 共享数据库、独立`Schema`
- 共享数据库、共享数据表

{% endalert %}
### 独立数据库

{% alert info no-icon%}
独立数据库方案，即每个租户一个数据库
{% endalert %}

:+1:此方案为不同的租户提供**独立的数据库**，有助于简化数据模型的扩展设计，满足不同租户的独特需求，如果出现故障，恢复数据比较简单

:persevere:增加了数据库的安装数量，随之带来**维护成本和购置成本的增加**

:notebook:这种方案与传统的一个客户、一套数据、一套部署类似，差别只在于软件统一部署在运营商那里。由此可见此方案 用户数据隔离级别最高，安全性最好，但是成本较高

###  共享数据库、独立 Schema

:question:什么是数据库Schema

oracle数据库：oracle中一个数据库可以具有多个用户，一个用户一般对应一个Schema，表都是建立在Schema中的，可以简单的理解：在oracle中一个用户一套数据库表

![oracle](https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211031151118555.png)

mysql数据库：mysql数据中的schema比较特殊，并不是数据库的下一级，而是等同于数据库。比如执行 `create schema test` 和执行 `create database test` 效果是一模一样的  


![mysql](https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211031151129278.png)

{% alert info no-icon%}

共享数据库、独立 Schema方案，即多个或所有的租户使用同一个数据库服务（如常见的ORACLE或MYSQL数据库），但是每个租户一个Schema

{% endalert %}

:+1:为安全性要求较高的租户提供了一定程度的逻辑数据隔离，并不是完全隔离；每个数据库可支持更多的租户数量

:persevere:如果出现故障，数据恢复比较困难，因为恢复数据库将牵涉到其他租户的数据；如果需要跨租户统计数据，存在一定困难

:notebook:此方案是方案一的变种，只需要安装一份数据库服务，通过不同的Schema对不同租户的数据进行隔离。由于数据库服务是共享的，所以成本相对低廉

### 共享数据库、共享数据表

{% alert info no-icon%}

共享数据库、共享数据表，即租户共享同一个Database，同一套数据库表（所有租户的数据都存放在一个数据库的同一套表中）。在表中增加租户 ID 等租户标志字段，表明该记录是属于哪个租户

{% endalert %}

:+1:所有租户使用同一套数据库，所以成本低廉

:persevere:隔离级别最低，安全性最低，需要在设计开发时加大对安全的开发量，数据备份和恢复最困难

:notebook:这种方案和基于传统应用的数据库设计并没有任何区别，但是由于所有租户使用相同的数据库表，所以需要做好对每个租户数据的隔离安全性处理，如此就增加了系统设计和数据管理方面的复杂程度
## 总结

:older_man:下图就是对以上三种方案在**成本**，**系统复杂度**，**隔离度**以及**资源共享度**上面的总结，不同的项目根据项目资金以及开发人员工作量选择相应的方案处理，对于**个人开发**的小项目还是使用传统的**共享数据库和共享数据表**的方式进行开发最优
![summary](https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211031151423558.png)

