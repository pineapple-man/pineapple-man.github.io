<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="pineapple-man"><title>top 命令信息查看 - pineapple-man</title><meta name="author" content="pineapple-man"><meta name="keywords" content="top"><link rel="icon" href="https://pineapple-man.github.io/assets/images/logo.svg"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png"},"articleBody":"\ntop 命令是 Linux 下常用的系统性能监控工具，能够实时显示系统中各个进程的资源占用状况，属于 Linux 系统下的任务管理器,并且 top 命令是一个动态显示过程，可以自动或者通过用户按键来不断刷新当前状态\n¶语法\n1top -hv|-bcHiOSs -d secs -n max -u|U user -p pid -o fld -w [cols]\n常用参数选项介绍：\n\n\n\noptions\n含义\n\n\n\n\n-b\n以批处理模式操作\n\n\n-c\n显示完整的命令\n\n\n-d secs\n屏幕刷新间隔时间\n\n\n-I\n忽略失效过程\n\n\n-s\n保密模式\n\n\n-S\n累计模式\n\n\n-u user\n指定用户名\n\n\n-p pid\n指定进程\n\n\n-n max\n指定循环显示的次数\n\n\n\n¶输出结果信息描述\n想要监控系统信息首先一点就是要能够看懂top命令提供给我们的信息，输入top命令后展示的信息类似于下图：\n\ntop 展示的信息分为两个部分，第一部分是系统综合数据统计，第二部分是详细进程列表\n¶第一部分\n\n¶系统任务队列信息展示\n第一行主要展示任务队列信息，同uptime命令的执行结果\n1top - 11:22:37 up 191 days,  1:36,  2 users,  load average: 1.07, 1.45, 1.52\n\n\n\n展示信息\n含义\n\n\n\n\n11:22:37\n当前系统时间\n\n\nup 191 days, 1:36\n系统运行时间，格式为：天，时：分\n\n\n2 users\n当前登录用户数\n\n\nload average: 1.07, 1.45, 1.52\n系统负载，即任务队列的平均长度，三个数据分别为：1 分钟、5 分钟、15 分钟前到现在的平均值\n\n\n\n¶系统进程信息展示\n第二行主要展示系统中进程信息\n1Tasks: 539 total,   2 running, 442 sleeping,   0 stopped,   2 zombie\n\n\n\n展示信息\n含义\n\n\n\n\n539 total\n系统存在 539 个进程\n\n\n2 running\n正在运行的进程数是 2 个\n\n\n442 sleeping\n睡眠的进程数是 442 个\n\n\n0 stopped\n停止的进程数是 0 个\n\n\n2 zombie\n僵尸进程数是 2 个\n\n\n\n¶系统 CPU 占用率信息展示\n第三行主要展示 CPU 的信息\n1%Cpu(s):  2.3 us,  1.1 sy,  0.0 ni, 95.9 id,  0.5 wa,  0.0 hi,  0.1 si,  0.0 st\n\n\n\n展示信息\n含义\n\n\n\n\n2.3 us\n用户空间占用 CPU 的百分比\n\n\n1.1 sy\n内核空间占用 CPU 的百分比\n\n\n0.0 ni\n改变过优先级的进程占用 CPU 的百分比\n\n\n95.9 id\n空闲 CPU 百分比\n\n\n0.5 wa\nIO 等待占用 CPU 的百分比\n\n\n0.0 hi\n硬中断（Hardware IRQ）占用 CPU 的百分比\n\n\n0.1 si\n软中断（Software Interrupts）占用 CPU 的百分比\n\n\n0.0 st\n虚拟机占用百分比\n\n\n\n¶系统内存信息展示\n第四行为系统中的内存信息展示\n1KiB Mem : 64918328 total,   830476 free,  6139916 used, 57947936 buff/cache\n\n\n\n展示信息\n含义\n\n\n\n\n64918328 total\n物理内存总量\n\n\n830476 free\n空闲内存总量\n\n\n6139916 used\n使用的物理内存总量\n\n\n57947936 buff/cache\n用作内核缓存的内存量\n\n\n\n🎶第四行中使用中的内存总量（used）指的是现在系统内核控制的内存数，纳入内核管理的内存不见得都在使用中，还包括过去使用过的现在可以被重复利用的内存，内核并不把这些可被重新使用的内存交还到 free 中去，因此linux 上 free 内存会越来越少\n¶系统内交换区信息展示\n最后一行是系统中交换分区的信息展示\n1KiB Swap:        0 total,        0 free,        0 used. 57889476 avail Mem\n\n\n\n展示信息\n含义\n\n\n\n\n0 total\n交换区总量\n\n\n0 free\n空闲交换区总量\n\n\n0 used\n使用的交换区总量\n\n\n57889476 avail Mem\n缓冲的交换区总量，内存中的内容被换出到交换区，而后又被换入到内存，但使用过的交换区尚未被覆盖，该数值即为这些已存在于内存中的交换区的大小\n\n\n\n对于内存监控，在 top 信息里我们要时刻监控第五行 swap 交换分区的 used，如果这个数值在不断的变化，说明内核在不断进行内存和 swap 的数据交换，此时说明系统内存容量不够使用了，需要进行内存扩容了\n¶第二部分\n第二部分为进程的详细信息展示\n12PID  USER PR NI VIRT   RES    SHR   S  %CPU %MEM  TIME+    COMMAND2281 root 20   0 1050296  160608 40316  S  18.2  0.2  14:37.41 node\n\n\n\n展示信息\n含义\n\n\n\n\nPID\n进程 id\n\n\nUSER\n进程所有者\n\n\nPR\n进程优先级\n\n\nNI\nnice 值，负值表示高优先级，正值表示低优先级\n\n\nVIRT\n进程使用的虚拟内存总量，单位 kb，VIRT=SWAP+RES\n\n\nRES\n进程使用的、未被换出的物理内存大小，单位 kb，RES=CODE+DATA\n\n\nSHR\n共享内存大小，单位 kb\n\n\nS\n进程状态（D=不可中断的睡眠状态，R=运行，S=睡眠，T=跟踪/停止，Z=僵尸进程）\n\n\n%CPU\n上次更新到现在的 CPU 时间占用百分比\n\n\n%MEM\n进程使用的物理内存百分比\n\n\nTIME+\n进程使用的 CPU 时间总计，单位 1/100 秒\n\n\nCOMMAND\n进程名称（命令名/命令行）\n\n\n\n默认进入 top 时，各进程是按照 CPU 的占用量来排序的，\n其中%CPU指的是单位时间内进程使用的 CPU 时间百分比；一方面，该进程占用的 CPU，表示的是系统中总共 CPU 的占有率，可以大于 100%，如果是 8 核的系统，可以到达800%，另一方面，如果占用率到达 100%也并不代表完全占满了一个核心，只能说是在逻辑上等价完全占用了一个核心，实际上如果在双核心的系统上，每个核心各占 50%也说不定\n¶top 交互命令\n¶详细展示每个 CPU 使用情况\n进入 top 视图的时候，按1将详细展示出每颗 CPU 的占用情况，展示效果如下：\n\n¶自定义进程展示信息\n通过 f 键可以选择显示的内容。按 f 键之后会显示列的列表，按 a-z 即可显示或隐藏对应的列，最后按回车键确定\n\n¶其他交互命令\n1234567891011121314151617h：显示帮助画面，给出一些简短的命令总结说明；k：终止一个进程；i：忽略闲置和僵死进程，这是一个开关式命令；q：退出程序；r：重新安排一个进程的优先级别；S：切换到累计模式；s：改变两次刷新之间的延迟时间（单位为s），如果有小数，就换算成ms。输入0值则系统将不断刷新，默认值是5s；l：切换显示平均负载和启动时间信息；m：切换显示内存信息；t：切换显示进程和CPU状态信息；c：切换显示命令名称和完整命令行；M：根据驻留内存大小进行排序；P：根据CPU使用百分比大小进行排序；T：根据时间/累计时间进行排序；w：将当前设置写入~/.toprc文件中\n¶常见问题汇总\n下面列出在使用 top 命令时，出现的一些疑惑点，并给出相关的解答\n¶出现 kswapd0 进程 CPU 占用过高\nswap 分区的作用是当物理内存不足时，会将一部分硬盘当做虚拟内存来使用。kswapd0 占用过高是因为物理内存不足，使用 swap 分区与内存换页操作交换数据，导致 CPU 占用过高\n可以通过修改 /etc/sys/vm/swappiness 里面的数值来修改 swap 分区使用与否，默认 60，数值越大表示更多的使用 swap 分区。这个交换参数控制内核从物理内存移出进程，移到交换空间。该参数从 0 到 100，当该参数=0，表示只要有可能就尽力避免交换进程移出物理内存;该参数=100，这告诉内核疯狂的将数据移出物理内存移到 swap 缓存中。设置 vm.swappiness=0 后并不代表禁用 swap 分区，只是告诉内核，能少用到 swap 分区就尽量少用到，设置 vm.swappiness=100 的话，则表示尽量使用 swap 分区\n\n❓Swap 的分配会对系统性能产生影响吗？\nswap 分配策略不同，会对系统性能产生较明显的影响。分配太多的 Swap 空间会浪费磁盘空间，而 Swap 空间太少，则系统会发生错误。如果系统的物理内存用光了，系统会跑得很慢（大部分 CPU 占用率用于进行内存页的扇入和扇出），但仍能运行；如果 Swap 空间用光了，那么系统就会发生错误\n\n下面举一个例子：\n例如，Web 服务器能根据不同的请求数量衍生出多个服务进程（或线程），如果 Swap 空间用完，则服务进程无法启动，通常会出现“application is out of memory”的错误，严重时会造成服务进程的死锁。因此 Swap 空间的分配是很重要的\n\n❓不同的 swap 分配策略会严重影响到系统性能，那么到底应该如何分配 swap 分区？\n通常情况下，Swap 空间应大于或等于物理内存的大小，最小不应小于 64M，通常 Swap 空间的大小应是物理内存的 2-2.5 倍。\n但根据不同的应用，应有不同的配置：如果是小的桌面系统，则只需要较小的 Swap 空间，而大的服务器系统则视情况不同需要不同大小的 Swap 空间。特别是数据库服务器和 Web 服务器，随着访问量的增加，对 Swap 空间的要求也会增加，一般来说对于 4G 以下的物理内存，配置 2 倍的 swap，4G 以上配置 1 倍\n\n另一方面，Swap 分区的数量对性能也有很大的影响。因为 Swap 交换的操作是磁盘 IO 的操作，如果有多个 Swap 交换区，Swap 空间的分配会以轮流的方式操作于所有的 Swap，这样会大大均衡 IO 的负载，加快 Swap 交换的速度。如果只有一个交换区，所有的交换操作会使交换区变得很忙，使系统大多数时间处于等待状态，效率很低。用性能监视工具会发现，此时 CPU 负载并不高，而系统却慢。这说明，系统的瓶颈在 IO 上，依靠提高 CPU 的速度解决不了问题，需要增大物理内存或者减少交互分区的使用率\n¶附录\nLinux - top 命令查看服务器 CPU 与内存占用\nLinux 中 top 命令输出指标详解\nLinux kswapd0 进程 CPU 占用过高\n","dateCreated":"2021-10-25T06:35:52+00:00","dateModified":"2023-06-07T02:13:34+00:00","datePublished":"2021-10-25T06:35:52+00:00","description":"本文主要讲解top命令的使用以及信息查看","headline":"top 命令信息查看","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://pineapple-man.github.io/top-%E5%91%BD%E4%BB%A4%E4%BF%A1%E6%81%AF%E6%9F%A5%E7%9C%8B/"},"publisher":{"@type":"Organization","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png","logo":{"@type":"ImageObject","url":"logo.png"}},"url":"https://pineapple-man.github.io/top-%E5%91%BD%E4%BB%A4%E4%BF%A1%E6%81%AF%E6%9F%A5%E7%9C%8B/","keywords":"系统监控"}</script><meta name="description" content="本文主要讲解top命令的使用以及信息查看"><meta property="og:type" content="blog"><meta property="og:title" content="top 命令信息查看"><meta property="og:url" content="https://pineapple-man.github.io/top-%E5%91%BD%E4%BB%A4%E4%BF%A1%E6%81%AF%E6%9F%A5%E7%9C%8B/"><meta property="og:site_name" content="pineapple-man"><meta property="og:description" content="本文主要讲解top命令的使用以及信息查看"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/20211025111656.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211025112754142.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211025115840582.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211025120159880.png"><meta property="article:published_time" content="2021-10-25T06:35:52.000Z"><meta property="article:modified_time" content="2023-06-07T02:13:34.003Z"><meta property="article:author" content="pineapple-man"><meta property="article:tag" content="系统监控"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/20211025111656.png"><meta property="og:image" content="https://pineapple-man.github.io/assets/images/logo.png"><link rel="stylesheet" href="/assets/css/style-oth3meuzcjopbgwqbdvoxqknhcm0sy9wkullcc94zhkkop3pmfrpl5t4fzzz.min.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-210516333-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-210516333-1")</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"></head><body><div id="blog"><header id="header" data-behavior="5"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/" aria-label="">pineapple-man</a></div><a class="header-right-picture" href="#about" aria-label="打开链接: /#about"><img class="header-picture" src="/assets/images/logo.png" alt="作者的图片"></a></header><nav id="sidebar" data-behavior="5"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about" aria-label="阅读有关作者的更多信息"><img class="sidebar-profile-picture" src="/assets/images/logo.png" alt="作者的图片"></a><h4 class="sidebar-profile-name">pineapple-man</h4><h5 class="sidebar-profile-bio"><p>做一个菠萝：站得笔直，头戴王冠，内心甜美</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/" rel="noopener" title="首页"><i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories" rel="noopener" title="分类"><i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags" rel="noopener" title="标签"><i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives" rel="noopener" title="归档"><i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about" rel="noopener" title="关于"><i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i> <span class="sidebar-button-desc">关于</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/pineapple-man" target="_blank" rel="noopener" title="GitHub"><i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto://mingchaohu720@gmail.com" target="_blank" rel="noopener" title="邮箱"><i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul></div></nav><div id="main" data-behavior="5" class="hasCoverMetaIn"><article class="post"><div class="post-header main-content-wrap text-center"><h1 class="post-title">top 命令信息查看</h1><div class="post-meta"><time datetime="2021-10-25T06:35:52+00:00">10月 25, 2021 </time><span>发布在 </span><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a> <i class="fas fa-book-open"></i> 本文共<span class="post-count"> 2.7k </span>字 <i class="far fa-clock"></i> 阅读预计<span class="post-count"> 26 </span>分钟</div></div><div class="post-content markdown"><div class="main-content-wrap"><h1 id="table-of-contents">目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-text">语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E4%BF%A1%E6%81%AF%E6%8F%8F%E8%BF%B0"><span class="toc-text">输出结果信息描述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86"><span class="toc-text">第一部分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97%E4%BF%A1%E6%81%AF%E5%B1%95%E7%A4%BA"><span class="toc-text">系统任务队列信息展示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF%E5%B1%95%E7%A4%BA"><span class="toc-text">系统进程信息展示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F-CPU-%E5%8D%A0%E7%94%A8%E7%8E%87%E4%BF%A1%E6%81%AF%E5%B1%95%E7%A4%BA"><span class="toc-text">系统 CPU 占用率信息展示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E4%BF%A1%E6%81%AF%E5%B1%95%E7%A4%BA"><span class="toc-text">系统内存信息展示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%86%85%E4%BA%A4%E6%8D%A2%E5%8C%BA%E4%BF%A1%E6%81%AF%E5%B1%95%E7%A4%BA"><span class="toc-text">系统内交换区信息展示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86"><span class="toc-text">第二部分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#top-%E4%BA%A4%E4%BA%92%E5%91%BD%E4%BB%A4"><span class="toc-text">top 交互命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E5%B1%95%E7%A4%BA%E6%AF%8F%E4%B8%AA-CPU-%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5"><span class="toc-text">详细展示每个 CPU 使用情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%9B%E7%A8%8B%E5%B1%95%E7%A4%BA%E4%BF%A1%E6%81%AF"><span class="toc-text">自定义进程展示信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E4%BA%A4%E4%BA%92%E5%91%BD%E4%BB%A4"><span class="toc-text">其他交互命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB"><span class="toc-text">常见问题汇总</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BA%E7%8E%B0-kswapd0-%E8%BF%9B%E7%A8%8B-CPU-%E5%8D%A0%E7%94%A8%E8%BF%87%E9%AB%98"><span class="toc-text">出现 kswapd0 进程 CPU 占用过高</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-text">附录</span></a></li></ol><p>top 命令是 Linux 下常用的系统性能监控工具，能够实时显示系统中各个进程的资源占用状况，属于 Linux 系统下的任务管理器,并且 top 命令是一个动态显示过程，可以自动或者通过用户按键来不断刷新当前状态</p><h2 id="语法"><a class="header-anchor" href="#语法">¶</a>语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top -hv|-bcHiOSs -d secs -n max -u|U user -p pid -o fld -w [cols]</span><br></pre></td></tr></table></figure><p>常用参数选项介绍：</p><table><thead><tr><th style="text-align:center">options</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>-b</code></td><td style="text-align:center">以批处理模式操作</td></tr><tr><td style="text-align:center"><code>-c</code></td><td style="text-align:center">显示完整的命令</td></tr><tr><td style="text-align:center"><code>-d secs</code></td><td style="text-align:center">屏幕刷新间隔时间</td></tr><tr><td style="text-align:center"><code>-I</code></td><td style="text-align:center">忽略失效过程</td></tr><tr><td style="text-align:center"><code>-s</code></td><td style="text-align:center">保密模式</td></tr><tr><td style="text-align:center"><code>-S</code></td><td style="text-align:center">累计模式</td></tr><tr><td style="text-align:center"><code>-u user</code></td><td style="text-align:center">指定用户名</td></tr><tr><td style="text-align:center"><code>-p pid</code></td><td style="text-align:center">指定进程</td></tr><tr><td style="text-align:center"><code>-n max</code></td><td style="text-align:center">指定循环显示的次数</td></tr></tbody></table><h2 id="输出结果信息描述"><a class="header-anchor" href="#输出结果信息描述">¶</a>输出结果信息描述</h2><p>想要监控系统信息首先一点就是要能够看懂<code>top</code>命令提供给我们的信息，输入<code>top</code>命令后展示的信息类似于下图：</p><p><img src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/20211025111656.png" alt=""></p><p>top 展示的信息分为两个部分，第一部分是<strong>系统综合数据统计</strong>，第二部分是<strong>详细进程列表</strong></p><h3 id="第一部分"><a class="header-anchor" href="#第一部分">¶</a>第一部分</h3><p><img src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211025112754142.png" alt=""></p><h4 id="系统任务队列信息展示"><a class="header-anchor" href="#系统任务队列信息展示">¶</a>系统任务队列信息展示</h4><p>第一行主要展示任务队列信息，同<code>uptime</code>命令的执行结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top - 11:22:37 up 191 days,  1:36,  2 users,  load average: 1.07, 1.45, 1.52</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">展示信息</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>11:22:37</code></td><td style="text-align:center">当前系统时间</td></tr><tr><td style="text-align:center"><code>up 191 days, 1:36</code></td><td style="text-align:center">系统运行时间，格式为：天，时：分</td></tr><tr><td style="text-align:center"><code>2 users</code></td><td style="text-align:center">当前登录用户数</td></tr><tr><td style="text-align:center"><code>load average: 1.07, 1.45, 1.52</code></td><td style="text-align:center">系统负载，即任务队列的平均长度，三个数据分别为：1 分钟、5 分钟、15 分钟前到现在的平均值</td></tr></tbody></table><h4 id="系统进程信息展示"><a class="header-anchor" href="#系统进程信息展示">¶</a>系统进程信息展示</h4><p>第二行主要展示系统中进程信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tasks: 539 total,   2 running, 442 sleeping,   0 stopped,   2 zombie</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">展示信息</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>539 total</code></td><td style="text-align:center">系统存在 539 个进程</td></tr><tr><td style="text-align:center"><code>2 running</code></td><td style="text-align:center">正在运行的进程数是 2 个</td></tr><tr><td style="text-align:center"><code>442 sleeping</code></td><td style="text-align:center">睡眠的进程数是 442 个</td></tr><tr><td style="text-align:center"><code>0 stopped</code></td><td style="text-align:center">停止的进程数是 0 个</td></tr><tr><td style="text-align:center"><code>2 zombie</code></td><td style="text-align:center">僵尸进程数是 2 个</td></tr></tbody></table><h4 id="系统-CPU-占用率信息展示"><a class="header-anchor" href="#系统-CPU-占用率信息展示">¶</a>系统 CPU 占用率信息展示</h4><p>第三行主要展示 CPU 的信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%Cpu(s):  2.3 us,  1.1 sy,  0.0 ni, 95.9 id,  0.5 wa,  0.0 hi,  0.1 si,  0.0 st</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">展示信息</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>2.3 us</code></td><td style="text-align:center">用户空间占用 CPU 的百分比</td></tr><tr><td style="text-align:center"><code>1.1 sy</code></td><td style="text-align:center">内核空间占用 CPU 的百分比</td></tr><tr><td style="text-align:center"><code>0.0 ni</code></td><td style="text-align:center">改变过优先级的进程占用 CPU 的百分比</td></tr><tr><td style="text-align:center"><code>95.9 id</code></td><td style="text-align:center">空闲 CPU 百分比</td></tr><tr><td style="text-align:center"><code>0.5 wa</code></td><td style="text-align:center">IO 等待占用 CPU 的百分比</td></tr><tr><td style="text-align:center"><code>0.0 hi</code></td><td style="text-align:center">硬中断（Hardware IRQ）占用 CPU 的百分比</td></tr><tr><td style="text-align:center"><code>0.1 si</code></td><td style="text-align:center">软中断（Software Interrupts）占用 CPU 的百分比</td></tr><tr><td style="text-align:center"><code>0.0 st</code></td><td style="text-align:center">虚拟机占用百分比</td></tr></tbody></table><h4 id="系统内存信息展示"><a class="header-anchor" href="#系统内存信息展示">¶</a>系统内存信息展示</h4><p>第四行为系统中的内存信息展示</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KiB Mem : 64918328 total,   830476 free,  6139916 used, 57947936 buff/cache</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">展示信息</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>64918328 total</code></td><td style="text-align:center">物理内存总量</td></tr><tr><td style="text-align:center"><code>830476 free</code></td><td style="text-align:center">空闲内存总量</td></tr><tr><td style="text-align:center"><code>6139916 used</code></td><td style="text-align:center">使用的物理内存总量</td></tr><tr><td style="text-align:center"><code>57947936 buff/cache</code></td><td style="text-align:center">用作内核缓存的内存量</td></tr></tbody></table><p>🎶第四行中使用中的内存总量（used）指的是现在系统内核控制的内存数，纳入内核管理的内存不见得都在使用中，还包括过去使用过的现在可以被重复利用的内存，内核并不把这些可被重新使用的内存交还到 free 中去，因此<strong>linux 上 free 内存会越来越少</strong></p><h4 id="系统内交换区信息展示"><a class="header-anchor" href="#系统内交换区信息展示">¶</a>系统内交换区信息展示</h4><p>最后一行是系统中交换分区的信息展示</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KiB Swap:        0 total,        0 free,        0 used. 57889476 avail Mem</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">展示信息</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>0 total</code></td><td style="text-align:center">交换区总量</td></tr><tr><td style="text-align:center"><code>0 free</code></td><td style="text-align:center">空闲交换区总量</td></tr><tr><td style="text-align:center"><code>0 used</code></td><td style="text-align:center">使用的交换区总量</td></tr><tr><td style="text-align:center"><code>57889476 avail Mem</code></td><td style="text-align:center">缓冲的交换区总量，内存中的内容被换出到交换区，而后又被换入到内存，但使用过的交换区尚未被覆盖，该数值即为这些已存在于内存中的交换区的大小</td></tr></tbody></table><p>对于内存监控，在 top 信息里我们要时刻监控第五行 swap 交换分区的 used，如果这个数值在不断的变化，说明内核在不断进行内存和 swap 的数据交换，此时说明系统内存容量不够使用了，需要进行内存扩容了</p><h3 id="第二部分"><a class="header-anchor" href="#第二部分">¶</a>第二部分</h3><p>第二部分为进程的详细信息展示</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PID  USER PR NI VIRT   RES    SHR   S  %CPU %MEM  TIME+    COMMAND</span><br><span class="line">2281 root 20   0 1050296  160608 40316  S  18.2  0.2  14:37.41 node</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">展示信息</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>PID</code></td><td style="text-align:center">进程 id</td></tr><tr><td style="text-align:center"><code>USER</code></td><td style="text-align:center">进程所有者</td></tr><tr><td style="text-align:center"><code>PR</code></td><td style="text-align:center">进程优先级</td></tr><tr><td style="text-align:center"><code>NI</code></td><td style="text-align:center">nice 值，负值表示高优先级，正值表示低优先级</td></tr><tr><td style="text-align:center"><code>VIRT</code></td><td style="text-align:center">进程使用的虚拟内存总量，单位 kb，VIRT=SWAP+RES</td></tr><tr><td style="text-align:center"><code>RES</code></td><td style="text-align:center">进程使用的、未被换出的物理内存大小，单位 kb，RES=CODE+DATA</td></tr><tr><td style="text-align:center"><code>SHR</code></td><td style="text-align:center">共享内存大小，单位 kb</td></tr><tr><td style="text-align:center"><code>S</code></td><td style="text-align:center">进程状态（D=不可中断的睡眠状态，R=运行，S=睡眠，T=跟踪/停止，Z=僵尸进程）</td></tr><tr><td style="text-align:center"><code>%CPU</code></td><td style="text-align:center">上次更新到现在的 CPU 时间占用百分比</td></tr><tr><td style="text-align:center"><code>%MEM</code></td><td style="text-align:center">进程使用的物理内存百分比</td></tr><tr><td style="text-align:center"><code>TIME+</code></td><td style="text-align:center">进程使用的 CPU 时间总计，单位 1/100 秒</td></tr><tr><td style="text-align:center"><code>COMMAND</code></td><td style="text-align:center">进程名称（命令名/命令行）</td></tr></tbody></table><p>默认进入 top 时，各进程是按照 CPU 的占用量来排序的，</p><p>其中<code>%CPU</code>指的是单位时间内进程使用的 CPU 时间百分比；一方面，该进程占用的 CPU，表示的是系统中总共 CPU 的占有率，可以大于 100%，如果是 8 核的系统，可以到达<code>800%</code>，另一方面，如果占用率到达 100%也并不代表完全占满了一个核心，只能说是在逻辑上等价完全占用了一个核心，实际上如果在双核心的系统上，每个核心各占 50%也说不定</p><h2 id="top-交互命令"><a class="header-anchor" href="#top-交互命令">¶</a>top 交互命令</h2><h3 id="详细展示每个-CPU-使用情况"><a class="header-anchor" href="#详细展示每个-CPU-使用情况">¶</a>详细展示每个 CPU 使用情况</h3><p>进入 top 视图的时候，按<code>1</code>将详细展示出每颗 CPU 的占用情况，展示效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211025115840582.png" alt=""></p><h3 id="自定义进程展示信息"><a class="header-anchor" href="#自定义进程展示信息">¶</a>自定义进程展示信息</h3><p>通过 f 键可以选择显示的内容。按 f 键之后会显示列的列表，按 a-z 即可显示或隐藏对应的列，最后按回车键确定</p><p><img src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211025120159880.png" alt=""></p><h3 id="其他交互命令"><a class="header-anchor" href="#其他交互命令">¶</a>其他交互命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">h：显示帮助画面，给出一些简短的命令总结说明；</span><br><span class="line">k：终止一个进程；</span><br><span class="line">i：忽略闲置和僵死进程，这是一个开关式命令；</span><br><span class="line">q：退出程序；</span><br><span class="line">r：重新安排一个进程的优先级别；</span><br><span class="line">S：切换到累计模式；</span><br><span class="line">s：改变两次刷新之间的延迟时间（单位为s），如果有小数，就换算成ms。</span><br><span class="line">输入0值则系统将不断刷新，默认值是5s；</span><br><span class="line"></span><br><span class="line">l：切换显示平均负载和启动时间信息；</span><br><span class="line">m：切换显示内存信息；</span><br><span class="line">t：切换显示进程和CPU状态信息；</span><br><span class="line">c：切换显示命令名称和完整命令行；</span><br><span class="line">M：根据驻留内存大小进行排序；</span><br><span class="line">P：根据CPU使用百分比大小进行排序；</span><br><span class="line">T：根据时间/累计时间进行排序；</span><br><span class="line">w：将当前设置写入~/.toprc文件中</span><br></pre></td></tr></table></figure><h2 id="常见问题汇总"><a class="header-anchor" href="#常见问题汇总">¶</a>常见问题汇总</h2><p>下面列出在使用 <code>top</code> 命令时，出现的一些疑惑点，并给出相关的解答</p><h3 id="出现-kswapd0-进程-CPU-占用过高"><a class="header-anchor" href="#出现-kswapd0-进程-CPU-占用过高">¶</a>出现 <code>kswapd0</code> 进程 CPU 占用过高</h3><p>swap 分区的作用是<strong>当物理内存不足时，会将一部分硬盘当做虚拟内存来使用</strong>。kswapd0 占用过高是因为物理内存不足，使用 swap 分区与内存换页操作交换数据，导致 CPU 占用过高</p><div class="alert success no-icon"><p>可以通过修改 <code>/etc/sys/vm/swappiness</code> 里面的数值来修改 swap 分区使用与否，默认 60，数值越大表示更多的使用 swap 分区。这个交换参数控制内核从物理内存移出进程，移到交换空间。该参数从 0 到 100，当该参数=0，表示只要有可能就尽力避免交换进程移出物理内存;该参数=100，这告诉内核疯狂的将数据移出物理内存移到 swap 缓存中。设置 <code>vm.swappiness=0</code> 后并不代表禁用 swap 分区，只是告诉内核，能少用到 swap 分区就尽量少用到，设置 vm.swappiness=100 的话，则表示尽量使用 swap 分区</p></div><p>❓Swap 的分配会对系统性能产生影响吗？</p><div class="alert success no-icon"><p>swap 分配策略不同，会对系统性能产生较明显的影响。分配太多的 Swap 空间会浪费磁盘空间，而 Swap 空间太少，则系统会发生错误。如果系统的物理内存用光了，系统会跑得很慢（大部分 CPU 占用率用于进行内存页的扇入和扇出），但仍能运行；如果 Swap 空间用光了，那么系统就会发生错误</p></div><p>下面举一个例子：</p><div class="alert warning no-icon"><p>例如，Web 服务器能根据不同的请求数量衍生出多个服务进程（或线程），如果 Swap 空间用完，则服务进程无法启动，通常会出现“application is out of memory”的错误，严重时会造成服务进程的死锁。因此 Swap 空间的分配是很重要的</p></div><p>❓不同的 swap 分配策略会严重影响到系统性能，那么到底应该如何分配 swap 分区？</p><div class="alert success no-icon"><p>通常情况下，Swap 空间应大于或等于物理内存的大小，最小不应小于 64M，通常 Swap 空间的大小应是物理内存的 2-2.5 倍。</p><p><strong>但根据不同的应用，应有不同的配置</strong>：如果是小的桌面系统，则只需要较小的 Swap 空间，而大的服务器系统则视情况不同需要不同大小的 Swap 空间。特别是数据库服务器和 Web 服务器，随着访问量的增加，对 Swap 空间的要求也会增加，一般来说对于 4G 以下的物理内存，配置 2 倍的 swap，4G 以上配置 1 倍</p></div><p>另一方面，Swap 分区的数量对性能也有很大的影响。因为 Swap 交换的操作是磁盘 IO 的操作，如果有多个 Swap 交换区，Swap 空间的分配会以轮流的方式操作于所有的 Swap，这样会大大均衡 IO 的负载，加快 Swap 交换的速度。如果只有一个交换区，所有的交换操作会使交换区变得很忙，使系统大多数时间处于等待状态，效率很低。用性能监视工具会发现，此时 CPU 负载并不高，而系统却慢。这说明，系统的瓶颈在 IO 上，依靠提高 CPU 的速度解决不了问题，需要增大物理内存或者减少交互分区的使用率</p><h2 id="附录"><a class="header-anchor" href="#附录">¶</a>附录</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/J080624/article/details/80526310">Linux - top 命令查看服务器 CPU 与内存占用</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/af584c5a79f2">Linux 中 top 命令输出指标详解</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/aaron911/p/11002338.html">Linux kswapd0 进程 CPU 占用过高</a></p></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">标签</span><br><a class="tag tag--primary tag--small t-none-link" href="/tags/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/" rel="tag">系统监控</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/" data-tooltip="同源策略" aria-label="上一篇: 同源策略"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/http%EF%BC%88%E4%B8%80%EF%BC%89http-%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/" data-tooltip="HTTP（一）HTTP 协议与工作原理" aria-label="下一篇: HTTP（一）HTTP 协议与工作原理"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></article><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2023 pineapple-man. All Rights Reserved.</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><br>Total <span id="busuanzi_value_site_pv"></span> views. 您是pineapple-man的第<span id="busuanzi_value_site_uv"></span>个小伙伴<br><i class="fas fa-book-open"></i> <span class="post-count">博客字数统计：370.7k</span><script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="5"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/" data-tooltip="同源策略" aria-label="上一篇: 同源策略"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/http%EF%BC%88%E4%B8%80%EF%BC%89http-%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/" data-tooltip="HTTP（一）HTTP 协议与工作原理" aria-label="下一篇: HTTP（一）HTTP 协议与工作原理"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-times"></i></div><img id="about-card-picture" src="/assets/images/logo.png" alt="作者的图片"><h4 id="about-card-name">pineapple-man</h4><div id="about-card-bio"><p>做一个菠萝：站得笔直，头戴王冠，内心甜美</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>刚毕业就失业</p></div><div id="about-card-location"><i class="fa fa-map-marker-alt"></i><br>西安</div></div></div><div id="cover" style="background-image:url(/assets/images/cover-v1.2.0.jpg)"></div><script src="/assets/js/script-kcoiyt1nxfue7qgcpkrcixymglcc3cuxeg98fy01hqww4nblnhd2ees6j6yc.min.js"></script></body></html>