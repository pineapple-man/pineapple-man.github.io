<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="pineapple-man"><title>ç¼“å†²åŒº - pineapple-man</title><meta name="author" content="pineapple-man"><meta name="keywords" content="buffer"><link rel="icon" href="https://pineapple-man.github.io/assets/images/logo.svg"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png"},"articleBody":"\nÂ¶æ¦‚è¿°\nç¼“å†²åŒºæ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨ç‰¹å®šæ•°æ®ç±»å‹çš„å®¹å™¨ï¼Œç”± java.nio åŒ…å®šä¹‰ï¼Œç›®å‰å¸¸ç”¨çš„ç¼“å†²åŒºéƒ½æ˜¯ Buffer æŠ½è±¡ç±»çš„å­ç±»ã€‚Java NIO ä¸­çš„ Buffer ä¸»è¦ç”¨äºä¸ NIO é€šé“è¿›è¡Œäº¤äº’ã€‚åœ¨ NIO ä¸­ï¼Œå¦‚æœç”¨æˆ·æƒ³è¦æ¶ˆè´¹æ•°æ®ï¼Œæ•°æ®é¦–å…ˆä¼šä»é€šé“è¯»å…¥ç¼“å†²åŒºï¼Œéšåç”¨æˆ·åœ¨ç¼“å†²åŒºä¸­æ¶ˆè´¹æ•°æ®ã€‚å¯¹åº”åœ°ï¼Œç”¨æˆ·å¦‚æœæƒ³è¦æ’å‡ºæ•°æ®ï¼Œæ•°æ®é¦–å…ˆä¼šä»ç¼“å†²åŒºå†™å…¥é€šé“ä¸­ï¼Œéšåé€šè¿‡é€šé“æ’å‡ºæ•°æ®ã€‚å…·ä½“çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š\n\nÂ¶Buffer ç±»åŠå…¶å­ç±»\nBuffer å°±åƒä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥ä¿å­˜å¤šä¸ªç›¸åŒç±»å‹çš„æ•°æ®ã€‚æ ¹æ®æ•°æ®ç±»å‹ä¸åŒï¼Œæœ‰ä»¥ä¸‹å¸¸ç”¨å­ç±»ï¼š\n\n.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}\n.tg td{border-style:solid;border-width:0px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;\n  padding:10px 5px;word-break:normal;}\n.tg th{border-style:solid;border-width:0px;font-family:Arial, sans-serif;font-size:14px;font-weight:normal;\n  overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-u1qu{font-family:\"Times New Roman\", Times, serif !important;font-size:medium;text-align:center;vertical-align:middle}\n\n\n\n  \n    ByteBuffer\n    CharBuffer\n    CharBuffer\n    CharBuffer\n    LongBuffer\n    LongBuffer\n    LongBuffer\n  \n\n\nä¸Šè¿° Buffer ç±»ä»–ä»¬éƒ½é‡‡ç”¨ç›¸ä¼¼çš„æ–¹æ³•è¿›è¡Œç®¡ç†æ•°æ®ï¼Œåªæ˜¯å„è‡ªç®¡ç†çš„æ•°æ®ç±»å‹ä¸åŒè€Œå·²ã€‚éƒ½æ˜¯é€šè¿‡å¦‚ä¸‹æ–¹æ³•è·å–ä¸€ä¸ª Buffer å¯¹è±¡ï¼š\n12//åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º capacity çš„ XxxBuffer å¯¹è±¡static XxxBuffer allocate(int capacity);\nBuffer æ˜¯éçº¿ç¨‹å®‰å…¨çš„\n\nÂ¶ç¼“å†²åŒºçš„åŸºæœ¬å±æ€§\nä¸€ä¸ªç¼“å†²åŒºå…·æœ‰å¦‚ä¸‹å››ä¸ªæœ€é‡è¦çš„åŸºæœ¬å±æ€§(markã€positionã€limitã€capacity)ï¼Œå®ƒä»¬éµå®ˆä»¥ä¸‹ä¸ç­‰å¼ï¼š0 &lt;= mark &lt;= position &lt;= limit &lt;= capacity\n\n.tg  {border-collapse:collapse;border-color:#9ABAD9;border-spacing:0;margin:0px auto;}\n.tg td{background-color:#EBF5FF;border-color:#9ABAD9;border-style:solid;border-width:1px;color:#444;\n  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{background-color:#409cff;border-color:#9ABAD9;border-style:solid;border-width:1px;color:#fff;\n  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-9wq8{border-color:inherit;text-align:center;vertical-align:middle}\n.tg .tg-ixdq{border-color:inherit;font-weight:bold;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;\n  vertical-align:middle;will-change:transform}\n.tg .tg-uzvj{border-color:inherit;font-weight:bold;text-align:center;vertical-align:middle}\n\n\n\n  \n    åŸºæœ¬å±æ€§\n    å«ä¹‰\n  \n\n\n  \n    å®¹é‡ (capacity)\n    ä½œä¸ºä¸€ä¸ªå†…å­˜å—ï¼ŒBufferå…·æœ‰ä¸€å®šçš„å›ºå®šå¤§å°ï¼Œä¹Ÿç§°ä¸º\"å®¹é‡\"ï¼Œç¼“å†²åŒºå®¹é‡ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”åˆ›å»ºåä¸èƒ½æ›´æ”¹\n  \n  \n    é™åˆ¶ (limit)\n    è¡¨ç¤ºç¼“å†²åŒºä¸­å¯ä»¥æ“ä½œæ•°æ®çš„å¤§å°ï¼ˆlimit åæ•°æ®ä¸èƒ½è¿›è¡Œè¯»å†™ï¼‰ã€‚ç¼“å†²åŒºçš„é™åˆ¶ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶å®¹é‡  å†™å…¥æ¨¡å¼ï¼Œé™åˆ¶ç­‰äºbufferçš„å®¹é‡ è¯»å–æ¨¡å¼ä¸‹ï¼Œlimitç­‰äºå†™å…¥çš„æ•°æ®é‡\n  \n  \n    ä½ç½®ï¼ˆposition)\n    ä¸‹ä¸€ä¸ªè¦è¯»å–æˆ–å†™å…¥çš„æ•°æ®çš„ç´¢å¼•ã€‚ç¼“å†²åŒºçš„ä½ç½®ä¸èƒ½ä¸º è´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶é™åˆ¶(limit)\n  \n  \n    æ ‡è®° (mark)ä¸é‡ç½® (reset)\n    æ ‡è®°æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œé€šè¿‡ Buffer ä¸­çš„ mark() æ–¹æ³• æŒ‡å®š Buffer ä¸­ä¸€ä¸ªç‰¹å®šçš„ positionï¼Œä¹‹åå¯ä»¥é€šè¿‡è°ƒç”¨ reset() æ–¹æ³•æ¢å¤åˆ°è¿™ ä¸ª position\n  \n\n\nç®€å•çš„ç›¸å…³æ“ä½œå¦‚ä¸‹ï¼š\n\nÂ¶ç¼“å†²åŒºå¸¸ç”¨æ–¹æ³•\n\n.tg  {border-collapse:collapse;border-color:#9ABAD9;border-spacing:0;margin:0px auto;}\n.tg td{background-color:#EBF5FF;border-color:#9ABAD9;border-style:solid;border-width:1px;color:#444;\n  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{background-color:#409cff;border-color:#9ABAD9;border-style:solid;border-width:1px;color:#fff;\n  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-sx1p{font-weight:bold;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:middle;\n  will-change:transform}\n.tg .tg-nrix{text-align:center;vertical-align:middle}\n\n\n\n  \n    å¸¸ç”¨API\n    å«ä¹‰\n  \n\n\n  \n    Buffer clear()\n    æ¸…ç©ºç¼“å†²åŒºå¹¶è¿”å›å¯¹ç¼“å†²åŒºçš„å¼•ç”¨\n  \n  \n    Buffer flip()\n    å°†ç¼“å†²åŒºçš„ç•Œé™è®¾ç½®ä¸ºå½“å‰ä½ç½®ï¼Œå¹¶å°†å½“å‰ä½ç½®é‡ç½®ä¸º 0ï¼Œç”±å†™æ¨¡å¼è½¬æ¢ä¸ºè¯»æ¨¡å¼\n  \n  \n    int capacity()\n    è¿”å› Buffer çš„ capacity å¤§å°\n  \n  \n    boolean hasRemaining()\n    åˆ¤æ–­ç¼“å†²åŒºä¸­æ˜¯å¦è¿˜æœ‰å…ƒç´ \n  \n  \n    int limit()\n    è¿”å› Buffer çš„ç•Œé™(limit) çš„ä½ç½®\n  \n  \n    Buffer limit(int n)\n    è®¾ç½®ç¼“å†²åŒºç•Œé™ä¸º n, å¹¶è¿”å›ä¸€ä¸ªå…·æœ‰æ–° limit çš„ç¼“å†²åŒºå¯¹è±¡\n  \n  \n    Buffer mark()\n    å¯¹ç¼“å†²åŒºè®¾ç½®æ ‡è®°\n  \n  \n    int position()\n    è¿”å›ç¼“å†²åŒºçš„å½“å‰ä½ç½® position\n  \n  \n    Buffer position(int n)\n    å°†è®¾ç½®ç¼“å†²åŒºçš„å½“å‰ä½ç½®ä¸º n , å¹¶è¿”å›ä¿®æ”¹åçš„ Buffer å¯¹è±¡\n  \n  \n    int remaining()\n    è¿”å› position å’Œ limit ä¹‹é—´çš„å…ƒç´ ä¸ªæ•°\n  \n  \n    Buffer reset()\n    å°†ä½ç½® position è½¬åˆ°ä»¥å‰è®¾ç½®çš„ mark æ‰€åœ¨çš„ä½ç½®\n  \n  \n    Buffer rewind()\n    å°†ä½ç½®è®¾ä¸ºä¸º 0ï¼Œ å–æ¶ˆè®¾ç½®çš„ mark\n  \n\n\nÂ¶ç¼“å†²åŒºçš„æ•°æ®æ“ä½œ\nBuffer æ‰€æœ‰å­ç±»æä¾›äº†ä¸¤ä¸ªæ•°æ®æ“ä½œçš„æ–¹æ³•ï¼šget() &amp; put() æ–¹æ³•æ¥è·å–åŠå†™å…¥ Bufferä¸­çš„æ•°æ®\n\n.tg  {border-collapse:collapse;border-color:#9ABAD9;border-spacing:0;margin:0px auto;}\n.tg td{background-color:#EBF5FF;border-color:#9ABAD9;border-style:solid;border-width:1px;color:#444;\n  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{background-color:#409cff;border-color:#9ABAD9;border-style:solid;border-width:1px;color:#fff;\n  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-sx1p{font-weight:bold;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:middle;\n  will-change:transform}\n.tg .tg-nrix{text-align:center;vertical-align:middle}\n\n\n\n  \n    å¸¸ç”¨API\n    å«ä¹‰\n  \n\n\n  \n    get()\n    è¯»å–å•ä¸ªå­—èŠ‚\n  \n  \n    get(byte[] dst)\n    æ‰¹é‡è¯»å–å¤šä¸ªå­—èŠ‚åˆ° dst ä¸­\n  \n  \n    get(int index)\n    è¯»å–æŒ‡å®šç´¢å¼•ä½ç½®çš„å­—èŠ‚(ä¸ä¼šç§»åŠ¨ position)\n  \n  \n    put(byte b)\n    å°†ç»™å®šå•ä¸ªå­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„å½“å‰ä½ç½®\n  \n  \n    put(byte[] src)\n    å°† src ä¸­çš„å­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„å½“å‰ä½ç½®\n  \n  \n    put(int index, byte b)\n    å°†æŒ‡å®šå­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„ç´¢å¼•ä½ç½®(ä¸ä¼šç§»åŠ¨ position)\n  \n\n\nÂ¶ByteBufferä½¿ç”¨æ¡ˆä¾‹\nâœ¨ ä½¿ç”¨Bufferè¯»å†™æ•°æ®ä¸€èˆ¬éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š\n\nå†™å…¥æ•°æ®åˆ°Buffer\nè°ƒç”¨flip()æ–¹æ³•ï¼Œè½¬æ¢ä¸ºè¯»æ¨¡å¼\nä»Bufferä¸­è¯»å–æ•°æ®\nè°ƒç”¨buffer.clear()æ–¹æ³•æˆ–è€…buffer.compact()æ–¹æ³•åˆ‡æ¢è‡³å†™æ¨¡å¼\n\nä¸€å¼€å§‹æƒ…å†µä¸‹ï¼Œæ•´ä¸ªByteBufferä¸­æ¯”è¾ƒé‡è¦çš„ä¸‰ä¸ªå±æ€§(position,limit,capacity)åˆå§‹åŒ–å¦‚ä¸‹ï¼š\n\nå†™æ¨¡å¼ä¸‹ï¼Œposition æ˜¯å†™å…¥ä½ç½®ï¼Œlimit ç­‰äºå®¹é‡ï¼Œä¸‹å›¾è¡¨ç¤ºå†™å…¥äº† 4 ä¸ªå­—èŠ‚åçš„çŠ¶æ€\n\nflip åŠ¨ä½œå‘ç”Ÿåï¼Œposition åˆ‡æ¢ä¸ºè¯»å–ä½ç½®ï¼Œlimit åˆ‡æ¢ä¸ºè¯»å–é™åˆ¶\n\nè¯»å– 4 ä¸ªå­—èŠ‚åï¼ŒçŠ¶æ€\n\nclear åŠ¨ä½œå‘ç”Ÿåï¼ŒçŠ¶æ€\n \ncompact æ–¹æ³•ï¼Œæ˜¯æŠŠæœªè¯»å®Œçš„éƒ¨åˆ†å‘å‰å‹ç¼©ï¼Œç„¶ååˆ‡æ¢è‡³å†™æ¨¡å¼\n\nÂ¶å‘ buffer å†™å…¥æ•°æ®\nå­˜åœ¨ä¸¤ç§æ–¹æ³•å‘ buffer ä¸­å†™å…¥æ•°æ®ï¼š\n\nè°ƒç”¨ channel çš„ read æ–¹æ³•\n\n1int readBytes = channel.read(buf);\n\nè°ƒç”¨ buffer è‡ªå·±çš„ put æ–¹æ³•\n\n1buf.put((byte)127);\nÂ¶ä» buffer ä¸­è¯»å–æ•°æ®\nåŒæ ·å­˜åœ¨ä¸¤ç§æ–¹å¼ä» buffer ä¸­è¯»å–æ•°æ®\n\nè°ƒç”¨ channel çš„ write æ–¹æ³•\n\n1int writeBytes = channel.write(buf);\n\nè°ƒç”¨ buffer è‡ªå·±çš„ get æ–¹æ³•\n\n1byte b = buf.get();\nget æ–¹æ³•ä¼šè®© position è¯»æŒ‡é’ˆå‘åèµ°ï¼Œå¦‚æœæƒ³é‡å¤è¯»å–æ•°æ®ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š\n\nè°ƒç”¨ rewind æ–¹æ³•å°† position é‡æ–°ç½®ä¸º 0\nè°ƒç”¨ get(int i) æ–¹æ³•è·å–ç´¢å¼• i çš„å†…å®¹ï¼Œå®ƒä¸ä¼šç§»åŠ¨è¯»æŒ‡é’ˆ\n\n\nÂ¶mark å’Œ reset\nmark æ˜¯åœ¨è¯»å–æ—¶ï¼Œåšä¸€ä¸ªæ ‡è®°ï¼Œå³ä½¿ position æ”¹å˜ï¼Œåªè¦è°ƒç”¨ reset å°±èƒ½å›åˆ° mark çš„ä½ç½®\nğŸ““ rewind å’Œ flip éƒ½ä¼šæ¸…é™¤ mark ä½ç½®\nÂ¶å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬\n123456//å­—ç¬¦ä¸²è½¬æ¢ä¸º bytebufferByteBuffer buffer1 = StandardCharsets.UTF_8.encode(&quot;ä½ å¥½&quot;);ByteBuffer buffer2 = Charset.forName(&quot;utf-8&quot;).encode(&quot;ä½ å¥½&quot;);//bytebuffer è½¬æ¢ä¸ºå­—ç¬¦ä¸² CharBuffer buffer3 = StandardCharsets.UTF_8.decode(buffer1);buffer3.toString();\nÂ¶ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº\nbyte byfferå¯ä»¥æ˜¯ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯åŸºäºç›´æ¥å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯éå †å†…å­˜ï¼‰ï¼›å¦ä¸€ç§æ˜¯éç›´æ¥å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯å †å†…å­˜ï¼‰ã€‚\nğŸ†š ç›´æ¥ç¼“å†²åŒºä¸éç›´æ¥ç¼“å†²åŒº\n\n\nå¯¹äºç›´æ¥å†…å­˜æ¥è¯´ï¼ŒJVMå°†ä¼šåœ¨IOæ“ä½œä¸Šå…·æœ‰æ›´é«˜çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒç›´æ¥ä½œç”¨äºæœ¬åœ°ç³»ç»Ÿçš„IOæ“ä½œ\n\n\néç›´æ¥å†…å­˜ï¼Œä¹Ÿå°±æ˜¯å †å†…å­˜ä¸­çš„æ•°æ®ï¼Œå¦‚æœè¦ä½œIOæ“ä½œï¼Œä¼šå…ˆä»æœ¬è¿›ç¨‹å†…å­˜å¤åˆ¶åˆ°ç›´æ¥å†…å­˜ï¼Œå†åˆ©ç”¨æœ¬åœ°IOå¤„ç†\n\n\nä»æ•°æ®æµçš„è§’åº¦,éç›´æ¥å†…å­˜æ˜¯ä¸‹é¢è¿™æ ·çš„ä½œç”¨é“¾ï¼šæœ¬åœ°IO--&gt;ç›´æ¥å†…å­˜--&gt;éç›´æ¥å†…å­˜--&gt;ç›´æ¥å†…å­˜--&gt;æœ¬åœ°IO\n\n\nç›´æ¥å†…å­˜æ˜¯ï¼šæœ¬åœ°IO--&gt;ç›´æ¥å†…å­˜--&gt;æœ¬åœ°IO\n\n\n\nåœ¨åšIOå¤„ç†æ—¶ï¼Œæ¯”å¦‚ç½‘ç»œå‘é€å¤§é‡æ•°æ®æ—¶ï¼Œç›´æ¥å†…å­˜ä¼šå…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚ç›´æ¥å†…å­˜ä½¿ç”¨ allocateDirect åˆ›å»ºï¼Œä½†æ˜¯å®ƒæ¯”ç”³è¯·æ™®é€šçš„å †å†…å­˜éœ€è¦è€—è´¹æ›´é«˜çš„æ€§èƒ½ã€‚\nä¸è¿‡ï¼Œè¿™éƒ¨åˆ†çš„æ•°æ®æ˜¯åœ¨JVMä¹‹å¤–çš„ï¼Œå› æ­¤å®ƒä¸ä¼šå ç”¨åº”ç”¨çš„å†…å­˜ã€‚æ‰€ä»¥ï¼Œå½“ä½ æœ‰å¾ˆå¤§çš„æ•°æ®è¦ç¼“å­˜ï¼Œå¹¶ä¸”å®ƒçš„ç”Ÿå‘½å‘¨æœŸåˆå¾ˆé•¿ï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒé€‚åˆä½¿ç”¨ç›´æ¥å†…å­˜ã€‚åªæ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸æ˜¯èƒ½å¸¦æ¥å¾ˆæ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œè¿˜æ˜¯æ¨èç›´æ¥ä½¿ç”¨å †å†…å­˜ã€‚\nå­—èŠ‚ç¼“å†²åŒºæ˜¯ç›´æ¥ç¼“å†²åŒºè¿˜æ˜¯éç›´æ¥ç¼“å†²åŒºå¯é€šè¿‡è°ƒç”¨å…¶ isDirect()  æ–¹æ³•æ¥ç¡®å®šã€‚\nâœ¨ ä½¿ç”¨åœºæ™¯\n\næœ‰å¾ˆå¤§çš„æ•°æ®éœ€è¦å­˜å‚¨ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸåˆå¾ˆé•¿\né€‚åˆé¢‘ç¹çš„IOæ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œå¹¶å‘åœºæ™¯\n\n\nÂ¶åˆ†æ•£å’Œæ±‡èš\nè®¸å¤šæ“ä½œç³»ç»Ÿéƒ½èƒ½æŠŠç»„è£…/åˆ†è§£è¿‡ç¨‹è¿›è¡Œå¾—æ›´åŠ é«˜æ•ˆã€‚æ ¹æ®å‘æ•£/æ±‡èšçš„æ¦‚å¿µï¼Œè¿›ç¨‹åªéœ€ä¸€ä¸ªç³» ç»Ÿè°ƒç”¨ï¼Œå°±èƒ½æŠŠä¸€è¿ä¸²ç¼“å†²åŒºåœ°å€ä¼ é€’ç»™æ“ä½œç³»ç»Ÿã€‚ç„¶åï¼Œå†…æ ¸å°±å¯ä»¥é¡ºåºå¡«å……æˆ–æ’å¹²å¤šä¸ªç¼“å†² åŒºï¼Œè¯»çš„æ—¶å€™å°±æŠŠæ•°æ®å‘æ•£åˆ°å¤šä¸ªç”¨æˆ·ç©ºé—´ç¼“å†²åŒºï¼Œå†™çš„æ—¶å€™å†ä»å¤šä¸ªç¼“å†²åŒºæŠŠæ•°æ®æ±‡èšèµ·æ¥\nè¿™æ ·ç”¨æˆ·è¿›ç¨‹å°±ä¸å¿…å¤šæ¬¡æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ä¹Ÿå¯ä»¥ä¼˜åŒ–æ•°æ®çš„å¤„ç†è¿‡ç¨‹ï¼Œå› ä¸ºå®ƒå·²æŒæ¡å¾…ä¼ è¾“æ•°æ®çš„å…¨éƒ¨ä¿¡æ¯ã€‚å¦‚æœç³»ç»Ÿé…æœ‰å¤šä¸ª CPU ï¼Œç”šè‡³å¯ä»¥åŒæ—¶å¡«å……æˆ–æ’å¹²å¤šä¸ªç¼“å†²åŒºã€‚\nÂ¶Scattering reads\nåˆ†æ•£è¯»å–ï¼Œè¿™æ ·å°±å¯ä»¥ä¸€æ¬¡æ€§å°†è¯»å–åˆ°çš„å†…å®¹åˆ†æ•£åœ¨å¤šä¸ªä¸åŒçš„ buffer ä¸­ï¼Œå‡å°‘äº†ä¸€ä¸ª buffer é‡å¤è¯»å–çš„æ¬¡æ•°ã€‚\n123456789101112131415try (RandomAccessFile file = new RandomAccessFile(&quot;helloword/3parts.txt&quot;, &quot;rw&quot;)) &#123;    FileChannel channel = file.getChannel();    ByteBuffer a = ByteBuffer.allocate(3);    ByteBuffer b = ByteBuffer.allocate(3);    ByteBuffer c = ByteBuffer.allocate(5);    channel.read(new ByteBuffer[]&#123;a, b, c&#125;);    a.flip();    b.flip();    c.flip();    debug(a);    debug(b);    debug(c);&#125; catch (IOException e) &#123;    e.printStackTrace();&#125;\nÂ¶Gathering Writes\n12345678910111213141516try (RandomAccessFile file = new RandomAccessFile(&quot;helloword/3parts.txt&quot;, &quot;rw&quot;)) &#123;    FileChannel channel = file.getChannel();    ByteBuffer d = ByteBuffer.allocate(4);    ByteBuffer e = ByteBuffer.allocate(4);    channel.position(11);    d.put(new byte[]&#123;&#x27;f&#x27;, &#x27;o&#x27;, &#x27;u&#x27;, &#x27;r&#x27;&#125;);    e.put(new byte[]&#123;&#x27;f&#x27;, &#x27;i&#x27;, &#x27;v&#x27;, &#x27;e&#x27;&#125;);    d.flip();    e.flip();    debug(d);    debug(e);    channel.write(new ByteBuffer[]&#123;d, e&#125;);&#125; catch (IOException e) &#123;    e.printStackTrace();&#125;\n","dateCreated":"2022-04-18T16:52:12+00:00","dateModified":"2023-06-07T02:13:34+00:00","datePublished":"2022-04-18T16:52:12+00:00","description":"æœ¬æ–‡ä¸»è¦è®²è§£ NIO ä¸­çš„ç¼“å†²åŒº","headline":"ç¼“å†²åŒº","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://pineapple-man.github.io/%E7%BC%93%E5%86%B2%E5%8C%BA/"},"publisher":{"@type":"Organization","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png","logo":{"@type":"ImageObject","url":"logo.png"}},"url":"https://pineapple-man.github.io/%E7%BC%93%E5%86%B2%E5%8C%BA/","keywords":"Java"}</script><meta name="description" content="æœ¬æ–‡ä¸»è¦è®²è§£ NIO ä¸­çš„ç¼“å†²åŒº"><meta property="og:type" content="blog"><meta property="og:title" content="ç¼“å†²åŒº"><meta property="og:url" content="https://pineapple-man.github.io/%E7%BC%93%E5%86%B2%E5%8C%BA/"><meta property="og:site_name" content="pineapple-man"><meta property="og:description" content="æœ¬æ–‡ä¸»è¦è®²è§£ NIO ä¸­çš„ç¼“å†²åŒº"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/nio-buffer.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/nio-bytebuffer.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-init.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-write.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-flip.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-read.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-init.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-compact.png"><meta property="article:published_time" content="2022-04-18T16:52:12.000Z"><meta property="article:modified_time" content="2023-06-07T02:13:34.011Z"><meta property="article:author" content="pineapple-man"><meta property="article:tag" content="Java"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/nio-buffer.png"><meta property="og:image" content="https://pineapple-man.github.io/assets/images/logo.png"><link rel="stylesheet" href="/assets/css/style-oth3meuzcjopbgwqbdvoxqknhcm0sy9wkullcc94zhkkop3pmfrpl5t4fzzz.min.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-210516333-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-210516333-1")</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"></head><body><div id="blog"><header id="header" data-behavior="5"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/" aria-label="">pineapple-man</a></div><a class="header-right-picture" href="#about" aria-label="æ‰“å¼€é“¾æ¥: /#about"><img class="header-picture" src="/assets/images/logo.png" alt="ä½œè€…çš„å›¾ç‰‡"></a></header><nav id="sidebar" data-behavior="5"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about" aria-label="é˜…è¯»æœ‰å…³ä½œè€…çš„æ›´å¤šä¿¡æ¯"><img class="sidebar-profile-picture" src="/assets/images/logo.png" alt="ä½œè€…çš„å›¾ç‰‡"></a><h4 class="sidebar-profile-name">pineapple-man</h4><h5 class="sidebar-profile-bio"><p>åšä¸€ä¸ªè èï¼šç«™å¾—ç¬”ç›´ï¼Œå¤´æˆ´ç‹å† ï¼Œå†…å¿ƒç”œç¾</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/" rel="noopener" title="é¦–é¡µ"><i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i> <span class="sidebar-button-desc">é¦–é¡µ</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories" rel="noopener" title="åˆ†ç±»"><i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i> <span class="sidebar-button-desc">åˆ†ç±»</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags" rel="noopener" title="æ ‡ç­¾"><i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i> <span class="sidebar-button-desc">æ ‡ç­¾</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives" rel="noopener" title="å½’æ¡£"><i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i> <span class="sidebar-button-desc">å½’æ¡£</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about" rel="noopener" title="å…³äº"><i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i> <span class="sidebar-button-desc">å…³äº</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/pineapple-man" target="_blank" rel="noopener" title="GitHub"><i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto://mingchaohu720@gmail.com" target="_blank" rel="noopener" title="é‚®ç®±"><i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i> <span class="sidebar-button-desc">é‚®ç®±</span></a></li></ul></div></nav><div id="main" data-behavior="5" class="hasCoverMetaIn"><article class="post"><div class="post-header main-content-wrap text-center"><h1 class="post-title">ç¼“å†²åŒº</h1><div class="post-meta"><time datetime="2022-04-18T16:52:12+00:00">4æœˆ 18, 2022 </time><span>å‘å¸ƒåœ¨ </span><a class="category-link" href="/categories/Java/">Java</a> <i class="fas fa-book-open"></i> æœ¬æ–‡å…±<span class="post-count"> 2.6k </span>å­— <i class="far fa-clock"></i> é˜…è¯»é¢„è®¡<span class="post-count"> 27 </span>åˆ†é’Ÿ</div></div><div class="post-content markdown"><div class="main-content-wrap"><h1 id="table-of-contents">ç›®å½•</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-text">æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Buffer-%E7%B1%BB%E5%8F%8A%E5%85%B6%E5%AD%90%E7%B1%BB"><span class="toc-text">Buffer ç±»åŠå…¶å­ç±»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B1%9E%E6%80%A7"><span class="toc-text">ç¼“å†²åŒºçš„åŸºæœ¬å±æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">ç¼“å†²åŒºå¸¸ç”¨æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="toc-text">ç¼“å†²åŒºçš„æ•°æ®æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ByteBuffer%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">ByteBufferä½¿ç”¨æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91-buffer-%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-text">å‘ buffer å†™å…¥æ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-buffer-%E4%B8%AD%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-text">ä» buffer ä¸­è¯»å–æ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mark-%E5%92%8C-reset"><span class="toc-text">mark å’Œ reset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E-ByteBuffer-%E4%BA%92%E8%BD%AC"><span class="toc-text">å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E4%B8%8E%E9%9D%9E%E7%9B%B4%E6%8E%A5%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-text">ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%95%A3%E5%92%8C%E6%B1%87%E8%81%9A"><span class="toc-text">åˆ†æ•£å’Œæ±‡èš</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Scattering-reads"><span class="toc-text">Scattering reads</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gathering-Writes"><span class="toc-text">Gathering Writes</span></a></li></ol></li></ol><h2 id="æ¦‚è¿°"><a class="header-anchor" href="#æ¦‚è¿°">Â¶</a>æ¦‚è¿°</h2><p>ç¼“å†²åŒºæ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨ç‰¹å®šæ•°æ®ç±»å‹çš„å®¹å™¨ï¼Œç”± <code>java.nio</code> åŒ…å®šä¹‰ï¼Œç›®å‰å¸¸ç”¨çš„ç¼“å†²åŒºéƒ½æ˜¯ Buffer æŠ½è±¡ç±»çš„å­ç±»ã€‚Java NIO ä¸­çš„ Buffer ä¸»è¦ç”¨äºä¸ NIO é€šé“è¿›è¡Œäº¤äº’ã€‚åœ¨ NIO ä¸­ï¼Œå¦‚æœç”¨æˆ·æƒ³è¦æ¶ˆè´¹æ•°æ®ï¼Œæ•°æ®é¦–å…ˆä¼šä»é€šé“è¯»å…¥ç¼“å†²åŒºï¼Œéšåç”¨æˆ·åœ¨ç¼“å†²åŒºä¸­æ¶ˆè´¹æ•°æ®ã€‚å¯¹åº”åœ°ï¼Œç”¨æˆ·å¦‚æœæƒ³è¦æ’å‡ºæ•°æ®ï¼Œæ•°æ®é¦–å…ˆä¼šä»ç¼“å†²åŒºå†™å…¥é€šé“ä¸­ï¼Œéšåé€šè¿‡é€šé“æ’å‡ºæ•°æ®ã€‚å…·ä½“çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/nio-buffer.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/nio-buffer.png" alt=""></a></div><h2 id="Buffer-ç±»åŠå…¶å­ç±»"><a class="header-anchor" href="#Buffer-ç±»åŠå…¶å­ç±»">Â¶</a>Buffer ç±»åŠå…¶å­ç±»</h2><p><strong>Buffer</strong> å°±åƒä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥ä¿å­˜å¤šä¸ªç›¸åŒç±»å‹çš„æ•°æ®ã€‚æ ¹æ®æ•°æ®ç±»å‹ä¸åŒï¼Œæœ‰ä»¥ä¸‹å¸¸ç”¨å­ç±»ï¼š</p><style type="text/css">.tg{border-collapse:collapse;border-spacing:0;margin:0 auto}.tg td{border-style:solid;border-width:0;font-family:Arial,sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal}.tg th{border-style:solid;border-width:0;font-family:Arial,sans-serif;font-size:14px;font-weight:400;overflow:hidden;padding:10px 5px;word-break:normal}.tg .tg-u1qu{font-family:"Times New Roman",Times,serif!important;font-size:medium;text-align:center;vertical-align:middle}</style><table class="tg"><thead><tr><td class="tg-u1qu">ByteBuffer</td><td class="tg-u1qu">CharBuffer</td><td class="tg-u1qu">CharBuffer</td><td class="tg-u1qu">CharBuffer</td><td class="tg-u1qu">LongBuffer</td><td class="tg-u1qu">LongBuffer</td><td class="tg-u1qu">LongBuffer</td></tr></thead></table><p>ä¸Šè¿° Buffer ç±»ä»–ä»¬éƒ½é‡‡ç”¨ç›¸ä¼¼çš„æ–¹æ³•è¿›è¡Œç®¡ç†æ•°æ®ï¼Œåªæ˜¯å„è‡ªç®¡ç†çš„æ•°æ®ç±»å‹ä¸åŒè€Œå·²ã€‚éƒ½æ˜¯é€šè¿‡å¦‚ä¸‹æ–¹æ³•è·å–ä¸€ä¸ª Buffer å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º capacity çš„ XxxBuffer å¯¹è±¡</span></span><br><span class="line"><span class="keyword">static</span> XxxBuffer <span class="title function_">allocate</span><span class="params">(<span class="type">int</span> capacity)</span>;</span><br></pre></td></tr></table></figure><div class="alert info no-icon"><p><font style="color:red;font-weight:700">Buffer æ˜¯éçº¿ç¨‹å®‰å…¨çš„</font></p></div><h2 id="ç¼“å†²åŒºçš„åŸºæœ¬å±æ€§"><a class="header-anchor" href="#ç¼“å†²åŒºçš„åŸºæœ¬å±æ€§">Â¶</a>ç¼“å†²åŒºçš„åŸºæœ¬å±æ€§</h2><p>ä¸€ä¸ªç¼“å†²åŒºå…·æœ‰å¦‚ä¸‹å››ä¸ªæœ€é‡è¦çš„åŸºæœ¬å±æ€§(<code>mark</code>ã€<code>position</code>ã€<code>limit</code>ã€<code>capacity</code>)ï¼Œå®ƒä»¬éµå®ˆä»¥ä¸‹ä¸ç­‰å¼ï¼š<code>0 &lt;= mark &lt;= position &lt;= limit &lt;= capacity</code></p><style type="text/css">.tg{border-collapse:collapse;border-color:#9abad9;border-spacing:0;margin:0 auto}.tg td{background-color:#ebf5ff;border-color:#9abad9;border-style:solid;border-width:1px;color:#444;font-family:Arial,sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal}.tg th{background-color:#409cff;border-color:#9abad9;border-style:solid;border-width:1px;color:#fff;font-family:Arial,sans-serif;font-size:14px;font-weight:400;overflow:hidden;padding:10px 5px;word-break:normal}.tg .tg-9wq8{border-color:inherit;text-align:center;vertical-align:middle}.tg .tg-ixdq{border-color:inherit;font-weight:700;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:middle;will-change:transform}.tg .tg-uzvj{border-color:inherit;font-weight:700;text-align:center;vertical-align:middle}</style><table class="tg"><thead><tr><th class="tg-ixdq">åŸºæœ¬å±æ€§</th><th class="tg-ixdq">å«ä¹‰</th></tr></thead><tbody><tr><td class="tg-uzvj">å®¹é‡ (capacity)</td><td class="tg-9wq8">ä½œä¸ºä¸€ä¸ªå†…å­˜å—ï¼ŒBufferå…·æœ‰ä¸€å®šçš„å›ºå®šå¤§å°ï¼Œä¹Ÿç§°ä¸º"å®¹é‡"ï¼Œç¼“å†²åŒºå®¹é‡ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”åˆ›å»ºåä¸èƒ½æ›´æ”¹</td></tr><tr><td class="tg-uzvj">é™åˆ¶ (limit)</td><td class="tg-9wq8">è¡¨ç¤ºç¼“å†²åŒºä¸­å¯ä»¥æ“ä½œæ•°æ®çš„å¤§å°ï¼ˆlimit åæ•°æ®ä¸èƒ½è¿›è¡Œè¯»å†™ï¼‰ã€‚ç¼“å†²åŒºçš„é™åˆ¶ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶å®¹é‡<span style="color:#a7a7a7"> </span>å†™å…¥æ¨¡å¼ï¼Œé™åˆ¶ç­‰äºbufferçš„å®¹é‡<span style="color:#a7a7a7"> </span>è¯»å–æ¨¡å¼ä¸‹ï¼Œlimitç­‰äºå†™å…¥çš„æ•°æ®é‡</td></tr><tr><td class="tg-uzvj">ä½ç½®ï¼ˆposition)</td><td class="tg-9wq8">ä¸‹ä¸€ä¸ªè¦è¯»å–æˆ–å†™å…¥çš„æ•°æ®çš„ç´¢å¼•ã€‚ç¼“å†²åŒºçš„ä½ç½®ä¸èƒ½ä¸º è´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶é™åˆ¶(<span style="background-color:#f3f4f4">limit</span>)</td></tr><tr><td class="tg-uzvj">æ ‡è®° (mark)ä¸é‡ç½® (reset)</td><td class="tg-9wq8">æ ‡è®°æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œé€šè¿‡ Buffer ä¸­çš„ mark() æ–¹æ³• æŒ‡å®š Buffer ä¸­ä¸€ä¸ªç‰¹å®šçš„ positionï¼Œä¹‹åå¯ä»¥é€šè¿‡è°ƒç”¨ reset() æ–¹æ³•æ¢å¤åˆ°è¿™ ä¸ª position</td></tr></tbody></table><p>ç®€å•çš„ç›¸å…³æ“ä½œå¦‚ä¸‹ï¼š</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/nio-bytebuffer.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/nio-bytebuffer.png" alt=""></a></div><h2 id="ç¼“å†²åŒºå¸¸ç”¨æ–¹æ³•"><a class="header-anchor" href="#ç¼“å†²åŒºå¸¸ç”¨æ–¹æ³•">Â¶</a>ç¼“å†²åŒºå¸¸ç”¨æ–¹æ³•</h2><style type="text/css">.tg{border-collapse:collapse;border-color:#9abad9;border-spacing:0;margin:0 auto}.tg td{background-color:#ebf5ff;border-color:#9abad9;border-style:solid;border-width:1px;color:#444;font-family:Arial,sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal}.tg th{background-color:#409cff;border-color:#9abad9;border-style:solid;border-width:1px;color:#fff;font-family:Arial,sans-serif;font-size:14px;font-weight:400;overflow:hidden;padding:10px 5px;word-break:normal}.tg .tg-sx1p{font-weight:700;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:middle;will-change:transform}.tg .tg-nrix{text-align:center;vertical-align:middle}</style><table class="tg"><thead><tr><th class="tg-sx1p">å¸¸ç”¨API</th><th class="tg-sx1p">å«ä¹‰</th></tr></thead><tbody><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">Buffer clear()</span></td><td class="tg-nrix">æ¸…ç©ºç¼“å†²åŒºå¹¶è¿”å›å¯¹ç¼“å†²åŒºçš„å¼•ç”¨</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">Buffer flip()</span></td><td class="tg-nrix">å°†ç¼“å†²åŒºçš„ç•Œé™è®¾ç½®ä¸ºå½“å‰ä½ç½®ï¼Œå¹¶å°†å½“å‰ä½ç½®é‡ç½®ä¸º 0ï¼Œç”±å†™æ¨¡å¼è½¬æ¢ä¸ºè¯»æ¨¡å¼</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">int capacity()</span></td><td class="tg-nrix">è¿”å› Buffer çš„ capacity å¤§å°</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">boolean hasRemaining()</span></td><td class="tg-nrix">åˆ¤æ–­ç¼“å†²åŒºä¸­æ˜¯å¦è¿˜æœ‰å…ƒç´ </td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">int limit()</span></td><td class="tg-nrix">è¿”å› Buffer çš„ç•Œé™(limit) çš„ä½ç½®</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">Buffer limit(int n)</span></td><td class="tg-nrix">è®¾ç½®ç¼“å†²åŒºç•Œé™ä¸º n, å¹¶è¿”å›ä¸€ä¸ªå…·æœ‰æ–° limit çš„ç¼“å†²åŒºå¯¹è±¡</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">Buffer mark()</span></td><td class="tg-nrix">å¯¹ç¼“å†²åŒºè®¾ç½®æ ‡è®°</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">int position()</span></td><td class="tg-nrix">è¿”å›ç¼“å†²åŒºçš„å½“å‰ä½ç½® position</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">Buffer position(int n)</span></td><td class="tg-nrix">å°†è®¾ç½®ç¼“å†²åŒºçš„å½“å‰ä½ç½®ä¸º n , å¹¶è¿”å›ä¿®æ”¹åçš„ Buffer å¯¹è±¡</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">int remaining()</span></td><td class="tg-nrix">è¿”å› position å’Œ limit ä¹‹é—´çš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">Buffer reset()</span></td><td class="tg-nrix">å°†ä½ç½® position è½¬åˆ°ä»¥å‰è®¾ç½®çš„ mark æ‰€åœ¨çš„ä½ç½®</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">Buffer rewind()</span></td><td class="tg-nrix">å°†ä½ç½®è®¾ä¸ºä¸º 0ï¼Œ å–æ¶ˆè®¾ç½®çš„ mark</td></tr></tbody></table><h2 id="ç¼“å†²åŒºçš„æ•°æ®æ“ä½œ"><a class="header-anchor" href="#ç¼“å†²åŒºçš„æ•°æ®æ“ä½œ">Â¶</a>ç¼“å†²åŒºçš„æ•°æ®æ“ä½œ</h2><p>Buffer æ‰€æœ‰å­ç±»æä¾›äº†ä¸¤ä¸ªæ•°æ®æ“ä½œçš„æ–¹æ³•ï¼š<code>get() &amp; put()</code>æ–¹æ³•æ¥è·å–åŠå†™å…¥ Bufferä¸­çš„æ•°æ®</p><style type="text/css">.tg{border-collapse:collapse;border-color:#9abad9;border-spacing:0;margin:0 auto}.tg td{background-color:#ebf5ff;border-color:#9abad9;border-style:solid;border-width:1px;color:#444;font-family:Arial,sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal}.tg th{background-color:#409cff;border-color:#9abad9;border-style:solid;border-width:1px;color:#fff;font-family:Arial,sans-serif;font-size:14px;font-weight:400;overflow:hidden;padding:10px 5px;word-break:normal}.tg .tg-sx1p{font-weight:700;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:middle;will-change:transform}.tg .tg-nrix{text-align:center;vertical-align:middle}</style><table class="tg"><thead><tr><th class="tg-sx1p">å¸¸ç”¨API</th><th class="tg-sx1p">å«ä¹‰</th></tr></thead><tbody><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">get()</span></td><td class="tg-nrix">è¯»å–å•ä¸ªå­—èŠ‚</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">get(byte[] dst)</span></td><td class="tg-nrix">æ‰¹é‡è¯»å–å¤šä¸ªå­—èŠ‚åˆ° dst ä¸­</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">get(int index)</span></td><td class="tg-nrix">è¯»å–æŒ‡å®šç´¢å¼•ä½ç½®çš„å­—èŠ‚(ä¸ä¼šç§»åŠ¨ position)</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">put(byte b)</span></td><td class="tg-nrix">å°†ç»™å®šå•ä¸ªå­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„å½“å‰ä½ç½®</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">put(byte[] src)</span></td><td class="tg-nrix">å°† src ä¸­çš„å­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„å½“å‰ä½ç½®</td></tr><tr><td class="tg-nrix"><span style="background-color:#f3f4f4">put(int index, byte b)</span></td><td class="tg-nrix">å°†æŒ‡å®šå­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„ç´¢å¼•ä½ç½®(ä¸ä¼šç§»åŠ¨ position)</td></tr></tbody></table><h2 id="ByteBufferä½¿ç”¨æ¡ˆä¾‹"><a class="header-anchor" href="#ByteBufferä½¿ç”¨æ¡ˆä¾‹">Â¶</a><code>ByteBuffer</code>ä½¿ç”¨æ¡ˆä¾‹</h2><p>âœ¨ <strong>ä½¿ç”¨Bufferè¯»å†™æ•°æ®ä¸€èˆ¬éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</strong></p><ol><li>å†™å…¥æ•°æ®åˆ°Buffer</li><li>è°ƒç”¨<code>flip()</code>æ–¹æ³•ï¼Œè½¬æ¢ä¸º<strong>è¯»æ¨¡å¼</strong></li><li>ä»Bufferä¸­è¯»å–æ•°æ®</li><li>è°ƒç”¨<code>buffer.clear()</code>æ–¹æ³•æˆ–è€…<code>buffer.compact()</code>æ–¹æ³•åˆ‡æ¢è‡³<strong>å†™æ¨¡å¼</strong></li></ol><p>ä¸€å¼€å§‹æƒ…å†µä¸‹ï¼Œæ•´ä¸ª<code>ByteBuffer</code>ä¸­æ¯”è¾ƒé‡è¦çš„ä¸‰ä¸ªå±æ€§(<code>position</code>,<code>limit</code>,<code>capacity</code>)åˆå§‹åŒ–å¦‚ä¸‹ï¼š</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-init.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-init.png" alt=""></a></div><p>å†™æ¨¡å¼ä¸‹ï¼Œposition æ˜¯å†™å…¥ä½ç½®ï¼Œlimit ç­‰äºå®¹é‡ï¼Œä¸‹å›¾è¡¨ç¤ºå†™å…¥äº† 4 ä¸ªå­—èŠ‚åçš„çŠ¶æ€</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-write.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-write.png" alt=""></a></div><p>flip åŠ¨ä½œå‘ç”Ÿåï¼Œposition åˆ‡æ¢ä¸ºè¯»å–ä½ç½®ï¼Œlimit åˆ‡æ¢ä¸ºè¯»å–é™åˆ¶</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-flip.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-flip.png" alt=""></a></div><p>è¯»å– 4 ä¸ªå­—èŠ‚åï¼ŒçŠ¶æ€</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-read.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-read.png" alt=""></a></div><p>clear åŠ¨ä½œå‘ç”Ÿåï¼ŒçŠ¶æ€</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-init.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-init.png" alt=""></a></div><p>compact æ–¹æ³•ï¼Œæ˜¯æŠŠæœªè¯»å®Œçš„éƒ¨åˆ†å‘å‰å‹ç¼©ï¼Œç„¶ååˆ‡æ¢è‡³å†™æ¨¡å¼</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-compact.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/java/io/bytebuffer-compact.png" alt=""></a></div><h3 id="å‘-buffer-å†™å…¥æ•°æ®"><a class="header-anchor" href="#å‘-buffer-å†™å…¥æ•°æ®">Â¶</a>å‘ buffer å†™å…¥æ•°æ®</h3><p>å­˜åœ¨ä¸¤ç§æ–¹æ³•å‘ buffer ä¸­å†™å…¥æ•°æ®ï¼š</p><ol><li>è°ƒç”¨ channel çš„ read æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">readBytes</span> <span class="operator">=</span> channel.read(buf);</span><br></pre></td></tr></table></figure><ol start="2"><li>è°ƒç”¨ buffer è‡ªå·±çš„ put æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.put((<span class="type">byte</span>)<span class="number">127</span>);</span><br></pre></td></tr></table></figure><h3 id="ä»-buffer-ä¸­è¯»å–æ•°æ®"><a class="header-anchor" href="#ä»-buffer-ä¸­è¯»å–æ•°æ®">Â¶</a>ä» buffer ä¸­è¯»å–æ•°æ®</h3><p>åŒæ ·å­˜åœ¨ä¸¤ç§æ–¹å¼ä» buffer ä¸­è¯»å–æ•°æ®</p><ol><li>è°ƒç”¨ channel çš„ write æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">writeBytes</span> <span class="operator">=</span> channel.write(buf);</span><br></pre></td></tr></table></figure><ol start="2"><li>è°ƒç”¨ buffer è‡ªå·±çš„ get æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> buf.get();</span><br></pre></td></tr></table></figure><p>get æ–¹æ³•ä¼šè®© position è¯»æŒ‡é’ˆå‘åèµ°ï¼Œå¦‚æœæƒ³é‡å¤è¯»å–æ•°æ®ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><div class="alert success no-icon"><ol><li>è°ƒç”¨ rewind æ–¹æ³•å°† position é‡æ–°ç½®ä¸º 0</li><li>è°ƒç”¨ get(int i) æ–¹æ³•è·å–ç´¢å¼• i çš„å†…å®¹ï¼Œå®ƒä¸ä¼šç§»åŠ¨è¯»æŒ‡é’ˆ</li></ol></div><h3 id="mark-å’Œ-reset"><a class="header-anchor" href="#mark-å’Œ-reset">Â¶</a>mark å’Œ reset</h3><p>mark æ˜¯åœ¨è¯»å–æ—¶ï¼Œåšä¸€ä¸ªæ ‡è®°ï¼Œå³ä½¿ position æ”¹å˜ï¼Œåªè¦è°ƒç”¨ reset å°±èƒ½å›åˆ° mark çš„ä½ç½®</p><p>ğŸ““ rewind å’Œ flip éƒ½ä¼šæ¸…é™¤ mark ä½ç½®</p><h3 id="å­—ç¬¦ä¸²ä¸-ByteBuffer-äº’è½¬"><a class="header-anchor" href="#å­—ç¬¦ä¸²ä¸-ByteBuffer-äº’è½¬">Â¶</a>å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å­—ç¬¦ä¸²è½¬æ¢ä¸º bytebuffer</span></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer1</span> <span class="operator">=</span> StandardCharsets.UTF_8.encode(<span class="string">&quot;ä½ å¥½&quot;</span>);</span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer2</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;utf-8&quot;</span>).encode(<span class="string">&quot;ä½ å¥½&quot;</span>);</span><br><span class="line"><span class="comment">//bytebuffer è½¬æ¢ä¸ºå­—ç¬¦ä¸² </span></span><br><span class="line"><span class="type">CharBuffer</span> <span class="variable">buffer3</span> <span class="operator">=</span> StandardCharsets.UTF_8.decode(buffer1);</span><br><span class="line">buffer3.toString();</span><br></pre></td></tr></table></figure><h2 id="ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº"><a class="header-anchor" href="#ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº">Â¶</a>ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº</h2><p><code>byte byffer</code>å¯ä»¥æ˜¯ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯åŸºäºç›´æ¥å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯éå †å†…å­˜ï¼‰ï¼›å¦ä¸€ç§æ˜¯éç›´æ¥å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯å †å†…å­˜ï¼‰ã€‚</p><p>ğŸ†š ç›´æ¥ç¼“å†²åŒºä¸éç›´æ¥ç¼“å†²åŒº</p><div class="alert success no-icon"><ul><li><p>å¯¹äºç›´æ¥å†…å­˜æ¥è¯´ï¼ŒJVMå°†ä¼šåœ¨IOæ“ä½œä¸Šå…·æœ‰æ›´é«˜çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒç›´æ¥ä½œç”¨äºæœ¬åœ°ç³»ç»Ÿçš„IOæ“ä½œ</p></li><li><p>éç›´æ¥å†…å­˜ï¼Œä¹Ÿå°±æ˜¯å †å†…å­˜ä¸­çš„æ•°æ®ï¼Œå¦‚æœè¦ä½œIOæ“ä½œï¼Œä¼šå…ˆä»æœ¬è¿›ç¨‹å†…å­˜å¤åˆ¶åˆ°ç›´æ¥å†…å­˜ï¼Œå†åˆ©ç”¨æœ¬åœ°IOå¤„ç†</p></li><li><p>ä»æ•°æ®æµçš„è§’åº¦,éç›´æ¥å†…å­˜æ˜¯ä¸‹é¢è¿™æ ·çš„ä½œç”¨é“¾ï¼š<code>æœ¬åœ°IO--&gt;ç›´æ¥å†…å­˜--&gt;éç›´æ¥å†…å­˜--&gt;ç›´æ¥å†…å­˜--&gt;æœ¬åœ°IO</code></p></li><li><p>ç›´æ¥å†…å­˜æ˜¯ï¼š<code>æœ¬åœ°IO--&gt;ç›´æ¥å†…å­˜--&gt;æœ¬åœ°IO</code></p></li></ul></div><p>åœ¨åšIOå¤„ç†æ—¶ï¼Œæ¯”å¦‚ç½‘ç»œå‘é€å¤§é‡æ•°æ®æ—¶ï¼Œç›´æ¥å†…å­˜ä¼šå…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚ç›´æ¥å†…å­˜ä½¿ç”¨ allocateDirect åˆ›å»ºï¼Œä½†æ˜¯å®ƒæ¯”ç”³è¯·æ™®é€šçš„å †å†…å­˜éœ€è¦è€—è´¹æ›´é«˜çš„æ€§èƒ½ã€‚</p><p>ä¸è¿‡ï¼Œè¿™éƒ¨åˆ†çš„æ•°æ®æ˜¯åœ¨JVMä¹‹å¤–çš„ï¼Œå› æ­¤å®ƒä¸ä¼šå ç”¨åº”ç”¨çš„å†…å­˜ã€‚æ‰€ä»¥ï¼Œå½“ä½ æœ‰å¾ˆå¤§çš„æ•°æ®è¦ç¼“å­˜ï¼Œå¹¶ä¸”å®ƒçš„ç”Ÿå‘½å‘¨æœŸåˆå¾ˆé•¿ï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒé€‚åˆä½¿ç”¨ç›´æ¥å†…å­˜ã€‚åªæ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸æ˜¯èƒ½å¸¦æ¥å¾ˆæ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œè¿˜æ˜¯æ¨èç›´æ¥ä½¿ç”¨å †å†…å­˜ã€‚</p><p>å­—èŠ‚ç¼“å†²åŒºæ˜¯ç›´æ¥ç¼“å†²åŒºè¿˜æ˜¯éç›´æ¥ç¼“å†²åŒºå¯é€šè¿‡è°ƒç”¨å…¶ isDirect() æ–¹æ³•æ¥ç¡®å®šã€‚</p><p>âœ¨ <strong>ä½¿ç”¨åœºæ™¯</strong></p><div class="alert success no-icon"><ul><li>æœ‰å¾ˆå¤§çš„æ•°æ®éœ€è¦å­˜å‚¨ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸåˆå¾ˆé•¿</li><li>é€‚åˆé¢‘ç¹çš„IOæ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œå¹¶å‘åœºæ™¯</li></ul></div><h2 id="åˆ†æ•£å’Œæ±‡èš"><a class="header-anchor" href="#åˆ†æ•£å’Œæ±‡èš">Â¶</a>åˆ†æ•£å’Œæ±‡èš</h2><p>è®¸å¤šæ“ä½œç³»ç»Ÿéƒ½èƒ½æŠŠç»„è£…/åˆ†è§£è¿‡ç¨‹è¿›è¡Œå¾—æ›´åŠ é«˜æ•ˆã€‚æ ¹æ®å‘æ•£/æ±‡èšçš„æ¦‚å¿µï¼Œè¿›ç¨‹åªéœ€ä¸€ä¸ªç³» ç»Ÿè°ƒç”¨ï¼Œå°±èƒ½æŠŠä¸€è¿ä¸²ç¼“å†²åŒºåœ°å€ä¼ é€’ç»™æ“ä½œç³»ç»Ÿã€‚ç„¶åï¼Œå†…æ ¸å°±å¯ä»¥é¡ºåºå¡«å……æˆ–æ’å¹²å¤šä¸ªç¼“å†² åŒºï¼Œè¯»çš„æ—¶å€™å°±æŠŠæ•°æ®å‘æ•£åˆ°å¤šä¸ªç”¨æˆ·ç©ºé—´ç¼“å†²åŒºï¼Œå†™çš„æ—¶å€™å†ä»å¤šä¸ªç¼“å†²åŒºæŠŠæ•°æ®æ±‡èšèµ·æ¥</p><p>è¿™æ ·ç”¨æˆ·è¿›ç¨‹å°±ä¸å¿…å¤šæ¬¡æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ä¹Ÿå¯ä»¥ä¼˜åŒ–æ•°æ®çš„å¤„ç†è¿‡ç¨‹ï¼Œå› ä¸ºå®ƒå·²æŒæ¡å¾…ä¼ è¾“æ•°æ®çš„å…¨éƒ¨ä¿¡æ¯ã€‚å¦‚æœç³»ç»Ÿé…æœ‰å¤šä¸ª CPU ï¼Œç”šè‡³å¯ä»¥åŒæ—¶å¡«å……æˆ–æ’å¹²å¤šä¸ªç¼“å†²åŒºã€‚</p><h3 id="Scattering-reads"><a class="header-anchor" href="#Scattering-reads">Â¶</a>Scattering reads</h3><p>åˆ†æ•£è¯»å–ï¼Œè¿™æ ·å°±å¯ä»¥ä¸€æ¬¡æ€§å°†è¯»å–åˆ°çš„å†…å®¹åˆ†æ•£åœ¨å¤šä¸ªä¸åŒçš„ buffer ä¸­ï¼Œå‡å°‘äº†ä¸€ä¸ª buffer é‡å¤è¯»å–çš„æ¬¡æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">RandomAccessFile</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;helloword/3parts.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>)) &#123;</span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> file.getChannel();</span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">a</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">3</span>);</span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">b</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">3</span>);</span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">c</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">5</span>);</span><br><span class="line">    channel.read(<span class="keyword">new</span> <span class="title class_">ByteBuffer</span>[]&#123;a, b, c&#125;);</span><br><span class="line">    a.flip();</span><br><span class="line">    b.flip();</span><br><span class="line">    c.flip();</span><br><span class="line">    debug(a);</span><br><span class="line">    debug(b);</span><br><span class="line">    debug(c);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Gathering-Writes"><a class="header-anchor" href="#Gathering-Writes">Â¶</a>Gathering Writes</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">RandomAccessFile</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;helloword/3parts.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>)) &#123;</span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> file.getChannel();</span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">d</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">4</span>);</span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">e</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">4</span>);</span><br><span class="line">    channel.position(<span class="number">11</span>);</span><br><span class="line"></span><br><span class="line">    d.put(<span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;r&#x27;</span>&#125;);</span><br><span class="line">    e.put(<span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;e&#x27;</span>&#125;);</span><br><span class="line">    d.flip();</span><br><span class="line">    e.flip();</span><br><span class="line">    debug(d);</span><br><span class="line">    debug(e);</span><br><span class="line">    channel.write(<span class="keyword">new</span> <span class="title class_">ByteBuffer</span>[]&#123;d, e&#125;);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">æ ‡ç­¾</span><br><a class="tag tag--primary tag--small t-none-link" href="/tags/Java/" rel="tag">Java</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5/" data-tooltip="æ··æ·†çŸ©é˜µ" aria-label="ä¸Šä¸€ç¯‡: æ··æ·†çŸ©é˜µ"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">ä¸Šä¸€ç¯‡</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/" data-tooltip="åˆ†å¸ƒå¼ç³»ç»Ÿæ¦‚è¿°" aria-label="ä¸‹ä¸€ç¯‡: åˆ†å¸ƒå¼ç³»ç»Ÿæ¦‚è¿°"><span class="hide-xs hide-sm text-small icon-mr">ä¸‹ä¸€ç¯‡</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="ç›®å½•"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></article><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2023 pineapple-man. All Rights Reserved.</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><br>Total <span id="busuanzi_value_site_pv"></span> views. æ‚¨æ˜¯pineapple-mançš„ç¬¬<span id="busuanzi_value_site_uv"></span>ä¸ªå°ä¼™ä¼´<br><i class="fas fa-book-open"></i> <span class="post-count">åšå®¢å­—æ•°ç»Ÿè®¡ï¼š370.7k</span><script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="5"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5/" data-tooltip="æ··æ·†çŸ©é˜µ" aria-label="ä¸Šä¸€ç¯‡: æ··æ·†çŸ©é˜µ"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">ä¸Šä¸€ç¯‡</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/" data-tooltip="åˆ†å¸ƒå¼ç³»ç»Ÿæ¦‚è¿°" aria-label="ä¸‹ä¸€ç¯‡: åˆ†å¸ƒå¼ç³»ç»Ÿæ¦‚è¿°"><span class="hide-xs hide-sm text-small icon-mr">ä¸‹ä¸€ç¯‡</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="ç›®å½•"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-times"></i></div><img id="about-card-picture" src="/assets/images/logo.png" alt="ä½œè€…çš„å›¾ç‰‡"><h4 id="about-card-name">pineapple-man</h4><div id="about-card-bio"><p>åšä¸€ä¸ªè èï¼šç«™å¾—ç¬”ç›´ï¼Œå¤´æˆ´ç‹å† ï¼Œå†…å¿ƒç”œç¾</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>åˆšæ¯•ä¸šå°±å¤±ä¸š</p></div><div id="about-card-location"><i class="fa fa-map-marker-alt"></i><br>è¥¿å®‰</div></div></div><div id="cover" style="background-image:url(/assets/images/cover-v1.2.0.jpg)"></div><script src="/assets/js/script-kcoiyt1nxfue7qgcpkrcixymglcc3cuxeg98fy01hqww4nblnhd2ees6j6yc.min.js"></script></body></html>