<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="pineapple-man"><title>DevOps 概述 - pineapple-man</title><meta name="author" content="pineapple-man"><meta name="keywords" content="DevOps"><link rel="icon" href="https://pineapple-man.github.io/assets/images/logo.svg"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png"},"articleBody":"\n¶DevOps 概述\n\nDevOps 是 Development 和 Operations 的组合，也就是开发和运维的简写，DevOps 是针对企业中的研发人员、运维人员和测试人员的工作理念，是他们在应用开发、代码部署和质量测试等整条生命周期中协作和沟通的最佳实践，DevOps 强调整个组织的合作以及交付和基础设施变更的自动化、从而实现持续集成、持续部署和持续交付\n\n目前常用的 DevOps 四大平台:代码托管(gitlab/svn)、项目管理(jira)、运维平台(腾讯蓝鲸/开源平台)、持续交付 ( Jenkins/gitlab)\n\n为什么需要推广 DevOps ？\n\nDevOps 强调团队协作、相互协作、持续发展，然而传统的模式是开发人员只顾开发程序，运维人员只负责基础环境管理和代码部署以及监控等，其并不是为了一个共同的目标而共同实现最终的目的，而 DevOps 则实现团队作战，即无论是开发、运维还是测试，都是为了最终的代码发布、持续部署和业务稳定而付出各自的努力，从而实现产品设计、开发、测试和部署的良性循环，实现产品的最终持续交付\n✨ DevOps 的优势：\n\n速度：应用版本快速的迭代更新，以更好地适应不断变换的市场需求\n快速交付：更快的将应用交付至生产环境\n可靠性：保证应用交付的结果是成功的\n规模：可以在大规模环境下且可靠的交付应用\n增强合作：建立适应 DevOps 文化模式的团队，开发人员和运维人员协同工作\n安全性：在快速迭代的同时保证应用的质量\n\n\n¶DevOps 的目标是什么？\nDevOps 的目标是建立流水线式的准时制（JIT）的业务流程。DevOps 旨在通过合适的准时制业务流程来最大化业务产出，例如增加销售和利润率、提升业务速度，或尽量降低运营成本。\n\nDevOps 意味着在业务中建立一条 IT 服务供应链，与其它产品的供应链嵌入业务的方式相同。这种从提供软件交付到供给 IT 服务的模式转变是巨大的。\n从架构的角度看，DevOps 需要建立一个自动快速部署系统，有很多方法论和工具可以利用。DevOps 没有统一的实施模板，每个组织都不得不自己考虑并建立 DevOps 流程来提高业务。因此，真正理解 DevOps 的概念，对员工遵循正确的流程有效执行来说是至关重要的。\nDevOps 技术团队进行软件开发流程\n\n\n\n¶持续集成（CI-Continuous Integration）\nCI（Continuous integration），持续集成是指多名开发者在开发不同功能代码的过程中，可以频繁的将代码行合并到一起并相互不影响工作。\n\n\n¶持续部署（CD-Continuous Deployment）\nCD（continuous deployment）是基于某种工具或平台实现代码自动化的构建、测试和部署到线上环境以实现交付高质量的产品，持续部署在某种程度上代表了一个开发团队的更新迭代速率\n\n¶持续交付（CD-Continuous Delivery）\n持续交付是在持续部署的基础之上，将产品交付到线上环境，因此持续交付是产品价值的一种交付，是产品价值的一种盈利的实现\n\n\n¶CI/CD 总结\n\n使用 Jenkins 进行软件部署的流程如下，分别需要经过测试环境、预发布环境和生产环境。其中，测试环境比较单一，数据量比较简单；预发布环境：正规的代码流程，还有正规的测试人员进行测试，数据和生产环境几乎一致\n\n¶常见的部署方式\n\n最原始的方案：开发自己上传\n运维自动手动部署：开发给运维，随后运维手动部署\n半自动化：运维使用脚本复制部署\n自动化：结合 Web 界面一键部署\n\nDevOps 就是希望越来越多的软件产品能够做到自动化的部署，这样可以加速软件迭代，快速完成软件需求\n¶部署策略\n软件最终都是要进行发布，随后部署在某台服务器上，但是不同的部署策略将严重影响到软件开发周期等因素，所以追求更短的迭代周期、更高频的发布，就需要发展出适应的 DevOps 要求的发布策略\n¶停机发布\n停机发布会在发布以前关闭服务，停止用户访问，然后一次性的升级所有服务。这种发布策略的发布频率往往比较低，且需要在发布之前做好充足的测试\n\n✨ 停机发布的特点：\n\n所有需要升级的组件被整合到一次发布中\n一个项目中的大部分应用都会被更新\n发布之前的研发流程和测试流程往往需要花很长的时间\n发布时如果出现问题, 修复和回滚的成本很高\n完成一次停机发布, 需要花费很久的时间, 且需要很多团队在一起才能完成\n往往需要客户端和服务器端同步升级\n\n\n停机发布并不适合互联网公司，因为两次发布的间隔很久，从功能特性提出到进入市场的时间太长，对市场反应不敏感，会在充分竞争的市场里处于下风。每次发布因为要停机，也会带来经济损失\n停机发布的最大优势就是部署简单，不需要考虑新旧版本共存时的兼容性问题；但是仍然存在许多劣势：发布过程中。服务不可用；只能在业务低峰期（往往是夜间）发布，并且需要很多团队在一起工作；这种发布出现错误之后很难进行回滚\n🎶 这种发布方式适用于开发测试环境；非关键应用，用户影响面小；兼容性比较难管控的场景\n\n¶金丝雀发布\n金丝雀发布这个术语源自 20 世纪初期，当时英国的煤矿工人在下井采矿之前，会把笼养的金丝雀携带到矿井中，如果矿井中一氧化碳等有毒气体的浓度过高，在影响矿工之前，金丝雀相比人类表现的更加敏感快速，金丝雀中毒之后，煤矿工人就知道该立刻撤离。金丝雀发布是在将整个软件的新版本发布给所有用户之前，先发布给部分用户，用真实的客户流量来测试，以保证软件不会出现严重问题，降低发布风险\n\n在实践中，金丝雀发布一般会先发布到一个小比例的机器，比如 2% 的服务器做流量验证，然后从中快速获得反馈，根据反馈决定是扩大发布还是回滚。金丝雀发布通常会结合监控系统，通过监控指标，观察金丝雀机器的健康状况。如果金丝雀测试通过，则把剩余的机器全部升级成新版本，否则回滚代码\n\n\n金丝雀发布对用户体验影响较小，再金丝雀发布过程中，只有少量用户会受到影响，发布安全能够得到保障；但是由于金丝雀的机器数量比较少，有一些问题并不能有效的暴露出来\n🎶 金丝雀发布适用于监控比较完备且于发布系统集成的环境\n\n¶灰度/滚动发布\n灰度发布是金丝雀发布的延伸，是将发布分成不同的阶段/批次，每个阶段/批次的用户数量逐级增加。如果新版本在当前阶段没有发现问题，就再增加用户数量进入下一个阶段，直至扩展到全部用户\n\n灰度发布可以减小发布风险，是一种零宕机时间的发布策略。它通过切换线上并存版本之间的路由权重，逐步从一个版本切换为另一个版本。整个发布过程会持续比较长的时间, 在这段时间内，新旧代码共存，所以在开发过程中，需要考虑版本之间的兼容性，新旧代码共存不能影响功能可用性和用户体验。当新版本代码出现问题时，灰度发布能够比较快的回滚到老版本的代码上\n结合特性开关等技术，灰度发布可以实现更复杂灵活的发布策略\n\n金丝雀发布、灰度发布步骤组成：\n\n\n准备好部署各个阶段的工件，包括:构建工件，测试脚本，配置文件和部署清单文件\n从负载均衡列表中移除掉「 金丝雀 」服务器\n升级「 金丝雀 」应用(排掉原有流量并进行部署)\n对应用进行自动化测试\n将 「 金丝雀 」服务器重新添加到负载均衡列表中(连通性和健康检查)\n如果 「 金丝雀 」在线使用测试成功，升级剩余的其他服务器。(否则就回滚) 灰度发布可以保证整体系统的稳定，在初始灰度的时候就可以发现、调整问题，以保证其影响度。\n\n灰度发布对用户体验影响比较小, 不需要停机发布、并且能够控制发布风险。但是发布时间会比较长，需要复杂的发布系统和负载均衡器。在发布完成之后还需要考虑新旧版本共存时的兼容性\n🎶 灰度发布适用于可用性较高的生产环境发布\n\n¶蓝绿发布\n蓝绿部署是指有两个完全相同的、互相独立的生产环境，一个叫做“蓝环境”，一个叫做“绿环境”。其中，绿环境是用户正在使用的生产环境。当要部署一个新版本的时候，先把这个新版本部署到蓝环境中，然后在蓝环境中运行冒烟测试，以检查新版本是否正常工作。如果测试通过，发布系统更新路由配置，将用户流量从绿环境导向蓝环境，蓝环境就变成了生产环境。这种切换通常在一秒钟之内就能搞定。如果出了问题，把路由切回到绿环境上，再在蓝环境中调试，找到问题的原因。因此，蓝绿部署可以做到仅仅一次切换，立刻就向所有用户推出新版本，新功能对所有用户立刻生效可见\n\n\n👍 蓝绿发布优势：\n\n升级切换和回退速度非常快\n零停机时间\n\n😣 蓝绿发布的不足\n\n一次性的全量切换，如果发布出现问题, 会对用户产生比较大的影响\n需要两倍的机器资源\n需要中间件和应用自身支持热备集群的流量切换🎶 蓝绿发布适用于机器资源比较富余或者按需分配 (背靠云厂商)\n\n\n\n¶A/B 测试\nA/B 测试和灰度发布非常像，可以从发布的目的上进行区分。AB 测试侧重的是根据 A 版本和 B 版本的差异进行决策，最终选择一个版本进行部署。和灰度发布相比，AB 测试更倾向于去决策，和金丝雀发布相比，AB 测试在权重和流量的切换上更灵活\n\n举个例子，某功能有两个实现版本 A 和 B，通过细粒度的流量控制，把 50% 的用户总是引导到 A 实现上，把剩下的 50% 用户总是引导到 B 实现上，通过比较 A 实现和 B 实现的转化率，最终选择转化率较高的 A 实现作为功能的最终版本\n\n👍 AB 测试发布的优势：\n\n\n快速实验能力\n\n\n用户体验影响小\n\n\n可以使用生产环境流量做测试\n\n\n可以针对某些特定用户做测试\n😣 AB 测试发布的不足：\n\n\n需要较为复杂的业务流量识别和控制能力\n\n\n需要考虑较为复杂的新旧版本兼容性问题\n\n\n🎶 AB 测试发布适用于做业务探索和创新测试的场景，常常用来对多个方案进行决策\n\n¶流量隔离环境发布\n在上述的发布策略中，发布的单位都是应用，但是一个功能模块往往是由多个应用组合在一起提供的服务，即使当前发布的应用出现了异常，这个异常也未必体现在当前应用中，在复杂的情况下，异常会延迟到它的下游应用才体现出来，如何发现此类问题并且不影响用户体验是非常重要的。此外，我们有时候还希望新版本的代码上线以后，只影响到一小部分用户。而传统的灰度发布，因为无法识别业务流量，所以即使某个应用只有一台机器出现了问题，也可能会影响到所有的用户。\n\n如下图左侧的灰度发布，App1 的所有机器都有一定概率会路由到出现问题的红色 App2 机器上。而右侧的隔离环境发布中，新版本的代码会先发布在全链路隔离环境中，即使发布中出现问题，也只会影响少量用户。\n\n👍 流量隔离环境发布优势:\n\n能够发现一些复杂的, 涉及到多应用的问题\n出现故障时, 只会影响很小一部分用户\n\n😣 流量隔离环境发布的不足:\n\n需要对流量隔离环境进行独立监控\n系统设计复杂, 需要中间件和链路上的所有应用能够识别业务流量\n\n🎶 流量隔离环境发布只适用于较为核心的生产业务场景\n\n¶附录\n阿里巴巴 devops 发布技术策略\n蓝绿部署、红黑部署、AB 测试、灰度发布、金丝雀发布、滚动发布的概念与区别\n","dateCreated":"2022-01-16T11:16:58+00:00","dateModified":"2023-06-07T02:13:34+00:00","datePublished":"2022-01-16T11:16:58+00:00","description":"前几年非常火热的 DevOps 到底是什么？通过本文你将得到答案","headline":"DevOps 概述","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://pineapple-man.github.io/devops-%E6%A6%82%E8%BF%B0/"},"publisher":{"@type":"Organization","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png","logo":{"@type":"ImageObject","url":"logo.png"}},"url":"https://pineapple-man.github.io/devops-%E6%A6%82%E8%BF%B0/","keywords":"DevOps"}</script><meta name="description" content="前几年非常火热的 DevOps 到底是什么？通过本文你将得到答案"><meta property="og:type" content="blog"><meta property="og:title" content="DevOps 概述"><meta property="og:url" content="https://pineapple-man.github.io/devops-%E6%A6%82%E8%BF%B0/"><meta property="og:site_name" content="pineapple-man"><meta property="og:description" content="前几年非常火热的 DevOps 到底是什么？通过本文你将得到答案"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426001926727.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426001133524.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426001322249.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426001325079.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426002705952.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426003003240.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426002737559.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426003408743.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426003509185.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83.webp"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-%E6%BB%9A%E5%8A%A8%E5%8F%91%E5%B8%83.webp"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-%E8%93%9D%E7%BB%BF%E5%8F%91%E5%B8%83.webp"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-ab%E6%B5%8B%E8%AF%95.webp"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-%E6%B5%81%E9%87%8F%E9%9A%94%E7%A6%BB%E7%8E%AF%E5%A2%83%E5%8F%91%E5%B8%83.webp"><meta property="article:published_time" content="2022-01-16T11:16:58.000Z"><meta property="article:modified_time" content="2023-06-07T02:13:34.007Z"><meta property="article:author" content="pineapple-man"><meta property="article:tag" content="DevOps"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426001926727.png"><meta property="og:image" content="https://pineapple-man.github.io/assets/images/logo.png"><link rel="stylesheet" href="/assets/css/style-oth3meuzcjopbgwqbdvoxqknhcm0sy9wkullcc94zhkkop3pmfrpl5t4fzzz.min.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-210516333-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-210516333-1")</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"></head><body><div id="blog"><header id="header" data-behavior="5"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/" aria-label="">pineapple-man</a></div><a class="header-right-picture" href="#about" aria-label="打开链接: /#about"><img class="header-picture" src="/assets/images/logo.png" alt="作者的图片"></a></header><nav id="sidebar" data-behavior="5"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about" aria-label="阅读有关作者的更多信息"><img class="sidebar-profile-picture" src="/assets/images/logo.png" alt="作者的图片"></a><h4 class="sidebar-profile-name">pineapple-man</h4><h5 class="sidebar-profile-bio"><p>做一个菠萝：站得笔直，头戴王冠，内心甜美</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/" rel="noopener" title="首页"><i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories" rel="noopener" title="分类"><i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags" rel="noopener" title="标签"><i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives" rel="noopener" title="归档"><i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about" rel="noopener" title="关于"><i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i> <span class="sidebar-button-desc">关于</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/pineapple-man" target="_blank" rel="noopener" title="GitHub"><i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto://mingchaohu720@gmail.com" target="_blank" rel="noopener" title="邮箱"><i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul></div></nav><div id="main" data-behavior="5" class="hasCoverMetaIn"><article class="post"><div class="post-header main-content-wrap text-center"><h1 class="post-title">DevOps 概述</h1><div class="post-meta"><time datetime="2022-01-16T11:16:58+00:00">1月 16, 2022 </time><span>发布在 </span><a class="category-link" href="/categories/%E9%80%9A%E7%94%A8%E6%8A%80%E8%83%BD/">通用技能</a> <i class="fas fa-book-open"></i> 本文共<span class="post-count"> 3.7k </span>字 <i class="far fa-clock"></i> 阅读预计<span class="post-count"> 33 </span>分钟</div></div><div class="post-content markdown"><div class="main-content-wrap"><h1 id="table-of-contents">目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#DevOps-%E6%A6%82%E8%BF%B0"><span class="toc-text">DevOps 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DevOps-%E7%9A%84%E7%9B%AE%E6%A0%87%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">DevOps 的目标是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%88CI-Continuous-Integration%EF%BC%89"><span class="toc-text">持续集成（CI-Continuous Integration）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2%EF%BC%88CD-Continuous-Deployment%EF%BC%89"><span class="toc-text">持续部署（CD-Continuous Deployment）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E4%BA%A4%E4%BB%98%EF%BC%88CD-Continuous-Delivery%EF%BC%89"><span class="toc-text">持续交付（CD-Continuous Delivery）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CI-CD-%E6%80%BB%E7%BB%93"><span class="toc-text">CI&#x2F;CD 总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F"><span class="toc-text">常见的部署方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E7%AD%96%E7%95%A5"><span class="toc-text">部署策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%9C%E6%9C%BA%E5%8F%91%E5%B8%83"><span class="toc-text">停机发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83"><span class="toc-text">金丝雀发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%81%B0%E5%BA%A6-%E6%BB%9A%E5%8A%A8%E5%8F%91%E5%B8%83"><span class="toc-text">灰度&#x2F;滚动发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%93%9D%E7%BB%BF%E5%8F%91%E5%B8%83"><span class="toc-text">蓝绿发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A-B-%E6%B5%8B%E8%AF%95"><span class="toc-text">A&#x2F;B 测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E9%9A%94%E7%A6%BB%E7%8E%AF%E5%A2%83%E5%8F%91%E5%B8%83"><span class="toc-text">流量隔离环境发布</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-text">附录</span></a></li></ol><h2 id="DevOps-概述"><a class="header-anchor" href="#DevOps-概述">¶</a>DevOps 概述</h2><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426001926727.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426001926727.png" alt=""></a></div><div class="alert success no-icon"><p>DevOps 是 Development 和 Operations 的组合，也就是开发和运维的简写，DevOps 是针对企业中的研发人员、运维人员和测试人员的工作理念，是他们在应用开发、代码部署和质量测试等整条生命周期中协作和沟通的最佳实践，DevOps 强调整个组织的合作以及交付和基础设施变更的自动化、从而实现持续集成、持续部署和持续交付</p></div><p>目前常用的 DevOps 四大平台:代码托管(gitlab/svn)、项目管理(jira)、运维平台(腾讯蓝鲸/开源平台)、持续交付 ( Jenkins/gitlab)</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426001133524.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426001133524.png" alt=""></a></div><div class="alert warning no-icon"><p>为什么需要推广 DevOps ？</p></div><p>DevOps 强调团队协作、相互协作、持续发展，然而传统的模式是开发人员只顾开发程序，运维人员只负责基础环境管理和代码部署以及监控等，其并不是为了一个共同的目标而共同实现最终的目的，而 DevOps 则实现团队作战，即无论是开发、运维还是测试，都是为了最终的代码发布、持续部署和业务稳定而付出各自的努力，从而实现产品设计、开发、测试和部署的良性循环，实现产品的最终持续交付</p><p>✨ DevOps 的优势：</p><div class="alert success no-icon"><ul><li>速度：应用版本快速的迭代更新，以更好地适应不断变换的市场需求</li><li>快速交付：更快的将应用交付至生产环境</li><li>可靠性：保证应用交付的结果是成功的</li><li>规模：可以在大规模环境下且可靠的交付应用</li><li>增强合作：建立适应 DevOps 文化模式的团队，开发人员和运维人员协同工作</li><li>安全性：在快速迭代的同时保证应用的质量</li></ul></div><h3 id="DevOps-的目标是什么？"><a class="header-anchor" href="#DevOps-的目标是什么？">¶</a>DevOps 的目标是什么？</h3><div class="alert success no-icon"><p>DevOps 的目标是建立流水线式的准时制（JIT）的业务流程。DevOps 旨在通过合适的准时制业务流程来最大化业务产出，例如增加销售和利润率、提升业务速度，或尽量降低运营成本。</p></div><p>DevOps 意味着在业务中建立一条 IT 服务供应链，与其它产品的供应链嵌入业务的方式相同。这种从提供软件交付到供给 IT 服务的模式转变是巨大的。</p><p>从架构的角度看，DevOps 需要建立一个自动快速部署系统，有很多方法论和工具可以利用。DevOps 没有统一的实施模板，每个组织都不得不自己考虑并建立 DevOps 流程来提高业务。因此，真正理解 DevOps 的概念，对员工遵循正确的流程有效执行来说是至关重要的。</p><div class="alert warning no-icon"><p>DevOps 技术团队进行软件开发流程</p></div><p><img src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426001322249.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426001325079.png" alt=""></p><h3 id="持续集成（CI-Continuous-Integration）"><a class="header-anchor" href="#持续集成（CI-Continuous-Integration）">¶</a>持续集成（CI-Continuous Integration）</h3><div class="alert success no-icon"><p>CI（Continuous integration），持续集成是指多名开发者在开发不同功能代码的过程中，可以频繁的将代码行合并到一起并相互不影响工作。</p></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426002705952.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426002705952.png" alt=""></a></div><h3 id="持续部署（CD-Continuous-Deployment）"><a class="header-anchor" href="#持续部署（CD-Continuous-Deployment）">¶</a>持续部署（CD-Continuous Deployment）</h3><div class="alert success no-icon"><p>CD（continuous deployment）是基于某种工具或平台实现代码自动化的构建、测试和部署到线上环境以实现交付高质量的产品，持续部署在某种程度上代表了一个开发团队的更新迭代速率</p></div><h3 id="持续交付（CD-Continuous-Delivery）"><a class="header-anchor" href="#持续交付（CD-Continuous-Delivery）">¶</a>持续交付（CD-Continuous Delivery）</h3><p>持续交付是在持续部署的基础之上，将产品交付到线上环境，因此持续交付是产品价值的一种交付，是产品价值的一种盈利的实现</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426003003240.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426003003240.png" alt=""></a></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426002737559.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426002737559.png" alt=""></a></div><h3 id="CI-CD-总结"><a class="header-anchor" href="#CI-CD-总结">¶</a>CI/CD 总结</h3><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426003408743.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426003408743.png" alt=""></a></div><p>使用 Jenkins 进行软件部署的流程如下，分别需要经过测试环境、预发布环境和生产环境。其中，测试环境比较单一，数据量比较简单；预发布环境：正规的代码流程，还有正规的测试人员进行测试，数据和生产环境几乎一致</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426003509185.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20210426003509185.png" alt=""></a></div><h3 id="常见的部署方式"><a class="header-anchor" href="#常见的部署方式">¶</a>常见的部署方式</h3><ul><li>最原始的方案：开发自己上传</li><li>运维自动手动部署：开发给运维，随后运维手动部署</li><li>半自动化：运维使用脚本复制部署</li><li>自动化：结合 Web 界面一键部署</li></ul><p>DevOps 就是希望越来越多的软件产品能够做到自动化的部署，这样可以加速软件迭代，快速完成软件需求</p><h2 id="部署策略"><a class="header-anchor" href="#部署策略">¶</a>部署策略</h2><p>软件最终都是要进行发布，随后部署在某台服务器上，但是不同的部署策略将严重影响到软件开发周期等因素，所以追求更短的迭代周期、更高频的发布，就需要发展出适应的 DevOps 要求的发布策略</p><h3 id="停机发布"><a class="header-anchor" href="#停机发布">¶</a>停机发布</h3><div class="alert success no-icon"><p>停机发布会在发布以前关闭服务，停止用户访问，然后一次性的升级所有服务。这种发布策略的发布频率往往比较低，且需要在发布之前做好充足的测试</p></div><p>✨ 停机发布的特点：</p><div class="alert success no-icon"><ul><li>所有需要升级的组件被整合到一次发布中</li><li>一个项目中的大部分应用都会被更新</li><li>发布之前的研发流程和测试流程往往需要花很长的时间</li><li>发布时如果出现问题, 修复和回滚的成本很高</li><li>完成一次停机发布, 需要花费很久的时间, 且需要很多团队在一起才能完成</li><li>往往需要客户端和服务器端同步升级</li></ul></div><p>停机发布并不适合互联网公司，因为两次发布的间隔很久，从功能特性提出到进入市场的时间太长，对市场反应不敏感，会在充分竞争的市场里处于下风。每次发布因为要停机，也会带来经济损失</p><p>停机发布的最大优势就是部署简单，不需要考虑新旧版本共存时的兼容性问题；但是仍然存在许多劣势：发布过程中。服务不可用；只能在业务低峰期（往往是夜间）发布，并且需要很多团队在一起工作；这种发布出现错误之后很难进行回滚</p><div class="alert warning no-icon"><p>🎶 这种发布方式适用于开发测试环境；非关键应用，用户影响面小；兼容性比较难管控的场景</p></div><h3 id="金丝雀发布"><a class="header-anchor" href="#金丝雀发布">¶</a>金丝雀发布</h3><div class="alert success no-icon"><p>金丝雀发布这个术语源自 20 世纪初期，当时英国的煤矿工人在下井采矿之前，会把笼养的金丝雀携带到矿井中，如果矿井中一氧化碳等有毒气体的浓度过高，在影响矿工之前，金丝雀相比人类表现的更加敏感快速，金丝雀中毒之后，煤矿工人就知道该立刻撤离。金丝雀发布是在将整个软件的新版本发布给所有用户之前，先发布给部分用户，用真实的客户流量来测试，以保证软件不会出现严重问题，降低发布风险</p></div><div class="alert info no-icon"><p>在实践中，金丝雀发布一般会先发布到一个小比例的机器，比如 2% 的服务器做流量验证，然后从中快速获得反馈，根据反馈决定是扩大发布还是回滚。金丝雀发布通常会结合监控系统，通过监控指标，观察金丝雀机器的健康状况。如果金丝雀测试通过，则把剩余的机器全部升级成新版本，否则回滚代码</p></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-金丝雀发布.webp" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-金丝雀发布.webp" alt=""></a></div><p>金丝雀发布对用户体验影响较小，再金丝雀发布过程中，只有少量用户会受到影响，发布安全能够得到保障；但是由于金丝雀的机器数量比较少，有一些问题并不能有效的暴露出来</p><div class="alert warning no-icon"><p>🎶 金丝雀发布适用于监控比较完备且于发布系统集成的环境</p></div><h3 id="灰度-滚动发布"><a class="header-anchor" href="#灰度-滚动发布">¶</a>灰度/滚动发布</h3><div class="alert success no-icon"><p>灰度发布是金丝雀发布的延伸，是将发布分成不同的阶段/批次，每个阶段/批次的用户数量逐级增加。如果新版本在当前阶段没有发现问题，就再增加用户数量进入下一个阶段，直至扩展到全部用户</p></div><p>灰度发布可以减小发布风险，是一种零宕机时间的发布策略。它通过切换线上并存版本之间的路由权重，逐步从一个版本切换为另一个版本。整个发布过程会持续比较长的时间, 在这段时间内，新旧代码共存，所以在开发过程中，需要考虑版本之间的兼容性，新旧代码共存不能影响功能可用性和用户体验。当新版本代码出现问题时，灰度发布能够比较快的回滚到老版本的代码上</p><p>结合特性开关等技术，灰度发布可以实现更复杂灵活的发布策略</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-滚动发布.webp" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-滚动发布.webp" alt=""></a></div><div class="alert warning no-icon"><p>金丝雀发布、灰度发布步骤组成：</p></div><ol><li>准备好部署各个阶段的工件，包括:构建工件，测试脚本，配置文件和部署清单文件</li><li>从负载均衡列表中移除掉「 金丝雀 」服务器</li><li>升级「 金丝雀 」应用(排掉原有流量并进行部署)</li><li>对应用进行自动化测试</li><li>将 「 金丝雀 」服务器重新添加到负载均衡列表中(连通性和健康检查)</li><li>如果 「 金丝雀 」在线使用测试成功，升级剩余的其他服务器。(否则就回滚) 灰度发布可以保证整体系统的稳定，在初始灰度的时候就可以发现、调整问题，以保证其影响度。</li></ol><p>灰度发布对用户体验影响比较小, 不需要停机发布、并且能够控制发布风险。但是发布时间会比较长，需要复杂的发布系统和负载均衡器。在发布完成之后还需要考虑新旧版本共存时的兼容性</p><div class="alert warning no-icon"><p>🎶 灰度发布适用于可用性较高的生产环境发布</p></div><h3 id="蓝绿发布"><a class="header-anchor" href="#蓝绿发布">¶</a>蓝绿发布</h3><div class="alert success no-icon"><p>蓝绿部署是指有两个完全相同的、互相独立的生产环境，一个叫做“蓝环境”，一个叫做“绿环境”。其中，绿环境是用户正在使用的生产环境。当要部署一个新版本的时候，先把这个新版本部署到蓝环境中，然后在蓝环境中运行冒烟测试，以检查新版本是否正常工作。如果测试通过，发布系统更新路由配置，将用户流量从绿环境导向蓝环境，蓝环境就变成了生产环境。这种切换通常在一秒钟之内就能搞定。如果出了问题，把路由切回到绿环境上，再在蓝环境中调试，找到问题的原因。因此，蓝绿部署可以做到仅仅一次切换，立刻就向所有用户推出新版本，新功能对所有用户立刻生效可见</p></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-蓝绿发布.webp" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-蓝绿发布.webp" alt=""></a></div><p>👍 蓝绿发布优势：</p><ul><li>升级切换和回退速度非常快</li><li>零停机时间</li></ul><p>😣 蓝绿发布的不足</p><ul><li>一次性的全量切换，如果发布出现问题, 会对用户产生比较大的影响</li><li>需要两倍的机器资源</li><li>需要中间件和应用自身支持热备集群的流量切换<div class="alert warning no-icon"><p>🎶 蓝绿发布适用于机器资源比较富余或者按需分配 (背靠云厂商)</p></div></li></ul><h3 id="A-B-测试"><a class="header-anchor" href="#A-B-测试">¶</a>A/B 测试</h3><div class="alert success no-icon"><p>A/B 测试和灰度发布非常像，可以从发布的目的上进行区分。AB 测试侧重的是根据 A 版本和 B 版本的差异进行决策，最终选择一个版本进行部署。和灰度发布相比，AB 测试更倾向于去决策，和金丝雀发布相比，AB 测试在权重和流量的切换上更灵活</p></div><p>举个例子，某功能有两个实现版本 A 和 B，通过细粒度的流量控制，把 50% 的用户总是引导到 A 实现上，把剩下的 50% 用户总是引导到 B 实现上，通过比较 A 实现和 B 实现的转化率，最终选择转化率较高的 A 实现作为功能的最终版本</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-ab测试.webp" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-ab测试.webp" alt=""></a></div><p>👍 AB 测试发布的优势：</p><ul><li><p>快速实验能力</p></li><li><p>用户体验影响小</p></li><li><p>可以使用生产环境流量做测试</p></li><li><p>可以针对某些特定用户做测试<br>😣 AB 测试发布的不足：</p></li><li><p>需要较为复杂的业务流量识别和控制能力</p></li><li><p>需要考虑较为复杂的新旧版本兼容性问题</p></li></ul><div class="alert warning no-icon"><p>🎶 AB 测试发布适用于做业务探索和创新测试的场景，常常用来对多个方案进行决策</p></div><h3 id="流量隔离环境发布"><a class="header-anchor" href="#流量隔离环境发布">¶</a>流量隔离环境发布</h3><div class="alert success no-icon"><p>在上述的发布策略中，发布的单位都是应用，但是一个功能模块往往是由多个应用组合在一起提供的服务，即使当前发布的应用出现了异常，这个异常也未必体现在当前应用中，在复杂的情况下，异常会延迟到它的下游应用才体现出来，如何发现此类问题并且不影响用户体验是非常重要的。此外，我们有时候还希望新版本的代码上线以后，只影响到一小部分用户。而传统的灰度发布，因为无法识别业务流量，所以即使某个应用只有一台机器出现了问题，也可能会影响到所有的用户。</p></div><p>如下图左侧的灰度发布，App1 的所有机器都有一定概率会路由到出现问题的红色 App2 机器上。而右侧的隔离环境发布中，新版本的代码会先发布在全链路隔离环境中，即使发布中出现问题，也只会影响少量用户。</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-流量隔离环境发布.webp" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/devops/devops-流量隔离环境发布.webp" alt=""></a></div><p>👍 流量隔离环境发布优势:</p><ul><li>能够发现一些复杂的, 涉及到多应用的问题</li><li>出现故障时, 只会影响很小一部分用户</li></ul><p>😣 流量隔离环境发布的不足:</p><ul><li>需要对流量隔离环境进行独立监控</li><li>系统设计复杂, 需要中间件和链路上的所有应用能够识别业务流量</li></ul><div class="alert warning no-icon"><p>🎶 流量隔离环境发布只适用于较为核心的生产业务场景</p></div><h2 id="附录"><a class="header-anchor" href="#附录">¶</a>附录</h2><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/FgQgg9wANAvzNyJ4VmFmTQ">阿里巴巴 devops 发布技术策略</a><br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1529300">蓝绿部署、红黑部署、AB 测试、灰度发布、金丝雀发布、滚动发布的概念与区别</a></p></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">标签</span><br><a class="tag tag--primary tag--small t-none-link" href="/tags/DevOps/" rel="tag">DevOps</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/springmvc-%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3%E6%80%BB%E7%BB%93/" data-tooltip="SpringMVC 核心注解总结" aria-label="上一篇: SpringMVC 核心注解总结"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E6%95%B0%E5%AD%97%E5%8A%A0%E5%AF%86/" data-tooltip="数字加密" aria-label="下一篇: 数字加密"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></article><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2023 pineapple-man. All Rights Reserved.</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><br>Total <span id="busuanzi_value_site_pv"></span> views. 您是pineapple-man的第<span id="busuanzi_value_site_uv"></span>个小伙伴<br><i class="fas fa-book-open"></i> <span class="post-count">博客字数统计：370.7k</span><script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="5"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/springmvc-%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3%E6%80%BB%E7%BB%93/" data-tooltip="SpringMVC 核心注解总结" aria-label="上一篇: SpringMVC 核心注解总结"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E6%95%B0%E5%AD%97%E5%8A%A0%E5%AF%86/" data-tooltip="数字加密" aria-label="下一篇: 数字加密"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-times"></i></div><img id="about-card-picture" src="/assets/images/logo.png" alt="作者的图片"><h4 id="about-card-name">pineapple-man</h4><div id="about-card-bio"><p>做一个菠萝：站得笔直，头戴王冠，内心甜美</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>刚毕业就失业</p></div><div id="about-card-location"><i class="fa fa-map-marker-alt"></i><br>西安</div></div></div><div id="cover" style="background-image:url(/assets/images/cover-v1.2.0.jpg)"></div><script src="/assets/js/script-kcoiyt1nxfue7qgcpkrcixymglcc3cuxeg98fy01hqww4nblnhd2ees6j6yc.min.js"></script></body></html>