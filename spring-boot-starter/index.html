<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="pineapple-man"><title>spring boot Starter - pineapple-man</title><meta name="author" content="pineapple-man"><meta name="keywords" content="spring boot starter"><link rel="icon" href="https://pineapple-man.github.io/assets/images/logo.svg"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png"},"articleBody":"\nSpring Boot 大大简化了项目初始搭建以及开发过程，而这些都是通过 Spring Boot 提供的 starter 来完成的，一个项目中的基础模块本质就是一个 Starter，本文主要对 Spring boot 的 starter 进行比较全面深入的记录。\n¶概述\nspring boot 在配置上相比 spring 要简单许多, 其核心在于 spring-boot-starter, 在使用 spring boot 来搭建一个项目时, 只需要引入官方提供的 starter, 就可以直接使用, 免去了各种配置。starter 简单来讲就是引入了一些相关依赖和一些初始化的配置。\nSpring 官方提供了很多 starter，第三方也可以定义 starter。为了加以区分，starter 从名称上进行了如下规范：\n\nSpring 官方提供的 starter 名称为：spring-boot-starter-xxx，例如 Spring 官方提供的 spring-boot-starter-web\n第三方提供的 starter 名称为：xxx-spring-boot-starter，例如由 mybatis 提供的 mybatis-spring-boot-starter\n\n\nSpring Boot 之所以能够帮我们简化项目的搭建和开发过程，主要是基于它提供的起步依赖和自动配置\n¶起步依赖\n起步依赖其实就是将具备某种功能的坐标打包到一起，可以简化依赖导入的过程。例如，我们导入 spring-boot-starter-web 这个 starter，则和 web 开发相关的 jar 包都一起导入到项目中了。如下图所示：\n\n¶自动配置\n自动配置，就是无须手动配置 xml，自动配置并管理 bean，那么 Spring Boot 是如何完成自动配置的尼？\n⛵ 自动配置涉及到如下几个关键步骤：\n\n基于 Java 代码的 bean 配置\n激动配置条件依赖\nBean 参数获取\nBean 的发现\nBean 的加载\n\n\n接下来以Mybatis-spring-boot-starter来说明自动配置的实现过程\n¶基于 Java 代码的 Bean 配置\n当我们在项目中导入了mybatis-spring-boot-starter这个 jar 后，可以看到它包括了很多相关的 jar 包\n12345&lt;dependency&gt;  &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;  &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;  &lt;version&gt;1.3.2&lt;/version&gt;&lt;/dependency&gt;\n\n其中在 mybatis-spring-boot-autoconfigure 这个 jar 包中有如下一个MybatisAutoConfiguration自动配置类\n\n打开这个类，关键代码如下：\n12345678910111213@Configuration@ConditionalOnClass(&#123;SqlSessionFactory.class, SqlSessionFactoryBean.class&#125;)@ConditionalOnBean(&#123;DataSource.class&#125;)@EnableConfigurationProperties(&#123;MybatisProperties.class&#125;)@AutoConfigureAfter(&#123;DataSourceAutoConfiguration.class&#125;)public class MybatisAutoConfiguration &#123;  @Bean  @ConditionalOnMissingBean  public SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception&#123;...&#125;  @Bean  @ConditionalOnMissingBean  public SqlSessionTemplate sqlSessionTemplate(SqlSessionFactory sqlSessionFactory)&#123;...&#125;&#125;\n@Configuration和 @Bean 这两个注解一起使用就可以创建一个基于 java 代码的配置类，可以用来替代传统的 xml 配置文件，两个注解具体的含义如下：\n\n\n\n注解\n含义\n\n\n\n\n@Configuration\n在类上标注，表明当前类是一个配置类\n\n\n@Bean\n表明需要向 Spring IoC 容器中注入的 Bean\n\n\n\n所以上面的MybatisAutoConfiguration这个类，自动帮我们生成了 SqlSessionFactory 和 SqlSessionTemplate 这些 Mybatis 的重要实例并交给 spring 容器管理，从而完成 bean 的自动注册\n¶自动配置条件依赖\n从MybatisAutoConfiguration这个类中使用的注解可以看出，要完成自动配置是有依赖条件的\n12@ConditionalOnClass(&#123;SqlSessionFactory.class, SqlSessionFactoryBean.class&#125;)@ConditionalOnBean(&#123;DataSource.class&#125;)\n所以要完成 Mybatis 的自动配置，需要在类路径中存在SqlSessionFactory、SqlSessionFactoryBean这两个类，同时需要存在 DataSource 这个 bean 且这个 bean 完成自动注册\nSpring boot 中常见的条件依赖注解有：\n\n\n\n注解\n功能说明\n\n\n\n\n@ConditionalOnBean\n仅在当前上下文中存在某个 bean 时，才会实例化这个 Bean\n\n\n@ConditionalOnClass\n某个 class 位于类路径上，才会实例化这个 Bean\n\n\n@ConditionalOnExpression\n当表达式为 true 的时候，才会实例化这个 Bean\n\n\n@ConditionalOnMissingBean\n仅在当前上下文中不存在某个 bean 时，才会实例化这个 Bean，防止重复创建\n\n\n@ConditionalOnMissingClass\n某个 class 在类路径上不存在的时候，才会实例化这个 Bean\n\n\n@ConditionalOnNotWebApplication\n不是 web 应用时才会实例化这个 Bean\n\n\n@AutoConfigureAfter\n在某个 bean 完成自动配置后实例化这个 bean\n\n\n@AutoConfigureBefore\n在某个 bean 完成自动配置前实例化这个 bean\n\n\n\n¶Bean 参数获取\n要完成 mybatis 的自动配置，需要我们在配置文件中提供数据源相关的配置参数，例如数据库驱动、连接 url、数据库用户名、密码等。那么 spring boot 是如何读取 yml 或者 properites 配置文件的的属性来创建数据源对象的？\n\n在我们导入 mybatis-spring-boot-starter 这个 jar 包后会传递过来一个 spring-boot-autoconfigure 包，在这个包中有一个自动配置类DataSourceAutoConfiguration，如下所示：\n12345@Configuration@ConditionalOnClass(&#123;DataSource.class, EmbeddedDatabaseType.class&#125;)@EnableConfigurationProperties(&#123;DataSourceProperties.class&#125;)@Import(&#123;Registrar.class, DataSourcePoolMetadataProvidersConfiguration.class&#125;)public class DataSourceAutoConfiguration &#123;&#125;\n上面这个类加入了EnableConfigurationProperties注解，DataSourceProperties 这个类如下：\n1234@ConfigurationProperties(    prefix = &quot;spring.datasource&quot;)public class DataSourceProperties implements BeanClassLoaderAware, EnvironmentAware, InitializingBean &#123;&#125;\n上面这个类上加入了ConfigurationProperties注解，这个注解的作用就是把 yml 或者 properties 配置文件中的配置参数信息封装到ConfigurationProperties注解标注的 bean(即DataSourceProperties)的相应属性上。\n@EnableConfigurationProperties注解的作用是使@ConfigurationProperties注解生效，并且将@ConfigurationProperties标注的 Bean 注入到 @EnablelConfigurationProperties类中。\n\n如下例所示，最终 DataSourceProperties 类将注入到 DataSourceAutoConfiguration中使用，随后 Spring 将根据DataSourceAutoConfiguration类中的配置，自动注入新的 Bean\n12345@Bean@ConditionalOnMissingBeanpublic DataSourceInitializer dataSourceInitializer(DataSourceProperties properties, ApplicationContext applicationContext) &#123;    return new DataSourceInitializer(properties, applicationContext);&#125;\n¶Bean 的发现\nspring boot 默认扫描启动类所在的包下的主类与子类的所有组件，但并没有包括依赖包中的类，那么依赖包中的 bean 是如何被发现和加载的？\n\n一般 Spring boot 应用程序的启动类都有 @SpringBootApplication 注解，这个注解的源码如下：\n12345678910111213141516@Target(&#123;ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@SpringBootConfiguration@EnableAutoConfiguration@ComponentScan(    excludeFilters = &#123;@Filter(    type = FilterType.CUSTOM,    classes = &#123;TypeExcludeFilter.class&#125;), @Filter(    type = FilterType.CUSTOM,    classes = &#123;AutoConfigurationExcludeFilter.class&#125;)&#125;)public @interface SpringBootApplication &#123;...&#125;\n其中比较重要是下面这三个注解：\n\n@SpringBootConfiguration：作用就相当@Configuration注解，被注解的类将成为一个 bean 配置类\n@ComponentScan：作用就是自动扫描并加载符合条件的组件，最终将这些 bean 加载到 spring 容器中\n@EnableAutoConfiguration：这个注解很重要，借助@Import的支持，收集和注册依赖包中相关的 Bean 定义\n\n\n继续追踪@EnableAutoConfiguration注解源码，这个注解引用了@Import注解，@Import注解能够导入需要自动配置的组件，此处就自动导入类EnableAutoConfigurationImportSelector\n12345678910111213@Target(&#123;ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@AutoConfigurationPackage@Import(&#123;EnableAutoConfigurationImportSelector.class&#125;)public @interface EnableAutoConfiguration &#123;    String ENABLED_OVERRIDE_PROPERTY = &quot;spring.boot.enableautoconfiguration&quot;;    Class&lt;?&gt;[] exclude() default &#123;&#125;;    String[] excludeName() default &#123;&#125;;&#125;\nEnableAutoConfigurationImportSelector类的源码如下，由于如今这个类已经被弃用，所哟详细的细节查看父类AutoConfigurationImportSelector\n12345678public class EnableAutoConfigurationImportSelector extends AutoConfigurationImportSelector &#123;    public EnableAutoConfigurationImportSelector() &#123;    &#125;    protected boolean isEnabled(AnnotationMetadata metadata) &#123;        return this.getClass().equals(EnableAutoConfigurationImportSelector.class) ? (Boolean)this.getEnvironment().getProperty(&quot;spring.boot.enableautoconfiguration&quot;, Boolean.class, true) : true;    &#125;&#125;\nAutoConfigurationImportSelector类中比较重要的是getCandidateConfigurations方法\n123456789public class AutoConfigurationImportSelector implements DeferredImportSelector, BeanClassLoaderAware, ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered &#123;  //...      protected List&lt;String&gt; getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) &#123;        List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(this.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader());        Assert.notEmpty(configurations, &quot;No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.&quot;);        return configurations;    &#125;  //...&#125;\ngetCandidateConfigurations() 方法中调用了 SpringFactoriesLoader 类的 loadFactoryNames 方法，继续跟踪源码：\n12345678910111213141516171819public static List&lt;String&gt; loadFactoryNames(Class&lt;?&gt; factoryClass, ClassLoader classLoader) &#123;    String factoryClassName = factoryClass.getName();    try &#123;        Enumeration&lt;URL&gt; urls = classLoader != null ? classLoader.getResources(&quot;META-INF/spring.factories&quot;) : ClassLoader.getSystemResources(&quot;META-INF/spring.factories&quot;);        ArrayList result = new ArrayList();        while(urls.hasMoreElements()) &#123;            URL url = (URL)urls.nextElement();            Properties properties = PropertiesLoaderUtils.loadProperties(new UrlResource(url));            String factoryClassNames = properties.getProperty(factoryClassName);            result.addAll(Arrays.asList(StringUtils.commaDelimitedListToStringArray(factoryClassNames)));        &#125;        return result;    &#125; catch (IOException var8) &#123;        throw new IllegalArgumentException(&quot;Unable to load [&quot; + factoryClass.getName() + &quot;] factories from location [&quot; + &quot;META-INF/spring.factories&quot; + &quot;]&quot;, var8);    &#125;&#125;\n以上 SpringFactoriesLoader的loadeFactoryNames静态方法可以从所有的 jar 中读取 META_INF/spring.factories文件，而自动装配的类就在这个文件汇总进行配置\n例如，Mybatis-spring-boot-starter中就有此文件，如下图：\n\n其中的内容如下：\n123# Auto Configureorg.springframework.boot.autoconfigure.EnableAutoConfiguration=\\org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration\n\n这样 Spring Boot 就可以加载到 MybatisAutoConfiguration 这个配置类了\n¶Bean 到加载\n在 Spring Boot 应用中要让一个普通类交给 Spring 容器管理，通常有以下方法：\n\n使用 @Configuration与@Bean 注解\n使用@Controller、@Service、 @Repository、 @Component 注解标注该类并且启用@ComponentScan自动扫描\n使用@Import注解以及对应的方法\n\n\n其中 Spring Boot 实现自动配置使用的是@Import注解这种方式，AutoConfigurationImportSelector类的selectImports方法返回一组从META-INF/spring.factories文件中读取的bean的全类名，这样 Spring Boot 就可以加载到这些 Bean 并完成实例的创建工作\n¶自动配置总结\n📓 自动配置的关键几步以及相应的注解总结如下：\n\n@Configuration 与@Bean：基于 Java 代码的 bean 配置\n@Conditional：设置自动配置条件依赖\n@EnableConfigurationProperties 与@ConfigurationProperties：读取配置文件转换为 bean\n@EnableAutoConfiguration 与@Import：实现 bean 发现与加载\n\n\n¶自定义 starter\n本小节通过自定义 starter 来加强之前的知识\n\n创建 starter 工程 hello-spring-boot-starter 并配置 pom.xml 文件\n\n\n123456789101112131415161718192021222324252627282930&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;    &lt;groupId&gt;com.pineappleman&lt;/groupId&gt;    &lt;artifactId&gt;hello-spring-boot-starter&lt;/artifactId&gt;    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;    &lt;parent&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;        &lt;version&gt;2.2.2.RELEASE&lt;/version&gt;        &lt;relativePath/&gt;    &lt;/parent&gt;    &lt;properties&gt;        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;    &lt;/properties&gt;    &lt;dependencies&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;&lt;/project&gt;\n\n创建配置属性类 HelloProperties\n\n\n1234567891011121314151617181920212223242526272829303132/* *读取配置文件转换为bean * */@ConfigurationProperties(prefix = &quot;hello&quot;)public class HelloProperties &#123;    private String name;    private String address;    public String getName() &#123;        return name;    &#125;    public void setName(String name) &#123;        this.name = name;    &#125;    public String getAddress() &#123;        return address;    &#125;    public void setAddress(String address) &#123;        this.address = address;    &#125;    @Override    public String toString() &#123;        return &quot;HelloProperties&#123;&quot; +                &quot;name=&#x27;&quot; + name + &#x27;\\&#x27;&#x27; +                &quot;, address=&#x27;&quot; + address + &#x27;\\&#x27;&#x27; +                &#x27;&#125;&#x27;;    &#125;&#125;\n\n创建服务类 HelloService\n\n\n12345678910111213public class HelloService &#123;    private String name;    private String address;    public HelloService(String name, String address) &#123;        this.name = name;        this.address = address;    &#125;    public String sayHello()&#123;        return &quot;你好！我的名字叫 &quot; + name + &quot;，我来自 &quot; + address;    &#125;&#125;\n\n创建自动配置类 HelloServiceAutoConfiguration\n\n\n123456789101112131415161718192021/** 配置类，基于Java代码的bean配置* */@Configuration@EnableConfigurationProperties(HelloProperties.class)public class HelloServiceAutoConfiguration &#123;    private HelloProperties helloProperties;    //通过构造方法注入配置属性对象HelloProperties    public HelloServiceAutoConfiguration(HelloProperties helloProperties) &#123;        this.helloProperties = helloProperties;    &#125;    //实例化HelloService并载入Spring IoC容器    @Bean    @ConditionalOnMissingBean    public HelloService helloService()&#123;        return new HelloService(helloProperties.getName(),helloProperties.getAddress());    &#125;&#125;\n\n在 resources 目录下创建 META-INF/spring.factories\n\n\n12org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\cn.itcast.config.HelloServiceAutoConfiguration\n通过以上步骤之后，可以通过 mvn install 将自定义的 starter 安装到本地 maven 仓库\n¶使用 starter\n\n创建 maven 工程 myapp 并配置 pom.xml 文件\n\n\n12345678910111213141516171819202122232425262728293031323334353637&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;         xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;    &lt;groupId&gt;org.example&lt;/groupId&gt;    &lt;artifactId&gt;myapp&lt;/artifactId&gt;    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;    &lt;parent&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;        &lt;version&gt;2.2.2.RELEASE&lt;/version&gt;        &lt;relativePath/&gt;    &lt;/parent&gt;    &lt;properties&gt;        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;    &lt;/properties&gt;    &lt;dependencies&gt;        &lt;!--导入自定义的 starter --&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.pineappleman&lt;/groupId&gt;            &lt;artifactId&gt;hello-spring-boot-starter&lt;/artifactId&gt;            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;            &lt;optional&gt;true&lt;/optional&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;&lt;/project&gt;\n\n创建 application.yml 文件\n\n\n12345server:  port: 8080hello:  name: xiaoming  address: beijing\n\n创建 HelloController\n\n\n12345678910111213@RestController@RequestMapping(value = &quot;/hello&quot;)public class HelloController &#123;\t/** 当前实例已经由自定义的 starter 完成了创建 */\t@Autowired\tprivate HelloService helloService;\t@GetMapping(value =&quot;/say&quot;)\tpublic String sayHello()&#123;\t\treturn helloService.sayHello();\t&#125;&#125;\n\n创建启动类 HelloApplication\n\n\n123456@SpringBootApplicationpublic class HelloApplication &#123;\tpublic static void main(String[] args) &#123;\t\tSpringApplication.run(HelloApplication.class, args);\t&#125;&#125;\n至此，就完成了 Spring Boot 的 Starter 的创建以及使用\n","dateCreated":"2022-01-30T12:47:40+00:00","dateModified":"2023-06-07T02:13:34+00:00","datePublished":"2022-01-30T12:47:40+00:00","description":"使用某个组件时，常看到 xxx.starter，那么究竟什么是 starter","headline":"spring boot Starter","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://pineapple-man.github.io/spring-boot-starter/"},"publisher":{"@type":"Organization","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png","logo":{"@type":"ImageObject","url":"logo.png"}},"url":"https://pineapple-man.github.io/spring-boot-starter/","keywords":"SpringBoot"}</script><meta name="description" content="使用某个组件时，常看到 xxx.starter，那么究竟什么是 starter"><meta property="og:type" content="blog"><meta property="og:title" content="spring boot Starter"><meta property="og:url" content="https://pineapple-man.github.io/spring-boot-starter/"><meta property="og:site_name" content="pineapple-man"><meta property="og:description" content="使用某个组件时，常看到 xxx.starter，那么究竟什么是 starter"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/springboot/springboot-starter%E8%B5%B7%E6%AD%A5%E4%BE%9D%E8%B5%96.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/springboot/springboot-mybatisStarter.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/springboot/springboot-mybaits-autoconfiguration.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/springboot/springboot-mybatisstarter-spring-factories.png"><meta property="article:published_time" content="2022-01-30T12:47:40.000Z"><meta property="article:modified_time" content="2023-06-07T02:13:34.011Z"><meta property="article:author" content="pineapple-man"><meta property="article:tag" content="SpringBoot"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/springboot/springboot-starter%E8%B5%B7%E6%AD%A5%E4%BE%9D%E8%B5%96.png"><meta property="og:image" content="https://pineapple-man.github.io/assets/images/logo.png"><link rel="stylesheet" href="/assets/css/style-oth3meuzcjopbgwqbdvoxqknhcm0sy9wkullcc94zhkkop3pmfrpl5t4fzzz.min.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-210516333-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-210516333-1")</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"></head><body><div id="blog"><header id="header" data-behavior="5"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/" aria-label="">pineapple-man</a></div><a class="header-right-picture" href="#about" aria-label="打开链接: /#about"><img class="header-picture" src="/assets/images/logo.png" alt="作者的图片"></a></header><nav id="sidebar" data-behavior="5"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about" aria-label="阅读有关作者的更多信息"><img class="sidebar-profile-picture" src="/assets/images/logo.png" alt="作者的图片"></a><h4 class="sidebar-profile-name">pineapple-man</h4><h5 class="sidebar-profile-bio"><p>做一个菠萝：站得笔直，头戴王冠，内心甜美</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/" rel="noopener" title="首页"><i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories" rel="noopener" title="分类"><i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags" rel="noopener" title="标签"><i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives" rel="noopener" title="归档"><i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about" rel="noopener" title="关于"><i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i> <span class="sidebar-button-desc">关于</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/pineapple-man" target="_blank" rel="noopener" title="GitHub"><i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto://mingchaohu720@gmail.com" target="_blank" rel="noopener" title="邮箱"><i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul></div></nav><div id="main" data-behavior="5" class="hasCoverMetaIn"><article class="post"><div class="post-header main-content-wrap text-center"><h1 class="post-title">spring boot Starter</h1><div class="post-meta"><time datetime="2022-01-30T12:47:40+00:00">1月 30, 2022 </time><span>发布在 </span><a class="category-link" href="/categories/Java/">Java</a> <i class="fas fa-book-open"></i> 本文共<span class="post-count"> 3.2k </span>字 <i class="far fa-clock"></i> 阅读预计<span class="post-count"> 36 </span>分钟</div></div><div class="post-content markdown"><div class="main-content-wrap"><h1 id="table-of-contents">目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%B7%E6%AD%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">起步依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">自动配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-Java-%E4%BB%A3%E7%A0%81%E7%9A%84-Bean-%E9%85%8D%E7%BD%AE"><span class="toc-text">基于 Java 代码的 Bean 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E4%BE%9D%E8%B5%96"><span class="toc-text">自动配置条件依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean-%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96"><span class="toc-text">Bean 参数获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean-%E7%9A%84%E5%8F%91%E7%8E%B0"><span class="toc-text">Bean 的发现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean-%E5%88%B0%E5%8A%A0%E8%BD%BD"><span class="toc-text">Bean 到加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%80%BB%E7%BB%93"><span class="toc-text">自动配置总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-starter"><span class="toc-text">自定义 starter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-starter"><span class="toc-text">使用 starter</span></a></li></ol><p>Spring Boot 大大简化了项目初始搭建以及开发过程，而这些都是通过 Spring Boot 提供的 starter 来完成的，一个项目中的基础模块本质就是一个 Starter，本文主要对 Spring boot 的 starter 进行比较全面深入的记录。</p><h2 id="概述"><a class="header-anchor" href="#概述">¶</a>概述</h2><p>spring boot 在配置上相比 spring 要简单许多, 其核心在于 spring-boot-starter, 在使用 spring boot 来搭建一个项目时, 只需要引入官方提供的 starter, 就可以直接使用, 免去了各种配置。starter 简单来讲就是引入了一些相关依赖和一些初始化的配置。</p><p>Spring 官方提供了很多 starter，第三方也可以定义 starter。为了加以区分，starter 从名称上进行了如下规范：</p><div class="alert success no-icon"><ol><li>Spring 官方提供的 starter 名称为：<code>spring-boot-starter-xxx</code>，例如 Spring 官方提供的 <code>spring-boot-starter-web</code></li><li>第三方提供的 starter 名称为：<code>xxx-spring-boot-starter</code>，例如由 mybatis 提供的 <code>mybatis-spring-boot-starter</code></li></ol></div><p>Spring Boot 之所以能够帮我们简化项目的搭建和开发过程，主要是基于它提供的起步依赖和自动配置</p><h2 id="起步依赖"><a class="header-anchor" href="#起步依赖">¶</a>起步依赖</h2><p>起步依赖<strong>其实就是将具备某种功能的坐标打包到一起</strong>，可以简化依赖导入的过程。例如，我们导入 spring-boot-starter-web 这个 starter，则和 web 开发相关的 jar 包都一起导入到项目中了。如下图所示：</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/springboot/springboot-starter起步依赖.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/springboot/springboot-starter起步依赖.png" alt=""></a></div><h2 id="自动配置"><a class="header-anchor" href="#自动配置">¶</a>自动配置</h2><p>自动配置，就是无须手动配置 xml，自动配置并管理 bean，那么 Spring Boot 是如何完成自动配置的尼？<br>⛵ 自动配置涉及到如下几个关键步骤：</p><div class="alert success no-icon"><ol><li>基于 Java 代码的 bean 配置</li><li>激动配置条件依赖</li><li>Bean 参数获取</li><li>Bean 的发现</li><li>Bean 的加载</li></ol></div><p>接下来以<code>Mybatis-spring-boot-starter</code>来说明自动配置的实现过程</p><h3 id="基于-Java-代码的-Bean-配置"><a class="header-anchor" href="#基于-Java-代码的-Bean-配置">¶</a>基于 Java 代码的 Bean 配置</h3><p>当我们在项目中导入了<code>mybatis-spring-boot-starter</code>这个 jar 后，可以看到它包括了很多相关的 jar 包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/springboot/springboot-mybatisStarter.png" alt=""></p><p>其中在 mybatis-spring-boot-autoconfigure 这个 jar 包中有如下一个<strong>MybatisAutoConfiguration</strong>自动配置类</p><p><img src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/springboot/springboot-mybaits-autoconfiguration.png" alt=""></p><p>打开这个类，关键代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;SqlSessionFactory.class, SqlSessionFactoryBean.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(&#123;DataSource.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;MybatisProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123;DataSourceAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisAutoConfiguration</span> &#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">  <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception&#123;...&#125;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">  <span class="keyword">public</span> SqlSessionTemplate <span class="title function_">sqlSessionTemplate</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>@Configuration</strong>和 <strong>@Bean</strong> 这两个注解一起使用就可以创建一个基于 java 代码的配置类，可以用来替代传统的 xml 配置文件，两个注解具体的含义如下：</p><table><thead><tr><th style="text-align:center">注解</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>@Configuration</code></td><td style="text-align:center">在类上标注，表明当前类是一个配置类</td></tr><tr><td style="text-align:center"><code>@Bean</code></td><td style="text-align:center">表明需要向 Spring IoC 容器中注入的 Bean</td></tr></tbody></table><p>所以上面的<strong>MybatisAutoConfiguration</strong>这个类，自动帮我们生成了 <code>SqlSessionFactory</code> 和 <code>SqlSessionTemplate</code> 这些 Mybatis 的重要实例并交给 spring 容器管理，从而完成 bean 的自动注册</p><h3 id="自动配置条件依赖"><a class="header-anchor" href="#自动配置条件依赖">¶</a>自动配置条件依赖</h3><p>从<code>MybatisAutoConfiguration</code>这个类中使用的注解可以看出，要完成自动配置是有依赖条件的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnClass(&#123;SqlSessionFactory.class, SqlSessionFactoryBean.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(&#123;DataSource.class&#125;)</span></span><br></pre></td></tr></table></figure><p>所以要完成 Mybatis 的自动配置，需要在类路径中存在<code>SqlSessionFactory</code>、<code>SqlSessionFactoryBean</code>这两个类，同时需要存在 DataSource 这个 bean 且这个 bean 完成自动注册</p><p>Spring boot 中常见的条件依赖注解有：</p><table><thead><tr><th style="text-align:center">注解</th><th style="text-align:center">功能说明</th></tr></thead><tbody><tr><td style="text-align:center"><code>@ConditionalOnBean</code></td><td style="text-align:center">仅在当前上下文中存在某个 bean 时，才会实例化这个 Bean</td></tr><tr><td style="text-align:center"><code>@ConditionalOnClass</code></td><td style="text-align:center">某个 class 位于类路径上，才会实例化这个 Bean</td></tr><tr><td style="text-align:center"><code>@ConditionalOnExpression</code></td><td style="text-align:center">当表达式为 true 的时候，才会实例化这个 Bean</td></tr><tr><td style="text-align:center"><code>@ConditionalOnMissingBean</code></td><td style="text-align:center">仅在当前上下文中不存在某个 bean 时，才会实例化这个 Bean，防止重复创建</td></tr><tr><td style="text-align:center"><code>@ConditionalOnMissingClass</code></td><td style="text-align:center">某个 class 在类路径上不存在的时候，才会实例化这个 Bean</td></tr><tr><td style="text-align:center"><code>@ConditionalOnNotWebApplication</code></td><td style="text-align:center">不是 web 应用时才会实例化这个 Bean</td></tr><tr><td style="text-align:center"><code>@AutoConfigureAfter</code></td><td style="text-align:center">在某个 bean 完成自动配置后实例化这个 bean</td></tr><tr><td style="text-align:center"><code>@AutoConfigureBefore</code></td><td style="text-align:center">在某个 bean 完成自动配置前实例化这个 bean</td></tr></tbody></table><h3 id="Bean-参数获取"><a class="header-anchor" href="#Bean-参数获取">¶</a>Bean 参数获取</h3><div class="alert success no-icon"><p>要完成 mybatis 的自动配置，需要我们在配置文件中提供数据源相关的配置参数，例如数据库驱动、连接 url、数据库用户名、密码等。那么 spring boot 是如何读取 yml 或者 properites 配置文件的的属性来创建数据源对象的？</p></div><p>在我们导入 mybatis-spring-boot-starter 这个 jar 包后会传递过来一个 spring-boot-autoconfigure 包，在这个包中有一个自动配置类<strong>DataSourceAutoConfiguration</strong>，如下所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;DataSource.class, EmbeddedDatabaseType.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;DataSourceProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;Registrar.class, DataSourcePoolMetadataProvidersConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceAutoConfiguration</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>上面这个类加入了<code>EnableConfigurationProperties</code>注解，DataSourceProperties 这个类如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(</span></span><br><span class="line"><span class="meta">    prefix = &quot;spring.datasource&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProperties</span> <span class="keyword">implements</span> <span class="title class_">BeanClassLoaderAware</span>, EnvironmentAware, InitializingBean &#123;&#125;</span><br></pre></td></tr></table></figure><p>上面这个类上加入了<strong>ConfigurationProperties</strong>注解，这个注解的作用就是把 yml 或者 properties 配置文件中的配置参数信息封装到<strong>ConfigurationProperties</strong>注解标注的 bean(即<strong>DataSourceProperties</strong>)的相应属性上。</p><div class="alert info no-icon"><p><code>@EnableConfigurationProperties</code>注解的作用是使<code>@ConfigurationProperties</code>注解生效，并且将<code>@ConfigurationProperties</code>标注的 Bean 注入到 <code>@EnablelConfigurationProperties</code>类中。</p></div><p>如下例所示，最终 <code>DataSourceProperties</code> 类将注入到 <code>DataSourceAutoConfiguration</code>中使用，随后 Spring 将根据<code>DataSourceAutoConfiguration</code>类中的配置，自动注入新的 Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="keyword">public</span> DataSourceInitializer <span class="title function_">dataSourceInitializer</span><span class="params">(DataSourceProperties properties, ApplicationContext applicationContext)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceInitializer</span>(properties, applicationContext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Bean-的发现"><a class="header-anchor" href="#Bean-的发现">¶</a>Bean 的发现</h3><div class="alert success no-icon"><p>spring boot 默认扫描启动类所在的包下的主类与子类的所有组件，但并没有包括依赖包中的类，那么依赖包中的 bean 是如何被发现和加载的？</p></div><div class="alert info no-icon"><p>一般 Spring boot 应用程序的启动类都有 <code>@SpringBootApplication</code> 注解，这个注解的源码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">    excludeFilters = &#123;@Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;TypeExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">), @Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">)&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;...&#125;</span><br></pre></td></tr></table></figure><p>其中比较重要是下面这三个注解：</p><ul><li><code>@SpringBootConfiguration</code>：作用就相当<code>@Configuration</code>注解，被注解的类将成为一个 bean 配置类</li><li><code>@ComponentScan</code>：作用就是自动扫描并加载符合条件的组件，最终将这些 bean 加载到 spring 容器中</li><li><code>@EnableAutoConfiguration</code>：这个注解很重要，借助<code>@Import</code>的支持，收集和注册依赖包中相关的 Bean 定义</li></ul></div><p>继续追踪<code>@EnableAutoConfiguration</code>注解源码，这个注解引用了<code>@Import</code>注解，<code>@Import</code>注解能够导入需要自动配置的组件，此处就自动导入类<code>EnableAutoConfigurationImportSelector</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;EnableAutoConfigurationImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="operator">=</span> <span class="string">&quot;spring.boot.enableautoconfiguration&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>EnableAutoConfigurationImportSelector</code>类的源码如下，由于如今这个类已经被弃用，所哟详细的细节查看父类<code>AutoConfigurationImportSelector</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnableAutoConfigurationImportSelector</span> <span class="keyword">extends</span> <span class="title class_">AutoConfigurationImportSelector</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EnableAutoConfigurationImportSelector</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">(AnnotationMetadata metadata)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getClass().equals(EnableAutoConfigurationImportSelector.class) ? (Boolean)<span class="built_in">this</span>.getEnvironment().getProperty(<span class="string">&quot;spring.boot.enableautoconfiguration&quot;</span>, Boolean.class, <span class="literal">true</span>) : <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AutoConfigurationImportSelector</code>类中比较重要的是<code>getCandidateConfigurations</code>方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title class_">DeferredImportSelector</span>, BeanClassLoaderAware, ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">      <span class="keyword">protected</span> List&lt;String&gt; <span class="title function_">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> &#123;</span><br><span class="line">        List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="built_in">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="built_in">this</span>.getBeanClassLoader());</span><br><span class="line">        Assert.notEmpty(configurations, <span class="string">&quot;No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> configurations;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>getCandidateConfigurations()</code> 方法中调用了 SpringFactoriesLoader 类的 loadFactoryNames 方法，继续跟踪源码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, ClassLoader classLoader)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">factoryClassName</span> <span class="operator">=</span> factoryClass.getName();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Enumeration&lt;URL&gt; urls = classLoader != <span class="literal">null</span> ? classLoader.getResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>) : ClassLoader.getSystemResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>);</span><br><span class="line">        <span class="type">ArrayList</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(urls.hasMoreElements()) &#123;</span><br><span class="line">            <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> (URL)urls.nextElement();</span><br><span class="line">            <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> PropertiesLoaderUtils.loadProperties(<span class="keyword">new</span> <span class="title class_">UrlResource</span>(url));</span><br><span class="line">            <span class="type">String</span> <span class="variable">factoryClassNames</span> <span class="operator">=</span> properties.getProperty(factoryClassName);</span><br><span class="line">            result.addAll(Arrays.asList(StringUtils.commaDelimitedListToStringArray(factoryClassNames)));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException var8) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unable to load [&quot;</span> + factoryClass.getName() + <span class="string">&quot;] factories from location [&quot;</span> + <span class="string">&quot;META-INF/spring.factories&quot;</span> + <span class="string">&quot;]&quot;</span>, var8);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上 <code>SpringFactoriesLoader</code>的<code>loadeFactoryNames</code>静态方法可以从所有的 jar 中读取 <code>META_INF/spring.factories</code>文件，而自动装配的类就在这个文件汇总进行配置</p><div class="alert warning no-icon"><p>例如，<code>Mybatis-spring-boot-starter</code>中就有此文件，如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/springboot/springboot-mybatisstarter-spring-factories.png" alt=""></p><p>其中的内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration</span><br></pre></td></tr></table></figure></div><p>这样 Spring Boot 就可以加载到 MybatisAutoConfiguration 这个配置类了</p><h3 id="Bean-到加载"><a class="header-anchor" href="#Bean-到加载">¶</a>Bean 到加载</h3><p>在 Spring Boot 应用中要让一个普通类交给 Spring 容器管理，通常有以下方法：</p><div class="alert success no-icon"><ol><li>使用<code>@Configuration</code>与<code>@Bean</code> 注解</li><li>使用<code>@Controller</code>、<code>@Service</code>、<code>@Repository</code>、<code>@Component</code> 注解标注该类并且启用<code>@ComponentScan</code>自动扫描</li><li>使用<code>@Import</code>注解以及对应的方法</li></ol></div><p>其中 Spring Boot 实现自动配置使用的是<code>@Import</code>注解这种方式，<code>AutoConfigurationImportSelector</code>类的<code>selectImports</code>方法返回一组从<code>META-INF/spring.factories</code>文件中读取的<code>bean</code>的全类名，这样 Spring Boot 就可以加载到这些 Bean 并完成实例的创建工作</p><h3 id="自动配置总结"><a class="header-anchor" href="#自动配置总结">¶</a>自动配置总结</h3><p>📓 自动配置的关键几步以及相应的注解总结如下：</p><div class="alert info no-icon"><ol><li>@Configuration 与@Bean：基于 Java 代码的 bean 配置</li><li>@Conditional：设置自动配置条件依赖</li><li>@EnableConfigurationProperties 与@ConfigurationProperties：读取配置文件转换为 bean</li><li>@EnableAutoConfiguration 与@Import：实现 bean 发现与加载</li></ol></div><h2 id="自定义-starter"><a class="header-anchor" href="#自定义-starter">¶</a>自定义 starter</h2><p>本小节通过自定义 starter 来加强之前的知识</p><div class="alert warning no-icon"><ol><li>创建 starter 工程 hello-spring-boot-starter 并配置 pom.xml 文件</li></ol></div><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.pineappleman<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hello-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="alert warning no-icon"><ol start="2"><li>创建配置属性类 HelloProperties</li></ol></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *读取配置文件转换为bean</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;HelloProperties&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, address=&#x27;&quot;</span> + address + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="alert warning no-icon"><ol start="3"><li>创建服务类 HelloService</li></ol></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloService</span><span class="params">(String name, String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好！我的名字叫 &quot;</span> + name + <span class="string">&quot;，我来自 &quot;</span> + address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="alert warning no-icon"><ol start="4"><li>创建自动配置类 HelloServiceAutoConfiguration</li></ol></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 配置类，基于Java代码的bean配置</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HelloProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过构造方法注入配置属性对象HelloProperties</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloServiceAutoConfiguration</span><span class="params">(HelloProperties helloProperties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.helloProperties = helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实例化HelloService并载入Spring IoC容器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>(helloProperties.getName(),helloProperties.getAddress());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="alert warning no-icon"><ol start="5"><li>在 resources 目录下创建 META-INF/spring.factories</li></ol></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">cn.itcast.config.HelloServiceAutoConfiguration</span><br></pre></td></tr></table></figure><p>通过以上步骤之后，可以通过 <code>mvn install</code> 将自定义的 starter 安装到本地 maven 仓库</p><h2 id="使用-starter"><a class="header-anchor" href="#使用-starter">¶</a>使用 starter</h2><div class="alert warning no-icon"><ol><li>创建 maven 工程 myapp 并配置 pom.xml 文件</li></ol></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.example&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;myapp&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">2.2</span><span class="number">.2</span>.RELEASE&lt;/version&gt;</span><br><span class="line">        &lt;relativePath/&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;<span class="number">8</span>&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;<span class="number">8</span>&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--导入自定义的 starter --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.pineappleman&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hello-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;<span class="literal">true</span>&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><div class="alert warning no-icon"><ol start="2"><li>创建 application.yml 文件</li></ol></div><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">hello:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">xiaoming</span></span><br><span class="line">  <span class="attr">address:</span> <span class="string">beijing</span></span><br></pre></td></tr></table></figure><div class="alert warning no-icon"><ol start="3"><li>创建 HelloController</li></ol></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">	<span class="comment">/** 当前实例已经由自定义的 starter 完成了创建 */</span></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> HelloService helloService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@GetMapping(value =&quot;/say&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> helloService.sayHello();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="alert warning no-icon"><ol start="4"><li>创建启动类 HelloApplication</li></ol></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApplication</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(HelloApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至此，就完成了 Spring Boot 的 Starter 的创建以及使用</p></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">标签</span><br><a class="tag tag--primary tag--small t-none-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/http%EF%BC%88%E5%9B%9B%EF%BC%89http-%E6%91%98%E8%A6%81%E8%AE%A4%E8%AF%81/" data-tooltip="HTTP（四）HTTP 摘要认证" aria-label="上一篇: HTTP（四）HTTP 摘要认证"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/mysql-%E5%9B%9B-%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E6%B5%81%E7%A8%8B/" data-tooltip="MySQL(四)简单查询语句流程" aria-label="下一篇: MySQL(四)简单查询语句流程"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></article><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2023 pineapple-man. All Rights Reserved.</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><br>Total <span id="busuanzi_value_site_pv"></span> views. 您是pineapple-man的第<span id="busuanzi_value_site_uv"></span>个小伙伴<br><i class="fas fa-book-open"></i> <span class="post-count">博客字数统计：370.7k</span><script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="5"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/http%EF%BC%88%E5%9B%9B%EF%BC%89http-%E6%91%98%E8%A6%81%E8%AE%A4%E8%AF%81/" data-tooltip="HTTP（四）HTTP 摘要认证" aria-label="上一篇: HTTP（四）HTTP 摘要认证"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/mysql-%E5%9B%9B-%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E6%B5%81%E7%A8%8B/" data-tooltip="MySQL(四)简单查询语句流程" aria-label="下一篇: MySQL(四)简单查询语句流程"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-times"></i></div><img id="about-card-picture" src="/assets/images/logo.png" alt="作者的图片"><h4 id="about-card-name">pineapple-man</h4><div id="about-card-bio"><p>做一个菠萝：站得笔直，头戴王冠，内心甜美</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>刚毕业就失业</p></div><div id="about-card-location"><i class="fa fa-map-marker-alt"></i><br>西安</div></div></div><div id="cover" style="background-image:url(/assets/images/cover-v1.2.0.jpg)"></div><script src="/assets/js/script-kcoiyt1nxfue7qgcpkrcixymglcc3cuxeg98fy01hqww4nblnhd2ees6j6yc.min.js"></script></body></html>