<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="pineapple-man"><title>StringTable - pineapple-man</title><meta name="author" content="pineapple-man"><meta name="keywords" content="StringTable"><link rel="icon" href="https://pineapple-man.github.io/assets/images/logo.svg"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png"},"articleBody":"\nÂ¶String åŸºæœ¬ç‰¹æ€§\nâœ¨ Stringç±»å…·æœ‰å¦‚ä¸‹åŸºæœ¬ç‰¹æ€§ï¼š\n\nString è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸€å¯¹&quot;&quot;å¼•èµ·æ¥è¡¨ç¤º\nå£°æ˜ä¸ºfinalï¼Œä¸å¯è¢«ç»§æ‰¿\nString å®ç°äº† Serializable æ¥å£æ”¯æŒåºåˆ—åŒ–\nString å®ç°äº† Comparable æ¥å£æ”¯æŒæ¯”è¾ƒå¤§å°\nString åœ¨ JDK8 åŠä»¥å‰å†…éƒ¨å®šä¹‰äº†final char[] valueç”¨äºå­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ï¼›JDK9 æ—¶æ”¹ä¸ºbyte[]\n\n\nStringï¼šä»£è¡¨ä¸å¯å˜çš„å­—ç¬¦åºåˆ—ï¼Œç®€ç§°ï¼šä¸å¯å˜æ€§\n\nå½“å¯¹å­—ç¬¦ä¸²é‡æ–°èµ‹å€¼æ—¶ï¼Œéœ€è¦é‡å†™æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„ value è¿›è¡Œèµ‹å€¼\nå½“å¯¹ç°æœ‰çš„å­—ç¬¦ä¸²è¿›è¡Œè¿æ¥æ“ä½œæ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„ value è¿›è¡Œèµ‹å€¼\nå½“è°ƒç”¨ string çš„ replace()æ–¹æ³•ä¿®æ”¹æŒ‡å®šå­—ç¬¦æˆ–å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„ value è¿›è¡Œèµ‹å€¼\n\n\n12345678910111213141516public class StringTest &#123;   String str = new String(&quot;good&quot;);   char[] ch = &#123;&#x27;t&#x27;, &#x27;e&#x27;, &#x27;s&#x27;, &#x27;t&#x27;&#125;;   public void change(String str, char ch[]) &#123;      str = &quot;test ok&quot;;      ch[0] = &#x27;b&#x27;;   &#125;   public static void main(String[] args) &#123;      StringTest stringTest = new StringTest();      stringTest.change(stringTest.str, stringTest.ch);      System.out.println(stringTest.str);//good      System.out.println(stringTest.ch);//best   &#125;&#125;\nğŸ¶ String ä¼ å‚æ•°æ—¶å¯ä»¥å½“ä½œåŸºæœ¬æ•°æ®ç±»å‹ä½¿ç”¨ï¼Œå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»å› æ­¤ä¹Ÿä¼šè¢«å½“ä½œåŸºæœ¬æ•°æ®ç±»å‹ä½¿ç”¨\n\né€šè¿‡å­—é¢é‡çš„æ–¹å¼ï¼ˆåŒºåˆ«äº newï¼‰ç»™ä¸€ä¸ªå­—ç¬¦ä¸²èµ‹å€¼ï¼Œæ­¤æ—¶çš„å­—ç¬¦ä¸²å€¼å£°æ˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚å­—ç¬¦ä¸²å¸¸é‡æ± ä¿è¯ä¸ä¼šå­˜å‚¨ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²\nString çš„ String Pool æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„ Hashtableï¼Œé»˜è®¤å€¼å¤§å°é•¿åº¦æ˜¯ 1009ã€‚å¦‚æœæ”¾è¿› String Pool çš„ String éå¸¸å¤šï¼Œå°±ä¼šé€ æˆ Hash å†²çªä¸¥é‡ï¼Œä»è€Œå¯¼è‡´é“¾è¡¨ä¼šå¾ˆé•¿ï¼Œè€Œé“¾è¡¨é•¿äº†åç›´æ¥ä¼šé€ æˆçš„å½±å“å°±æ˜¯å½“è°ƒç”¨String.internæ—¶æ€§èƒ½ä¼šå¤§å¹…ä¸‹é™ï¼Œä½¿ç”¨-XX:StringTablesizeå¯è®¾ç½® StringTable çš„é•¿åº¦\n\nåœ¨ jdk6 ä¸­ StringTable æ˜¯å›ºå®šçš„ï¼Œå°±æ˜¯ 1009 çš„é•¿åº¦ï¼Œæ‰€ä»¥å¦‚æœå¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²è¿‡å¤šå°±ä¼šå¯¼è‡´æ•ˆç‡ä¸‹é™å¾ˆå¿«ã€‚StringTablesize è®¾ç½®æ²¡æœ‰è¦æ±‚\nåœ¨ jdk7 ä¸­ï¼ŒStringTable çš„é•¿åº¦é»˜è®¤å€¼æ˜¯ 60013ï¼ŒStringTablesize è®¾ç½®æ²¡æœ‰è¦æ±‚\nåœ¨ JDK8 ä¸­ï¼Œè®¾ç½® StringTable é•¿åº¦çš„è¯ï¼Œ1009 æ˜¯å¯ä»¥è®¾ç½®çš„æœ€å°å€¼\n\n\nÂ¶String å­˜å‚¨ç»“æ„å˜æ›´\nåœ¨ JDK 9 åŠä»¥åï¼Œå°†åº•å±‚çš„char[]è½¬å˜ä¸ºbyte[]\nÂ¶Motivation\nThe current implementation of the String class stores characters in a char array, using two bytes (sixteen bits) for each character. Data gathered from many different applications indicates that strings are a major component of heap usage and, moreover, that most String objects contain only Latin-1 characters. Such characters require only one byte of storage, hence half of the space in the internal char arrays of such String objects is going unused.\nJSRå®˜æ–¹æ–‡æ¡£\nç›®å‰ String ç±»çš„å®ç°å°†å­—ç¬¦å­˜å‚¨åœ¨ä¸€ä¸ªcharæ•°ç»„ä¸­ï¼Œæ¯ä¸ªå­—ç¬¦ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼ˆ16 ä½ï¼‰ï¼Œä»è®¸å¤šä¸åŒçš„åº”ç”¨ä¸­æ”¶é›†åˆ°çš„æ•°æ®è¡¨æ˜ï¼Œå­—ç¬¦ä¸²æ˜¯å †ä½¿ç”¨çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œæ­¤å¤–ï¼Œå¤§å¤šæ•°å­—ç¬¦ä¸²å¯¹è±¡åªåŒ…å« Latin-1 å­—ç¬¦ï¼Œè¿™äº›å­—ç¬¦åªéœ€è¦ä¸€ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤è¿™äº›å­—ç¬¦ä¸²å¯¹è±¡çš„å†…éƒ¨å­—ç¬¦æ•°ç»„ä¸­æœ‰ä¸€åŠç©ºé—´æ˜¯æµªè´¹çš„\nÂ¶Description\nWe propose to change the internal representation of the String class from a UTF-16 char array to a byte array plus an encoding-flag field. The new String class will store characters encoded either as ISO-8859-1/Latin-1 (one byte per character), or as UTF-16 (two bytes per character), based upon the contents of the string. The encoding flag will indicate which encoding is used.\nString-related classes such as AbstractStringBuilder, StringBuilder, and StringBuffer will be updated to use the same representation, as will the HotSpot VMâ€™s intrinsic string operations.\nThis is purely an implementation change, with no changes to existing public interfaces. There are no plans to add any new public APIs or other interfaces.\nThe prototyping work done to date confirms the expected reduction in memory footprint, substantial reductions of GC activity, and minor performance regressions in some corner cases.\nJSRå®˜æ–¹æ–‡æ¡£\næˆ‘ä»¬å»ºè®®å°† String ç±»çš„å†…éƒ¨è¡¨ç¤ºæ–¹æ³•ä»UTF-16å­—ç¬¦æ•°ç»„æ”¹ä¸ºå­—èŠ‚æ•°ç»„åŠ ç¼–ç æ ‡å¿—åŸŸï¼ˆç¼–ç æ ‡å¿—å°†è¡¨æ˜ä½¿ç”¨çš„æ˜¯å“ªç§ç¼–ç ï¼‰\næ–°çš„ String ç±»å°†æ ¹æ®å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œä»¥ISO-8859-1/Latin-1ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸€ä¸ªå­—èŠ‚ï¼‰æˆ–UTF-16ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸¤ä¸ªå­—èŠ‚ï¼‰çš„æ–¹å¼å­˜å‚¨å­—ç¬¦ç¼–ç ã€‚\nä¸å­—ç¬¦ä¸²ç›¸å…³çš„ç±»ï¼Œå¦‚AbstractStringBuilderã€StringBuilderå’ŒStringBufferå°†è¢«æ›´æ–°ä»¥ä½¿ç”¨ç›¸åŒçš„è¡¨ç¤ºæ–¹æ³•ï¼ŒHotSpot VM çš„å†…åœ¨å­—ç¬¦ä¸²æ“ä½œä¹Ÿæ˜¯å¦‚æ­¤.\nè¿™çº¯ç²¹æ˜¯ä¸€ä¸ªå®ç°ä¸Šçš„å˜åŒ–ï¼Œå¯¹ç°æœ‰çš„å…¬å…±æ¥å£æ²¡æœ‰å˜åŒ–ã€‚ç›®å‰æ²¡æœ‰è®¡åˆ’å¢åŠ ä»»ä½•æ–°çš„å…¬å…± API æˆ–å…¶ä»–æ¥å£,è¿„ä»Šä¸ºæ­¢æ‰€åšçš„åŸå‹è®¾è®¡å·¥ä½œè¯å®äº†å†…å­˜å ç”¨çš„é¢„æœŸå‡å°‘ï¼ŒGC æ´»åŠ¨çš„å¤§å¹…å‡å°‘ï¼Œä»¥åŠåœ¨æŸäº›è§’è½æƒ…å†µä¸‹çš„è½»å¾®æ€§èƒ½å€’é€€\nğŸ““String ä¸å†ç”¨char[] å­˜å‚¨æ”¹æˆäº†byte[] åŠ ä¸Šç¼–ç æ ‡è®°ï¼ŒèŠ‚çº¦äº†ä¸€äº›ç©ºé—´\n12345public final class String implements java.io.Serializable,                        Comparable&lt;String&gt;, CharSequence &#123;    @Stable    private final byte[] value;&#125;\nÂ¶String çš„å†…å­˜åˆ†é…\nåœ¨ Java è¯­è¨€ä¸­æœ‰ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹å’Œä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹ Stringã€‚è¿™äº›ç±»å‹ä¸ºäº†ä½¿å®ƒä»¬åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é€Ÿåº¦æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜ï¼Œéƒ½æä¾›äº†ä¸€ç§å¸¸é‡æ± çš„æ¦‚å¿µ.å¸¸é‡æ± å°±ç±»ä¼¼ä¸€ä¸ª Java ç³»ç»Ÿçº§åˆ«æä¾›çš„ç¼“å­˜ï¼Œ8 ç§åŸºæœ¬æ•°æ®ç±»å‹çš„å¸¸é‡æ± éƒ½æ˜¯ç³»ç»Ÿåè°ƒçš„\nâœ¨String ç±»å‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„ä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ï¼š\n\nç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜çš„Stringå¯¹è±¡ä¼šç›´æ¥å­˜å‚¨å†å¸¸é‡æ± ç§\nå¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„Stringå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨Stringæä¾›çš„intern()æ–¹æ³•\n\n\nÂ¶String table ä½ç½®\nJdk6 åŠä»¥å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ°¸ä¹…ä»£\n\nJava 7 ä¸­ Oracle çš„å·¥ç¨‹å¸ˆå¯¹å­—ç¬¦ä¸²æ± çš„é€»è¾‘åšäº†å¾ˆå¤§çš„æ”¹å˜ï¼Œå³å°†å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½ç½®è°ƒæ•´åˆ° Java å †å†…\n\næ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½ä¿å­˜åœ¨å †ï¼ˆHeapï¼‰ä¸­ï¼Œå’Œå…¶ä»–æ™®é€šå¯¹è±¡ä¸€æ ·ï¼Œè¿™æ ·å¯ä»¥è®©ä½ åœ¨è¿›è¡Œè°ƒä¼˜åº”ç”¨æ—¶ä»…éœ€è¦è°ƒæ•´å †å¤§å°å°±å¯ä»¥äº†\nå­—ç¬¦ä¸²å¸¸é‡æ± æ¦‚å¿µåŸæœ¬ä½¿ç”¨å¾—æ¯”è¾ƒå¤šï¼Œä½†æ˜¯è¿™ä¸ªæ”¹åŠ¨ä½¿å¾—æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç†ç”±è®©æˆ‘ä»¬é‡æ–°è€ƒè™‘åœ¨ Java 7 ä¸­ä½¿ç”¨String.intern()\n\n\n\nğŸ¤” StringTable ä½ç½®ä¸ºä»€ä¹ˆè¦è°ƒæ•´\nSynopsis: In JDK 7, interned strings are no longer allocated in the permanent generation of the Java heap, but are instead allocated in the main part of the Java heap (known as the young and old generations), along with the other objects created by the application. This change will result in more data residing in the main Java heap, and less data in the permanent generation, and thus may require heap sizes to be adjusted. Most applications will see only relatively small differences in heap usage due to this change, but larger applications that load many classes or make heavy use of the String.intern() method will see more significant differences.\nJSRå®˜æ–¹æ–‡æ¡£\nç®€ä»‹ï¼šåœ¨ JDK 7 ä¸­ï¼Œå†…éƒ¨å­—ç¬¦ä¸²ä¸å†åˆ†é…åœ¨ Java å †çš„æ°¸ä¹…ä»£ä¸­ï¼Œè€Œæ˜¯åˆ†é…åœ¨ Java å †çš„ä¸»è¦éƒ¨åˆ†ï¼Œä¸åº”ç”¨ç¨‹åºåˆ›å»ºçš„å…¶ä»–å¯¹è±¡ä¸€èµ·ã€‚è¿™ç§å˜åŒ–å°†å¯¼è‡´æ›´å¤šçš„æ•°æ®é©»ç•™åœ¨ä¸» Java å †ä¸­ï¼Œè€Œæ›´å°‘çš„æ•°æ®åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œå› æ­¤å¯èƒ½éœ€è¦è°ƒæ•´å †çš„å¤§å°ã€‚å¤§å¤šæ•°åº”ç”¨ç¨‹åºå°†çœ‹åˆ°ç”±äºè¿™ä¸€å˜åŒ–è€Œå¯¼è‡´çš„å †ä½¿ç”¨çš„ç›¸å¯¹è¾ƒå°çš„å·®å¼‚ï¼Œä½†åŠ è½½è®¸å¤šç±»æˆ–å¤§é‡ä½¿ç”¨ String.intern()æ–¹æ³•çš„å¤§å‹åº”ç”¨ç¨‹åºå°†çœ‹åˆ°æ›´æ˜æ˜¾çš„å·®å¼‚\nÂ¶å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ\n\nå¸¸é‡ä¸å¸¸é‡çš„æ‹¼æ¥ç»“æœåœ¨å¸¸é‡æ± ï¼ŒåŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–\nå¸¸é‡æ± ä¸­ä¸ä¼šå­˜åœ¨ç›¸åŒå†…å®¹çš„å˜é‡\nåªè¦å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å˜é‡ï¼Œç»“æœå°±åœ¨å †ä¸­ã€‚å˜é‡æ‹¼æ¥çš„åŸç†æ˜¯ StringBuilder\nå¦‚æœæ‹¼æ¥çš„ç»“æœè°ƒç”¨intern()æ–¹æ³•ï¼Œåˆ™ä¸»åŠ¨å°†å¸¸é‡æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥æ± ä¸­ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡åœ°å€\n\nç¼–è¯‘å™¨ä¼˜åŒ–çš„ä¾‹å­ï¼š\n12345678public static void test1() &#123;   // éƒ½æ˜¯å¸¸é‡ï¼Œå‰ç«¯ç¼–è¯‘æœŸä¼šè¿›è¡Œä»£ç ä¼˜åŒ–   // é€šè¿‡ideaç›´æ¥çœ‹å¯¹åº”çš„åç¼–è¯‘çš„classæ–‡ä»¶ï¼Œä¼šæ˜¾ç¤º String s1 = &quot;abc&quot;; è¯´æ˜åšäº†ä»£ç ä¼˜åŒ–   String s1 = &quot;a&quot; + &quot;b&quot; + &quot;c&quot;;   String s2 = &quot;abc&quot;;   // trueï¼Œæœ‰ä¸Šè¿°å¯çŸ¥ï¼Œs1å’Œs2å®é™…ä¸ŠæŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„åŒä¸€ä¸ªå€¼   System.out.println(s1 == s2);&#125;\nå˜é‡ä¸å¸¸é‡é—´çš„æ‹¼æ¥æ“ä½œ\n123456789101112131415161718192021public static void test5() &#123;    String s1 = &quot;javaEE&quot;;    String s2 = &quot;hadoop&quot;;    String s3 = &quot;javaEEhadoop&quot;;    String s4 = &quot;javaEE&quot; + &quot;hadoop&quot;;    String s5 = s1 + &quot;hadoop&quot;;    String s6 = &quot;javaEE&quot; + s2;    String s7 = s1 + s2;    System.out.println(s3 == s4); // true ç¼–è¯‘æœŸä¼˜åŒ–    System.out.println(s3 == s5); // false s1æ˜¯å˜é‡ï¼Œä¸èƒ½ç¼–è¯‘æœŸä¼˜åŒ–    System.out.println(s3 == s6); // false s2æ˜¯å˜é‡ï¼Œä¸èƒ½ç¼–è¯‘æœŸä¼˜åŒ–    System.out.println(s3 == s7); // false s1ã€s2éƒ½æ˜¯å˜é‡    System.out.println(s5 == s6); // false s5ã€s6 ä¸åŒçš„å¯¹è±¡å®ä¾‹    System.out.println(s5 == s7); // false s5ã€s7 ä¸åŒçš„å¯¹è±¡å®ä¾‹    System.out.println(s6 == s7); // false s6ã€s7 ä¸åŒçš„å¯¹è±¡å®ä¾‹    String s8 = s6.intern();    System.out.println(s3 == s8); // true internä¹‹åï¼Œs8å’Œs3ä¸€æ ·ï¼ŒæŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„&quot;javaEEhadoop&quot;&#125;\n\nä¸å®ç”¨ final ä¿®é¥°ï¼Œå³ä¸ºå˜é‡ï¼Œå¦‚ s3 çš„æ±‚è§£ï¼Œä¼šé€šè¿‡ new StringBuilder è¿›è¡Œæ‹¼æ¥\nä½¿ç”¨finalå…³é”®å­—ä¿®é¥°ï¼Œæœ€ç»ˆå˜é‡é€€åŒ–ä¸ºå¸¸é‡ï¼Œä¼šåœ¨ç¼–è¯‘å™¨è¿›è¡Œä»£ç ä¼˜åŒ–ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œèƒ½å¤Ÿä½¿ç”¨ final çš„åœ°æ–¹å°½é‡ä½¿ç”¨\n\n123456789101112public void test6()&#123;    String s0 = &quot;beijing&quot;;    String s1 = &quot;bei&quot;;    String s2 = &quot;jing&quot;;    String s3 = s1 + s2;    System.out.println(s0 == s3); // false s3æŒ‡å‘å¯¹è±¡å®ä¾‹ï¼Œs0æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„&quot;beijing&quot;    String s7 = &quot;shanxi&quot;;    final String s4 = &quot;shan&quot;;    final String s5 = &quot;xi&quot;;    String s6 = s4 + s5;    System.out.println(s6 == s7); // true s4å’Œs5æ˜¯finalä¿®é¥°çš„ï¼Œç¼–è¯‘æœŸå°±èƒ½ç¡®å®šs6çš„å€¼äº†&#125;\nåœ¨å¤§é‡çš„å®éªŒéªŒè¯ä¸‹ï¼Œé€šè¿‡ StringBuilder çš„ append æ–¹å¼çš„é€Ÿåº¦ï¼Œè¦æ¯”ç›´æ¥å¯¹ String ä½¿ç”¨+æ‹¼æ¥çš„æ–¹å¼å¿«å¤§çº¦ 8000 å€ï¼Œæ¯” StringBuffer çš„ append æ–¹æ³•å¿« 4 å€å·¦å³ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯¹äºéœ€è¦å¤šæ¬¡æˆ–å¤§é‡æ‹¼æ¥çš„æ“ä½œï¼Œåœ¨ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å°±åº”è¯¥å°½å¯èƒ½ä½¿ç”¨ StringBuilder è¿›è¡Œ append æ“ä½œã€‚å¹¶ä¸”å¦‚æœæå‰çŸ¥é“éœ€è¦æ‹¼æ¥ String çš„ä¸ªæ•°ï¼Œå°±åº”è¯¥ç›´æ¥ä½¿ç”¨å¸¦å‚æ„é€ å™¨æŒ‡å®š capacityï¼Œä»¥å‡å°‘æ‰©å®¹æ¬¡æ•°\nÂ¶inter()çš„ä½¿ç”¨\nå½“è°ƒç”¨ intern æ–¹æ³•æ—¶ï¼Œå¦‚æœæ± å­é‡Œå·²ç»åŒ…å«äº†ä¸€ä¸ªä¸è¿™ä¸ª StrinÂ·g å¯¹è±¡ç›¸ç­‰çš„å­—ç¬¦ä¸²ï¼Œæ­£å¦‚ equals(Object)æ–¹æ³•æ‰€ç¡®å®šçš„ï¼Œé‚£ä¹ˆæ± å­é‡Œçš„å­—ç¬¦ä¸²ä¼šè¢«è¿”å›ã€‚å¦åˆ™ï¼Œè¿™ä¸ª String å¯¹è±¡è¢«æ·»åŠ åˆ°æ± ä¸­ï¼Œå¹¶è¿”å›è¿™ä¸ª String å¯¹è±¡çš„å¼•ç”¨\nç”±æ­¤å¯è§ï¼Œå¯¹äºä»»ä½•ä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ tï¼Œå½“ä¸”ä»…å½“ s.equals(t)ä¸ºçœŸæ—¶ï¼Œs.intern() == t.intern()ä¸ºçœŸï¼Œæ‰€æœ‰å­—é¢å­—ç¬¦ä¸²å’Œä»¥å­—ç¬¦ä¸²ä¸ºå€¼çš„å¸¸é‡è¡¨è¾¾å¼éƒ½æ˜¯internedï¼Œè¿”å›ä¸€ä¸ªä¸æ­¤å­—ç¬¦ä¸²å†…å®¹ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œä½†ä¿è¯æ˜¯æ¥è‡ªä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²æ± \nÂ¶G1 çš„ String å»é‡æ“ä½œ\n123//éœ€è¦s1ã€s2jString s1 = new String(&quot;hello&quot;);String s2 = new String(&quot;hello&quot;);\nstring æ± å­çš„æ“ä½œï¼ŒString s = new string(â€œhello worldâ€)æœ‰å‡ ä¸ªå¯¹è±¡ç”Ÿæˆï¼Œç”Ÿæˆå¯¹è±¡çš„ s å­˜æ”¾åœ¨å“ªé‡Œ\nÂ¶é™„å½•\nnew String(â€œ123â€) åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ\nString s=new String(â€œabcâ€)åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡?\né¢è¯•é¢˜ä¹‹ String str = new String(â€œabcâ€); åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡\nå®˜æ–¹è¡¨åæ›´æ”¹ String æºç åŸå› \nJava å‡½æ•°ä¼ å‚(String çš„ä¸å¯å˜æ€§)\nStringTable è°ƒæ•´å®˜æ–¹è¯´æ˜\nStringBuffer å’Œ StringBuilder çš„åŒºåˆ«\nString a=&quot;123&quot;åˆ›å»ºå¯¹è±¡ä¸ªæ•°é—®é¢˜\n","dateCreated":"2022-03-31T16:42:29+00:00","dateModified":"2023-06-07T02:13:34+00:00","datePublished":"2022-03-31T16:42:29+00:00","description":"å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ï¼Œé‚£ä¹ˆåœ¨ JVM åº•å±‚ä¸­ï¼Œå­—ç¬¦ä¸²åˆ°åº•æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ","headline":"StringTable","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://pineapple-man.github.io/stringtable/"},"publisher":{"@type":"Organization","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png","logo":{"@type":"ImageObject","url":"logo.png"}},"url":"https://pineapple-man.github.io/stringtable/","keywords":"JVM"}</script><meta name="description" content="å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ï¼Œé‚£ä¹ˆåœ¨ JVM åº•å±‚ä¸­ï¼Œå­—ç¬¦ä¸²åˆ°åº•æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ"><meta property="og:type" content="blog"><meta property="og:title" content="StringTable"><meta property="og:url" content="https://pineapple-man.github.io/stringtable/"><meta property="og:site_name" content="pineapple-man"><meta property="og:description" content="å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ï¼Œé‚£ä¹ˆåœ¨ JVM åº•å±‚ä¸­ï¼Œå­—ç¬¦ä¸²åˆ°åº•æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/imgjvm-stringtabl-jdk6.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/imgjvm-stringtable-jdk7.png"><meta property="article:published_time" content="2022-03-31T16:42:29.000Z"><meta property="article:modified_time" content="2023-06-07T02:13:34.011Z"><meta property="article:author" content="pineapple-man"><meta property="article:tag" content="JVM"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/imgjvm-stringtabl-jdk6.png"><meta property="og:image" content="https://pineapple-man.github.io/assets/images/logo.png"><link rel="stylesheet" href="/assets/css/style-oth3meuzcjopbgwqbdvoxqknhcm0sy9wkullcc94zhkkop3pmfrpl5t4fzzz.min.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-210516333-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-210516333-1")</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"></head><body><div id="blog"><header id="header" data-behavior="5"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/" aria-label="">pineapple-man</a></div><a class="header-right-picture" href="#about" aria-label="æ‰“å¼€é“¾æ¥: /#about"><img class="header-picture" src="/assets/images/logo.png" alt="ä½œè€…çš„å›¾ç‰‡"></a></header><nav id="sidebar" data-behavior="5"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about" aria-label="é˜…è¯»æœ‰å…³ä½œè€…çš„æ›´å¤šä¿¡æ¯"><img class="sidebar-profile-picture" src="/assets/images/logo.png" alt="ä½œè€…çš„å›¾ç‰‡"></a><h4 class="sidebar-profile-name">pineapple-man</h4><h5 class="sidebar-profile-bio"><p>åšä¸€ä¸ªè èï¼šç«™å¾—ç¬”ç›´ï¼Œå¤´æˆ´ç‹å† ï¼Œå†…å¿ƒç”œç¾</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/" rel="noopener" title="é¦–é¡µ"><i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i> <span class="sidebar-button-desc">é¦–é¡µ</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories" rel="noopener" title="åˆ†ç±»"><i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i> <span class="sidebar-button-desc">åˆ†ç±»</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags" rel="noopener" title="æ ‡ç­¾"><i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i> <span class="sidebar-button-desc">æ ‡ç­¾</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives" rel="noopener" title="å½’æ¡£"><i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i> <span class="sidebar-button-desc">å½’æ¡£</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about" rel="noopener" title="å…³äº"><i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i> <span class="sidebar-button-desc">å…³äº</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/pineapple-man" target="_blank" rel="noopener" title="GitHub"><i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto://mingchaohu720@gmail.com" target="_blank" rel="noopener" title="é‚®ç®±"><i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i> <span class="sidebar-button-desc">é‚®ç®±</span></a></li></ul></div></nav><div id="main" data-behavior="5" class="hasCoverMetaIn"><article class="post"><div class="post-header main-content-wrap text-center"><h1 class="post-title">StringTable</h1><div class="post-meta"><time datetime="2022-03-31T16:42:29+00:00">3æœˆ 31, 2022 </time><span>å‘å¸ƒåœ¨ </span><a class="category-link" href="/categories/Java/">Java</a> <i class="fas fa-book-open"></i> æœ¬æ–‡å…±<span class="post-count"> 2.9k </span>å­— <i class="far fa-clock"></i> é˜…è¯»é¢„è®¡<span class="post-count"> 30 </span>åˆ†é’Ÿ</div></div><div class="post-content markdown"><div class="main-content-wrap"><h1 id="table-of-contents">ç›®å½•</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#String-%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7"><span class="toc-text">String åŸºæœ¬ç‰¹æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#String-%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%8F%98%E6%9B%B4"><span class="toc-text">String å­˜å‚¨ç»“æ„å˜æ›´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Motivation"><span class="toc-text">Motivation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Description"><span class="toc-text">Description</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#String-%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D"><span class="toc-text">String çš„å†…å­˜åˆ†é…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#String-table-%E4%BD%8D%E7%BD%AE"><span class="toc-text">String table ä½ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%93%8D%E4%BD%9C"><span class="toc-text">å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#inter-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">inter()çš„ä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#G1-%E7%9A%84-String-%E5%8E%BB%E9%87%8D%E6%93%8D%E4%BD%9C"><span class="toc-text">G1 çš„ String å»é‡æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-text">é™„å½•</span></a></li></ol><h2 id="String-åŸºæœ¬ç‰¹æ€§"><a class="header-anchor" href="#String-åŸºæœ¬ç‰¹æ€§">Â¶</a>String åŸºæœ¬ç‰¹æ€§</h2><p>âœ¨ <code>String</code>ç±»å…·æœ‰å¦‚ä¸‹åŸºæœ¬ç‰¹æ€§ï¼š</p><div class="alert success no-icon"><ul><li>String è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸€å¯¹<code>&quot;&quot;</code>å¼•èµ·æ¥è¡¨ç¤º</li><li>å£°æ˜ä¸º<code>final</code>ï¼Œä¸å¯è¢«ç»§æ‰¿</li><li>String å®ç°äº† Serializable æ¥å£æ”¯æŒåºåˆ—åŒ–</li><li>String å®ç°äº† Comparable æ¥å£æ”¯æŒæ¯”è¾ƒå¤§å°</li><li>String åœ¨ JDK8 åŠä»¥å‰å†…éƒ¨å®šä¹‰äº†<code>final char[] value</code>ç”¨äºå­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ï¼›JDK9 æ—¶æ”¹ä¸º<code>byte[]</code></li></ul></div><p>Stringï¼šä»£è¡¨ä¸å¯å˜çš„å­—ç¬¦åºåˆ—ï¼Œç®€ç§°ï¼š<strong>ä¸å¯å˜æ€§</strong></p><div class="alert success no-icon"><ul><li>å½“å¯¹å­—ç¬¦ä¸²é‡æ–°èµ‹å€¼æ—¶ï¼Œéœ€è¦é‡å†™æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„ value è¿›è¡Œèµ‹å€¼</li><li>å½“å¯¹ç°æœ‰çš„å­—ç¬¦ä¸²è¿›è¡Œè¿æ¥æ“ä½œæ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„ value è¿›è¡Œèµ‹å€¼</li><li>å½“è°ƒç”¨ string çš„ replace()æ–¹æ³•ä¿®æ”¹æŒ‡å®šå­—ç¬¦æˆ–å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„ value è¿›è¡Œèµ‹å€¼</li></ul></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringTest</span> &#123;</span><br><span class="line">   <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;good&quot;</span>);</span><br><span class="line">   <span class="type">char</span>[] ch = &#123;<span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">change</span><span class="params">(String str, <span class="type">char</span> ch[])</span> &#123;</span><br><span class="line">      str = <span class="string">&quot;test ok&quot;</span>;</span><br><span class="line">      ch[<span class="number">0</span>] = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      <span class="type">StringTest</span> <span class="variable">stringTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringTest</span>();</span><br><span class="line">      stringTest.change(stringTest.str, stringTest.ch);</span><br><span class="line">      System.out.println(stringTest.str);<span class="comment">//good</span></span><br><span class="line">      System.out.println(stringTest.ch);<span class="comment">//best</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="alert info no-icon"><p>ğŸ¶ String ä¼ å‚æ•°æ—¶å¯ä»¥å½“ä½œåŸºæœ¬æ•°æ®ç±»å‹ä½¿ç”¨ï¼Œå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»å› æ­¤ä¹Ÿä¼šè¢«å½“ä½œåŸºæœ¬æ•°æ®ç±»å‹ä½¿ç”¨</p></div><p>é€šè¿‡å­—é¢é‡çš„æ–¹å¼ï¼ˆåŒºåˆ«äº newï¼‰ç»™ä¸€ä¸ªå­—ç¬¦ä¸²èµ‹å€¼ï¼Œæ­¤æ—¶çš„å­—ç¬¦ä¸²å€¼å£°æ˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚å­—ç¬¦ä¸²å¸¸é‡æ± ä¿è¯ä¸ä¼šå­˜å‚¨ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²</p><p>String çš„ String Pool æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„ Hashtableï¼Œé»˜è®¤å€¼å¤§å°é•¿åº¦æ˜¯ 1009ã€‚å¦‚æœæ”¾è¿› String Pool çš„ String éå¸¸å¤šï¼Œå°±ä¼šé€ æˆ Hash å†²çªä¸¥é‡ï¼Œä»è€Œå¯¼è‡´é“¾è¡¨ä¼šå¾ˆé•¿ï¼Œè€Œé“¾è¡¨é•¿äº†åç›´æ¥ä¼šé€ æˆçš„å½±å“å°±æ˜¯å½“è°ƒç”¨<code>String.intern</code>æ—¶æ€§èƒ½ä¼šå¤§å¹…ä¸‹é™ï¼Œä½¿ç”¨<code>-XX:StringTablesize</code>å¯è®¾ç½® StringTable çš„é•¿åº¦</p><div class="alert success no-icon"><ul><li>åœ¨ jdk6 ä¸­ StringTable æ˜¯å›ºå®šçš„ï¼Œå°±æ˜¯ 1009 çš„é•¿åº¦ï¼Œæ‰€ä»¥å¦‚æœå¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²è¿‡å¤šå°±ä¼šå¯¼è‡´æ•ˆç‡ä¸‹é™å¾ˆå¿«ã€‚StringTablesize è®¾ç½®æ²¡æœ‰è¦æ±‚</li><li>åœ¨ jdk7 ä¸­ï¼ŒStringTable çš„é•¿åº¦é»˜è®¤å€¼æ˜¯ 60013ï¼ŒStringTablesize è®¾ç½®æ²¡æœ‰è¦æ±‚</li><li>åœ¨ JDK8 ä¸­ï¼Œè®¾ç½® StringTable é•¿åº¦çš„è¯ï¼Œ1009 æ˜¯å¯ä»¥è®¾ç½®çš„æœ€å°å€¼</li></ul></div><h2 id="String-å­˜å‚¨ç»“æ„å˜æ›´"><a class="header-anchor" href="#String-å­˜å‚¨ç»“æ„å˜æ›´">Â¶</a>String å­˜å‚¨ç»“æ„å˜æ›´</h2><p>åœ¨ JDK 9 åŠä»¥åï¼Œå°†åº•å±‚çš„<code>char[]</code>è½¬å˜ä¸º<code>byte[]</code></p><h3 id="Motivation"><a class="header-anchor" href="#Motivation">Â¶</a>Motivation</h3><blockquote><p>The current implementation of the <code>String</code> class stores characters in a <code>char</code> array, using two bytes (sixteen bits) for each character. Data gathered from many different applications indicates that strings are a major component of heap usage and, moreover, that most <code>String</code> objects contain only Latin-1 characters. Such characters require only one byte of storage, hence half of the space in the internal <code>char</code> arrays of such <code>String</code> objects is going unused.</p><footer><strong>JSRå®˜æ–¹æ–‡æ¡£</strong></footer></blockquote><p>ç›®å‰ String ç±»çš„å®ç°å°†å­—ç¬¦å­˜å‚¨åœ¨ä¸€ä¸ª<code>char</code>æ•°ç»„ä¸­ï¼Œ<strong>æ¯ä¸ªå­—ç¬¦ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚</strong>ï¼ˆ16 ä½ï¼‰ï¼Œä»è®¸å¤šä¸åŒçš„åº”ç”¨ä¸­æ”¶é›†åˆ°çš„æ•°æ®è¡¨æ˜ï¼Œ<strong>å­—ç¬¦ä¸²æ˜¯å †ä½¿ç”¨çš„ä¸»è¦ç»„æˆéƒ¨åˆ†</strong>ï¼Œæ­¤å¤–ï¼Œ<strong>å¤§å¤šæ•°å­—ç¬¦ä¸²å¯¹è±¡åªåŒ…å« Latin-1 å­—ç¬¦</strong>ï¼Œè¿™äº›å­—ç¬¦<strong>åªéœ€è¦ä¸€ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´</strong>ï¼Œå› æ­¤è¿™äº›å­—ç¬¦ä¸²å¯¹è±¡çš„å†…éƒ¨å­—ç¬¦æ•°ç»„ä¸­<strong>æœ‰ä¸€åŠç©ºé—´æ˜¯æµªè´¹çš„</strong></p><h3 id="Description"><a class="header-anchor" href="#Description">Â¶</a>Description</h3><blockquote><p>We propose to change the internal representation of the <code>String</code> class from a UTF-16 <code>char</code> array to a <code>byte</code> array plus an encoding-flag field. The new <code>String</code> class will store characters encoded either as ISO-8859-1/Latin-1 (one byte per character), or as UTF-16 (two bytes per character), based upon the contents of the string. The encoding flag will indicate which encoding is used.</p><p>String-related classes such as <code>AbstractStringBuilder</code>, <code>StringBuilder</code>, and <code>StringBuffer</code> will be updated to use the same representation, as will the HotSpot VMâ€™s intrinsic string operations.</p><p>This is purely an implementation change, with no changes to existing public interfaces. There are no plans to add any new public APIs or other interfaces.</p><p>The prototyping work done to date confirms the expected reduction in memory footprint, substantial reductions of GC activity, and minor performance regressions in some corner cases.</p><footer><strong>JSRå®˜æ–¹æ–‡æ¡£</strong></footer></blockquote><p>æˆ‘ä»¬å»ºè®®å°† String ç±»çš„å†…éƒ¨è¡¨ç¤ºæ–¹æ³•ä»<code>UTF-16</code><strong>å­—ç¬¦æ•°ç»„</strong>æ”¹ä¸º<strong>å­—èŠ‚æ•°ç»„åŠ ç¼–ç æ ‡å¿—åŸŸ</strong>ï¼ˆç¼–ç æ ‡å¿—å°†è¡¨æ˜ä½¿ç”¨çš„æ˜¯å“ªç§ç¼–ç ï¼‰</p><p>æ–°çš„ String ç±»å°†æ ¹æ®å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œä»¥<code>ISO-8859-1/Latin-1</code>ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸€ä¸ªå­—èŠ‚ï¼‰æˆ–<code>UTF-16</code>ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸¤ä¸ªå­—èŠ‚ï¼‰çš„æ–¹å¼å­˜å‚¨å­—ç¬¦ç¼–ç ã€‚</p><p>ä¸å­—ç¬¦ä¸²ç›¸å…³çš„ç±»ï¼Œå¦‚<code>AbstractStringBuilder</code>ã€<code>StringBuilder</code>å’Œ<code>StringBuffer</code>å°†è¢«æ›´æ–°ä»¥ä½¿ç”¨ç›¸åŒçš„è¡¨ç¤ºæ–¹æ³•ï¼ŒHotSpot VM çš„å†…åœ¨å­—ç¬¦ä¸²æ“ä½œä¹Ÿæ˜¯å¦‚æ­¤.</p><p>è¿™çº¯ç²¹æ˜¯ä¸€ä¸ªå®ç°ä¸Šçš„å˜åŒ–ï¼Œå¯¹ç°æœ‰çš„å…¬å…±æ¥å£æ²¡æœ‰å˜åŒ–ã€‚ç›®å‰æ²¡æœ‰è®¡åˆ’å¢åŠ ä»»ä½•æ–°çš„å…¬å…± API æˆ–å…¶ä»–æ¥å£,è¿„ä»Šä¸ºæ­¢æ‰€åšçš„åŸå‹è®¾è®¡å·¥ä½œè¯å®äº†å†…å­˜å ç”¨çš„é¢„æœŸå‡å°‘ï¼ŒGC æ´»åŠ¨çš„å¤§å¹…å‡å°‘ï¼Œä»¥åŠåœ¨æŸäº›è§’è½æƒ…å†µä¸‹çš„è½»å¾®æ€§èƒ½å€’é€€</p><p>ğŸ““String ä¸å†ç”¨<code>char[]</code> å­˜å‚¨æ”¹æˆäº†<code>byte[]</code>åŠ ä¸Šç¼–ç æ ‡è®°ï¼ŒèŠ‚çº¦äº†ä¸€äº›ç©ºé—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">String</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable,</span><br><span class="line">                        Comparable&lt;String&gt;, CharSequence &#123;</span><br><span class="line">    <span class="meta">@Stable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">byte</span>[] value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="String-çš„å†…å­˜åˆ†é…"><a class="header-anchor" href="#String-çš„å†…å­˜åˆ†é…">Â¶</a>String çš„å†…å­˜åˆ†é…</h2><p>åœ¨ Java è¯­è¨€ä¸­æœ‰ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹å’Œä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹ Stringã€‚è¿™äº›ç±»å‹ä¸ºäº†ä½¿å®ƒä»¬åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é€Ÿåº¦æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜ï¼Œéƒ½æä¾›äº†ä¸€ç§å¸¸é‡æ± çš„æ¦‚å¿µ.å¸¸é‡æ± å°±ç±»ä¼¼ä¸€ä¸ª Java ç³»ç»Ÿçº§åˆ«æä¾›çš„ç¼“å­˜ï¼Œ8 ç§åŸºæœ¬æ•°æ®ç±»å‹çš„å¸¸é‡æ± éƒ½æ˜¯ç³»ç»Ÿåè°ƒçš„</p><p>âœ¨String ç±»å‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„ä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ï¼š</p><div class="alert success no-icon"><ul><li>ç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜çš„<code>String</code>å¯¹è±¡ä¼šç›´æ¥å­˜å‚¨å†å¸¸é‡æ± ç§</li><li>å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„<code>String</code>å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>String</code>æä¾›çš„<code>intern()</code>æ–¹æ³•</li></ul></div><h2 id="String-table-ä½ç½®"><a class="header-anchor" href="#String-table-ä½ç½®">Â¶</a>String table ä½ç½®</h2><p>Jdk6 åŠä»¥å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ°¸ä¹…ä»£</p><p><img src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/imgjvm-stringtabl-jdk6.png" alt=""></p><p>Java 7 ä¸­ Oracle çš„å·¥ç¨‹å¸ˆå¯¹å­—ç¬¦ä¸²æ± çš„é€»è¾‘åšäº†å¾ˆå¤§çš„æ”¹å˜ï¼Œå³<strong>å°†å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½ç½®è°ƒæ•´åˆ° Java å †</strong>å†…</p><div class="alert success no-icon"><ul><li>æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½ä¿å­˜åœ¨å †ï¼ˆHeapï¼‰ä¸­ï¼Œå’Œå…¶ä»–æ™®é€šå¯¹è±¡ä¸€æ ·ï¼Œè¿™æ ·å¯ä»¥è®©ä½ åœ¨è¿›è¡Œè°ƒä¼˜åº”ç”¨æ—¶ä»…éœ€è¦è°ƒæ•´å †å¤§å°å°±å¯ä»¥äº†</li><li>å­—ç¬¦ä¸²å¸¸é‡æ± æ¦‚å¿µåŸæœ¬ä½¿ç”¨å¾—æ¯”è¾ƒå¤šï¼Œä½†æ˜¯è¿™ä¸ªæ”¹åŠ¨ä½¿å¾—æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç†ç”±è®©æˆ‘ä»¬é‡æ–°è€ƒè™‘åœ¨ Java 7 ä¸­ä½¿ç”¨<code>String.intern()</code></li></ul></div><p><img src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/imgjvm-stringtable-jdk7.png" alt=""></p><p>ğŸ¤” StringTable ä½ç½®ä¸ºä»€ä¹ˆè¦è°ƒæ•´</p><blockquote><p><strong>Synopsis:</strong> In JDK 7, interned strings are no longer allocated in the permanent generation of the Java heap, but are instead allocated in the main part of the Java heap (known as the young and old generations), along with the other objects created by the application. This change will result in more data residing in the main Java heap, and less data in the permanent generation, and thus may require heap sizes to be adjusted. Most applications will see only relatively small differences in heap usage due to this change, but larger applications that load many classes or make heavy use of the <code>String.intern()</code> method will see more significant differences.</p><footer><strong>JSRå®˜æ–¹æ–‡æ¡£</strong></footer></blockquote><p>ç®€ä»‹ï¼šåœ¨ JDK 7 ä¸­ï¼Œå†…éƒ¨å­—ç¬¦ä¸²ä¸å†åˆ†é…åœ¨ Java å †çš„æ°¸ä¹…ä»£ä¸­ï¼Œè€Œæ˜¯åˆ†é…åœ¨ Java å †çš„ä¸»è¦éƒ¨åˆ†ï¼Œä¸åº”ç”¨ç¨‹åºåˆ›å»ºçš„å…¶ä»–å¯¹è±¡ä¸€èµ·ã€‚è¿™ç§å˜åŒ–å°†å¯¼è‡´æ›´å¤šçš„æ•°æ®é©»ç•™åœ¨ä¸» Java å †ä¸­ï¼Œè€Œæ›´å°‘çš„æ•°æ®åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œå› æ­¤å¯èƒ½éœ€è¦è°ƒæ•´å †çš„å¤§å°ã€‚å¤§å¤šæ•°åº”ç”¨ç¨‹åºå°†çœ‹åˆ°ç”±äºè¿™ä¸€å˜åŒ–è€Œå¯¼è‡´çš„å †ä½¿ç”¨çš„ç›¸å¯¹è¾ƒå°çš„å·®å¼‚ï¼Œ<strong>ä½†åŠ è½½è®¸å¤šç±»æˆ–å¤§é‡ä½¿ç”¨ String.intern()æ–¹æ³•çš„å¤§å‹åº”ç”¨ç¨‹åºå°†çœ‹åˆ°æ›´æ˜æ˜¾çš„å·®å¼‚</strong></p><h2 id="å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ"><a class="header-anchor" href="#å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ">Â¶</a>å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ</h2><ul><li>å¸¸é‡ä¸å¸¸é‡çš„æ‹¼æ¥ç»“æœåœ¨å¸¸é‡æ± ï¼ŒåŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–</li><li>å¸¸é‡æ± ä¸­ä¸ä¼šå­˜åœ¨ç›¸åŒå†…å®¹çš„å˜é‡</li><li>åªè¦å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å˜é‡ï¼Œç»“æœå°±åœ¨å †ä¸­ã€‚å˜é‡æ‹¼æ¥çš„åŸç†æ˜¯ StringBuilder</li><li>å¦‚æœæ‹¼æ¥çš„ç»“æœè°ƒç”¨<code>intern()</code>æ–¹æ³•ï¼Œåˆ™ä¸»åŠ¨å°†å¸¸é‡æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥æ± ä¸­ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡åœ°å€</li></ul><p>ç¼–è¯‘å™¨ä¼˜åŒ–çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="comment">// éƒ½æ˜¯å¸¸é‡ï¼Œå‰ç«¯ç¼–è¯‘æœŸä¼šè¿›è¡Œä»£ç ä¼˜åŒ–</span></span><br><span class="line">   <span class="comment">// é€šè¿‡ideaç›´æ¥çœ‹å¯¹åº”çš„åç¼–è¯‘çš„classæ–‡ä»¶ï¼Œä¼šæ˜¾ç¤º String s1 = &quot;abc&quot;; è¯´æ˜åšäº†ä»£ç ä¼˜åŒ–</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span> + <span class="string">&quot;b&quot;</span> + <span class="string">&quot;c&quot;</span>;</span><br><span class="line">   <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">   <span class="comment">// trueï¼Œæœ‰ä¸Šè¿°å¯çŸ¥ï¼Œs1å’Œs2å®é™…ä¸ŠæŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„åŒä¸€ä¸ªå€¼</span></span><br><span class="line">   System.out.println(s1 == s2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å˜é‡ä¸å¸¸é‡é—´çš„æ‹¼æ¥æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;javaEEhadoop&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span> + <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> s1 + <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s6</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span> + s2;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s7</span> <span class="operator">=</span> s1 + s2;</span><br><span class="line"></span><br><span class="line">    System.out.println(s3 == s4); <span class="comment">// true ç¼–è¯‘æœŸä¼˜åŒ–</span></span><br><span class="line">    System.out.println(s3 == s5); <span class="comment">// false s1æ˜¯å˜é‡ï¼Œä¸èƒ½ç¼–è¯‘æœŸä¼˜åŒ–</span></span><br><span class="line">    System.out.println(s3 == s6); <span class="comment">// false s2æ˜¯å˜é‡ï¼Œä¸èƒ½ç¼–è¯‘æœŸä¼˜åŒ–</span></span><br><span class="line">    System.out.println(s3 == s7); <span class="comment">// false s1ã€s2éƒ½æ˜¯å˜é‡</span></span><br><span class="line">    System.out.println(s5 == s6); <span class="comment">// false s5ã€s6 ä¸åŒçš„å¯¹è±¡å®ä¾‹</span></span><br><span class="line">    System.out.println(s5 == s7); <span class="comment">// false s5ã€s7 ä¸åŒçš„å¯¹è±¡å®ä¾‹</span></span><br><span class="line">    System.out.println(s6 == s7); <span class="comment">// false s6ã€s7 ä¸åŒçš„å¯¹è±¡å®ä¾‹</span></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">s8</span> <span class="operator">=</span> s6.intern();</span><br><span class="line">    System.out.println(s3 == s8); <span class="comment">// true internä¹‹åï¼Œs8å’Œs3ä¸€æ ·ï¼ŒæŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„&quot;javaEEhadoop&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸å®ç”¨ final ä¿®é¥°ï¼Œå³ä¸ºå˜é‡ï¼Œå¦‚ s3 çš„æ±‚è§£ï¼Œä¼šé€šè¿‡ new StringBuilder è¿›è¡Œæ‹¼æ¥</li><li>ä½¿ç”¨<code>final</code>å…³é”®å­—ä¿®é¥°ï¼Œæœ€ç»ˆå˜é‡é€€åŒ–ä¸ºå¸¸é‡ï¼Œä¼šåœ¨ç¼–è¯‘å™¨è¿›è¡Œä»£ç ä¼˜åŒ–ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œèƒ½å¤Ÿä½¿ç”¨ final çš„åœ°æ–¹å°½é‡ä½¿ç”¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test6</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s0</span> <span class="operator">=</span> <span class="string">&quot;beijing&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;bei&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;jing&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> s1 + s2;</span><br><span class="line">    System.out.println(s0 == s3); <span class="comment">// false s3æŒ‡å‘å¯¹è±¡å®ä¾‹ï¼Œs0æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„&quot;beijing&quot;</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s7</span> <span class="operator">=</span> <span class="string">&quot;shanxi&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;shan&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> <span class="string">&quot;xi&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s6</span> <span class="operator">=</span> s4 + s5;</span><br><span class="line">    System.out.println(s6 == s7); <span class="comment">// true s4å’Œs5æ˜¯finalä¿®é¥°çš„ï¼Œç¼–è¯‘æœŸå°±èƒ½ç¡®å®šs6çš„å€¼äº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å¤§é‡çš„å®éªŒéªŒè¯ä¸‹ï¼Œé€šè¿‡ StringBuilder çš„ append æ–¹å¼çš„é€Ÿåº¦ï¼Œè¦æ¯”ç›´æ¥å¯¹ String ä½¿ç”¨<code>+</code>æ‹¼æ¥çš„æ–¹å¼å¿«å¤§çº¦ 8000 å€ï¼Œæ¯” StringBuffer çš„ append æ–¹æ³•å¿« 4 å€å·¦å³ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯¹äºéœ€è¦å¤šæ¬¡æˆ–å¤§é‡æ‹¼æ¥çš„æ“ä½œï¼Œåœ¨ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å°±åº”è¯¥å°½å¯èƒ½ä½¿ç”¨ StringBuilder è¿›è¡Œ append æ“ä½œã€‚å¹¶ä¸”å¦‚æœæå‰çŸ¥é“éœ€è¦æ‹¼æ¥ String çš„ä¸ªæ•°ï¼Œå°±åº”è¯¥ç›´æ¥ä½¿ç”¨å¸¦å‚æ„é€ å™¨æŒ‡å®š capacityï¼Œä»¥å‡å°‘æ‰©å®¹æ¬¡æ•°</p><h2 id="inter-çš„ä½¿ç”¨"><a class="header-anchor" href="#inter-çš„ä½¿ç”¨">Â¶</a>inter()çš„ä½¿ç”¨</h2><p>å½“è°ƒç”¨ intern æ–¹æ³•æ—¶ï¼Œå¦‚æœæ± å­é‡Œå·²ç»åŒ…å«äº†ä¸€ä¸ªä¸è¿™ä¸ª StrinÂ·g å¯¹è±¡ç›¸ç­‰çš„å­—ç¬¦ä¸²ï¼Œæ­£å¦‚ equals(Object)æ–¹æ³•æ‰€ç¡®å®šçš„ï¼Œé‚£ä¹ˆæ± å­é‡Œçš„å­—ç¬¦ä¸²ä¼šè¢«è¿”å›ã€‚å¦åˆ™ï¼Œè¿™ä¸ª String å¯¹è±¡è¢«æ·»åŠ åˆ°æ± ä¸­ï¼Œå¹¶è¿”å›è¿™ä¸ª String å¯¹è±¡çš„å¼•ç”¨</p><p>ç”±æ­¤å¯è§ï¼Œå¯¹äºä»»ä½•ä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ tï¼Œå½“ä¸”ä»…å½“ s.equals(t)ä¸ºçœŸæ—¶ï¼Œs.intern() == t.intern()ä¸ºçœŸï¼Œæ‰€æœ‰å­—é¢å­—ç¬¦ä¸²å’Œä»¥å­—ç¬¦ä¸²ä¸ºå€¼çš„å¸¸é‡è¡¨è¾¾å¼éƒ½æ˜¯<code>interned</code>ï¼Œè¿”å›ä¸€ä¸ªä¸æ­¤å­—ç¬¦ä¸²å†…å®¹ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œä½†ä¿è¯æ˜¯æ¥è‡ªä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²æ± </p><h2 id="G1-çš„-String-å»é‡æ“ä½œ"><a class="header-anchor" href="#G1-çš„-String-å»é‡æ“ä½œ">Â¶</a>G1 çš„ String å»é‡æ“ä½œ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//éœ€è¦s1ã€s2j</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>);</span><br></pre></td></tr></table></figure><p>string æ± å­çš„æ“ä½œï¼ŒString s = new string(â€œhello worldâ€)æœ‰å‡ ä¸ªå¯¹è±¡ç”Ÿæˆï¼Œç”Ÿæˆå¯¹è±¡çš„ s å­˜æ”¾åœ¨å“ªé‡Œ</p><h2 id="é™„å½•"><a class="header-anchor" href="#é™„å½•">Â¶</a>é™„å½•</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/niceyoo/p/11100090.html">new String(â€œ123â€) åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ydpvictor/archive/2012/09/09/2677260.html">String s=new String(â€œabcâ€)åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡?</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/limingchuan123456789/article/details/14150327">é¢è¯•é¢˜ä¹‹ String str = new String(â€œabcâ€); åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡</a><br><a target="_blank" rel="noopener" href="http://openjdk.java.net/jeps/254">å®˜æ–¹è¡¨åæ›´æ”¹ String æºç åŸå› </a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32483145/article/details/81130562">Java å‡½æ•°ä¼ å‚(String çš„ä¸å¯å˜æ€§)</a><br><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase/jdk7-relnotes.html#jdk7changes">StringTable è°ƒæ•´å®˜æ–¹è¯´æ˜</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/mad1989/article/details/26389541">StringBuffer å’Œ StringBuilder çš„åŒºåˆ«</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/baidu_27969827/article/details/79219708">String a=&quot;123&quot;åˆ›å»ºå¯¹è±¡ä¸ªæ•°é—®é¢˜</a></p></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">æ ‡ç­¾</span><br><a class="tag tag--primary tag--small t-none-link" href="/tags/JVM/" rel="tag">JVM</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/happens-before-%E5%8E%9F%E5%88%99/" data-tooltip="Happens-Before åŸåˆ™" aria-label="ä¸Šä¸€ç¯‡: Happens-Before åŸåˆ™"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">ä¸Šä¸€ç¯‡</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/c%E8%AF%AD%E8%A8%80%E9%A2%84%E5%A4%84%E7%90%86%E5%91%BD%E4%BB%A4/" data-tooltip="Cè¯­è¨€é¢„å¤„ç†å‘½ä»¤" aria-label="ä¸‹ä¸€ç¯‡: Cè¯­è¨€é¢„å¤„ç†å‘½ä»¤"><span class="hide-xs hide-sm text-small icon-mr">ä¸‹ä¸€ç¯‡</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="ç›®å½•"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></article><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2023 pineapple-man. All Rights Reserved.</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><br>Total <span id="busuanzi_value_site_pv"></span> views. æ‚¨æ˜¯pineapple-mançš„ç¬¬<span id="busuanzi_value_site_uv"></span>ä¸ªå°ä¼™ä¼´<br><i class="fas fa-book-open"></i> <span class="post-count">åšå®¢å­—æ•°ç»Ÿè®¡ï¼š370.7k</span><script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="5"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/happens-before-%E5%8E%9F%E5%88%99/" data-tooltip="Happens-Before åŸåˆ™" aria-label="ä¸Šä¸€ç¯‡: Happens-Before åŸåˆ™"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">ä¸Šä¸€ç¯‡</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/c%E8%AF%AD%E8%A8%80%E9%A2%84%E5%A4%84%E7%90%86%E5%91%BD%E4%BB%A4/" data-tooltip="Cè¯­è¨€é¢„å¤„ç†å‘½ä»¤" aria-label="ä¸‹ä¸€ç¯‡: Cè¯­è¨€é¢„å¤„ç†å‘½ä»¤"><span class="hide-xs hide-sm text-small icon-mr">ä¸‹ä¸€ç¯‡</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="ç›®å½•"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-times"></i></div><img id="about-card-picture" src="/assets/images/logo.png" alt="ä½œè€…çš„å›¾ç‰‡"><h4 id="about-card-name">pineapple-man</h4><div id="about-card-bio"><p>åšä¸€ä¸ªè èï¼šç«™å¾—ç¬”ç›´ï¼Œå¤´æˆ´ç‹å† ï¼Œå†…å¿ƒç”œç¾</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>åˆšæ¯•ä¸šå°±å¤±ä¸š</p></div><div id="about-card-location"><i class="fa fa-map-marker-alt"></i><br>è¥¿å®‰</div></div></div><div id="cover" style="background-image:url(/assets/images/cover-v1.2.0.jpg)"></div><script src="/assets/js/script-kcoiyt1nxfue7qgcpkrcixymglcc3cuxeg98fy01hqww4nblnhd2ees6j6yc.min.js"></script></body></html>