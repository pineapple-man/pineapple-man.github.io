<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="pineapple-man"><title>JJWT - pineapple-man</title><meta name="author" content="pineapple-man"><meta name="keywords" content="JJWT"><link rel="icon" href="https://pineapple-man.github.io/assets/images/logo.svg"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png"},"articleBody":"\nJWT çš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„å…¶å®ƒä¸šåŠ¡é€»è¾‘ä¿¡æ¯\nÂ¶æ¦‚è¿°\nJJWT æ—¨åœ¨æˆä¸ºæœ€æ˜“ä½¿ç”¨å’Œç†è§£çš„åº“ï¼Œç”¨äºåœ¨ JVM å’Œ Android ä¸Šåˆ›å»ºå’ŒéªŒè¯ JSON Web ä»¤ç‰Œï¼ŒJWTæœ¬èº«æ˜¯æ”¯æŒåŠ å¯†ç­¾åçš„ï¼Œåœ¨ä½¿ç”¨ç­¾åçš„JWTæ—¶ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ä¸¤ç‚¹ï¼š\n\nä¿è¯ JWT æ˜¯ç”±è®¤è¯†çš„äººåˆ›å»ºçš„ï¼ˆJWT æ˜¯çœŸå®çš„ï¼‰\nä¿è¯åœ¨åˆ›å»º JWT ä¹‹åæ²¡æœ‰æ“çºµæˆ–æ”¹å˜ JWTï¼ˆä¿æŒå…¶å®Œæ•´æ€§ï¼‰\n\n\nçœŸå®æ€§å’Œå®Œæ•´æ€§ ä¿è¯JWTåŒ…å«å¯ä»¥ä¿¡ä»»çš„ä¿¡æ¯ã€‚ å¦‚æœJWTæœªé€šè¿‡çœŸå®æ€§æˆ–å®Œæ•´æ€§æ£€æŸ¥ï¼Œåº”è¯¥å§‹ç»ˆæ‹’ç»JWTï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ä¿¡ä»»å®ƒ\nÂ¶Hello World\nä»ç„¶æŒ‰ç…§å¸¸è§çš„å¥—è·¯ï¼ˆä¾èµ–ï¼ŒHelloWorldï¼Œè¯¦ç»†æ¦‚å¿µï¼‰ä¸‰æ­¥éª¤å­¦ä¹ ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“\nÂ¶ä¾èµ–\n1234567891011121314151617&lt;dependency&gt;    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;    &lt;artifactId&gt;jjwt-api&lt;/artifactId&gt;    &lt;version&gt;0.10.5&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;    &lt;artifactId&gt;jjwt-impl&lt;/artifactId&gt;    &lt;version&gt;0.10.5&lt;/version&gt;    &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;    &lt;artifactId&gt;jjwt-jackson&lt;/artifactId&gt;    &lt;version&gt;0.10.5&lt;/version&gt;    &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;\nÂ¶åˆ›å»º JWT\n12345678public static void main(String[] args) &#123;\t\tSecretKey key = Keys.secretKeyFor(SignatureAlgorithm.HS256);\t\tString jws = Jwts.builder()            .setSubject(&quot;pineapple-man&quot;).signWith(key)            .compact();\t\tSystem.out.println(jws);    /**eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJwaW5lYXBwbGUtbWFuIn0.moDrltTQbK9mhQflt8_KfVtQY-5NrZg4uvRyz5k-DzQ*/&#125;\nä¸Šè¿°ä»£ç ä¸­ï¼Œæ„å»ºäº†ä¸€ä¸ªä¸»é¢˜ä¸ºpineapple-mançš„ JWTï¼Œä½¿ç”¨çš„æ˜¯HMAC-SHA-256ç®—æ³•çš„å¯†é’¥å¯¹ JWT è¿›è¡Œç­¾åï¼Œå¹¶åœ¨æœ€ç»ˆå°†å®ƒå‹ç¼©æˆ String å½¢å¼\nÂ¶è§£æ JWT\n12345678public static void main(String[] args) &#123;\tSecretKey key = Keys.secretKeyFor(SignatureAlgorithm.HS256);\tString jws = Jwts.builder().setSubject(&quot;pineapple-man&quot;).signWith(key).compact();\tSystem.out.println(jws);       //è§£æSystem.out.println(Jwts.parser().setSigningKey(key).parseClaimsJws(jws)\t\t\t.getBody().getSubject().equals(&quot;pineapple-man&quot;));&#125;\nå°†ä¹‹å‰çš„å¯†é’¥ç”¨äºéªŒè¯JWTçš„ç­¾åï¼Œå¦‚æœå®ƒæ— æ³•éªŒè¯JWTï¼Œåˆ™æŠ›å‡ºSignatureExceptionã€‚å¦‚æœåœ¨åš JWT è§£ææ—¶ï¼Œå‘ç”Ÿäº†éªŒè¯å¤±è´¥çš„ç°è±¡ï¼Œå¯ä»¥é€šè¿‡æ•è·JwtExceptionå¼‚å¸¸æ¥è‡ªå®šä¹‰å¤±è´¥æƒ…å†µä¸‹çš„å¤„ç†\n123456try &#123;    Jwts.parser().setSigningKey(key).parseClaimsJws(compactJws);    //OK, we can trust this JWT&#125; catch (JwtException e) &#123;    //don&#x27;t trust the JWT!&#125;\nÂ¶JWS\nJWS å°±æ˜¯å·²ç»ç­¾åçš„ JWTï¼Œä¸‹é¢å±•ç¤ºäº†å¦‚ä½•æ‰‹åŠ¨å®ç° JWS\n12345678910111213//å¤´éƒ¨ä¿¡æ¯String header = &quot;&#123;&#x27;alg&#x27;:&#x27;HS256&#x27;&#125;&quot;;String claims = &quot;&#123;&#x27;sub&#x27;:&#x27;pineapple-man&#x27;&#125;&quot;;//å¯¹ä»–ä»¬åˆ†åˆ«è¿›è¡Œ`UTF_8`ç¼–ç ï¼šbyte[] encodedHeader = Base64.getEncoder().encode(header.getBytes(StandardCharsets.UTF_8));byte[] encodedClaims = Base64.getEncoder().encode(claims.getBytes(StandardCharsets.UTF_8));//å°†ç¼–ç åçš„Headerå’ŒBodyä½¿ç”¨.è¿›è¡Œåˆ†éš”ï¼Œå¹¶è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²String concatenated = Arrays.toString(encodedHeader) + &quot;.&quot; + Arrays.toString(encodedClaims);//ä½¿ç”¨åŠ å¯†ç§é’¥ï¼Œé€‰æ‹©ç­¾åç®—æ³•ï¼ˆæ­¤å¤„ä½¿ç”¨HMAC-SHA-256ï¼‰ï¼Œå¹¶å¯¹è¿æ¥çš„å­—ç¬¦ä¸²è¿›è¡Œç­¾åKey key = getMySecretKey()byte[] signature = hmacSha256( concatenated, key )//ç”±äºç­¾åå§‹ç»ˆç»“æœæ˜¯å­—èŠ‚æ•°ç»„ï¼Œå› æ­¤Base64URLå¯¹ç­¾åè¿›è¡Œç¼–ç å¹¶ä½¿ç”¨.å°†å®ƒè¿æ¥åˆ°å­—ç¬¦ä¸²concatenatedåé¢String jws = concatenated + &#x27;.&#x27; + Base64.getEncoder().encode( signature )\nä»¥ä¸Šå°±æ˜¯ JWSï¼ˆå·²ç»ç­¾åçš„ JWTï¼‰ç”Ÿæˆè¿‡ç¨‹çš„å®ç°æ–¹å¼\nÂ¶åˆ›å»º JWS\nå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼åˆ›å»ºJWSï¼š\n\nä½¿ç”¨Jwts.builder()æ–¹æ³•åˆ›å»ºJwtBuilderå®ä¾‹\nè°ƒç”¨JwtBuilderæ–¹æ³•æ ¹æ®éœ€è¦æ·»åŠ æ ‡å¤´å‚æ•°å’Œå£°æ˜\næŒ‡å®šè¦ç”¨äºå¯¹JWTè¿›è¡Œç­¾åçš„SecretKeyæˆ–éå¯¹ç§°PrivateKey\nè°ƒç”¨compact()æ–¹æ³•è¿›è¡Œå‹ç¼©å’Œç­¾åï¼Œç”Ÿæˆæœ€ç»ˆçš„jws\n\n12345String jws = Jwts.builder() \t// (1)    .setSubject(&quot;pineapple-man&quot;)      \t// (2)    .signWith(key)          \t// (3)    .compact();             \t// (4)\nÂ¶è®¾ç½® Header Parameters\nJWT Headeræä¾›å…³äºJWT Claimsç›¸å…³çš„å†…å®¹ï¼Œæ ¼å¼å’ŒåŠ å¯†æ“ä½œçš„å…ƒæ•°æ®\nå¦‚æœéœ€è¦è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªJWTå¤´å‚æ•°ï¼Œåˆ™å¯ä»¥æ ¹æ®éœ€è¦ç®€å•åœ°å¤šæ¬¡è°ƒç”¨JwtBuilder.setHeaderParam\n123String jws = Jwts.builder()    .setHeaderParam(&quot;kid&quot;, &quot;myKeyId&quot;)    // ... etc ...\næ¯æ¬¡è°ƒç”¨setHeaderParamæ—¶ï¼Œå®ƒåªæ˜¯å°†é”®å€¼å¯¹é™„åŠ åˆ°å†…éƒ¨Headerå®ä¾‹ï¼Œå¦‚æœé”®å€¼å·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–ä»»ä½•ç°æœ‰çš„åŒåé”®/å€¼å¯¹\nğŸ¶ä¸éœ€è¦è®¾ç½®algæˆ–zipæ ‡å¤´å‚æ•°ï¼Œå› ä¸ºJJWTä¼šæ ¹æ®ä½¿ç”¨çš„ç­¾åç®—æ³•æˆ–å‹ç¼©ç®—æ³•è‡ªåŠ¨è®¾ç½®å®ƒä»¬\n\né™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹å¼ï¼Œè®¾ç½®JWT Headerï¼Œç”±äºç¬¬ä¸€ç§æ–¹å¼èƒ½å¤Ÿå®Œæˆå¸¸è§çš„ä¸šåŠ¡åœºæ™¯ï¼Œå…¶ä½™çš„æ–¹å¼è¿™é‡Œå¹¶ä¸é˜è¿°\nÂ¶è®¾ç½® Claims\nClaimsæ˜¯JWTçš„æ­£æ–‡éƒ¨åˆ†ï¼ŒåŒ…å«JWTåˆ›å»ºè€…å¸Œæœ›å‘JWTæ”¶ä»¶äººæä¾›çš„ä¿¡æ¯ï¼Œå¸¸è§çš„ API å¦‚ä¸‹\n\n\n\nAPI\nå«ä¹‰\n\n\n\n\nsetIssuer\nsets the iss (Issuer) Claim\n\n\nsetSubject\nsets the sub (Subject) Claim\n\n\nsetAudience\nsets the aud (Audience) Claim\n\n\nsetExpiration\nsets the exp (Expiration Time) Claim\n\n\nsetNotBefore\nsets the nbf (Not Before) Claim\n\n\nsetIssuedAt\nsets the iat (Issued At) Claim\n\n\nsetId\nsets the jti (JWT ID) Claim\n\n\n\n12345678910String jws = Jwts.builder()    .setIssuer(&quot;me&quot;)    .setSubject(&quot;Bob&quot;)    .setAudience(&quot;you&quot;)    .setExpiration(expiration) \t//a java.util.Date    .setNotBefore(notBefore) \t//a java.util.Date    .setIssuedAt(new Date()) \t// for example, now    .setId(UUID.randomUUID()) \t//just an example id    /// ... etc ...\nå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ Claimsï¼Œå¦‚æœéœ€è¦è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªä¸ä¸Šé¢æ˜¾ç¤ºçš„æ ‡å‡† setter æ–¹æ³•å£°æ˜ä¸åŒ¹é…çš„è‡ªå®šä¹‰å£°æ˜ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å¤šæ¬¡è°ƒç”¨JwtBuilde.claim å£°æ˜ï¼š\n123String jws = Jwts.builder()    .claim(&quot;hello&quot;, &quot;world&quot;)    // ... etc ...\næ¯æ¬¡è°ƒç”¨claimæ—¶ï¼Œå®ƒåªæ˜¯å°†é”®å€¼å¯¹é™„åŠ åˆ°å†…éƒ¨claimså®ä¾‹ï¼Œå¦‚æœé”®å€¼å·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–ä»»ä½•ç°æœ‰çš„åŒåkey/valueå¯¹ï¼ŒåŒå¤´éƒ¨ä¿¡æ¯ä¸€æ ·\nÂ¶ç­¾å\nJWT è§„èŒƒç¡®å®šäº† 12 ç§æ ‡å‡†ç­¾åç®—æ³•ï¼Œä¸‰ç§å¯†é’¥ç®—æ³•å’Œä¹ç§éå¯¹ç§°å¯†é’¥ç®—æ³•ï¼Œç”±äºä¹Ÿä¸æ˜¯åšå¯†ç å­¦çš„è¿™é‡Œä¹Ÿä¸è¿‡å¤šå±•å¼€ã€‚è‡ªå·±é¡¹ç›®ä¸­å¸¸è§çš„ä½¿ç”¨HMAC-SHA-256å°±è¶³å¤Ÿäº†\nğŸ‘´å»ºè®®é€šè¿‡è°ƒç”¨JwtBuilderçš„signWithæ–¹æ³•æ¥æŒ‡å®šç­¾åå¯†é’¥ï¼Œä»¥åŠå¯¹åº”çš„æ‘˜è¦ç®—æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š\n1234String jws = Jwts.builder()   // ... etc ...   .signWith(key) // &lt;---   .compact();\nä½¿ç”¨signWithæ—¶ï¼ŒJJWTè¿˜ä¼šè‡ªåŠ¨ä½¿ç”¨ç›¸å…³çš„ç®—æ³•æ ‡è¯†ç¬¦è®¾ç½®æ‰€éœ€çš„algå¤´ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœä½¿ç”¨é•¿åº¦ä¸º 4096 ä½çš„RSA PrivateKeyè°ƒç”¨signWithï¼ŒJJWTå°†ä½¿ç”¨RS512ç®—æ³•å¹¶è‡ªåŠ¨å°†algå¤´è®¾ç½®ä¸ºRS512\nğŸ¶ä¸èƒ½ç”¨PublicKeysç­¾ç½²JWTï¼Œå› ä¸ºè¿™æ€»æ˜¯ä¸å®‰å…¨çš„ã€‚ JJWTå°†æ‹’ç»ä»»ä½•æŒ‡å®šçš„PublicKeyçš„æ–¹å¼ç­¾åï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ï¼šInvalidKeyException\n\nÂ¶è§£æ JWS\nâ›µè§£æ JWS æ­¥éª¤å¦‚ä¸‹ï¼š\n\nä½¿ç”¨Jwts.parser()æ–¹æ³•åˆ›å»ºJwtParserå®ä¾‹\næŒ‡å®šè¦ç”¨äºéªŒè¯JWSç­¾åçš„SecretKeyæˆ–éå¯¹ç§°PublicKey\nè°ƒç”¨parseClaimsJws(String)æ–¹æ³•ï¼Œç”ŸæˆåŸå§‹JWS\n\nğŸ¶å¦‚ä¹‹å‰æ‰€è¿°ï¼Œæ•´ä¸ªè°ƒç”¨å°†åŒ…è£…åœ¨try/catchå—ä¸­ï¼Œä»¥é˜²è§£ææˆ–ç­¾åéªŒè¯å¤±è´¥\n12345678910Jws&lt;Claims&gt; jws;try &#123;    jws = Jwts.parser()         \t// (1)    .setSigningKey(key)         \t// (2)    .parseClaimsJws(jwsString); \t// (3)    // we can safely trust the JWTcatch (JwtException ex) &#123;    // we cannot use the JWT as intended by its creator&#125;\nÂ¶æ ¡éªŒ Key\né˜…è¯»JWSæ—¶ï¼Œæœ€é‡è¦çš„äº‹æƒ…æ˜¯æŒ‡å®šç”¨äºéªŒè¯ JWS åŠ å¯†ç­¾åçš„å¯†é’¥ã€‚ å¦‚æœç­¾åéªŒè¯å¤±è´¥ï¼Œåˆ™æ— æ³•å®‰å…¨åœ°ä¿¡ä»»æ­¤JWTï¼Œåº”å°†å…¶ä¸¢å¼ƒã€‚å¦‚æœjwsæ˜¯ä½¿ç”¨SecretKeyç­¾åçš„ï¼Œåˆ™åº”åœ¨JwtParserä¸ŠæŒ‡å®šç›¸åŒçš„SecretKey\n123Jwts.parser()  .setSigningKey(secretKey) // &lt;----  .parseClaimsJws(jwsString);\nå¦‚æœjwsæ˜¯ä½¿ç”¨PrivateKeyç­¾åçš„ï¼Œé‚£ä¹ˆåº”è¯¥åœ¨JwtParserä¸ŠæŒ‡å®šè¯¥å¯†é’¥ç›¸åº”çš„PublicKeyï¼ˆä¸æ˜¯PrivateKeyï¼‰\n123Jwts.parser()  .setSigningKey(publicKey) // &lt;---- publicKey, not privateKey  .parseClaimsJws(jwsString);\nâ“å¦‚æœåº”ç”¨ç¨‹åºä¸æ­¢ä½¿ç”¨ä¸€ä¸ª SecretKey æˆ– KeyPair ä¼šæ€ä¹ˆæ ·ï¼Ÿ å¦‚æœå¯ä»¥ä½¿ç”¨ä¸åŒçš„ SecretKeys æˆ–å…¬é’¥/ç§é’¥æˆ–ä¸¤è€…çš„ç»„åˆåˆ›å»º JWSï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ\nåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ— æ³•ä½¿ç”¨å•ä¸ªé”®è°ƒç”¨JwtParserçš„setSigningKeyæ–¹æ³•ã€‚ç›¸åï¼Œéœ€è¦ä½¿ç”¨SigningKeyResolveræ–¹æ³•æŒ‡å®šè§£æ JWS æ–¹æ³•\n\n12345//å®ç°äº† SigningKeyResolver æ¥å£çš„è‡ªå®šä¹‰è§£æç±»SigningKeyResolver signingKeyResolver = getMySigningKeyResolver();Jwts.parser()    .setSigningKeyResolver(signingKeyResolver) // &lt;----    .parseClaimsJws(jwsString);\né€šè¿‡å®ç°SigningKeyResolverAdapteræ¥å£çš„resolveSigningKey(JwsHeaderï¼ŒClaims)æ–¹æ³•æ¥ç®€åŒ–ä¸€äº›äº‹æƒ…\n123456public class MySigningKeyResolver extends SigningKeyResolverAdapter &#123;    @Override    public Key resolveSigningKey(JwsHeader jwsHeader, Claims claims) &#123;        // implement    &#125;&#125;\nåœ¨è§£æJWS JSONä¹‹åï¼ŒJwtParserå°†åœ¨éªŒè¯jwsç­¾åä¹‹å‰è°ƒç”¨resolveSigningKey()æ–¹æ³•ã€‚ è¿™ä¹Ÿå°±å…è®¸æ£€æŸ¥Jws Headerå’ŒClaimså‚æ•°ï¼Œä»¥å¸®åŠ©æŸ¥æ‰¾ç”¨äºéªŒè¯ç‰¹å®šjwsçš„å¯†é’¥çš„ä¿¡æ¯ã€‚ è¿™å¯¹äºå¤æ‚å®‰å…¨æ¨¡å‹çš„åº”ç”¨ç¨‹åºéå¸¸å¼ºå¤§ï¼Œè¿™äº›å®‰å…¨æ¨¡å‹å¯èƒ½åœ¨ä¸åŒæ—¶é—´ä½¿ç”¨ä¸åŒçš„å¯†é’¥æˆ–é’ˆå¯¹ä¸åŒçš„ç”¨æˆ·æˆ–å®¢ã€‚JWTè§„èŒƒæ”¯æŒçš„æ–¹æ³•æ˜¯åœ¨åˆ›å»ºJWSæ—¶ï¼Œåœ¨JWSå¤´ä¸­è®¾ç½®kidï¼ˆKey IDï¼‰å­—æ®µï¼Œä¾‹å¦‚ï¼š\n123456Key signingKey = getSigningKey();String keyId = getKeyId(signingKey); \t\t//any mechanism you have to associate a key with an ID is fineString jws = Jwts.builder()    .setHeaderParam(JwsHeader.KEY_ID, keyId) // 1    .signWith(signingKey)                    // 2    .compact();\nç„¶ååœ¨è§£ææœŸé—´ï¼ŒSigningKeyResolverå¯ä»¥æ£€æŸ¥JwsHeaderä»¥è·å–è¯¥kidï¼Œç„¶åä½¿ç”¨è¯¥å€¼ä»æŸä¸ªä½ç½®æŸ¥æ‰¾å¯†é’¥ï¼Œå¦‚æ•°æ®åº“ã€‚ ä¾‹å¦‚ï¼š\n123456789public class MySigningKeyResolver extends SigningKeyResolverAdapter &#123;    @Override    public Key resolveSigningKey(JwsHeader jwsHeader, Claims claims) &#123;        //inspect the header or claims, lookup and return the signing key        String keyId = jwsHeader.getKeyId(); \t//or any other field that you need to inspect        Key key = lookupVerificationKey(keyId); //implement me        return key;    &#125;&#125;\nğŸ¶æ£€æŸ¥jwsHeader.getKeyId()åªæ˜¯æŸ¥æ‰¾å¯†é’¥çš„æœ€å¸¸ç”¨æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ£€æŸ¥ä»»æ„æ•°é‡çš„æ ‡å¤´å­—æ®µæˆ–å£°æ˜ï¼Œä»¥ç¡®å®šå¦‚ä½•æŸ¥æ‰¾éªŒè¯å¯†é’¥ã€‚\nÂ¶Claims æ–­è¨€\nå¦‚æœæ­£åœ¨è§£æçš„JWSå…·æœ‰ç‰¹å®šçš„å­subå€¼ï¼Œå¯ä»¥ä½¿ç”¨JwtParserä¸Šçš„å„ç§require *æ–¹æ³•æ¥è·å–æ•°æ®\n12345try &#123;    Jwts.parser().requireSubject(&quot;pineapple-man&quot;).setSigningKey(key).parseClaimsJws(s);&#125; catch(InvalidClaimException ice) &#123;    // the sub field was missing or did not have a &#x27;pineapple-man&#x27; value&#125;\nå¦‚æœç¼ºå°‘æŸä¸ªå€¼ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ•è·InvalidClaimExceptionï¼Œè€Œæ˜¯æ•è·MissingClaimExceptionæˆ–IncorrectClaimExceptionå¼‚å¸¸\n1234567try &#123;    Jwts.parser().requireSubject(&quot;pineapple-man&quot;).setSigningKey(key).parseClaimsJws(s);&#125; catch(MissingClaimException mce) &#123;    // the parsed JWT did not have the sub field&#125; catch(IncorrectClaimException ice) &#123;    // the parsed JWT had a sub field, but its value was not equal to &#x27;pineapple-man&#x27;&#125;\nå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨require(fieldNameï¼ŒrequiredFieldValue)æ–¹æ³•æ¥è·å–è‡ªå®šä¹‰å­—æ®µã€‚\n12345try &#123;\tJwts.parser().require(&quot;field&quot;,&quot;requiredValue&quot;).setSigningKey(key).parseClaimsJws(s);&#125; catch(InvalidClaimException ice) &#123;    // the &#x27;myfield&#x27; field was missing or did not have a &#x27;myRequiredValue&#x27; value&#125;\nÂ¶å‹ç¼©\nå¦‚æœJWTçš„ClaimåŸŸå¯ä»¥è¶³å¤Ÿå¤§ï¼ŒåŒ…å«è®¸å¤škey/valueå¯¹ï¼›æˆ–è€…å•ä¸ªå€¼éå¸¸å†—é•¿ï¼Œå¯ä»¥é€šè¿‡å‹ç¼©æ¥å‡å°åˆ›å»ºçš„JWSçš„å¤§å°\nä¾‹å¦‚ï¼šå¦‚æœåœ¨URLä¸­ä½¿ç”¨ç”Ÿæˆçš„JWSï¼Œå‹ç¼©å°†å¾ˆé‡è¦ï¼Œå› ä¸ºæµè§ˆå™¨ï¼Œç”¨æˆ·é‚®ä»¶ä»£ç†æˆ– HTTP ç½‘å…³å…¼å®¹æ€§é—®é¢˜ï¼ŒURLæœ€å¥½ä¿æŒåœ¨4096ä¸ªå­—ç¬¦ä»¥ä¸‹ï¼Œæ‰€ä»¥è¾ƒå°çš„JWTæœ‰åŠ©äºé™ä½å¸¦å®½åˆ©ç”¨ç‡\n\nÂ¶é»˜è®¤å‹ç¼©\nå¦‚æœè¦å‹ç¼©JWTï¼Œå¯ä»¥ä½¿ç”¨JwtBuilder çš„compressWith(CompressionAlgorithm)æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼š\n123Jwts.builder()   .compressWith(CompressionCodecs.DEFLATE) // or CompressionCodecs.GZIP   // .. etc ...\nä½¿ç”¨DEFLATEæˆ–GZIPå‹ç¼©ç¼–è§£ç å™¨ï¼Œä½†æ˜¯åœ¨è§£å‹ç¼©æ—¶ï¼Œä¸å¿…æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä¸éœ€è¦é…ç½®JwtParserï¼ŒJJWTå°†æŒ‰é¢„æœŸè‡ªåŠ¨è§£å‹ç¼©ä¸»ä½“\nÂ¶è‡ªå®šä¹‰å‹ç¼©\nå¦‚æœåœ¨åˆ›å»ºJWTæ—¶ä½¿ç”¨è‡ªå·±çš„è‡ªå®šä¹‰å‹ç¼©ç¼–è§£ç å™¨ï¼ˆé€šè¿‡JwtBuilder.compressWithï¼‰ï¼Œåˆ™éœ€è¦ä½¿ç”¨setCompressionCodecResolveræ–¹æ³•å°†ç¼–è§£ç å™¨æä¾›ç»™JwtParserã€‚ ä¾‹å¦‚ï¼š\n1234CompressionCodecResolver ccr = new MyCompressionCodecResolver();Jwts.parser()    .setCompressionCodecResolver(ccr) // &lt;----    // .. etc ...\né€šå¸¸ï¼ŒCompressionCodecResolverå®ç°å°†æ£€æŸ¥zipæ ‡å¤´ä»¥æ‰¾å‡ºä½¿ç”¨çš„ç®—æ³•ï¼Œç„¶åè¿”å›æ”¯æŒè¯¥ç®—æ³•çš„ç¼–è§£ç å™¨å®ä¾‹ã€‚ ä¾‹å¦‚ï¼š\n123456789101112public class MyCompressionCodecResolver implements CompressionCodecResolver &#123;    @Override    public CompressionCodec resolveCompressionCodec(Header header) throws CompressionException &#123;        String alg = header.getCompressionAlgorithm();        CompressionCodec codec = getCompressionCodec(alg); //implement        return codec;    &#125;&#125;\nÂ¶é™„å½•\nJava Web Token ä¹‹ JJWT ä½¿ç”¨\n","dateCreated":"2021-11-27T04:08:32+00:00","dateModified":"2023-06-07T02:13:34+00:00","datePublished":"2021-11-27T04:08:32+00:00","description":"æœ¬æ–‡ä¸»è¦è®²è§£å¦‚ä½•ä½¿ç”¨ JJWT è¿›è¡Œ JWT","headline":"JJWT","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://pineapple-man.github.io/jjwt/"},"publisher":{"@type":"Organization","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png","logo":{"@type":"ImageObject","url":"logo.png"}},"url":"https://pineapple-man.github.io/jjwt/","keywords":"ä¸­é—´ä»¶"}</script><meta name="description" content="æœ¬æ–‡ä¸»è¦è®²è§£å¦‚ä½•ä½¿ç”¨ JJWT è¿›è¡Œ JWT"><meta property="og:type" content="blog"><meta property="og:title" content="JJWT"><meta property="og:url" content="https://pineapple-man.github.io/jjwt/"><meta property="og:site_name" content="pineapple-man"><meta property="og:description" content="æœ¬æ–‡ä¸»è¦è®²è§£å¦‚ä½•ä½¿ç”¨ JJWT è¿›è¡Œ JWT"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2021-11-27T04:08:32.000Z"><meta property="article:modified_time" content="2023-06-07T02:13:34.015Z"><meta property="article:author" content="pineapple-man"><meta property="article:tag" content="ä¸­é—´ä»¶"><meta name="twitter:card" content="summary"><meta property="og:image" content="https://pineapple-man.github.io/assets/images/logo.png"><link rel="stylesheet" href="/assets/css/style-oth3meuzcjopbgwqbdvoxqknhcm0sy9wkullcc94zhkkop3pmfrpl5t4fzzz.min.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-210516333-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-210516333-1")</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"></head><body><div id="blog"><header id="header" data-behavior="5"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/" aria-label="">pineapple-man</a></div><a class="header-right-picture" href="#about" aria-label="æ‰“å¼€é“¾æ¥: /#about"><img class="header-picture" src="/assets/images/logo.png" alt="ä½œè€…çš„å›¾ç‰‡"></a></header><nav id="sidebar" data-behavior="5"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about" aria-label="é˜…è¯»æœ‰å…³ä½œè€…çš„æ›´å¤šä¿¡æ¯"><img class="sidebar-profile-picture" src="/assets/images/logo.png" alt="ä½œè€…çš„å›¾ç‰‡"></a><h4 class="sidebar-profile-name">pineapple-man</h4><h5 class="sidebar-profile-bio"><p>åšä¸€ä¸ªè èï¼šç«™å¾—ç¬”ç›´ï¼Œå¤´æˆ´ç‹å† ï¼Œå†…å¿ƒç”œç¾</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/" rel="noopener" title="é¦–é¡µ"><i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i> <span class="sidebar-button-desc">é¦–é¡µ</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories" rel="noopener" title="åˆ†ç±»"><i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i> <span class="sidebar-button-desc">åˆ†ç±»</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags" rel="noopener" title="æ ‡ç­¾"><i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i> <span class="sidebar-button-desc">æ ‡ç­¾</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives" rel="noopener" title="å½’æ¡£"><i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i> <span class="sidebar-button-desc">å½’æ¡£</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about" rel="noopener" title="å…³äº"><i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i> <span class="sidebar-button-desc">å…³äº</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/pineapple-man" target="_blank" rel="noopener" title="GitHub"><i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto://mingchaohu720@gmail.com" target="_blank" rel="noopener" title="é‚®ç®±"><i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i> <span class="sidebar-button-desc">é‚®ç®±</span></a></li></ul></div></nav><div id="main" data-behavior="5" class="hasCoverMetaIn"><article class="post"><div class="post-header main-content-wrap text-center"><h1 class="post-title">JJWT</h1><div class="post-meta"><time datetime="2021-11-27T04:08:32+00:00">11æœˆ 27, 2021 </time><span>å‘å¸ƒåœ¨ </span><a class="category-link" href="/categories/Java/">Java</a> <i class="fas fa-book-open"></i> æœ¬æ–‡å…±<span class="post-count"> 2.7k </span>å­— <i class="far fa-clock"></i> é˜…è¯»é¢„è®¡<span class="post-count"> 29 </span>åˆ†é’Ÿ</div></div><div class="post-content markdown"><div class="main-content-wrap"><h1 id="table-of-contents">ç›®å½•</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-text">æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hello-World"><span class="toc-text">Hello World</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96"><span class="toc-text">ä¾èµ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-JWT"><span class="toc-text">åˆ›å»º JWT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90-JWT"><span class="toc-text">è§£æ JWT</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JWS"><span class="toc-text">JWS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-JWS"><span class="toc-text">åˆ›å»º JWS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-Header-Parameters"><span class="toc-text">è®¾ç½® Header Parameters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-Claims"><span class="toc-text">è®¾ç½® Claims</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D"><span class="toc-text">ç­¾å</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90-JWS"><span class="toc-text">è§£æ JWS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C-Key"><span class="toc-text">æ ¡éªŒ Key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Claims-%E6%96%AD%E8%A8%80"><span class="toc-text">Claims æ–­è¨€</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9"><span class="toc-text">å‹ç¼©</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%8E%8B%E7%BC%A9"><span class="toc-text">é»˜è®¤å‹ç¼©</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8E%8B%E7%BC%A9"><span class="toc-text">è‡ªå®šä¹‰å‹ç¼©</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-text">é™„å½•</span></a></li></ol><p>JWT çš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„å…¶å®ƒä¸šåŠ¡é€»è¾‘ä¿¡æ¯</p><h2 id="æ¦‚è¿°"><a class="header-anchor" href="#æ¦‚è¿°">Â¶</a>æ¦‚è¿°</h2><p>JJWT æ—¨åœ¨æˆä¸ºæœ€æ˜“ä½¿ç”¨å’Œç†è§£çš„åº“ï¼Œç”¨äºåœ¨ JVM å’Œ Android ä¸Šåˆ›å»ºå’ŒéªŒè¯ JSON Web ä»¤ç‰Œï¼Œ<code>JWT</code>æœ¬èº«æ˜¯æ”¯æŒåŠ å¯†ç­¾åçš„ï¼Œåœ¨ä½¿ç”¨ç­¾åçš„<code>JWT</code>æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ä¸¤ç‚¹ï¼š</p><div class="alert success no-icon"><ul><li>ä¿è¯ JWT æ˜¯ç”±è®¤è¯†çš„äººåˆ›å»ºçš„ï¼ˆJWT æ˜¯çœŸå®çš„ï¼‰</li><li>ä¿è¯åœ¨åˆ›å»º JWT ä¹‹åæ²¡æœ‰æ“çºµæˆ–æ”¹å˜ JWTï¼ˆä¿æŒå…¶å®Œæ•´æ€§ï¼‰</li></ul></div><p><code>çœŸå®æ€§</code>å’Œ<code>å®Œæ•´æ€§</code> ä¿è¯<code>JWT</code>åŒ…å«å¯ä»¥ä¿¡ä»»çš„ä¿¡æ¯ã€‚ å¦‚æœ<code>JWT</code>æœªé€šè¿‡<strong>çœŸå®æ€§</strong>æˆ–<strong>å®Œæ•´æ€§</strong>æ£€æŸ¥ï¼Œåº”è¯¥å§‹ç»ˆæ‹’ç»<code>JWT</code>ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ä¿¡ä»»å®ƒ</p><h2 id="Hello-World"><a class="header-anchor" href="#Hello-World">Â¶</a>Hello World</h2><p>ä»ç„¶æŒ‰ç…§å¸¸è§çš„å¥—è·¯ï¼ˆä¾èµ–ï¼ŒHelloWorldï¼Œè¯¦ç»†æ¦‚å¿µï¼‰ä¸‰æ­¥éª¤å­¦ä¹ ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“</p><h3 id="ä¾èµ–"><a class="header-anchor" href="#ä¾èµ–">Â¶</a>ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-JWT"><a class="header-anchor" href="#åˆ›å»º-JWT">Â¶</a>åˆ›å»º JWT</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">SecretKey</span> <span class="variable">key</span> <span class="operator">=</span> Keys.secretKeyFor(SignatureAlgorithm.HS256);</span><br><span class="line">		<span class="type">String</span> <span class="variable">jws</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">            .setSubject(<span class="string">&quot;pineapple-man&quot;</span>).signWith(key)</span><br><span class="line">            .compact();</span><br><span class="line">		System.out.println(jws);</span><br><span class="line">    <span class="comment">/**eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJwaW5lYXBwbGUtbWFuIn0.moDrltTQbK9mhQflt8_KfVtQY-5NrZg4uvRyz5k-DzQ*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œæ„å»ºäº†ä¸€ä¸ªä¸»é¢˜ä¸º<code>pineapple-man</code>çš„ JWTï¼Œä½¿ç”¨çš„æ˜¯<code>HMAC-SHA-256</code>ç®—æ³•çš„å¯†é’¥å¯¹ JWT è¿›è¡Œç­¾åï¼Œå¹¶åœ¨æœ€ç»ˆå°†å®ƒå‹ç¼©æˆ String å½¢å¼</p><h3 id="è§£æ-JWT"><a class="header-anchor" href="#è§£æ-JWT">Â¶</a>è§£æ JWT</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">SecretKey</span> <span class="variable">key</span> <span class="operator">=</span> Keys.secretKeyFor(SignatureAlgorithm.HS256);</span><br><span class="line">	<span class="type">String</span> <span class="variable">jws</span> <span class="operator">=</span> Jwts.builder().setSubject(<span class="string">&quot;pineapple-man&quot;</span>).signWith(key).compact();</span><br><span class="line">	System.out.println(jws);</span><br><span class="line">       <span class="comment">//è§£æ</span></span><br><span class="line">System.out.println(Jwts.parser().setSigningKey(key).parseClaimsJws(jws)</span><br><span class="line">			.getBody().getSubject().equals(<span class="string">&quot;pineapple-man&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†ä¹‹å‰çš„å¯†é’¥ç”¨äºéªŒè¯<code>JWT</code>çš„ç­¾åï¼Œå¦‚æœå®ƒæ— æ³•éªŒè¯<code>JWT</code>ï¼Œåˆ™æŠ›å‡º<code>SignatureException</code>ã€‚å¦‚æœåœ¨åš JWT è§£ææ—¶ï¼Œå‘ç”Ÿäº†éªŒè¯å¤±è´¥çš„ç°è±¡ï¼Œå¯ä»¥é€šè¿‡æ•è·<code>JwtException</code>å¼‚å¸¸æ¥è‡ªå®šä¹‰å¤±è´¥æƒ…å†µä¸‹çš„å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Jwts.parser().setSigningKey(key).parseClaimsJws(compactJws);</span><br><span class="line">    <span class="comment">//OK, we can trust this JWT</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">    <span class="comment">//don&#x27;t trust the JWT!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="JWS"><a class="header-anchor" href="#JWS">Â¶</a>JWS</h2><p>JWS å°±æ˜¯å·²ç»ç­¾åçš„ JWTï¼Œä¸‹é¢å±•ç¤ºäº†å¦‚ä½•æ‰‹åŠ¨å®ç° JWS</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¤´éƒ¨ä¿¡æ¯</span></span><br><span class="line">String header = <span class="string">&quot;&#123;&#x27;alg&#x27;:&#x27;HS256&#x27;&#125;&quot;</span>;</span><br><span class="line">String claims = <span class="string">&quot;&#123;&#x27;sub&#x27;:&#x27;pineapple-man&#x27;&#125;&quot;</span>;</span><br><span class="line"><span class="comment">//å¯¹ä»–ä»¬åˆ†åˆ«è¿›è¡Œ`UTF_8`ç¼–ç ï¼š</span></span><br><span class="line">byte<span class="punctuation">[</span><span class="punctuation">]</span> encodedHeader = Base64.getEncoder().encode(header.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">byte<span class="punctuation">[</span><span class="punctuation">]</span> encodedClaims = Base64.getEncoder().encode(claims.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"><span class="comment">//å°†ç¼–ç åçš„Headerå’ŒBodyä½¿ç”¨.è¿›è¡Œåˆ†éš”ï¼Œå¹¶è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">String concatenated = Arrays.toString(encodedHeader) + <span class="string">&quot;.&quot;</span> + Arrays.toString(encodedClaims);</span><br><span class="line"><span class="comment">//ä½¿ç”¨åŠ å¯†ç§é’¥ï¼Œé€‰æ‹©ç­¾åç®—æ³•ï¼ˆæ­¤å¤„ä½¿ç”¨HMAC-SHA-256ï¼‰ï¼Œå¹¶å¯¹è¿æ¥çš„å­—ç¬¦ä¸²è¿›è¡Œç­¾å</span></span><br><span class="line">Key key = getMySecretKey()</span><br><span class="line">byte<span class="punctuation">[</span><span class="punctuation">]</span> signature = hmacSha256( concatenated<span class="punctuation">,</span> key )</span><br><span class="line"><span class="comment">//ç”±äºç­¾åå§‹ç»ˆç»“æœæ˜¯å­—èŠ‚æ•°ç»„ï¼Œå› æ­¤Base64URLå¯¹ç­¾åè¿›è¡Œç¼–ç å¹¶ä½¿ç”¨.å°†å®ƒè¿æ¥åˆ°å­—ç¬¦ä¸²concatenatedåé¢</span></span><br><span class="line">String jws = concatenated + &#x27;.&#x27; + Base64.getEncoder().encode( signature )</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯ JWSï¼ˆå·²ç»ç­¾åçš„ JWTï¼‰ç”Ÿæˆè¿‡ç¨‹çš„å®ç°æ–¹å¼</p><h3 id="åˆ›å»º-JWS"><a class="header-anchor" href="#åˆ›å»º-JWS">Â¶</a>åˆ›å»º JWS</h3><p>å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼åˆ›å»º<code>JWS</code>ï¼š</p><ol><li>ä½¿ç”¨<code>Jwts.builder()</code>æ–¹æ³•åˆ›å»º<code>JwtBuilder</code>å®ä¾‹</li><li>è°ƒç”¨<code>JwtBuilder</code>æ–¹æ³•æ ¹æ®éœ€è¦æ·»åŠ æ ‡å¤´å‚æ•°å’Œå£°æ˜</li><li>æŒ‡å®šè¦ç”¨äºå¯¹<code>JWT</code>è¿›è¡Œç­¾åçš„<code>SecretKey</code>æˆ–<code>éå¯¹ç§°PrivateKey</code></li><li>è°ƒç”¨<code>compact()</code>æ–¹æ³•è¿›è¡Œå‹ç¼©å’Œç­¾åï¼Œç”Ÿæˆæœ€ç»ˆçš„<code>jws</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jws</span> <span class="operator">=</span> Jwts.builder() 	<span class="comment">// (1)</span></span><br><span class="line">    .setSubject(<span class="string">&quot;pineapple-man&quot;</span>)      	<span class="comment">// (2)</span></span><br><span class="line">    .signWith(key)          	<span class="comment">// (3)</span></span><br><span class="line">    .compact();             	<span class="comment">// (4)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®-Header-Parameters"><a class="header-anchor" href="#è®¾ç½®-Header-Parameters">Â¶</a>è®¾ç½® Header Parameters</h4><p><code>JWT Header</code>æä¾›å…³äº<code>JWT Claims</code>ç›¸å…³çš„å†…å®¹ï¼Œæ ¼å¼å’ŒåŠ å¯†æ“ä½œçš„å…ƒæ•°æ®</p><p>å¦‚æœéœ€è¦è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª<code>JWT</code>å¤´å‚æ•°ï¼Œåˆ™å¯ä»¥æ ¹æ®éœ€è¦ç®€å•åœ°å¤šæ¬¡è°ƒç”¨<code>JwtBuilder.setHeaderParam</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jws</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">    .setHeaderParam(<span class="string">&quot;kid&quot;</span>, <span class="string">&quot;myKeyId&quot;</span>)</span><br><span class="line">    <span class="comment">// ... etc ...</span></span><br></pre></td></tr></table></figure><p>æ¯æ¬¡è°ƒç”¨<code>setHeaderParam</code>æ—¶ï¼Œå®ƒåªæ˜¯å°†é”®å€¼å¯¹é™„åŠ åˆ°å†…éƒ¨<code>Header</code>å®ä¾‹ï¼Œå¦‚æœé”®å€¼å·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–ä»»ä½•ç°æœ‰çš„åŒåé”®/å€¼å¯¹</p><div class="alert info no-icon"><p>ğŸ¶ä¸éœ€è¦è®¾ç½®<code>alg</code>æˆ–<code>zip</code>æ ‡å¤´å‚æ•°ï¼Œå› ä¸º<code>JJWT</code>ä¼šæ ¹æ®ä½¿ç”¨çš„ç­¾åç®—æ³•æˆ–å‹ç¼©ç®—æ³•è‡ªåŠ¨è®¾ç½®å®ƒä»¬</p></div><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹å¼ï¼Œè®¾ç½®<code>JWT Header</code>ï¼Œç”±äºç¬¬ä¸€ç§æ–¹å¼èƒ½å¤Ÿå®Œæˆå¸¸è§çš„ä¸šåŠ¡åœºæ™¯ï¼Œå…¶ä½™çš„æ–¹å¼è¿™é‡Œå¹¶ä¸é˜è¿°</p><h4 id="è®¾ç½®-Claims"><a class="header-anchor" href="#è®¾ç½®-Claims">Â¶</a>è®¾ç½® Claims</h4><p><code>Claims</code>æ˜¯<code>JWT</code>çš„æ­£æ–‡éƒ¨åˆ†ï¼ŒåŒ…å«<code>JWT</code>åˆ›å»ºè€…å¸Œæœ›å‘<code>JWT</code>æ”¶ä»¶äººæä¾›çš„ä¿¡æ¯ï¼Œå¸¸è§çš„ API å¦‚ä¸‹</p><table><thead><tr><th style="text-align:center">API</th><th style="text-align:center">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center"><code>setIssuer</code></td><td style="text-align:center">sets the <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519#section-4.1.1"><code>iss</code> (Issuer) Claim</a></td></tr><tr><td style="text-align:center"><code>setSubject</code></td><td style="text-align:center">sets the <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519#section-4.1.2"><code>sub</code> (Subject) Claim</a></td></tr><tr><td style="text-align:center"><code>setAudience</code></td><td style="text-align:center">sets the <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519#section-4.1.3"><code>aud</code> (Audience) Claim</a></td></tr><tr><td style="text-align:center"><code>setExpiration</code></td><td style="text-align:center">sets the <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519#section-4.1.4"><code>exp</code> (Expiration Time) Claim</a></td></tr><tr><td style="text-align:center"><code>setNotBefore</code></td><td style="text-align:center">sets the <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519#section-4.1.5"><code>nbf</code> (Not Before) Claim</a></td></tr><tr><td style="text-align:center"><code>setIssuedAt</code></td><td style="text-align:center">sets the <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519#section-4.1.6"><code>iat</code> (Issued At) Claim</a></td></tr><tr><td style="text-align:center"><code>setId</code></td><td style="text-align:center">sets the <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519#section-4.1.7"><code>jti</code> (JWT ID) Claim</a></td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jws</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">    .setIssuer(<span class="string">&quot;me&quot;</span>)</span><br><span class="line">    .setSubject(<span class="string">&quot;Bob&quot;</span>)</span><br><span class="line">    .setAudience(<span class="string">&quot;you&quot;</span>)</span><br><span class="line">    .setExpiration(expiration) 	<span class="comment">//a java.util.Date</span></span><br><span class="line">    .setNotBefore(notBefore) 	<span class="comment">//a java.util.Date</span></span><br><span class="line">    .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>()) 	<span class="comment">// for example, now</span></span><br><span class="line">    .setId(UUID.randomUUID()) 	<span class="comment">//just an example id</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// ... etc ...</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ Claimsï¼Œå¦‚æœéœ€è¦è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªä¸ä¸Šé¢æ˜¾ç¤ºçš„æ ‡å‡† setter æ–¹æ³•å£°æ˜ä¸åŒ¹é…çš„è‡ªå®šä¹‰å£°æ˜ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å¤šæ¬¡è°ƒç”¨<code>JwtBuilde.claim</code> å£°æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jws</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">    .claim(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)</span><br><span class="line">    <span class="comment">// ... etc ...</span></span><br></pre></td></tr></table></figure><p>æ¯æ¬¡è°ƒç”¨<code>claim</code>æ—¶ï¼Œå®ƒåªæ˜¯å°†é”®å€¼å¯¹é™„åŠ åˆ°å†…éƒ¨<code>claims</code>å®ä¾‹ï¼Œå¦‚æœé”®å€¼å·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–ä»»ä½•ç°æœ‰çš„åŒå<code>key/value</code>å¯¹ï¼ŒåŒå¤´éƒ¨ä¿¡æ¯ä¸€æ ·</p><h4 id="ç­¾å"><a class="header-anchor" href="#ç­¾å">Â¶</a>ç­¾å</h4><p>JWT è§„èŒƒç¡®å®šäº† 12 ç§æ ‡å‡†ç­¾åç®—æ³•ï¼Œä¸‰ç§å¯†é’¥ç®—æ³•å’Œä¹ç§éå¯¹ç§°å¯†é’¥ç®—æ³•ï¼Œç”±äºä¹Ÿä¸æ˜¯åšå¯†ç å­¦çš„è¿™é‡Œä¹Ÿä¸è¿‡å¤šå±•å¼€ã€‚è‡ªå·±é¡¹ç›®ä¸­å¸¸è§çš„ä½¿ç”¨<code>HMAC-SHA-256</code>å°±è¶³å¤Ÿäº†</p><p>ğŸ‘´å»ºè®®é€šè¿‡è°ƒç”¨<code>JwtBuilder</code>çš„<code>signWith</code>æ–¹æ³•æ¥æŒ‡å®šç­¾åå¯†é’¥ï¼Œä»¥åŠå¯¹åº”çš„æ‘˜è¦ç®—æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jws</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">   <span class="comment">// ... etc ...</span></span><br><span class="line">   .signWith(key) <span class="comment">// &lt;---</span></span><br><span class="line">   .compact();</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>signWith</code>æ—¶ï¼Œ<code>JJWT</code>è¿˜ä¼šè‡ªåŠ¨ä½¿ç”¨ç›¸å…³çš„ç®—æ³•æ ‡è¯†ç¬¦è®¾ç½®æ‰€éœ€çš„<code>alg</code>å¤´ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœä½¿ç”¨é•¿åº¦ä¸º 4096 ä½çš„<code>RSA PrivateKey</code>è°ƒç”¨<code>signWith</code>ï¼Œ<code>JJWT</code>å°†ä½¿ç”¨<code>RS512</code>ç®—æ³•å¹¶è‡ªåŠ¨å°†<code>alg</code>å¤´è®¾ç½®ä¸º<code>RS512</code></p><div class="alert info no-icon"><p>ğŸ¶ä¸èƒ½ç”¨<code>PublicKeys</code>ç­¾ç½²<code>JWT</code>ï¼Œå› ä¸ºè¿™æ€»æ˜¯ä¸å®‰å…¨çš„ã€‚ <code>JJWT</code>å°†æ‹’ç»ä»»ä½•æŒ‡å®šçš„<code>PublicKey</code>çš„æ–¹å¼ç­¾åï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ï¼š<code>InvalidKeyException</code></p></div><h3 id="è§£æ-JWS"><a class="header-anchor" href="#è§£æ-JWS">Â¶</a>è§£æ JWS</h3><p>â›µè§£æ JWS æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>ä½¿ç”¨<code>Jwts.parser()</code>æ–¹æ³•åˆ›å»º<code>JwtParser</code>å®ä¾‹</li><li>æŒ‡å®šè¦ç”¨äºéªŒè¯<code>JWS</code>ç­¾åçš„<code>SecretKey</code>æˆ–<code>éå¯¹ç§°PublicKey</code></li><li>è°ƒç”¨<code>parseClaimsJws(String)</code>æ–¹æ³•ï¼Œç”ŸæˆåŸå§‹<code>JWS</code></li></ol><p>ğŸ¶å¦‚ä¹‹å‰æ‰€è¿°ï¼Œæ•´ä¸ªè°ƒç”¨å°†åŒ…è£…åœ¨<code>try/catch</code>å—ä¸­ï¼Œä»¥é˜²è§£ææˆ–ç­¾åéªŒè¯å¤±è´¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Jws&lt;Claims&gt; jws;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    jws = Jwts.parser()         	<span class="comment">// (1)</span></span><br><span class="line">    .setSigningKey(key)         	<span class="comment">// (2)</span></span><br><span class="line">    .parseClaimsJws(jwsString); 	<span class="comment">// (3)</span></span><br><span class="line">    <span class="comment">// we can safely trust the JWT</span></span><br><span class="line"><span class="keyword">catch</span> (JwtException ex) &#123;</span><br><span class="line">    <span class="comment">// we cannot use the JWT as intended by its creator</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æ ¡éªŒ-Key"><a class="header-anchor" href="#æ ¡éªŒ-Key">Â¶</a>æ ¡éªŒ Key</h4><p>é˜…è¯»<code>JWS</code>æ—¶ï¼Œæœ€é‡è¦çš„äº‹æƒ…æ˜¯æŒ‡å®šç”¨äºéªŒè¯ JWS åŠ å¯†ç­¾åçš„<strong>å¯†é’¥</strong>ã€‚ å¦‚æœç­¾åéªŒè¯å¤±è´¥ï¼Œåˆ™æ— æ³•å®‰å…¨åœ°ä¿¡ä»»æ­¤<code>JWT</code>ï¼Œåº”å°†å…¶ä¸¢å¼ƒã€‚å¦‚æœ<code>jws</code>æ˜¯ä½¿ç”¨<code>SecretKey</code>ç­¾åçš„ï¼Œåˆ™åº”åœ¨<code>JwtParser</code>ä¸ŠæŒ‡å®š<strong>ç›¸åŒ</strong>çš„<code>SecretKey</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Jwts.parser()</span><br><span class="line">  .setSigningKey(secretKey) <span class="comment">// &lt;----</span></span><br><span class="line">  .parseClaimsJws(jwsString);</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>jws</code>æ˜¯ä½¿ç”¨<code>PrivateKey</code>ç­¾åçš„ï¼Œé‚£ä¹ˆåº”è¯¥åœ¨<code>JwtParser</code>ä¸ŠæŒ‡å®šè¯¥å¯†é’¥<strong>ç›¸åº”</strong>çš„<code>PublicKey</code>ï¼ˆä¸æ˜¯<code>PrivateKey</code>ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Jwts.parser()</span><br><span class="line">  .setSigningKey(publicKey) <span class="comment">// &lt;---- publicKey, not privateKey</span></span><br><span class="line">  .parseClaimsJws(jwsString);</span><br></pre></td></tr></table></figure><p>â“å¦‚æœåº”ç”¨ç¨‹åºä¸æ­¢ä½¿ç”¨ä¸€ä¸ª SecretKey æˆ– KeyPair ä¼šæ€ä¹ˆæ ·ï¼Ÿ å¦‚æœå¯ä»¥ä½¿ç”¨ä¸åŒçš„ SecretKeys æˆ–å…¬é’¥/ç§é’¥æˆ–ä¸¤è€…çš„ç»„åˆåˆ›å»º JWSï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p><div class="alert success no-icon"><p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ— æ³•ä½¿ç”¨å•ä¸ªé”®è°ƒç”¨<code>JwtParser</code>çš„<code>setSigningKey</code>æ–¹æ³•ã€‚ç›¸åï¼Œéœ€è¦ä½¿ç”¨<code>SigningKeyResolver</code>æ–¹æ³•æŒ‡å®šè§£æ JWS æ–¹æ³•</p></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ç°äº† SigningKeyResolver æ¥å£çš„è‡ªå®šä¹‰è§£æç±»</span></span><br><span class="line"><span class="type">SigningKeyResolver</span> <span class="variable">signingKeyResolver</span> <span class="operator">=</span> getMySigningKeyResolver();</span><br><span class="line">Jwts.parser()</span><br><span class="line">    .setSigningKeyResolver(signingKeyResolver) <span class="comment">// &lt;----</span></span><br><span class="line">    .parseClaimsJws(jwsString);</span><br></pre></td></tr></table></figure><p>é€šè¿‡å®ç°<code>SigningKeyResolverAdapter</code>æ¥å£çš„<code>resolveSigningKey(JwsHeaderï¼ŒClaims)</code>æ–¹æ³•æ¥ç®€åŒ–ä¸€äº›äº‹æƒ…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySigningKeyResolver</span> <span class="keyword">extends</span> <span class="title class_">SigningKeyResolverAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Key <span class="title function_">resolveSigningKey</span><span class="params">(JwsHeader jwsHeader, Claims claims)</span> &#123;</span><br><span class="line">        <span class="comment">// implement</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è§£æ<code>JWS JSON</code>ä¹‹åï¼Œ<code>JwtParser</code>å°†åœ¨éªŒè¯<code>jws</code>ç­¾åä¹‹å‰è°ƒç”¨<code>resolveSigningKey()</code>æ–¹æ³•ã€‚ è¿™ä¹Ÿå°±å…è®¸æ£€æŸ¥<code>Jws Header</code>å’Œ<code>Claims</code>å‚æ•°ï¼Œä»¥å¸®åŠ©æŸ¥æ‰¾ç”¨äºéªŒè¯ç‰¹å®š<code>jws</code>çš„å¯†é’¥çš„ä¿¡æ¯ã€‚ <strong>è¿™å¯¹äºå¤æ‚å®‰å…¨æ¨¡å‹çš„åº”ç”¨ç¨‹åºéå¸¸å¼ºå¤§ï¼Œè¿™äº›å®‰å…¨æ¨¡å‹å¯èƒ½åœ¨ä¸åŒæ—¶é—´ä½¿ç”¨ä¸åŒçš„å¯†é’¥æˆ–é’ˆå¯¹ä¸åŒçš„ç”¨æˆ·æˆ–å®¢</strong>ã€‚<code>JWT</code>è§„èŒƒæ”¯æŒçš„æ–¹æ³•æ˜¯åœ¨åˆ›å»º<code>JWS</code>æ—¶ï¼Œåœ¨<code>JWS</code>å¤´ä¸­è®¾ç½®<code>kidï¼ˆKey IDï¼‰</code>å­—æ®µï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Key</span> <span class="variable">signingKey</span> <span class="operator">=</span> getSigningKey();</span><br><span class="line"><span class="type">String</span> <span class="variable">keyId</span> <span class="operator">=</span> getKeyId(signingKey); 		<span class="comment">//any mechanism you have to associate a key with an ID is fine</span></span><br><span class="line"><span class="type">String</span> <span class="variable">jws</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">    .setHeaderParam(JwsHeader.KEY_ID, keyId) <span class="comment">// 1</span></span><br><span class="line">    .signWith(signingKey)                    <span class="comment">// 2</span></span><br><span class="line">    .compact();</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨è§£ææœŸé—´ï¼Œ<code>SigningKeyResolver</code>å¯ä»¥æ£€æŸ¥<code>JwsHeader</code>ä»¥è·å–è¯¥<code>kid</code>ï¼Œç„¶å<strong>ä½¿ç”¨è¯¥å€¼ä»æŸä¸ªä½ç½®æŸ¥æ‰¾å¯†é’¥ï¼Œå¦‚æ•°æ®åº“</strong>ã€‚ ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySigningKeyResolver</span> <span class="keyword">extends</span> <span class="title class_">SigningKeyResolverAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Key <span class="title function_">resolveSigningKey</span><span class="params">(JwsHeader jwsHeader, Claims claims)</span> &#123;</span><br><span class="line">        <span class="comment">//inspect the header or claims, lookup and return the signing key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">keyId</span> <span class="operator">=</span> jwsHeader.getKeyId(); 	<span class="comment">//or any other field that you need to inspect</span></span><br><span class="line">        <span class="type">Key</span> <span class="variable">key</span> <span class="operator">=</span> lookupVerificationKey(keyId); <span class="comment">//implement me</span></span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸ¶æ£€æŸ¥<code>jwsHeader.getKeyId()</code>åªæ˜¯æŸ¥æ‰¾å¯†é’¥çš„æœ€å¸¸ç”¨æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ£€æŸ¥ä»»æ„æ•°é‡çš„æ ‡å¤´å­—æ®µæˆ–å£°æ˜ï¼Œä»¥ç¡®å®šå¦‚ä½•æŸ¥æ‰¾éªŒè¯å¯†é’¥ã€‚</p><h4 id="Claims-æ–­è¨€"><a class="header-anchor" href="#Claims-æ–­è¨€">Â¶</a>Claims æ–­è¨€</h4><p>å¦‚æœæ­£åœ¨è§£æçš„<code>JWS</code>å…·æœ‰ç‰¹å®šçš„å­<code>sub</code>å€¼ï¼Œå¯ä»¥ä½¿ç”¨<code>JwtParser</code>ä¸Šçš„å„ç§<code>require *</code>æ–¹æ³•æ¥è·å–æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Jwts.parser().requireSubject(<span class="string">&quot;pineapple-man&quot;</span>).setSigningKey(key).parseClaimsJws(s);</span><br><span class="line">&#125; <span class="keyword">catch</span>(InvalidClaimException ice) &#123;</span><br><span class="line">    <span class="comment">// the sub field was missing or did not have a &#x27;pineapple-man&#x27; value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç¼ºå°‘æŸä¸ªå€¼ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ•è·<code>InvalidClaimException</code>ï¼Œè€Œæ˜¯æ•è·<code>MissingClaimException</code>æˆ–<code>IncorrectClaimException</code>å¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Jwts.parser().requireSubject(<span class="string">&quot;pineapple-man&quot;</span>).setSigningKey(key).parseClaimsJws(s);</span><br><span class="line">&#125; <span class="keyword">catch</span>(MissingClaimException mce) &#123;</span><br><span class="line">    <span class="comment">// the parsed JWT did not have the sub field</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(IncorrectClaimException ice) &#123;</span><br><span class="line">    <span class="comment">// the parsed JWT had a sub field, but its value was not equal to &#x27;pineapple-man&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>require(fieldNameï¼ŒrequiredFieldValue)</code>æ–¹æ³•æ¥è·å–è‡ªå®šä¹‰å­—æ®µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	Jwts.parser().require(<span class="string">&quot;field&quot;</span>,<span class="string">&quot;requiredValue&quot;</span>).setSigningKey(key).parseClaimsJws(s);</span><br><span class="line">&#125; <span class="keyword">catch</span>(InvalidClaimException ice) &#123;</span><br><span class="line">    <span class="comment">// the &#x27;myfield&#x27; field was missing or did not have a &#x27;myRequiredValue&#x27; value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‹ç¼©"><a class="header-anchor" href="#å‹ç¼©">Â¶</a>å‹ç¼©</h3><p>å¦‚æœ<code>JWT</code>çš„<code>Claim</code>åŸŸå¯ä»¥è¶³å¤Ÿå¤§ï¼ŒåŒ…å«è®¸å¤š<code>key/value</code>å¯¹ï¼›æˆ–è€…å•ä¸ªå€¼éå¸¸å†—é•¿ï¼Œå¯ä»¥é€šè¿‡<strong>å‹ç¼©æ¥å‡å°åˆ›å»ºçš„<code>JWS</code>çš„å¤§å°</strong></p><div class="alert warning no-icon"><p>ä¾‹å¦‚ï¼šå¦‚æœåœ¨<code>URL</code>ä¸­ä½¿ç”¨ç”Ÿæˆçš„<code>JWS</code>ï¼Œå‹ç¼©å°†å¾ˆé‡è¦ï¼Œå› ä¸ºæµè§ˆå™¨ï¼Œç”¨æˆ·é‚®ä»¶ä»£ç†æˆ– HTTP ç½‘å…³å…¼å®¹æ€§é—®é¢˜ï¼Œ<code>URL</code>æœ€å¥½ä¿æŒåœ¨<code>4096</code>ä¸ªå­—ç¬¦ä»¥ä¸‹ï¼Œæ‰€ä»¥è¾ƒå°çš„<code>JWT</code>æœ‰åŠ©äºé™ä½å¸¦å®½åˆ©ç”¨ç‡</p></div><h4 id="é»˜è®¤å‹ç¼©"><a class="header-anchor" href="#é»˜è®¤å‹ç¼©">Â¶</a>é»˜è®¤å‹ç¼©</h4><p>å¦‚æœè¦å‹ç¼©<code>JWT</code>ï¼Œå¯ä»¥ä½¿ç”¨<code>JwtBuilde</code>r çš„<code>compressWith(CompressionAlgorithm)</code>æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Jwts.builder()</span><br><span class="line">   .compressWith(CompressionCodecs.DEFLATE) <span class="comment">// or CompressionCodecs.GZIP</span></span><br><span class="line">   <span class="comment">// .. etc ...</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>DEFLATE</code>æˆ–<code>GZIP</code>å‹ç¼©ç¼–è§£ç å™¨ï¼Œä½†æ˜¯åœ¨è§£å‹ç¼©æ—¶ï¼Œä¸å¿…æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä¸éœ€è¦é…ç½®<code>JwtParser</code>ï¼Œ<code>JJWT</code>å°†æŒ‰é¢„æœŸè‡ªåŠ¨è§£å‹ç¼©ä¸»ä½“</p><h4 id="è‡ªå®šä¹‰å‹ç¼©"><a class="header-anchor" href="#è‡ªå®šä¹‰å‹ç¼©">Â¶</a>è‡ªå®šä¹‰å‹ç¼©</h4><p>å¦‚æœåœ¨åˆ›å»º<code>JWT</code>æ—¶ä½¿ç”¨è‡ªå·±çš„è‡ªå®šä¹‰å‹ç¼©ç¼–è§£ç å™¨ï¼ˆé€šè¿‡<code>JwtBuilder.compressWith</code>ï¼‰ï¼Œåˆ™éœ€è¦ä½¿ç”¨<code>setCompressionCodecResolver</code>æ–¹æ³•å°†ç¼–è§£ç å™¨æä¾›ç»™<code>JwtParser</code>ã€‚ ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CompressionCodecResolver</span> <span class="variable">ccr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCompressionCodecResolver</span>();</span><br><span class="line">Jwts.parser()</span><br><span class="line">    .setCompressionCodecResolver(ccr) <span class="comment">// &lt;----</span></span><br><span class="line">    <span class="comment">// .. etc ...</span></span><br></pre></td></tr></table></figure><p>é€šå¸¸ï¼Œ<code>CompressionCodecResolver</code>å®ç°å°†æ£€æŸ¥<code>zip</code>æ ‡å¤´ä»¥æ‰¾å‡ºä½¿ç”¨çš„ç®—æ³•ï¼Œç„¶åè¿”å›æ”¯æŒè¯¥ç®—æ³•çš„ç¼–è§£ç å™¨å®ä¾‹ã€‚ ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCompressionCodecResolver</span> <span class="keyword">implements</span> <span class="title class_">CompressionCodecResolver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CompressionCodec <span class="title function_">resolveCompressionCodec</span><span class="params">(Header header)</span> <span class="keyword">throws</span> CompressionException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">alg</span> <span class="operator">=</span> header.getCompressionAlgorithm();</span><br><span class="line"></span><br><span class="line">        <span class="type">CompressionCodec</span> <span class="variable">codec</span> <span class="operator">=</span> getCompressionCodec(alg); <span class="comment">//implement</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> codec;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é™„å½•"><a class="header-anchor" href="#é™„å½•">Â¶</a>é™„å½•</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41540822/article/details/88781964">Java Web Token ä¹‹ JJWT ä½¿ç”¨</a></p></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">æ ‡ç­¾</span><br><a class="tag tag--primary tag--small t-none-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">ä¸­é—´ä»¶</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" data-tooltip="æƒé™æ§åˆ¶è§£å†³æ–¹æ¡ˆ" aria-label="ä¸Šä¸€ç¯‡: æƒé™æ§åˆ¶è§£å†³æ–¹æ¡ˆ"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">ä¸Šä¸€ç¯‡</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/mybatis-%E5%8A%A8%E6%80%81sql/" data-tooltip="MyBatis åŠ¨æ€Sql" aria-label="ä¸‹ä¸€ç¯‡: MyBatis åŠ¨æ€Sql"><span class="hide-xs hide-sm text-small icon-mr">ä¸‹ä¸€ç¯‡</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="ç›®å½•"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></article><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2023 pineapple-man. All Rights Reserved.</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><br>Total <span id="busuanzi_value_site_pv"></span> views. æ‚¨æ˜¯pineapple-mançš„ç¬¬<span id="busuanzi_value_site_uv"></span>ä¸ªå°ä¼™ä¼´<br><i class="fas fa-book-open"></i> <span class="post-count">åšå®¢å­—æ•°ç»Ÿè®¡ï¼š370.7k</span><script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="5"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" data-tooltip="æƒé™æ§åˆ¶è§£å†³æ–¹æ¡ˆ" aria-label="ä¸Šä¸€ç¯‡: æƒé™æ§åˆ¶è§£å†³æ–¹æ¡ˆ"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">ä¸Šä¸€ç¯‡</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/mybatis-%E5%8A%A8%E6%80%81sql/" data-tooltip="MyBatis åŠ¨æ€Sql" aria-label="ä¸‹ä¸€ç¯‡: MyBatis åŠ¨æ€Sql"><span class="hide-xs hide-sm text-small icon-mr">ä¸‹ä¸€ç¯‡</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="ç›®å½•"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-times"></i></div><img id="about-card-picture" src="/assets/images/logo.png" alt="ä½œè€…çš„å›¾ç‰‡"><h4 id="about-card-name">pineapple-man</h4><div id="about-card-bio"><p>åšä¸€ä¸ªè èï¼šç«™å¾—ç¬”ç›´ï¼Œå¤´æˆ´ç‹å† ï¼Œå†…å¿ƒç”œç¾</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>åˆšæ¯•ä¸šå°±å¤±ä¸š</p></div><div id="about-card-location"><i class="fa fa-map-marker-alt"></i><br>è¥¿å®‰</div></div></div><div id="cover" style="background-image:url(/assets/images/cover-v1.2.0.jpg)"></div><script src="/assets/js/script-kcoiyt1nxfue7qgcpkrcixymglcc3cuxeg98fy01hqww4nblnhd2ees6j6yc.min.js"></script></body></html>