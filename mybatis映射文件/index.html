<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="pineapple-man"><title>MyBatis映射文件 - pineapple-man</title><meta name="author" content="pineapple-man"><meta name="keywords" content="MyBatis映射文件"><link rel="icon" href="https://pineapple-man.github.io/assets/images/logo.svg"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png"},"articleBody":"\n¶XML 映射器\nMyBatis 的真正强大在于它的语句映射，SQL 映射文件只有很少的几个顶级元素（根据应被定义的顺序列出）：\n\n\n\n标签\n含义\n\n\n\n\ncache\n该命名空间的缓存配置\n\n\ncache-ref\n引用其他命令空间的缓存配置\n\n\nresultMap\n描述如何从数据库结果集中加载对象，时最复杂也是最强大的元素\n\n\nsql\n可被其它语句引用的可重用语句块\n\n\ninsert\n映射插入语句\n\n\nupdate\n映射更新语句\n\n\ndelete\n映射删除语句\n\n\nselect\n映射查询语句\n\n\n\n¶&lt;select&gt;\n多数应用都是查询密集型，所以先从查询开始\n🎶 MyBatis 的基本原则之一是：在每个插入、更新或删除操作之间，通常会执行多个查询操作\n¶常见配置\n123&lt;select id=&quot;selectPerson&quot; parameterType=&quot;int&quot; resultType=&quot;hashmap&quot;&gt;  SELECT * FROM PERSON WHERE ID = #&#123;id&#125;&lt;/select&gt;\n✨语句特点\n\n这个语句名是selectPerson\n接受一个int(Integer)类型的参数\n返回一个HashMap类型的对象，其中键是列名，值便是结果行中的对应值\n参数使用#&#123;&#125;进行获取\n\n¶底层设计\n以上的查询语句，其实就是告诉 MyBatis 创建一个预处理语句(PreparedStatement)参数\n123String selectPerson = &quot;SELECT * FROM PERSON WHERE ID=?&quot;;PreparedStatement ps = conn.prepareStatement(selectPerson);ps.setInt(1,id);\n¶属性\nselect 元素可以配置很多属性来配置每条语句的行为细节\n123456789101112&lt;select  id=&quot;selectPerson&quot;  parameterType=&quot;int&quot;  parameterMap=&quot;deprecated&quot;  resultType=&quot;hashmap&quot;  resultMap=&quot;personResultMap&quot;  flushCache=&quot;false&quot;  useCache=&quot;true&quot;  timeout=&quot;10&quot;  fetchSize=&quot;256&quot;  statementType=&quot;PREPARED&quot;  resultSetType=&quot;FORWARD_ONLY&quot;&gt;\n\n\n\n属性\n描述\n\n\n\n\nresultType\n期望从这条语句中返回结果的类全限定名或别名。 注意，如果返回的是集合，那应该设置为集合包含的类型，而不是集合本身的类型。 resultType 和 resultMap 之间只能同时使用一个。\n\n\n\n¶insert,update&amp;delete\n数据变更语句 insert，update 和 delete 的实现非常接近：\n1234567891011121314151617181920212223&lt;insert  id=&quot;insertAuthor&quot;  parameterType=&quot;domain.blog.Author&quot;  flushCache=&quot;true&quot;  statementType=&quot;PREPARED&quot;  keyProperty=&quot;&quot;  keyColumn=&quot;&quot;  useGeneratedKeys=&quot;&quot;  timeout=&quot;20&quot;&gt;&lt;update  id=&quot;updateAuthor&quot;  parameterType=&quot;domain.blog.Author&quot;  flushCache=&quot;true&quot;  statementType=&quot;PREPARED&quot;  timeout=&quot;20&quot;&gt;&lt;delete  id=&quot;deleteAuthor&quot;  parameterType=&quot;domain.blog.Author&quot;  flushCache=&quot;true&quot;  statementType=&quot;PREPARED&quot;  timeout=&quot;20&quot;&gt;\n¶获取自增主键的值\nmysql 支持自增主键，自增主键值的获取，mybatis 利用statement.getGeneratedKeys()\nuseGenerateKeys=&quot;true&quot;使用自增主键获取主键值策略\nkeyProperty指定对应的主键属性，也就是 mybatis 获取到主键值以后，将这个值封装给 javabean 的那个属性\n\n\n\n属性\n描述\n\n\n\n\ndatabaseId\n如果配置了数据库厂商标识（databaseIdProvider），MyBatis 会加载所有不带 databaseId 或匹配当前 databaseId 的语句；如果带和不带的语句都有，则不带的会被忽略。\n\n\n\n123456&lt;!-- public void addEmp(Employee employee); --&gt;&lt;insert id=&quot;addEmp&quot; parameterType=&quot;com.atguigu.mybatis.bean.Employee&quot;   useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot; databaseId=&quot;mysql&quot;&gt;   insert into tbl_employee(last_name,email,gender)   values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;)&lt;/insert&gt;\n¶获取非自增主键的值\nOracle 不支持自增使的数据库，使用 selectKey 子元素\n✨selectKey 元素将会首先运行， id 会被设置， 然后插入语句会被调用\n\n\n\n属性\n描述\n\n\n\n\nkeyProperty\n仅适用于 insert 和 update，指定能够唯一识别对象的属性，MyBatis 会使用 getGeneratedKeys 的返回值或 insert 语句的 selectKey 子元素设置它的值，默认值：未设置（unset）。如果生成列不止一个，可以用逗号分隔多个属性名称。\n\n\norder\n“BEFORE”:当前 sql 在插入 sql 之前运行“AFTER”：当前 sql 在插入 sql 之后运行\n\n\n\n🎶BEFORE 与 AFTER 的运行顺序\n\nBEFORE:\n\n先运行 selectKey 查询 id 的 sql；查出 id 值封装给 javaBean 的 id 属性\n再运行插入的 sql；就可以取出 id 属性对应的值\n\n\nAFTER\n\n先运行插入的 sql（从序列中取出新值作为 id）；\n再运行 selectKey 查询 id 的 sql；\n\n\n\n12345678&lt;insert id=&quot;addEmp&quot; databaseId=&quot;oracle&quot;&gt;    &lt;selectKey keyProperty=&quot;id&quot; order=&quot;BEFORE&quot; resultType=&quot;Integer&quot;&gt;        select EMPLOYEES_SEQ.nextval from dual    &lt;/selectKey&gt;    &lt;!-- 插入时的主键是从序列中拿到的 --&gt;    insert into employees(EMPLOYEE_ID,LAST_NAME,EMAIL)    values(#&#123;id&#125;,#&#123;lastName&#125;,#&#123;email,jdbcType=NULL&#125;)&lt;/insert&gt;\n¶参数处理\nDAO 和 MyBatis Mapper 之间参数传递的处理\n¶单个参数\n可以接受基本类型， 对象类型。 这种情况 MyBatis 可直接使用这个参数， 不需要经过任何处理\n1#&#123;参数名/任意名&#125;\n¶多个参数\n任意多个参数， 都会被 MyBatis 重新包装成一个 Map 传入\n✨Map 的 key 是 param1，param2， 或者 0， 1…， 值就是参数的值\n123key: param1 .. paramNvalue：传入的参数值#&#123;param1&#125;就是从map中获取指定的key的值\n¶命名参数\n🎶明确指定封装参数时 map 的 key @Param(&quot;id&quot;)\n123key:使用@Param注解指定的值value:参数值#&#123;指定的key&#125;取出对应的参数值\n¶POJO\n如果多个参数正好是我们业务逻辑的数据模型，我们就可以直接传入 POJO\n1#&#123;属性名&#125;:取出传入的pojo的属性值\n¶Map\n如果多个参数不是业务模型中的数据，没有对应的 pojo，不经常使用，为了方便，我们也可以传入 map\n1#&#123;key&#125;:取出map中对应的值\n¶TO\n如果多个参数不是业务模型中的数据，但是经常要使用，推荐编写一个 TO（Transfer Object）数据传输对象\n1234Page&#123;\tint index;\tint size;&#125;\n¶Demo\n123456public Employee getEmp(@Param(&quot;id&quot;)Integer id,String lastName);id ==&gt; #&#123;id&#125;lastName ==&gt; #&#123;param2&#125;public Employee getEmp(Integer id,@Param(&quot;e&quot;)Employee emp);id ==&gt; #&#123;id&#125;lastName ==&gt; #&#123;param2.lastName&#125;|#&#123;e.lastName&#125;\n🎶如果是Collection(List,Set)类型或者数组，也会特殊处理，也是把传入的list或者数组封装在map中\n\n\n\n类型\nkey\n\n\n\n\nCollection\ncollection\n\n\nList\nlist\n\n\n数组\narray\n\n\n\n12public Employee getEmpById(List&lt;Integer&gt; ids);//取出第一个 id 的值：#&#123;list[0]&#125;\n🎶参数多时会封装 map，为了不混乱，我们可以使用@Param来指定封装时使用的key\n对于大多数简单的使用场景，不需要使用复杂的参数\n12345&lt;select id=&quot;selectUsers&quot; resultType=&quot;User&quot;&gt;  select id, username, password  from users  where id = #&#123;id&#125;&lt;/select&gt;\n根据参数类型（parameterType）会被自动设置为int，这个参数可以随意命名\n原始类型或简单数据类型（比如Integer和String）因为没有其他属性，会用它们的值来作为参数，然而，如果传入一个复杂的对象，行为就会不一样了\n1234&lt;insert id=&quot;insertUser&quot; parameterType=&quot;User&quot;&gt;  insert into users (id, username, password)  values (#&#123;id&#125;, #&#123;username&#125;, #&#123;password&#125;)&lt;/insert&gt;\n如果 User 类型的参数对象传递到了语句中，会查找 id、username 和 password 属性，然后将它们的值传入预处理语句的参数中\n参数也可以指定一个特殊的数据类型\n1#&#123;property,javaType=int,jdbcType=NUMERIC&#125;\n几乎总是可以根据参数对象的类型确定 javaType，除非该对象是一个 HashMap。这个时候，你需要显式指定 javaType 来确保正确的类型处理器（TypeHandler）被使用。\n🎶JDBC 要求，如果一个列允许使用 null 值，并且会使用值为 null 的参数，就必须要指定 JDBC 类型（jdbcType）\n要更进一步地自定义类型处理方式，可以指定一个特殊的类型处理器类（或别名）\n1#&#123;age,javaType=int,jdbcType=NUMERIC,typeHandler=MyTypeHandler&#125;\n对于数值类型，还可以设置 numericScale 指定小数点后保留的位数\n1#&#123;height,javaType=double,jdbcType=NUMERIC,numericScale=2&#125;\n👴参数的配置好像越来越繁琐了，但实际上，很少需要如此繁琐的配置\nmode 属性允许你指定 IN，OUT 或 INOUT 参数。如果参数的 mode 为 OUT 或 INOUT，将会修改参数对象的属性值，以便作为输出参数返回。 如果 mode 为 OUT（或 INOUT），而且 jdbcType 为 CURSOR（也就是 Oracle 的 REFCURSOR），你必须指定一个 resultMap 引用来将结果集 ResultMap 映射到参数的类型上。要注意这里的 javaType 属性是可选的，如果留空并且 jdbcType 是 CURSOR，它会被自动地被设为 ResultMap\n1#&#123;department, mode=OUT, jdbcType=CURSOR, javaType=ResultSet, resultMap=departmentResultMap&#125;\n🎶大多时候，你只须简单指定属性名，顶多要为可能为空的列指定 jdbcType，其他的事情交给 MyBatis 自己去推断就行了\n123#&#123;firstName&#125;#&#123;middleInitial,jdbcType=VARCHAR&#125;#&#123;lastName&#125;\n¶字符串替换\n\n\n\n表达式\n含义\n\n\n\n\n#{}\n可以获取 map 中的值或者 pojo 对象属性的值；是以预编译的形式，将参数设置到sql语句中；使用PreparedStatement；防止 sql 注入\n\n\n${}\n可以获取 map 中的值或者 pojo 对象属性的值；取出的值直接拼接在sql语句中;存在安全问题\n\n\n\n原生 jdbc 不支持占位符的地方我们就可以使用$&#123;&#125;进行取值，如：分表、排序\n当 SQL 语句中的元数据（如表名或列名）是动态生成的时候，字符串替换将会非常有用。 举个例子，如果你想 select 一个表任意一列的数据时，不需要这样写：\n12345678910@Select(&quot;select * from user where id = #&#123;id&#125;&quot;)User findById(@Param(&quot;id&quot;) long id);@Select(&quot;select * from user where name = #&#123;name&#125;&quot;)User findByName(@Param(&quot;name&quot;) String name);@Select(&quot;select * from user where email = #&#123;email&#125;&quot;)User findByEmail(@Param(&quot;email&quot;) String email);// 其它的 &quot;findByXxx&quot; 方法\n而是可以只写这样一个方法：\n12@Select(&quot;select * from user where $&#123;column&#125; = #&#123;value&#125;&quot;)User findByColumn(@Param(&quot;column&quot;) String column, @Param(&quot;value&quot;) String value);\n其中 $&#123;column&#125; 会被直接替换，而 #&#123;value&#125; 会使用 ? 预处理。 这样，就能完成同样的任务：\n123User userOfId1 = userMapper.findByColumn(&quot;id&quot;, 1L);User userOfNameKid = userMapper.findByColumn(&quot;name&quot;, &quot;kid&quot;);User userOfEmail = userMapper.findByColumn(&quot;email&quot;, &quot;noone@nowhere.com&quot;);\n这种方式也同样适用于替换表名的情况\n🎶用这种方式接受用户的输入，并用作语句参数是不安全的，会导致潜在的 SQL 注入攻击，因此，要么不允许用户输入这些字段，要么自行转义并检验这些参数\n👴大多数情况下，我们取参数的值都应该是使用#&#123;&#125;\n¶结果映射\nResultMap 的设计思想是：对简单的语句做到零配置，对于复杂一点的语句，只需要描述语句之前的关系就可以了\n如果返回的是一个集合，要写集合中元素的类型\n12@MapKey(&quot;lastName&quot;)public Map&lt;String, Employee&gt; getEmpByLastNameLikeReturnMap(String lastName);\n@Mapkey告诉 mybatis 封装这个 map 的时候使用那个属性作为 map 的 key\n返回一条记录的 map，key 是列名，值是对应的值\n1public Map&lt;String, Object&gt; getEmpByIdReturnMap(Integer id);\n¶&lt;resultMap&gt;\n自定义结果集映射规则，实现高级结果集映射\n\n\n\n标签\n含义\n\n\n\n\n&lt;id&gt;\n定义主键列封装规则，底层有优化\n\n\n&lt;result&gt;\n定义普通列封装规则\n\n\n\n123456789&lt;resultMap type=&quot;com.atguigu.mybatis.bean.Employee&quot; id=&quot;MySimpleEmp&quot;&gt;   &lt;!--column：指定哪一列 property：指定对应的javaBean属性--&gt;\t&lt;!--定义主键列封装规则--&gt;    &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;    &lt;!-- 定义普通列封装规则 --&gt;    &lt;result column=&quot;last_name&quot; property=&quot;lastName&quot;/&gt;    &lt;result column=&quot;email&quot; property=&quot;email&quot;/&gt;    &lt;result column=&quot;gender&quot; property=&quot;gender&quot;/&gt;&lt;/resultMap&gt;\n👴其他不指定的列会自动封装；只要写 resultMap 就把全部的映射规则都写上\n各个属性含义信息\n\n\n\n属性\n含义\n\n\n\n\nproperty\n映射到 Java Bean 的属性\n\n\ncolumn\n数据表的列命\n\n\njavaType\n一个 Java 类的完全限定名，或一个类型别名。如果映射到一个 Java Bean，MyBatis 通常可以断定类型\n\n\njdbcType\nJDBC 类型是仅仅需要对插入，更新和删除操作可能为空的列进行处理\n\n\ntypeHandler\n类型处理器，使用这个属性，可以覆盖默认的类型处理器，这个属性值是类的完全限定名或者是一个类型处理器的实现，或者是类型别名\n\n\n\n¶场景一：联合查询\n查询 Employee 的同时查询员工对应的部门\n12345678&lt;resultMap type=&quot;com.atguigu.mybatis.bean.Employee&quot; id=&quot;MyDifEmp&quot;&gt;\t&lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;\t&lt;result column=&quot;last_name&quot; property=&quot;lastName&quot;/&gt;    &lt;result column=&quot;gender&quot; property=&quot;gender&quot;/&gt;    &lt;!--级联赋值--&gt;    &lt;result column=&quot;did&quot; property=&quot;dept.id&quot;/&gt;    &lt;result column=&quot;dept_name&quot; property=&quot;dept.departmentName&quot;/&gt;&lt;/resultMap&gt;\n使用&lt;association&gt;定义关联的单个对象的封装规则,association 指定联合的 javaBean 对象\n12345&lt;!--property指定那个属性是联合对象，javaType:指定这个属性对象的类型--&gt;&lt;association property=&quot;dept&quot; javaType=&quot;com.atguigu.mybatis.bean.Department&quot;&gt;    &lt;id column=&quot;did&quot; property=&quot;id&quot;/&gt;    &lt;result column=&quot;dept_name&quot; property=&quot;departmentName&quot;/&gt;&lt;/association&gt;\n¶场景一：分步查询\n使用 association 进行分布查询\n\n先按照员工 id 查询员工信息\n根据查询员工信息中的 d_id 值去部门表查出部门信息\n部门信息设置到员工中\n\n12345678910111213141516&lt;result column=&quot;gender&quot; property=&quot;gender&quot;/&gt;   &lt;!-- association定义关联对象的封装规则      select:表明当前属性是调用select指定的方法查出的结果      column:指定将哪一列的值传给这个方法      流程：使用select指定的方法（传入column指定的这列参数的值）查出对象，并封装给property指定的属性    --&gt;   &lt;association property=&quot;dept&quot;      select=&quot;com.atguigu.mybatis.dao.DepartmentMapper.getDeptById&quot;      column=&quot;d_id&quot;&gt;   &lt;/association&gt;&lt;/resultMap&gt;&lt;!--  public Employee getEmpByIdStep(Integer id);--&gt;&lt;select id=&quot;getEmpByIdStep&quot; resultMap=&quot;MyEmpByStep&quot;&gt;   select * from tbl_employee where id=#&#123;id&#125;&lt;/select&gt;\n分段查询的基础之上加上两个配置，可以实现延迟加载（懒加载、按需加载）\n123456&lt;settings&gt;\t&lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;NULL&quot;/&gt;\t&lt;!--显示的指定每个我们需要更改的配置的值，即使他是默认的。防止版本更新带来的问题  --&gt;\t&lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;\t&lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot;/&gt;&lt;/settings&gt;\n¶场景二：联合查询\n查询部门的时候将部门对应的所有员工信息也查询出来\n123456public class Department &#123;   private Integer id;   private String departmentName;   private List&lt;Employee&gt; emps;&#125;\n123456789@Alias(&quot;emp&quot;)public class Employee &#123;   private Integer id;   private String lastName;   private String email;   private String gender;   private Department dept;&#125;\n12345678910111213141516171819202122232425&lt;!--嵌套结果集的方式，使用collection标签定义关联的集合类型的属性封装规则  --&gt;&lt;resultMap type=&quot;com.atguigu.mybatis.bean.Department&quot; id=&quot;MyDept&quot;&gt;   &lt;id column=&quot;did&quot; property=&quot;id&quot;/&gt;   &lt;result column=&quot;dept_name&quot; property=&quot;departmentName&quot;/&gt;   &lt;!--      collection定义关联集合类型的属性的封装规则      ofType:指定集合里面元素的类型   --&gt;   &lt;collection property=&quot;emps&quot; ofType=&quot;com.atguigu.mybatis.bean.Employee&quot;&gt;      &lt;!-- 定义这个集合中元素的封装规则 --&gt;      &lt;id column=&quot;eid&quot; property=&quot;id&quot;/&gt;      &lt;result column=&quot;last_name&quot; property=&quot;lastName&quot;/&gt;      &lt;result column=&quot;email&quot; property=&quot;email&quot;/&gt;      &lt;result column=&quot;gender&quot; property=&quot;gender&quot;/&gt;   &lt;/collection&gt;&lt;/resultMap&gt;&lt;!-- public Department getDeptByIdPlus(Integer id); --&gt;&lt;select id=&quot;getDeptByIdPlus&quot; resultMap=&quot;MyDept&quot;&gt;   SELECT d.id did,d.dept_name dept_name,         e.id eid,e.last_name last_name,e.email email,e.gender gender   FROM tbl_dept d   LEFT JOIN tbl_employee e   ON d.id=e.d_id   WHERE d.id=#&#123;id&#125;&lt;/select&gt;\n¶场景二：分步查询\n1234567891011&lt;resultMap type=&quot;com.atguigu.mybatis.bean.Department&quot; id=&quot;MyDeptStep&quot;&gt;   &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;   &lt;id column=&quot;dept_name&quot; property=&quot;departmentName&quot;/&gt;   &lt;collection property=&quot;emps&quot;      select=&quot;com.atguigu.mybatis.dao.EmployeeMapperPlus.getEmpsByDeptId&quot;      column=&quot;&#123;deptId=id&#125;&quot; fetchType=&quot;lazy&quot;&gt;&lt;/collection&gt;&lt;/resultMap&gt;&lt;!-- public Department getDeptByIdStep(Integer id); --&gt;&lt;select id=&quot;getDeptByIdStep&quot; resultMap=&quot;MyDeptStep&quot;&gt;   select id,dept_name from tbl_dept where id=#&#123;id&#125;&lt;/select&gt;\n📖多列的值传递过去：将多列的值封装 map 传递；column=“{key1=column1,key2=column2}”\nfetchType=“lazy”：表示使用延迟加载；- lazy：延迟- eager：立即\n¶discriminator（鉴别器）\nmybatis 可以使用 discriminator 判断某列的值，然后根据某列的值改变封装行为\n封装 Employee：\n\n如果查出的是女生：就把部门信息查询出来，否则不查询；\n如果是男生，把 last_name 这一列的值赋值给 email;\n\n\n12345678910111213141516171819202122232425&lt;resultMap type=&quot;com.atguigu.mybatis.bean.Employee&quot; id=&quot;MyEmpDis&quot;&gt;    &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;    &lt;result column=&quot;last_name&quot; property=&quot;lastName&quot;/&gt;    &lt;result column=&quot;email&quot; property=&quot;email&quot;/&gt;    &lt;result column=&quot;gender&quot; property=&quot;gender&quot;/&gt;    &lt;!--      column：指定判定的列名      javaType：列值对应的java类型  --&gt;    &lt;discriminator javaType=&quot;string&quot; column=&quot;gender&quot;&gt;        &lt;!--女生  resultType:指定封装的结果类型；不能缺少。/resultMap--&gt;        &lt;case value=&quot;0&quot; resultType=&quot;com.atguigu.mybatis.bean.Employee&quot;&gt;            &lt;association property=&quot;dept&quot;                         select=&quot;com.atguigu.mybatis.dao.DepartmentMapper.getDeptById&quot;                         column=&quot;d_id&quot;&gt;            &lt;/association&gt;        &lt;/case&gt;        &lt;!--男生 ;如果是男生，把last_name这一列的值赋值给email; --&gt;        &lt;case value=&quot;1&quot; resultType=&quot;com.atguigu.mybatis.bean.Employee&quot;&gt;            &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;            &lt;result column=&quot;last_name&quot; property=&quot;lastName&quot;/&gt;            &lt;result column=&quot;last_name&quot; property=&quot;email&quot;/&gt;            &lt;result column=&quot;gender&quot; property=&quot;gender&quot;/&gt;        &lt;/case&gt;    &lt;/discriminator&gt;&lt;/resultMap&gt;\n","dateCreated":"2021-11-26T07:20:14+00:00","dateModified":"2023-06-07T02:13:34+00:00","datePublished":"2021-11-26T07:20:14+00:00","description":"本文主要记录 MyBatis 映射文件的书写格式","headline":"MyBatis映射文件","image":["https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/mybatis.jpg"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://pineapple-man.github.io/mybatis%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6/"},"publisher":{"@type":"Organization","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png","logo":{"@type":"ImageObject","url":"logo.png"}},"url":"https://pineapple-man.github.io/mybatis%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6/","keywords":"MyBatis","thumbnailUrl":"https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/mybatis.jpg"}</script><meta name="description" content="本文主要记录 MyBatis 映射文件的书写格式"><meta property="og:type" content="blog"><meta property="og:title" content="MyBatis映射文件"><meta property="og:url" content="https://pineapple-man.github.io/mybatis%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6/"><meta property="og:site_name" content="pineapple-man"><meta property="og:description" content="本文主要记录 MyBatis 映射文件的书写格式"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2021-11-26T07:20:14.000Z"><meta property="article:modified_time" content="2023-06-07T02:13:34.015Z"><meta property="article:author" content="pineapple-man"><meta property="article:tag" content="MyBatis"><meta name="twitter:card" content="summary"><meta property="og:image" content="https://pineapple-man.github.io/assets/images/logo.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/mybatis.jpg"><meta class="swiftype" name="image" data-type="enum" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/mybatis.jpg"><link rel="stylesheet" href="/assets/css/style-oth3meuzcjopbgwqbdvoxqknhcm0sy9wkullcc94zhkkop3pmfrpl5t4fzzz.min.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-210516333-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-210516333-1")</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"></head><body><div id="blog"><header id="header" data-behavior="5"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/" aria-label="">pineapple-man</a></div><a class="header-right-picture" href="#about" aria-label="打开链接: /#about"><img class="header-picture" src="/assets/images/logo.png" alt="作者的图片"></a></header><nav id="sidebar" data-behavior="5"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about" aria-label="阅读有关作者的更多信息"><img class="sidebar-profile-picture" src="/assets/images/logo.png" alt="作者的图片"></a><h4 class="sidebar-profile-name">pineapple-man</h4><h5 class="sidebar-profile-bio"><p>做一个菠萝：站得笔直，头戴王冠，内心甜美</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/" rel="noopener" title="首页"><i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories" rel="noopener" title="分类"><i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags" rel="noopener" title="标签"><i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives" rel="noopener" title="归档"><i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about" rel="noopener" title="关于"><i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i> <span class="sidebar-button-desc">关于</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/pineapple-man" target="_blank" rel="noopener" title="GitHub"><i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto://mingchaohu720@gmail.com" target="_blank" rel="noopener" title="邮箱"><i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul></div></nav><div id="main" data-behavior="5" class="hasCoverMetaIn"><article class="post"><div class="post-header main-content-wrap text-center"><h1 class="post-title">MyBatis映射文件</h1><div class="post-meta"><time datetime="2021-11-26T07:20:14+00:00">11月 26, 2021 </time><span>发布在 </span><a class="category-link" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a> <i class="fas fa-book-open"></i> 本文共<span class="post-count"> 4.4k </span>字 <i class="far fa-clock"></i> 阅读预计<span class="post-count"> 48 </span>分钟</div></div><div class="post-content markdown"><div class="main-content-wrap"><h1 id="table-of-contents">目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#XML-%E6%98%A0%E5%B0%84%E5%99%A8"><span class="toc-text">XML 映射器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#select"><span class="toc-text">&lt;select&gt;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%85%8D%E7%BD%AE"><span class="toc-text">常见配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E8%AE%BE%E8%AE%A1"><span class="toc-text">底层设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-text">属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#insert-update-delete"><span class="toc-text">insert,update&amp;delete</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE%E7%9A%84%E5%80%BC"><span class="toc-text">获取自增主键的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%9D%9E%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE%E7%9A%84%E5%80%BC"><span class="toc-text">获取非自增主键的值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="toc-text">参数处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-text">单个参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-text">多个参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E5%8F%82%E6%95%B0"><span class="toc-text">命名参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POJO"><span class="toc-text">POJO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Map"><span class="toc-text">Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TO"><span class="toc-text">TO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Demo"><span class="toc-text">Demo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9B%BF%E6%8D%A2"><span class="toc-text">字符串替换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84"><span class="toc-text">结果映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#resultMap"><span class="toc-text">&lt;resultMap&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E4%B8%80%EF%BC%9A%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-text">场景一：联合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E4%B8%80%EF%BC%9A%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2"><span class="toc-text">场景一：分步查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E4%BA%8C%EF%BC%9A%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-text">场景二：联合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E4%BA%8C%EF%BC%9A%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2"><span class="toc-text">场景二：分步查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#discriminator%EF%BC%88%E9%89%B4%E5%88%AB%E5%99%A8%EF%BC%89"><span class="toc-text">discriminator（鉴别器）</span></a></li></ol></li></ol><h2 id="XML-映射器"><a class="header-anchor" href="#XML-映射器">¶</a>XML 映射器</h2><p>MyBatis 的真正强大在于它的语句映射，SQL 映射文件只有很少的几个顶级元素（根据应被定义的顺序列出）：</p><table><thead><tr><th style="text-align:center">标签</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>cache</code></td><td style="text-align:center">该命名空间的缓存配置</td></tr><tr><td style="text-align:center"><code>cache-ref</code></td><td style="text-align:center">引用其他命令空间的缓存配置</td></tr><tr><td style="text-align:center"><code>resultMap</code></td><td style="text-align:center">描述如何从数据库结果集中加载对象，时最复杂也是最强大的元素</td></tr><tr><td style="text-align:center"><code>sql</code></td><td style="text-align:center">可被其它语句引用的可重用语句块</td></tr><tr><td style="text-align:center"><code>insert</code></td><td style="text-align:center">映射插入语句</td></tr><tr><td style="text-align:center"><code>update</code></td><td style="text-align:center">映射更新语句</td></tr><tr><td style="text-align:center"><code>delete</code></td><td style="text-align:center">映射删除语句</td></tr><tr><td style="text-align:center"><code>select</code></td><td style="text-align:center">映射查询语句</td></tr></tbody></table><h2 id="select"><a class="header-anchor" href="#select">¶</a><code>&lt;select&gt;</code></h2><p>多数应用都是<strong>查询密集型</strong>，所以先从查询开始</p><p>🎶 MyBatis 的基本原则之一是：在每个插入、更新或删除操作之间，通常会执行多个查询操作</p><h3 id="常见配置"><a class="header-anchor" href="#常见配置">¶</a>常见配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPerson&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;hashmap&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM PERSON WHERE ID = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>✨语句特点</p><ol><li>这个语句名是<code>selectPerson</code></li><li>接受一个<code>int(Integer)</code>类型的参数</li><li>返回一个<code>HashMap</code>类型的对象，其中键是列名，值便是结果行中的对应值</li><li>参数使用<code>#&#123;&#125;</code>进行获取</li></ol><h3 id="底层设计"><a class="header-anchor" href="#底层设计">¶</a>底层设计</h3><p>以上的查询语句，其实就是告诉 MyBatis 创建一个预处理语句(PreparedStatement)参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">selectPerson</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM PERSON WHERE ID=?&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(selectPerson);</span><br><span class="line">ps.setInt(<span class="number">1</span>,id);</span><br></pre></td></tr></table></figure><h3 id="属性"><a class="header-anchor" href="#属性">¶</a>属性</h3><p>select 元素可以配置很多属性来配置每条语句的行为细节</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;selectPerson&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterMap</span>=<span class="string">&quot;deprecated&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">resultType</span>=<span class="string">&quot;hashmap&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">resultMap</span>=<span class="string">&quot;personResultMap&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushCache</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">useCache</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">fetchSize</span>=<span class="string">&quot;256&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">resultSetType</span>=<span class="string">&quot;FORWARD_ONLY&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">属性</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">resultType</td><td style="text-align:center">期望从这条语句中返回结果的类全限定名或别名。 注意，如果返回的是集合，那应该设置为集合包含的类型，而不是集合本身的类型。 resultType 和 resultMap 之间只能同时使用一个。</td></tr></tbody></table><h2 id="insert-update-delete"><a class="header-anchor" href="#insert-update-delete">¶</a><code>insert</code>,<code>update</code>&amp;<code>delete</code></h2><p>数据变更语句 insert，update 和 delete 的实现非常接近：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;insertAuthor&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterType</span>=<span class="string">&quot;domain.blog.Author&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushCache</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">keyProperty</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">keyColumn</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;updateAuthor&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterType</span>=<span class="string">&quot;domain.blog.Author&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushCache</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;deleteAuthor&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterType</span>=<span class="string">&quot;domain.blog.Author&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushCache</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="获取自增主键的值"><a class="header-anchor" href="#获取自增主键的值">¶</a>获取自增主键的值</h3><p>mysql 支持自增主键，自增主键值的获取，mybatis 利用<code>statement.getGeneratedKeys()</code></p><p><code>useGenerateKeys=&quot;true&quot;</code>使用自增主键获取主键值策略</p><p><code>keyProperty</code>指定对应的主键属性，也就是 mybatis 获取到主键值以后，将这个值封装给 javabean 的那个属性</p><table><thead><tr><th style="text-align:center">属性</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center"><code>databaseId</code></td><td style="text-align:center">如果配置了数据库厂商标识（databaseIdProvider），MyBatis 会加载所有不带 databaseId 或匹配当前 databaseId 的语句；如果带和不带的语句都有，则不带的会被忽略。</td></tr></tbody></table><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public void addEmp(Employee employee); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">   insert into tbl_employee(last_name,email,gender)</span><br><span class="line">   values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="获取非自增主键的值"><a class="header-anchor" href="#获取非自增主键的值">¶</a>获取非自增主键的值</h3><p>Oracle 不支持自增使的数据库，使用 selectKey 子元素</p><p>✨selectKey 元素将会首先运行， id 会被设置， 然后插入语句会被调用</p><table><thead><tr><th style="text-align:center">属性</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">keyProperty</td><td style="text-align:center">仅适用于 insert 和 update，指定能够唯一识别对象的属性，MyBatis 会使用 getGeneratedKeys 的返回值或 insert 语句的 selectKey 子元素设置它的值，默认值：未设置（<code>unset</code>）。如果生成列不止一个，可以用逗号分隔多个属性名称。</td></tr><tr><td style="text-align:center">order</td><td style="text-align:center">“BEFORE”:当前 sql 在插入 sql 之前运行<br>“AFTER”：当前 sql 在插入 sql 之后运行</td></tr></tbody></table><p>🎶BEFORE 与 AFTER 的运行顺序</p><ul><li><code>BEFORE</code>:<ul><li>先运行 selectKey 查询 id 的 sql；查出 id 值封装给 javaBean 的 id 属性</li><li>再运行插入的 sql；就可以取出 id 属性对应的值</li></ul></li><li><code>AFTER</code><ul><li>先运行插入的 sql（从序列中取出新值作为 id）；</li><li>再运行 selectKey 查询 id 的 sql；</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Integer&quot;</span>&gt;</span></span><br><span class="line">        select EMPLOYEES_SEQ.nextval from dual</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 插入时的主键是从序列中拿到的 --&gt;</span></span><br><span class="line">    insert into employees(EMPLOYEE_ID,LAST_NAME,EMAIL)</span><br><span class="line">    values(#&#123;id&#125;,#&#123;lastName&#125;,#&#123;email,jdbcType=NULL&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="参数处理"><a class="header-anchor" href="#参数处理">¶</a>参数处理</h2><p>DAO 和 MyBatis Mapper 之间参数传递的处理</p><h3 id="单个参数"><a class="header-anchor" href="#单个参数">¶</a>单个参数</h3><p>可以接受基本类型， 对象类型。 这种情况 MyBatis 可直接使用这个参数， 不需要经过任何处理</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;参数名/任意名&#125;</span><br></pre></td></tr></table></figure><h3 id="多个参数"><a class="header-anchor" href="#多个参数">¶</a>多个参数</h3><p>任意多个参数， 都会被 MyBatis <strong>重新包装成一个 Map 传入</strong></p><p>✨Map 的 key 是 param1，param2， 或者 0， 1…， 值就是参数的值</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">key: param1 .. paramN</span><br><span class="line">value：传入的参数值</span><br><span class="line">#&#123;param1&#125;就是从map中获取指定的key的值</span><br></pre></td></tr></table></figure><h3 id="命名参数"><a class="header-anchor" href="#命名参数">¶</a>命名参数</h3><p>🎶明确指定封装参数时 map 的 key <code>@Param(&quot;id&quot;)</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">key:使用@Param注解指定的值</span><br><span class="line">value:参数值</span><br><span class="line">#&#123;指定的key&#125;取出对应的参数值</span><br></pre></td></tr></table></figure><h3 id="POJO"><a class="header-anchor" href="#POJO">¶</a>POJO</h3><p>如果多个参数正好是我们业务逻辑的数据模型，我们就可以直接传入 POJO</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;属性名&#125;:取出传入的pojo的属性值</span><br></pre></td></tr></table></figure><h3 id="Map"><a class="header-anchor" href="#Map">¶</a>Map</h3><p>如果多个参数不是业务模型中的数据，没有对应的 pojo，不经常使用，为了方便，我们也可以传入 map</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;key&#125;:取出map中对应的值</span><br></pre></td></tr></table></figure><h3 id="TO"><a class="header-anchor" href="#TO">¶</a>TO</h3><p>如果多个参数不是业务模型中的数据，但是经常要使用，推荐编写一个 TO（Transfer Object）数据传输对象</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Page&#123;</span><br><span class="line">	int index;</span><br><span class="line">	int size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Demo"><a class="header-anchor" href="#Demo">¶</a>Demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Employee <span class="title function_">getEmp</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span>Integer id,String lastName)</span>;</span><br><span class="line">id ==&gt; #&#123;id&#125;</span><br><span class="line">lastName ==&gt; #&#123;param2&#125;</span><br><span class="line"><span class="keyword">public</span> Employee <span class="title function_">getEmp</span><span class="params">(Integer id,<span class="meta">@Param(&quot;e&quot;)</span>Employee emp)</span>;</span><br><span class="line">id ==&gt; #&#123;id&#125;</span><br><span class="line">lastName ==&gt; #&#123;param2.lastName&#125;|#&#123;e.lastName&#125;</span><br></pre></td></tr></table></figure><p>🎶如果是<code>Collection(List,Set)</code>类型或者数组，也会特殊处理，也是把传入的<code>list</code>或者数组封装在<code>map</code>中</p><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">key</th></tr></thead><tbody><tr><td style="text-align:center">Collection</td><td style="text-align:center">collection</td></tr><tr><td style="text-align:center">List</td><td style="text-align:center">list</td></tr><tr><td style="text-align:center">数组</td><td style="text-align:center">array</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Employee <span class="title function_">getEmpById</span><span class="params">(List&lt;Integer&gt; ids)</span>;</span><br><span class="line"><span class="comment">//取出第一个 id 的值：#&#123;list[0]&#125;</span></span><br></pre></td></tr></table></figure><p>🎶参数多时会封装 map，为了不混乱，我们可以使用<code>@Param</code>来指定封装时使用的<code>key</code></p><p>对于大多数简单的使用场景，不需要使用复杂的参数</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">  select id, username, password</span><br><span class="line">  from users</span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>根据参数类型（<code>parameterType</code>）会被自动设置为<code>int</code>，这个参数可以<strong>随意命名</strong></p><p>原始类型或简单数据类型（比如<code>Integer</code>和<code>String</code>）因为没有其他属性，会用它们的值来作为参数，然而，如果传入一个复杂的对象，行为就会不一样了</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">  insert into users (id, username, password)</span><br><span class="line">  values (#&#123;id&#125;, #&#123;username&#125;, #&#123;password&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果 User 类型的参数对象传递到了语句中，会查找 id、username 和 password 属性，然后将它们的值传入预处理语句的参数中</p><p>参数也可以指定一个特殊的数据类型</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;property,javaType=int,jdbcType=NUMERIC&#125;</span><br></pre></td></tr></table></figure><p>几乎总是可以根据参数对象的类型确定 javaType，除非该对象是一个 <code>HashMap</code>。这个时候，你需要显式指定 <code>javaType</code> 来确保正确的类型处理器（<code>TypeHandler</code>）被使用。</p><p>🎶JDBC 要求，如果一个列允许使用 null 值，并且会使用值为 null 的参数，就必须要指定 JDBC 类型（jdbcType）</p><p>要更进一步地自定义类型处理方式，可以指定一个特殊的类型处理器类（或别名）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;age,javaType=int,jdbcType=NUMERIC,typeHandler=MyTypeHandler&#125;</span><br></pre></td></tr></table></figure><p>对于数值类型，还可以设置 <code>numericScale</code> 指定小数点后保留的位数</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;height,javaType=double,jdbcType=NUMERIC,numericScale=2&#125;</span><br></pre></td></tr></table></figure><p>👴参数的配置好像越来越繁琐了，但实际上，很少需要如此繁琐的配置</p><p>mode 属性允许你指定 <code>IN</code>，<code>OUT</code> 或 <code>INOUT</code> 参数。如果参数的 <code>mode</code> 为 <code>OUT</code> 或 <code>INOUT</code>，将会修改参数对象的属性值，以便作为输出参数返回。 如果 <code>mode</code> 为 <code>OUT</code>（或 <code>INOUT</code>），而且 <code>jdbcType</code> 为 <code>CURSOR</code>（也就是 Oracle 的 REFCURSOR），你必须指定一个 <code>resultMap</code> 引用来将结果集 <code>ResultMap</code> 映射到参数的类型上。要注意这里的 <code>javaType</code> 属性是可选的，如果留空并且 jdbcType 是 <code>CURSOR</code>，它会被自动地被设为 <code>ResultMap</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;department, mode=OUT, jdbcType=CURSOR, javaType=ResultSet, resultMap=departmentResultMap&#125;</span><br></pre></td></tr></table></figure><p>🎶大多时候，你只须简单指定属性名，顶多要为可能为空的列指定 <code>jdbcType</code>，其他的事情交给 MyBatis 自己去推断就行了</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#&#123;firstName&#125;</span><br><span class="line">#&#123;middleInitial,jdbcType=VARCHAR&#125;</span><br><span class="line">#&#123;lastName&#125;</span><br></pre></td></tr></table></figure><h2 id="字符串替换"><a class="header-anchor" href="#字符串替换">¶</a>字符串替换</h2><table><thead><tr><th style="text-align:center">表达式</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center">#{}</td><td style="text-align:center">可以获取 map 中的值或者 pojo 对象属性的值；<br>是以预编译的形式，将参数设置到<code>sql</code>语句中；<br>使用<code>PreparedStatement</code>；防止 sql 注入</td></tr><tr><td style="text-align:center">${}</td><td style="text-align:center">可以获取 map 中的值或者 pojo 对象属性的值；<br>取出的值直接拼接在<code>sql</code>语句中;<br>存在安全问题</td></tr></tbody></table><p>原生 jdbc 不支持占位符的地方我们就可以使用<code>$&#123;&#125;</code>进行取值，如：分表、排序</p><p>当 SQL 语句中的元数据（如表名或列名）是动态生成的时候，字符串替换将会非常有用。 举个例子，如果你想 <code>select</code> 一个表任意一列的数据时，不需要这样写：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from user where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> <span class="type">long</span> id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;select * from user where name = #&#123;name&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findByName</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;select * from user where email = #&#123;email&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findByEmail</span><span class="params">(<span class="meta">@Param(&quot;email&quot;)</span> String email)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其它的 &quot;findByXxx&quot; 方法</span></span><br></pre></td></tr></table></figure><p>而是可以只写这样一个方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from user where $&#123;column&#125; = #&#123;value&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findByColumn</span><span class="params">(<span class="meta">@Param(&quot;column&quot;)</span> String column, <span class="meta">@Param(&quot;value&quot;)</span> String value)</span>;</span><br></pre></td></tr></table></figure><p>其中 <code>$&#123;column&#125;</code> 会被直接替换，而 <code>#&#123;value&#125;</code> 会使用 <code>?</code> 预处理。 这样，就能完成同样的任务：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">userOfId1</span> <span class="operator">=</span> userMapper.findByColumn(<span class="string">&quot;id&quot;</span>, <span class="number">1L</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">userOfNameKid</span> <span class="operator">=</span> userMapper.findByColumn(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;kid&quot;</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">userOfEmail</span> <span class="operator">=</span> userMapper.findByColumn(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;noone@nowhere.com&quot;</span>);</span><br></pre></td></tr></table></figure><p>这种方式也同样适用于替换表名的情况</p><p>🎶用这种方式接受用户的输入，并用作语句参数是不安全的，会导致潜在的 SQL 注入攻击，因此，要么不允许用户输入这些字段，要么自行转义并检验这些参数</p><p>👴大多数情况下，我们取参数的值都应该是使用<code>#&#123;&#125;</code></p><h2 id="结果映射"><a class="header-anchor" href="#结果映射">¶</a>结果映射</h2><p>ResultMap 的设计思想是：对简单的语句做到零配置，对于复杂一点的语句，只需要描述语句之前的关系就可以了</p><p>如果返回的是一个集合，要写集合中元素的类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapKey(&quot;lastName&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Employee&gt; <span class="title function_">getEmpByLastNameLikeReturnMap</span><span class="params">(String lastName)</span>;</span><br></pre></td></tr></table></figure><p><code>@Mapkey</code>告诉 mybatis 封装这个 map 的时候使用那个属性作为 map 的 key</p><p>返回一条记录的 map，key 是列名，值是对应的值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getEmpByIdReturnMap</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure><h3 id="resultMap"><a class="header-anchor" href="#resultMap">¶</a><code>&lt;resultMap&gt;</code></h3><p>自定义结果集映射规则，实现高级结果集映射</p><table><thead><tr><th style="text-align:center">标签</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>&lt;id&gt;</code></td><td style="text-align:center">定义主键列封装规则，底层有优化</td></tr><tr><td style="text-align:center"><code>&lt;result&gt;</code></td><td style="text-align:center">定义普通列封装规则</td></tr></tbody></table><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MySimpleEmp&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--column：指定哪一列 property：指定对应的javaBean属性--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--定义主键列封装规则--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义普通列封装规则 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>👴其他不指定的列会自动封装；只要写 resultMap 就把全部的映射规则都写上</p><p>各个属性含义信息</p><table><thead><tr><th style="text-align:center">属性</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center">property</td><td style="text-align:center">映射到 Java Bean 的属性</td></tr><tr><td style="text-align:center">column</td><td style="text-align:center">数据表的列命</td></tr><tr><td style="text-align:center">javaType</td><td style="text-align:center">一个 Java 类的完全限定名，或一个类型别名。如果映射到一个 Java Bean，MyBatis 通常可以断定类型</td></tr><tr><td style="text-align:center">jdbcType</td><td style="text-align:center">JDBC 类型是仅仅需要对插入，更新和删除操作可能为空的列进行处理</td></tr><tr><td style="text-align:center">typeHandler</td><td style="text-align:center">类型处理器，使用这个属性，可以覆盖默认的类型处理器，这个属性值是类的完全限定名或者是一个类型处理器的实现，或者是类型别名</td></tr></tbody></table><h3 id="场景一：联合查询"><a class="header-anchor" href="#场景一：联合查询">¶</a>场景一：联合查询</h3><p>查询 Employee 的同时查询员工对应的部门</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDifEmp&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--级联赋值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span> <span class="attr">property</span>=<span class="string">&quot;dept.id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;dept.departmentName&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用<code>&lt;association&gt;</code>定义关联的单个对象的封装规则,association 指定联合的 javaBean 对象</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--property指定那个属性是联合对象，javaType:指定这个属性对象的类型--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Department&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentName&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="场景一：分步查询"><a class="header-anchor" href="#场景一：分步查询">¶</a>场景一：分步查询</h3><p>使用 association 进行分布查询</p><ol><li>先按照员工 id 查询员工信息</li><li>根据查询员工信息中的 d_id 值去部门表查出部门信息</li><li>部门信息设置到员工中</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- association定义关联对象的封装规则</span></span><br><span class="line"><span class="comment">      select:表明当前属性是调用select指定的方法查出的结果</span></span><br><span class="line"><span class="comment">      column:指定将哪一列的值传给这个方法</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      流程：使用select指定的方法（传入column指定的这列参数的值）查出对象，并封装给property指定的属性</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">select</span>=<span class="string">&quot;com.atguigu.mybatis.dao.DepartmentMapper.getDeptById&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">column</span>=<span class="string">&quot;d_id&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  public Employee getEmpByIdStep(Integer id);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdStep&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyEmpByStep&quot;</span>&gt;</span></span><br><span class="line">   select * from tbl_employee where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>分段查询的基础之上加上两个配置，可以实现延迟加载（懒加载、按需加载）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTypeForNull&quot;</span> <span class="attr">value</span>=<span class="string">&quot;NULL&quot;</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--显示的指定每个我们需要更改的配置的值，即使他是默认的。防止版本更新带来的问题  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="场景二：联合查询"><a class="header-anchor" href="#场景二：联合查询">¶</a>场景二：联合查询</h3><p>查询部门的时候将部门对应的所有员工信息也查询出来</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Department</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Integer id;</span><br><span class="line">   <span class="keyword">private</span> String departmentName;</span><br><span class="line">   <span class="keyword">private</span> List&lt;Employee&gt; emps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;emp&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Integer id;</span><br><span class="line">   <span class="keyword">private</span> String lastName;</span><br><span class="line">   <span class="keyword">private</span> String email;</span><br><span class="line">   <span class="keyword">private</span> String gender;</span><br><span class="line">   <span class="keyword">private</span> Department dept;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--嵌套结果集的方式，使用collection标签定义关联的集合类型的属性封装规则  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Department&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDept&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentName&quot;</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      collection定义关联集合类型的属性的封装规则</span></span><br><span class="line"><span class="comment">      ofType:指定集合里面元素的类型</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 定义这个集合中元素的封装规则 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- public Department getDeptByIdPlus(Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptByIdPlus&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDept&quot;</span>&gt;</span></span><br><span class="line">   SELECT d.id did,d.dept_name dept_name,</span><br><span class="line">         e.id eid,e.last_name last_name,e.email email,e.gender gender</span><br><span class="line">   FROM tbl_dept d</span><br><span class="line">   LEFT JOIN tbl_employee e</span><br><span class="line">   ON d.id=e.d_id</span><br><span class="line">   WHERE d.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="场景二：分步查询"><a class="header-anchor" href="#场景二：分步查询">¶</a>场景二：分步查询</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Department&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDeptStep&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentName&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">select</span>=<span class="string">&quot;com.atguigu.mybatis.dao.EmployeeMapperPlus.getEmpsByDeptId&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">column</span>=<span class="string">&quot;&#123;deptId=id&#125;&quot;</span> <span class="attr">fetchType</span>=<span class="string">&quot;lazy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- public Department getDeptByIdStep(Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptByIdStep&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDeptStep&quot;</span>&gt;</span></span><br><span class="line">   select id,dept_name from tbl_dept where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>📖多列的值传递过去：将多列的值封装 map 传递；column=“{key1=column1,key2=column2}”<br>fetchType=“lazy”：表示使用延迟加载；- lazy：延迟- eager：立即</p><h3 id="discriminator（鉴别器）"><a class="header-anchor" href="#discriminator（鉴别器）">¶</a>discriminator（鉴别器）</h3><p>mybatis 可以使用 discriminator 判断某列的值，然后根据某列的值改变封装行为</p><div class="alert warning no-icon"><p>封装 Employee：</p><ul><li>如果查出的是女生：就把部门信息查询出来，否则不查询；</li><li>如果是男生，把 last_name 这一列的值赋值给 email;</li></ul></div><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyEmpDis&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      column：指定判定的列名</span></span><br><span class="line"><span class="comment">      javaType：列值对应的java类型  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--女生  resultType:指定封装的结果类型；不能缺少。/resultMap--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">select</span>=<span class="string">&quot;com.atguigu.mybatis.dao.DepartmentMapper.getDeptById&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">column</span>=<span class="string">&quot;d_id&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--男生 ;如果是男生，把last_name这一列的值赋值给email; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">标签</span><br><a class="tag tag--primary tag--small t-none-link" href="/tags/MyBatis/" rel="tag">MyBatis</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/mybatis-%E5%8A%A8%E6%80%81sql/" data-tooltip="MyBatis 动态Sql" aria-label="上一篇: MyBatis 动态Sql"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/mybatis-%E5%A4%9A%E8%A1%A8%E8%81%94%E5%90%88%E5%A4%84%E7%90%86/" data-tooltip="MyBatis 多表联合处理" aria-label="下一篇: MyBatis 多表联合处理"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></article><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2023 pineapple-man. All Rights Reserved.</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><br>Total <span id="busuanzi_value_site_pv"></span> views. 您是pineapple-man的第<span id="busuanzi_value_site_uv"></span>个小伙伴<br><i class="fas fa-book-open"></i> <span class="post-count">博客字数统计：370.7k</span><script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="5"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/mybatis-%E5%8A%A8%E6%80%81sql/" data-tooltip="MyBatis 动态Sql" aria-label="上一篇: MyBatis 动态Sql"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/mybatis-%E5%A4%9A%E8%A1%A8%E8%81%94%E5%90%88%E5%A4%84%E7%90%86/" data-tooltip="MyBatis 多表联合处理" aria-label="下一篇: MyBatis 多表联合处理"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-times"></i></div><img id="about-card-picture" src="/assets/images/logo.png" alt="作者的图片"><h4 id="about-card-name">pineapple-man</h4><div id="about-card-bio"><p>做一个菠萝：站得笔直，头戴王冠，内心甜美</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>刚毕业就失业</p></div><div id="about-card-location"><i class="fa fa-map-marker-alt"></i><br>西安</div></div></div><div id="cover" style="background-image:url(/assets/images/cover-v1.2.0.jpg)"></div><script src="/assets/js/script-kcoiyt1nxfue7qgcpkrcixymglcc3cuxeg98fy01hqww4nblnhd2ees6j6yc.min.js"></script></body></html>