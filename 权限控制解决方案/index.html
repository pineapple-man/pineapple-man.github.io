<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="pineapple-man"><title>权限控制解决方案 - pineapple-man</title><meta name="author" content="pineapple-man"><meta name="keywords" content="RBAC"><link rel="icon" href="https://pineapple-man.github.io/assets/images/logo.svg"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png"},"articleBody":"\n¶概述\n❓什么是权限控制(管理)？\n权限管理，一般指根据系统设置的安全规则或安全策略，用户可以访问而且只能访问自己被授权的资源。权限管理几乎出现在任何有用户和密码的系统里面。不要将权限管理与用户身份认证、密码加密与系统管理等概念混淆\n百度百科权限管理\n简而言之，权限管理主要工作是：根据系统设置的安全规则或者安全策略，限制用户的访问资源\n❓为什么需要权限控制(管理)？\n如何没有权限控制，那么此系统中的任何一个用户都拥有所有的权限，这是所有人不能接收的，所以需要相应的权限控制方法\n\n❓什么时候需要进行权限控制？\n如果已经构建了用户系统，某个时刻 API 就需要判断当前访问的用户是否能够访问当前资源，这时候就需要构建自己的权限系统，权限系统中一个很重要的概念就是授权，授权指的是判断用户具备那些权限的过程与认证是两个完全不同的含义\n\n¶权限管理解决方案\n权限控制问题已经存在很久，现存最常用的权限控制模型有：基于角色的访问控制（RBAC: Role-Based Access Control）和基于属性的权限验证（ABAC: Attribute-Based Access Control）\n¶RBAC 初探\n❓什么是 RBAC（Role-based access control）？\nRBAC 是目前公认的解决大型企业的统一资源访问控制的有效方法，RBAC 不同于传统的强制访问控制和自由选定访问控制的控制方案（直接赋予使用者权限），而是将权限赋予角色。在 RBAC 方法中，权限与角色相关联，用户通过成为适当角色的成员而得到这些角色的权限，具体的细节展示在下图\n\n\n👍使用 RBAC 之后，将会极大地简化系统的权限管理。用户可以很容易地从一个角色指派到另一个角色，并且角色可根据新的需求和系统的合并从而赋予新的权限，而权限也可根据需要而从某角色中回收。\n¶ABAC 初探\n在 ABAC 权限模型下，可以轻松地实现以下权限控制逻辑：\n\n编辑 A 具有某本书的编辑权限；\n当一个文档的所属部门跟用户的部门相同时，用户可以访问这个文档\n当用户是一个文档的拥有者并且文档的状态是草稿，用户可以编辑这个文档\n早上九点前禁止 A 部门的人访问 B 系统\n在除了上海以外的地方禁止以管理员身份访问 A 系统\n\n\n✨上述的逻辑中有几个共同点：\n\n具体到某一个而不是某一类资源\n具体到某一个操作\n能通过请求的上下文（如时间、地理位置、资源 Tag）动态执行策略\n\n基于属性的权限控制可以细粒度地授权在某种情况下对某个资源具备某个特定的权限\n\n\n🆚基于属性的权限验证和基于角色的访问控制两者各有优劣：\nRBAC 模型构建起来更加简单，缺点在于无法做到对资源细粒度地授权（都是授权某一类资源而不是授权某一个具体的资源）；ABAC 模型构建相对复杂，学习成本高，优点在于细粒度和根据上下文动态执行\n\n¶权限控制的分类\n从不同角度看待同一个事物存在不同的分歧，以下给出百度百科给出的两种权限控制的分类\n¶从控制力度对权限管理分类\n✨从控制力度来看，可以将权限管理分为两大类：\n\n功能级权限管理\n数据级权限管理\n\n\n\n数据级权限管理某个用户能够访问和操作哪些数据。通常来说，数据权限由用户所属的组织来确定。比如：生产部只能看自己部门的生产数据；销售部门只能看销售数据。公司的总经理可以看所有的数据，数据级权限管理间接性的保证了数据隔离。在实际的业务系统中，数据权限往往更加复杂，非常有可能销售部门可以看生产部门的数据，以确定销售策略、安排计划等\n为了面对复杂的需求，数据权限的控制通常是由程序员书写个性化的 SQL 来限制数据范围的，而不是交给权限模型来控制。当然也可以从权限模型或者权限框架的角度去解决这个问题，但适用性有限\n\n¶从控制方向对权限管理分类\n✨从控制方向来看，也可以将权限管理分为两大类：\n\n从系统获取数据，比如查询订单、查询客户资料\n向系统提交数据，比如删除订单、修改客户资料\n\n\n¶RBAC 模型概述\nRBAC 认为权限的过程可以抽象概括为：判断Who 是否可以对 What 进行 How 的访问操作这个逻辑表达式的值是否为True的求解过程，即将权限问题转换为Who、What、How 的问题。其中who、what、how构成了访问权限三元组\n✨RBAC 支持公认的安全原则：最小特权原则、责任分离原则和数据抽象原则\n\n最小特权原则得到支持，是因为在 RBAC 模型中可以通过限制分配给角色权限的多少和大小来实现，分配给某用户对应的角色的权限只要不超过该用户完成其任务的需要就可以了\n责任分离原则得到支持，是因为在 RBAC 模型中可以通过在完成敏感任务过程中分配两个责任上互相约束的两个角色来实现，例如在清查账目时，只需要设置财务管理员和会计两个角色参加就可以了\n数据抽象得到支持，是借助于抽象许可权这样的概念实现的。如在账目管理活动中，可以使用信用、借方等抽象许可权，而不是使用操作系统提供的读、写、执行等具体的许可权。但 RBAC 并不强迫实现这些原则，安全管理员可以允许配置 RBAC 模型使它不支持这些原则。因此，RBAC 支持数据抽象的程度与 RBAC 模型的实现细节有关\n\n\n¶RBAC 模型族\n✨RBAC96 是一个模型族，其中包括 RBAC0 ~ RBAC3 四个概念性模型：\n\n基本模型 RBAC0 定义了完全支持 RBAC 概念的任何系统的最低需求\nRBAC1 和 RBAC2 两者都包含 RBAC0，但各自都增加了独立的特点，它们被称为高级模型。其中 RBAC1 中增加了角色分级的概念，一个角色可以从另一个角色继承许可权；RBAC2 中强调在 RBAC 的不同组件中配置方面的一些限制\nRBAC3 称为统一模型，它包含了 RBAC1 和 RBAC2，利用传递性，也把 RBAC0 包括在内\n\n\n\n¶RBAC0\nRBAC0 定义了能构成一个 RBAC 控制系统的最小的元素集合，在 RBAC 之中,包含用户 users(USERS)、角色 roles(ROLES)、目标 objects(OBS)、操作 operations(OPS)、许可权 permissions(PRMS) 五个基本数据元素，此模型指明用户、角色、访问权限和会话之间的关系\n\n\n\n\n组件\n含义\n\n\n\n\n用户（User）\n系统接口及访问的操作者\n\n\n角色（Role）\n具有一类相同操作权限的用户的总称\n\n\n权限（Permission）\n能够访问某接口或者做某操作的授权资格\n\n\n会话（Session）\nRABC0 权限管理的核心部分，其他的版本都是建立在 RBAC0 的基础上的\n\n\n\n对应的 UML 类图如下：\n\n每个角色至少具备一个权限，每个用户至少扮演一个角色；可以对两个完全不同的角色分配完全相同的访问权限；会话由用户控制，一个用户可以创建会话并激活多个用户角色，从而获取相应的访问权限，用户可以在会话中更改激活角色，并且用户可以主动结束一个会话。用户和角色是多对多的关系，表示一个用户在不同的场景下可以拥有不同的角色\n\n例如项目经理也可以是项目架构师等；当然了一个角色可以给多个用户，例如一个项目中有多个组长，多个组员等\n🎶将用户和权限进行分离，是彼此相互独立，使权限的授权认证更加灵活\n\n角色和许可（权限）是多对多的关系，表示角色可以拥有多分权利，同一个权利可以授给多个角色都是非常容易理解的，想想现实生活中，当官的级别不同的权限的情景，其实这个模型就是对权限这方面的一个抽象，联系生活理解就非常容易了\n¶RBAC1\nRBAC1 基于 RBAC0 模型，引入角色间的继承关系，即角色之间有了上下级的区别，角色间的继承关系可分为一般继承关系和受限继承关系。这种模型合适于角色之间的层次明确，包含明确\n\n🆚一般继承关系与受限继承关系异同\n\n一般继承关系仅要求角色继承关系是一个绝对偏序关系，允许角色间的多继承\n受限继承关系则进一步要求角色继承关系是一个树结构，实现角色间的单继承\n\n\n  \n¶RBAC2\nRBAC2 基于 RBAC0 模型进行了角色的访问控制\n\nRBAC2 模型中添加了责任分离关系。RBAC2 的约束规定了权限被赋予角色时，或角色被赋予用户时，以及当用户在某一时刻激活一个角色时所应遵循的强制性规则。责任分离包括静态责任分离和动态责任分离\n约束与用户—角色—权限关系一起决定了 RBAC2 模型中用户的访问许可，此约束有多种：\n\n互斥角色 ：同一用户只能分配到一组互斥角色集合中至多一个角色，支持责任分离的原则。互斥角色是指各自权限互相制约的两个角色。对于这类角色一个用户在某一次活动中只能被分配其中的一个角色，不能同时获得两个角色的使用权。例如：在审计活动中，一个角色不能同时被指派给会计角色和审计员角色\n基数约束 ：一个角色被分配的用户数量受限；一个用户可拥有的角色数目受限；同样一个角色对应的访问权限数目也应受限，以控制高级权限在系统中的分配\n先决条件角色 ：可以分配角色给用户仅当该用户已经是另一角色的成员；对应的可以分配访问权限给角色，仅当该角色已经拥有另一种访问权限。要想获得较高的权限，要首先拥有低一级的权限\n运行时互斥 ：例如，允许一个用户具有两个角色的成员资格，但在运行中不可同时激活这两个角色\n\n\n\n¶RBAC3\nRBAC3 是最全面级的权限管理，它是基于 RBAC0 的基础上，将 RBAC1 和 RBAC2 进行整合了，也是最复杂的，可以简单的理解：RBAC3 = RBAC1 + RBAC2\n\n\n¶RBAC 的设计思路\n🎶一个 RBAC 权限模型核心授权逻辑仅考虑以下三点\n\n某用户扮演什么角色？\n某角色具有什么权限？\n通过角色的权限推到用户的权限\n\n\n以一个简单的场景（Gitlab 的权限系统）为例，用户系统中有 Admin、Maintainer、Operator 三种角色，这三种角色分别具备不同的权限，比如只有 Admin 具备创建代码仓库、删除代码仓库的权限，其他的角色都不具备\n\n授予某个用户 Admin 这个角色，他就具备了创建代码仓库和删除代码仓库这两个权限\n基于角色的访问控制基本原理是在用户和访问权限之间加入角色这一层，实现用户和权限的分离，用户只有通过激活角色才能获得访问权限。通过角色对权限分组，大大简化了用户权限分配表，间接地实现了对用户的分组，提高了权限的分配效率。并且加入角色层后，访问控制机制更接近真实世界中的职业分配，便于权限管理\n\n在 RBAC 模型中，角色是系统根据管理中相对稳定的职权和责任来划分，每种角色可以完成一定的职能。用户通过饰演不同的角色获得角色所拥有的权限，一旦某个用户成为某角色的成员，则此用户可以完成该角色所具有的职能。通过将权限指定给角色而不是用户，在权限分派上提供了极大的灵活性和极细的权限指定粒度\n¶RBAC 用户角色权限设计方案\n一个用户拥有若干角色，每一个角色拥有若干权限。这样，就构造成用户-角色-权限的授权模型。在这种模型中，用户与角色之间，角色与权限之间，一般者是多对多的关系，如下图\n\n❓到底什么是角色？\n可以理解为一定数量的权限的集合，权限的载体。例如：一个论坛系统，超级管理员、版主都是角色。版主可管理版内的帖子、可管理版内的用户等，这些是权限。要给某个用户授予这些权限，不需要直接将权限授予用户，可将版主这个角色赋予该用户\n\n当用户的数量非常大时，要给系统每个用户逐一授权（授角色），是件非常烦琐的事情。这时，就需要给用户分组，每个用户组内有多个用户。除了可给用户授权外，还可以给用户组授权。这样一来，用户拥有的所有权限，就是用户个人拥有的权限与该用户所在用户组拥有的权限之和。（下图为用户组、用户与角色三者的关联关系）\n\n❓在应用系统中，权限表现成什么？\n对功能模块的操作，对上传文件的删改，菜单的访问，甚至页面上某个按钮、某个图片的可见性控制，都可属于权限的范畴。有些权限设计，会把功能操作作为一类，而把文件、菜单、页面元素等作为另一类，这样构成“用户-角色-权限-资源”的授权模型。而在做数据表建模时，可把功能操作和资源统一管理，也就是都直接与权限表进行关联，这样可能更具便捷性和易扩展性\n\n\n权限表中有一列权限类型，我们根据它的取值来区分是哪一类权限，如MENU表示菜单的访问权限、OPERATION表示功能模块的操作权限、FILE表示文件的修改权限、ELEMENT表示页面元素的可见性控制等。这样设计的好处有二\n\n不需要区分哪些是权限操作，哪些是资源，（实际上，有时候也不好区分，如菜单，把它理解为资源呢还是功能模块权限呢？）\n方便扩展，当系统要对新的东西进行权限控制时，我只需要建立一个新的关联表权限 XX 关联表，并确定这类权限的权限类型字符串。\n\n\n🎶这里要注意的是，权限表与权限菜单关联表、权限菜单关联表与菜单表都是一对一的关系。（文件、页面权限点、功能操作等同理）。也就是每添加一个菜单，就得同时往这三个表中各插入一条记录。这样，可以不需要权限菜单关联表，让权限表与菜单表直接关联，此时，须在权限表中新增一列用来保存菜单的 ID，权限表通过权限类型和这个 ID 来区分是种类型下的哪条记录。如此，RBAC 权限模型的扩展模型的完整设计图如下：\n\n下图是另一种设计方案\n\n¶角色组\n随着系统的日益庞大，为了方便管理，可引入角色组对角色进行分类管理，跟用户组不同，角色组不参与授权\n例如：某电网系统的权限管理模块中，角色就是挂在区局下，而区局在这里可当作角色组，它不参于权限分配。另外，为方便上面各主表自身的管理与查找，可采用树型结构，如菜单树、功能树等，当然这些可不需要参于权限分配。\n\n❓角色和用户组有什么区别？\n两者的主要差别是：用户组是用户的集合，但不是许可权的集合；而角色却同时具有用户集合和许可权集合的概念，角色的作用把这两个集合联系在一起的中间媒介\n在一个系统中，如果用户组的许可权和成员仅可以被系统安全员修改的话，在这种机制下，用户组的机制是非常接近于角色的概念的。角色也可以在用户组的基础上实现，这有利于保持原有系统中的控制关系。在这种情况下，角色相当于一个策略部件，与用户组的授权及责任关系相联系，而用户组是实现角色的机制，因此，两者之间是策略与实现机制之间的关系\n\n¶如何选择合适的权限模型？\n组织的规模是至关重要的因素。由于 ABAC 最初的设计和实施困难，对于小型企业而言，考虑起来可能太复杂了。对于中小型企业，RBAC 是 ABAC 的简单替代方案，每个用户都有一个唯一的角色，并具有相应的权限和限制。当用户转移到新角色时，其权限将更改为新职位的权限。这意味着，在明确定义角色的层次结构中，可以轻松管理少量内部和外部用户。\n但是，当必须手动建立新角色时，对于大型组织而言，效率不高。一旦定义了属性和规则，当用户和利益相关者众多时，ABAC 的策略就更容易应用，同时还降低了安全风险\n简而言之，如果满足以下条件，请选择 ABAC：\n\n在一个拥有许多用户的大型组织中\n需要深入的特定访问控制功能\n有时间投资远距离的模型\n需要确保隐私和安全合规\n\n\n如果满足以下条件，请考虑 RBAC：\n\n所在的是中小型企业\n访问控制策略广泛\n外部用户很少，并且组织角色得到了明确定义\n\n\n¶总结\n不良的权限管理系统，必然留下系统漏洞，给黑客可趁之机。很多软件可以轻松通过 URL 侵入、SQL 注入等模式，轻松越权获得未授权数据。甚至对系统数据进行修改、删除，造成巨大损失。很多系统，尤其是采用硬编码方式的系统，存在权限逻辑与业务代码紧密耦合，同时又分散在系统各个地方，系统漏洞势必非常多，而且随着系统不断修改，漏洞逐步增多。\n好的系统，应该将权限逻辑集中起来，由专业的安全引擎进行设置和解析。业务逻辑调用安全引擎，获得权限结果，不再使用非专业模式。\n¶附录\n权限系统与 RBAC 模型概述\n如何对用户进行权限管理\n图文详解基于角色的权限控制模型 RBAC\nRole-based access control wiki\n产品 | 权限设计=功能权限+数据权限\n","dateCreated":"2021-11-27T15:47:28+00:00","dateModified":"2023-06-07T02:13:34+00:00","datePublished":"2021-11-27T15:47:28+00:00","description":"开发系统时，必然面临权限控制问题，需要解决不同的用户的访问、操作、数据权限控制，本文主要讲解目前普遍使用的RBAC思想","headline":"权限控制解决方案","image":["https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/rbac-permissions-overview.jpg"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://pineapple-man.github.io/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"},"publisher":{"@type":"Organization","name":"pineapple-man","sameAs":["https://github.com/pineapple-man","mailto://mingchaohu720@gmail.com"],"image":"logo.png","logo":{"@type":"ImageObject","url":"logo.png"}},"url":"https://pineapple-man.github.io/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/","keywords":"安全","thumbnailUrl":"https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/rbac-permissions-overview.jpg"}</script><meta name="description" content="开发系统时，必然面临权限控制问题，需要解决不同的用户的访问、操作、数据权限控制，本文主要讲解目前普遍使用的RBAC思想"><meta property="og:type" content="blog"><meta property="og:title" content="权限控制解决方案"><meta property="og:url" content="https://pineapple-man.github.io/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"><meta property="og:site_name" content="pineapple-man"><meta property="og:description" content="开发系统时，必然面临权限控制问题，需要解决不同的用户的访问、操作、数据权限控制，本文主要讲解目前普遍使用的RBAC思想"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/rbac.67730a66.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/abac_dce8a437.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/821379-5bd8751eaba6ffca.webp"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171727177709875.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171727279428882.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171727283952955.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171728213791309.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171728235048924.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171728248487668.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/rbac_oneuser_mulrole.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211031194436350.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171735451928995.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839120364424.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839137705455.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839156767770.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839188643344.png"><meta property="article:published_time" content="2021-11-27T15:47:28.000Z"><meta property="article:modified_time" content="2023-06-07T02:13:34.003Z"><meta property="article:author" content="pineapple-man"><meta property="article:tag" content="安全"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/rbac.67730a66.png"><meta property="og:image" content="https://pineapple-man.github.io/assets/images/logo.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/rbac-permissions-overview.jpg"><meta class="swiftype" name="image" data-type="enum" content="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/rbac-permissions-overview.jpg"><link rel="stylesheet" href="/assets/css/style-oth3meuzcjopbgwqbdvoxqknhcm0sy9wkullcc94zhkkop3pmfrpl5t4fzzz.min.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-210516333-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-210516333-1")</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"></head><body><div id="blog"><header id="header" data-behavior="5"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/" aria-label="">pineapple-man</a></div><a class="header-right-picture" href="#about" aria-label="打开链接: /#about"><img class="header-picture" src="/assets/images/logo.png" alt="作者的图片"></a></header><nav id="sidebar" data-behavior="5"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about" aria-label="阅读有关作者的更多信息"><img class="sidebar-profile-picture" src="/assets/images/logo.png" alt="作者的图片"></a><h4 class="sidebar-profile-name">pineapple-man</h4><h5 class="sidebar-profile-bio"><p>做一个菠萝：站得笔直，头戴王冠，内心甜美</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/" rel="noopener" title="首页"><i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories" rel="noopener" title="分类"><i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags" rel="noopener" title="标签"><i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives" rel="noopener" title="归档"><i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about" rel="noopener" title="关于"><i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i> <span class="sidebar-button-desc">关于</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/pineapple-man" target="_blank" rel="noopener" title="GitHub"><i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto://mingchaohu720@gmail.com" target="_blank" rel="noopener" title="邮箱"><i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul></div></nav><div id="main" data-behavior="5" class="hasCoverMetaIn"><article class="post"><div class="post-header main-content-wrap text-center"><h1 class="post-title">权限控制解决方案</h1><div class="post-meta"><time datetime="2021-11-27T15:47:28+00:00">11月 27, 2021 </time><span>发布在 </span><a class="category-link" href="/categories/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">解决方案</a> <i class="fas fa-book-open"></i> 本文共<span class="post-count"> 5.3k </span>字 <i class="far fa-clock"></i> 阅读预计<span class="post-count"> 48 </span>分钟</div></div><div class="post-content markdown"><div class="main-content-wrap"><h1 id="table-of-contents">目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">权限管理解决方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RBAC-%E5%88%9D%E6%8E%A2"><span class="toc-text">RBAC 初探</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ABAC-%E5%88%9D%E6%8E%A2"><span class="toc-text">ABAC 初探</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">权限控制的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%8E%A7%E5%88%B6%E5%8A%9B%E5%BA%A6%E5%AF%B9%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E5%88%86%E7%B1%BB"><span class="toc-text">从控制力度对权限管理分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%8E%A7%E5%88%B6%E6%96%B9%E5%90%91%E5%AF%B9%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E5%88%86%E7%B1%BB"><span class="toc-text">从控制方向对权限管理分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RBAC-%E6%A8%A1%E5%9E%8B%E6%A6%82%E8%BF%B0"><span class="toc-text">RBAC 模型概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RBAC-%E6%A8%A1%E5%9E%8B%E6%97%8F"><span class="toc-text">RBAC 模型族</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RBAC0"><span class="toc-text">RBAC0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RBAC1"><span class="toc-text">RBAC1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RBAC2"><span class="toc-text">RBAC2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RBAC3"><span class="toc-text">RBAC3</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RBAC-%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-text">RBAC 的设计思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RBAC-%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88"><span class="toc-text">RBAC 用户角色权限设计方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E7%BB%84"><span class="toc-text">角色组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E6%9D%83%E9%99%90%E6%A8%A1%E5%9E%8B%EF%BC%9F"><span class="toc-text">如何选择合适的权限模型？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-text">附录</span></a></li></ol><h2 id="概述"><a class="header-anchor" href="#概述">¶</a>概述</h2><p>❓什么是权限控制(管理)？</p><blockquote><p>权限管理，一般指根据系统设置的安全规则或安全策略，用户可以访问而且只能访问自己被授权的资源。权限管理几乎出现在任何有用户和密码的系统里面。不要将权限管理与<strong>用户身份认证</strong>、<strong>密码加密</strong>与<strong>系统管理</strong>等概念混淆</p><footer><strong>百度百科</strong><cite><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86">权限管理</a></cite></footer></blockquote><p>简而言之，权限管理主要工作是：根据系统设置的安全规则或者安全策略，限制用户的访问资源</p><p>❓为什么需要权限控制(管理)？</p><div class="alert success no-icon"><p>如何没有权限控制，那么此系统中的任何一个用户都拥有所有的权限，这是所有人不能接收的，所以需要相应的权限控制方法</p></div><p>❓什么时候需要进行权限控制？</p><div class="alert success no-icon"><p>如果已经构建了用户系统，某个时刻 API 就需要判断当前访问的用户是否能够访问当前资源，这时候就需要构建自己的权限系统，权限系统中一个很重要的概念就是授权，授权指的是判断用户具备那些权限的过程<strong>与认证是两个完全不同的含义</strong></p></div><h3 id="权限管理解决方案"><a class="header-anchor" href="#权限管理解决方案">¶</a>权限管理解决方案</h3><p>权限控制问题已经存在很久，现存最常用的权限控制模型有：<strong>基于角色的访问控制（RBAC: Role-Based Access Control）<strong>和</strong>基于属性的权限验证（ABAC: Attribute-Based Access Control）</strong></p><h3 id="RBAC-初探"><a class="header-anchor" href="#RBAC-初探">¶</a>RBAC 初探</h3><p>❓什么是 RBAC（Role-based access control）？</p><div class="alert success no-icon"><p>RBAC 是目前公认的解决大型企业的统一资源访问控制的有效方法，RBAC 不同于传统的<strong>强制访问控制</strong>和<strong>自由选定访问控制</strong>的控制方案（直接<strong>赋予使用者权限</strong>），而是将<strong>权限赋予角色</strong>。在 RBAC 方法中，<strong>权限与角色相关联</strong>，用户通过成为适当角色的成员而得到这些角色的权限，具体的细节展示在下图</p></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/rbac.67730a66.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/rbac.67730a66.png" alt=""></a></div><p>👍使用 RBAC 之后，将会极大地简化系统的权限管理。用户可以很容易地从一个角色指派到另一个角色，并且角色可根据新的需求和系统的合并从而赋予新的权限，而权限也可根据需要而从某角色中回收。</p><h3 id="ABAC-初探"><a class="header-anchor" href="#ABAC-初探">¶</a>ABAC 初探</h3><p>在 ABAC 权限模型下，可以轻松地实现以下权限控制逻辑：</p><div class="alert warning no-icon"><ol><li>编辑 A 具有某本书的编辑权限；</li><li>当一个文档的所属部门跟用户的部门相同时，用户可以访问这个文档</li><li>当用户是一个文档的拥有者并且文档的状态是草稿，用户可以编辑这个文档</li><li>早上九点前禁止 A 部门的人访问 B 系统</li><li>在除了上海以外的地方禁止以管理员身份访问 A 系统</li></ol></div><p>✨上述的逻辑中有几个共同点：</p><ol><li>具体到某一个而不是某一类资源</li><li>具体到某一个操作</li><li>能通过请求的上下文（如时间、地理位置、资源 Tag）动态执行策略</li></ol><div class="alert success no-icon"><p>基于属性的权限控制可以细粒度地授权在某种情况下对某个资源具备某个特定的权限</p></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/abac_dce8a437.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/abac_dce8a437.png" alt=""></a></div><p>🆚基于属性的权限验证和基于角色的访问控制两者各有优劣：</p><div class="alert success no-icon"><p>RBAC 模型构建起来更加简单，缺点在于无法做到对资源细粒度地授权（都是授权某一类资源而不是授权某一个具体的资源）；ABAC 模型构建相对复杂，学习成本高，优点在于细粒度和根据上下文动态执行</p></div><h2 id="权限控制的分类"><a class="header-anchor" href="#权限控制的分类">¶</a>权限控制的分类</h2><p>从不同角度看待同一个事物存在不同的分歧，以下给出百度百科给出的两种权限控制的分类</p><h3 id="从控制力度对权限管理分类"><a class="header-anchor" href="#从控制力度对权限管理分类">¶</a>从控制力度对权限管理分类</h3><p>✨从控制力度来看，可以将权限管理分为两大类：</p><div class="alert success no-icon"><ol><li>功能级权限管理</li><li>数据级权限管理</li></ol></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/821379-5bd8751eaba6ffca.webp" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/821379-5bd8751eaba6ffca.webp" alt=""></a></div><p>数据级权限管理<strong>某个用户能够访问和操作哪些数据</strong>。通常来说，数据权限由用户所属的组织来确定。比如：生产部只能看自己部门的生产数据；销售部门只能看销售数据。公司的总经理可以看所有的数据，<span class="highlight-text red">数据级权限管理间接性的保证了数据隔离</span>。在实际的业务系统中，数据权限往往更加复杂，非常有可能销售部门可以看生产部门的数据，以确定销售策略、安排计划等</p><div class="alert info no-icon"><p>为了面对复杂的需求，数据权限的控制通常是由程序员书写个性化的 SQL 来限制数据范围的，而不是交给权限模型来控制。当然也可以从权限模型或者权限框架的角度去解决这个问题，但适用性有限</p></div><h3 id="从控制方向对权限管理分类"><a class="header-anchor" href="#从控制方向对权限管理分类">¶</a>从控制方向对权限管理分类</h3><p>✨从控制方向来看，也可以将权限管理分为两大类：</p><div class="alert success no-icon"><ol><li>从系统获取数据，比如查询订单、查询客户资料</li><li>向系统提交数据，比如删除订单、修改客户资料</li></ol></div><h2 id="RBAC-模型概述"><a class="header-anchor" href="#RBAC-模型概述">¶</a>RBAC 模型概述</h2><p>RBAC 认为权限的过程可以抽象概括为：判断<span class="highlight-text red">Who 是否可以对 What 进行 How 的访问操作</span>这个逻辑表达式的值是否为<code>True</code>的求解过程，即将<strong>权限问题</strong>转换为<strong>Who、What、How 的问题</strong>。其中<code>who、what、how</code>构成了访问权限三元组</p><p>✨RBAC 支持公认的安全原则：<strong>最小特权原则</strong>、<strong>责任分离原则</strong>和<strong>数据抽象原则</strong></p><div class="alert success no-icon"><ul><li><strong>最小特权原则</strong>得到支持，是因为在 RBAC 模型中可以通过限制分配给角色权限的多少和大小来实现，分配给某用户对应的角色的权限只要不超过该用户完成其任务的需要就可以了</li><li><strong>责任分离原则</strong>得到支持，是因为在 RBAC 模型中可以通过<strong>在完成敏感任务过程中分配两个责任上互相约束的两个角色来实现</strong>，例如在清查账目时，只需要设置财务管理员和会计两个角色参加就可以了</li><li><strong>数据抽象</strong>得到支持，是借助于抽象许可权这样的概念实现的。如在账目管理活动中，可以使用信用、借方等抽象许可权，而不是使用操作系统提供的读、写、执行等具体的许可权。但 RBAC 并不强迫实现这些原则，安全管理员可以允许配置 RBAC 模型使它不支持这些原则。因此，RBAC 支持数据抽象的程度与 RBAC 模型的实现细节有关</li></ul></div><h3 id="RBAC-模型族"><a class="header-anchor" href="#RBAC-模型族">¶</a>RBAC 模型族</h3><p>✨RBAC96 是一个模型族，其中包括 RBAC0 ~ RBAC3 四个概念性模型：</p><div class="alert success no-icon"><ol><li>基本模型 RBAC0 定义了完全支持 RBAC 概念的任何系统的最低需求</li><li>RBAC1 和 RBAC2 两者都包含 RBAC0，但各自都增加了独立的特点，它们被称为高级模型。其中 RBAC1 中增加了角色分级的概念，一个角色可以从另一个角色继承许可权；RBAC2 中强调在 RBAC 的不同组件中配置方面的一些限制</li><li>RBAC3 称为统一模型，它包含了 RBAC1 和 RBAC2，利用传递性，也把 RBAC0 包括在内</li></ol></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171727177709875.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171727177709875.png" alt=""></a></div><h4 id="RBAC0"><a class="header-anchor" href="#RBAC0">¶</a>RBAC0</h4><div class="alert info no-icon"><p>RBAC0 定义了能构成一个 RBAC 控制系统的最小的元素集合，在 RBAC 之中,包含用户 users(USERS)、角色 roles(ROLES)、目标 objects(OBS)、操作 operations(OPS)、许可权 permissions(PRMS) 五个基本数据元素，此模型指明用户、角色、访问权限和会话之间的关系</p></div><table><thead><tr><th style="text-align:center">组件</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center">用户（User）</td><td style="text-align:center">系统接口及访问的操作者</td></tr><tr><td style="text-align:center">角色（Role）</td><td style="text-align:center">具有一类相同操作权限的用户的总称</td></tr><tr><td style="text-align:center">权限（Permission）</td><td style="text-align:center">能够访问某接口或者做某操作的授权资格</td></tr><tr><td style="text-align:center">会话（Session）</td><td style="text-align:center">RABC0 权限管理的核心部分，其他的版本都是建立在 RBAC0 的基础上的</td></tr></tbody></table><p>对应的 UML 类图如下：</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171727279428882.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171727279428882.png" alt=""></a></div><p>每个角色至少具备一个权限，每个用户至少扮演一个角色；可以对两个完全不同的角色分配完全相同的访问权限；会话由用户控制，一个用户可以创建会话并激活多个用户角色，从而获取相应的访问权限，用户可以在会话中更改激活角色，并且用户可以主动结束一个会话。用户和角色是多对多的关系，表示一个用户在不同的场景下可以拥有不同的角色</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171727283952955.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171727283952955.png" alt=""></a></div><p>例如项目经理也可以是项目架构师等；当然了一个角色可以给多个用户，例如一个项目中有多个组长，多个组员等</p><div class="alert info no-icon"><p>🎶将用户和权限进行分离，是彼此相互独立，使权限的授权认证更加灵活</p></div><p>角色和许可（权限）是多对多的关系，表示角色可以拥有多分权利，同一个权利可以授给多个角色都是非常容易理解的，想想现实生活中，当官的级别不同的权限的情景，其实这个模型就是对权限这方面的一个抽象，联系生活理解就非常容易了</p><h4 id="RBAC1"><a class="header-anchor" href="#RBAC1">¶</a>RBAC1</h4><div class="alert info no-icon"><p>RBAC1 基于 RBAC0 模型，引入角色间的继承关系，即角色之间有了上下级的区别，角色间的<strong>继承关系</strong>可分为<strong>一般继承关系</strong>和<strong>受限继承关系</strong>。这种模型合适于角色之间的层次明确，包含明确</p></div><p>🆚一般继承关系与受限继承关系异同</p><div class="alert success no-icon"><ul><li>一般继承关系仅要求角色继承关系是一个绝对偏序关系，允许角色间的多继承</li><li>受限继承关系则进一步要求角色继承关系是一个树结构，实现角色间的单继承</li></ul></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171728213791309.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171728213791309.png" alt=""></a></div><h4 id="RBAC2"><a class="header-anchor" href="#RBAC2">¶</a>RBAC2</h4><div class="alert info no-icon"><p>RBAC2 基于 RBAC0 模型进行了角色的访问控制</p></div><p>RBAC2 模型中添加了责任分离关系。RBAC2 的约束规定了权限被赋予角色时，或角色被赋予用户时，以及当用户在某一时刻激活一个角色时所应遵循的强制性规则。责任分离包括<strong>静态责任分离</strong>和<strong>动态责任分离</strong></p><p>约束与用户—角色—权限关系一起决定了 RBAC2 模型中用户的访问许可，此约束有多种：</p><div class="alert success no-icon"><ul><li><strong>互斥角色</strong> ：同一用户只能分配到一组互斥角色集合中至多一个角色，支持责任分离的原则。互斥角色是指各自权限互相制约的两个角色。对于这类角色一个用户在某一次活动中只能被分配其中的一个角色，不能同时获得两个角色的使用权。例如：在审计活动中，一个角色不能同时被指派给会计角色和审计员角色</li><li><strong>基数约束</strong> ：一个角色被分配的用户数量受限；一个用户可拥有的角色数目受限；同样一个角色对应的访问权限数目也应受限，以控制高级权限在系统中的分配</li><li><strong>先决条件角色</strong> ：可以分配角色给用户仅当该用户已经是另一角色的成员；对应的可以分配访问权限给角色，仅当该角色已经拥有另一种访问权限。要想获得较高的权限，要首先拥有低一级的权限</li><li><strong>运行时互斥</strong> ：例如，允许一个用户具有两个角色的成员资格，但在运行中不可同时激活这两个角色</li></ul></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171728235048924.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171728235048924.png" alt=""></a></div><h4 id="RBAC3"><a class="header-anchor" href="#RBAC3">¶</a>RBAC3</h4><div class="alert info no-icon"><p>RBAC3 是最全面级的权限管理，它是基于 RBAC0 的基础上，将 RBAC1 和 RBAC2 进行整合了，也是最复杂的，可以简单的理解：RBAC3 = RBAC1 + RBAC2</p></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171728248487668.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171728248487668.png" alt=""></a></div><h2 id="RBAC-的设计思路"><a class="header-anchor" href="#RBAC-的设计思路">¶</a>RBAC 的设计思路</h2><p>🎶一个 RBAC 权限模型核心授权逻辑仅考虑以下三点</p><div class="alert success no-icon"><ol><li>某用户扮演什么角色？</li><li>某角色具有什么权限？</li><li>通过角色的权限推到用户的权限</li></ol></div><p>以一个简单的场景（Gitlab 的权限系统）为例，用户系统中有 Admin、Maintainer、Operator 三种角色，这三种角色分别具备不同的权限，比如只有 Admin 具备创建代码仓库、删除代码仓库的权限，其他的角色都不具备</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/rbac_oneuser_mulrole.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/rbac_oneuser_mulrole.png" alt=""></a></div><p>授予某个用户 <strong>Admin</strong> 这个角色，他就具备了<span class="highlight-text red">创建代码仓库</span>和<span class="highlight-text red">删除代码仓库</span>这两个权限</p><p>基于角色的访问控制基本原理是在用户和访问权限之间加入角色这一层，实现用户和权限的分离，用户只有通过激活角色才能获得访问权限。通过角色对权限分组，大大简化了用户权限分配表，间接地实现了对用户的分组，提高了权限的分配效率。并且加入角色层后，访问控制机制更接近真实世界中的职业分配，便于权限管理</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211031194436350.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/image-20211031194436350.png" alt=""></a></div><p>在 RBAC 模型中，角色是系统根据管理中相对稳定的职权和责任来划分，每种角色可以完成一定的职能。用户通过饰演不同的角色获得角色所拥有的权限，一旦某个用户成为某角色的成员，则此用户可以完成该角色所具有的职能。通过将权限指定给角色而不是用户，在权限分派上提供了极大的灵活性和极细的权限指定粒度</p><h2 id="RBAC-用户角色权限设计方案"><a class="header-anchor" href="#RBAC-用户角色权限设计方案">¶</a>RBAC 用户角色权限设计方案</h2><p>一个用户拥有若干角色，每一个角色拥有若干权限。这样，就构造成<strong>用户-角色-权限</strong>的授权模型。在这种模型中，用户与角色之间，角色与权限之间，一般者是多对多的关系，如下图</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171735451928995.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/171735451928995.png" alt=""></a></div><p>❓到底什么是角色？</p><div class="alert success no-icon"><p>可以理解为一定数量的权限的集合，权限的载体。例如：一个论坛系统，<strong>超级管理员</strong>、<strong>版主</strong>都是角色。版主可管理版内的帖子、可管理版内的用户等，这些是权限。要给某个用户授予这些权限，不需要直接将权限授予用户，可将<strong>版主</strong>这个角色赋予该用户</p></div><p>当用户的数量非常大时，要给系统每个用户逐一授权（授角色），是件非常烦琐的事情。这时，就需要给用户分组，每个用户组内有多个用户。除了可给用户授权外，还可以给用户组授权。这样一来，用户拥有的所有权限，就是用户个人拥有的权限与该用户所在用户组拥有的权限之和。（下图为用户组、用户与角色三者的关联关系）</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839120364424.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839120364424.png" alt=""></a></div><p>❓在应用系统中，权限表现成什么？</p><div class="alert success no-icon"><p>对功能模块的操作，对上传文件的删改，菜单的访问，甚至页面上某个按钮、某个图片的可见性控制，都可属于权限的范畴。有些权限设计，会把功能操作作为一类，而把文件、菜单、页面元素等作为另一类，这样构成“用户-角色-权限-资源”的授权模型。而在做数据表建模时，可把功能操作和资源统一管理，也就是都直接与权限表进行关联，这样可能更具便捷性和易扩展性</p></div><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839137705455.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839137705455.png" alt=""></a></div><p>权限表中有一列<strong>权限类型</strong>，我们根据它的取值来区分是哪一类权限，如<code>MENU</code>表示菜单的访问权限、<code>OPERATION</code>表示功能模块的操作权限、<code>FILE</code>表示文件的修改权限、<code>ELEMENT</code>表示页面元素的可见性控制等。这样设计的好处有二</p><div class="alert success no-icon"><ol><li>不需要区分哪些是权限操作，哪些是资源，（实际上，有时候也不好区分，如菜单，把它理解为资源呢还是功能模块权限呢？）</li><li>方便扩展，当系统要对新的东西进行权限控制时，我只需要建立一个新的关联表<strong>权限 XX 关联表</strong>，并确定这类权限的权限类型字符串。</li></ol></div><p>🎶这里要注意的是，权限表与权限菜单关联表、权限菜单关联表与菜单表都是一对一的关系。（文件、页面权限点、功能操作等同理）。也就是每添加一个菜单，就得同时往这三个表中各插入一条记录。这样，可以不需要权限菜单关联表，让权限表与菜单表直接关联，此时，须在权限表中新增一列用来保存菜单的 ID，权限表通过<strong>权限类型</strong>和这个 ID 来区分是种类型下的哪条记录。如此，RBAC 权限模型的扩展模型的完整设计图如下：</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839156767770.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839156767770.png" alt=""></a></div><p>下图是另一种设计方案</p><div class="figure fig-100 center"><a class="fancybox" target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839188643344.png" data-caption="" data-fancybox="default"><img class="fig-img" src="https://cdn.jsdelivr.net/gh/pineapple-man/blogImage@main/image/180839188643344.png" alt=""></a></div><h2 id="角色组"><a class="header-anchor" href="#角色组">¶</a>角色组</h2><p>随着系统的日益庞大，为了方便管理，可引入角色组对角色进行分类管理，跟用户组不同，角色组不参与授权</p><div class="alert warning no-icon"><p>例如：某电网系统的权限管理模块中，角色就是挂在区局下，而区局在这里可当作角色组，它不参于权限分配。另外，为方便上面各主表自身的管理与查找，可采用树型结构，如菜单树、功能树等，当然这些可不需要参于权限分配。</p></div><p>❓角色和用户组有什么区别？</p><div class="alert success no-icon"><p>两者的主要差别是：用户组是用户的集合，但不是许可权的集合；而角色却同时具有用户集合和许可权集合的概念，角色的作用把这两个集合联系在一起的中间媒介</p><p>在一个系统中，如果用户组的许可权和成员仅可以被系统安全员修改的话，在这种机制下，用户组的机制是非常接近于角色的概念的。角色也可以在用户组的基础上实现，这有利于保持原有系统中的控制关系。在这种情况下，角色相当于一个策略部件，与用户组的授权及责任关系相联系，而用户组是实现角色的机制，因此，两者之间是策略与实现机制之间的关系</p></div><h2 id="如何选择合适的权限模型？"><a class="header-anchor" href="#如何选择合适的权限模型？">¶</a>如何选择合适的权限模型？</h2><span class="highlight-text red">组织的规模是至关重要的因素</span>。由于 ABAC 最初的设计和实施困难，对于小型企业而言，考虑起来可能太复杂了。<span class="highlight-text red">对于中小型企业，RBAC 是 ABAC 的简单替代方案</span>，每个用户都有一个唯一的角色，并具有相应的权限和限制。当用户转移到新角色时，其权限将更改为新职位的权限。这意味着，在明确定义角色的层次结构中，可以轻松管理少量内部和外部用户。<p>但是，当必须手动建立新角色时，对于大型组织而言，效率不高。一旦定义了属性和规则，当用户和利益相关者众多时，ABAC 的策略就更容易应用，同时还降低了安全风险</p><p>简而言之，如果满足以下条件，请选择 ABAC：</p><div class="alert success no-icon"><ul><li>在一个拥有许多用户的大型组织中</li><li>需要深入的特定访问控制功能</li><li>有时间投资远距离的模型</li><li>需要确保隐私和安全合规</li></ul></div><p>如果满足以下条件，请考虑 RBAC：</p><div class="alert success no-icon"><ul><li>所在的是中小型企业</li><li>访问控制策略广泛</li><li>外部用户很少，并且组织角色得到了明确定义</li></ul></div><h2 id="总结"><a class="header-anchor" href="#总结">¶</a>总结</h2><p>不良的权限管理系统，必然留下系统漏洞，给黑客可趁之机。很多软件可以轻松通过 URL 侵入、SQL 注入等模式，轻松越权获得未授权数据。甚至对系统数据进行修改、删除，造成巨大损失。很多系统，尤其是采用硬编码方式的系统，存在权限逻辑与业务代码紧密耦合，同时又分散在系统各个地方，系统漏洞势必非常多，而且随着系统不断修改，漏洞逐步增多。</p><p>好的系统，应该<span class="highlight-text red">将权限逻辑集中起来，由专业的安全引擎进行设置和解析</span>。业务逻辑调用安全引擎，获得权限结果，不再使用非专业模式。</p><h2 id="附录"><a class="header-anchor" href="#附录">¶</a>附录</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shijiaqi1066/p/3793894.html">权限系统与 RBAC 模型概述</a></p><p><a target="_blank" rel="noopener" href="https://docs.authing.cn/v2/guides/basics/authenticate-first-user/how-to-implement-access-control.html">如何对用户进行权限管理</a></p><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904004179230733">图文详解基于角色的权限控制模型 RBAC</a></p><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Role-based_access_control">Role-based access control wiki</a></p><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/47564944">产品 | 权限设计=功能权限+数据权限</a></p></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">标签</span><br><a class="tag tag--primary tag--small t-none-link" href="/tags/%E5%AE%89%E5%85%A8/" rel="tag">安全</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" data-tooltip="负载均衡解决方案" aria-label="上一篇: 负载均衡解决方案"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/jjwt/" data-tooltip="JJWT" aria-label="下一篇: JJWT"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></article><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2023 pineapple-man. All Rights Reserved.</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><br>Total <span id="busuanzi_value_site_pv"></span> views. 您是pineapple-man的第<span id="busuanzi_value_site_uv"></span>个小伙伴<br><i class="fas fa-book-open"></i> <span class="post-count">博客字数统计：370.7k</span><script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="5"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" data-tooltip="负载均衡解决方案" aria-label="上一篇: 负载均衡解决方案"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/jjwt/" data-tooltip="JJWT" aria-label="下一篇: JJWT"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-times"></i></div><img id="about-card-picture" src="/assets/images/logo.png" alt="作者的图片"><h4 id="about-card-name">pineapple-man</h4><div id="about-card-bio"><p>做一个菠萝：站得笔直，头戴王冠，内心甜美</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>刚毕业就失业</p></div><div id="about-card-location"><i class="fa fa-map-marker-alt"></i><br>西安</div></div></div><div id="cover" style="background-image:url(/assets/images/cover-v1.2.0.jpg)"></div><script src="/assets/js/script-kcoiyt1nxfue7qgcpkrcixymglcc3cuxeg98fy01hqww4nblnhd2ees6j6yc.min.js"></script></body></html>